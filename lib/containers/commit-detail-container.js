"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _yubikiri = _interopRequireDefault(require("yubikiri"));
var _eventKit = require("event-kit");
var _observeModel = _interopRequireDefault(require("../views/observe-model"));
var _loadingView = _interopRequireDefault(require("../views/loading-view"));
var _commitDetailController = _interopRequireDefault(require("../controllers/commit-detail-controller"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
class CommitDetailContainer extends _react.default.Component {
  constructor(props) {
    super(props);
    _defineProperty(this, "fetchData", repository => {
      return (0, _yubikiri.default)({
        commit: repository.getCommit(this.props.sha),
        currentBranch: repository.getCurrentBranch(),
        currentRemote: async query => repository.getRemoteForBranch((await query.currentBranch).getName()),
        isCommitPushed: repository.isCommitPushed(this.props.sha)
      });
    });
    _defineProperty(this, "renderResult", data => {
      const currentCommit = data && data.commit;
      if (currentCommit !== this.lastCommit) {
        this.sub.dispose();
        if (currentCommit && currentCommit.isPresent()) {
          this.sub = new _eventKit.CompositeDisposable(...currentCommit.getMultiFileDiff().getFilePatches().map(fp => fp.onDidChangeRenderStatus(() => {
            this.forceUpdate();
          })));
        }
        this.lastCommit = currentCommit;
      }
      if (this.props.repository.isLoading() || data === null || !data.commit.isPresent()) {
        return _react.default.createElement(_loadingView.default, null);
      }
      return _react.default.createElement(_commitDetailController.default, _extends({}, data, this.props));
    });
    this.lastCommit = null;
    this.sub = new _eventKit.CompositeDisposable();
  }
  render() {
    return _react.default.createElement(_observeModel.default, {
      model: this.props.repository,
      fetchData: this.fetchData
    }, this.renderResult);
  }
  componentWillUnmount() {
    this.sub.dispose();
  }
}
exports.default = CommitDetailContainer;
_defineProperty(CommitDetailContainer, "propTypes", {
  repository: _propTypes.default.object.isRequired,
  sha: _propTypes.default.string.isRequired,
  itemType: _propTypes.default.func.isRequired
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfeXViaWtpcmkiLCJfZXZlbnRLaXQiLCJfb2JzZXJ2ZU1vZGVsIiwiX2xvYWRpbmdWaWV3IiwiX2NvbW1pdERldGFpbENvbnRyb2xsZXIiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9leHRlbmRzIiwiT2JqZWN0IiwiYXNzaWduIiwiYmluZCIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsIl9kZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsInQiLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJyIiwiZSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiQ29tbWl0RGV0YWlsQ29udGFpbmVyIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwicmVwb3NpdG9yeSIsInl1YmlraXJpIiwiY29tbWl0IiwiZ2V0Q29tbWl0Iiwic2hhIiwiY3VycmVudEJyYW5jaCIsImdldEN1cnJlbnRCcmFuY2giLCJjdXJyZW50UmVtb3RlIiwicXVlcnkiLCJnZXRSZW1vdGVGb3JCcmFuY2giLCJnZXROYW1lIiwiaXNDb21taXRQdXNoZWQiLCJkYXRhIiwiY3VycmVudENvbW1pdCIsImxhc3RDb21taXQiLCJzdWIiLCJkaXNwb3NlIiwiaXNQcmVzZW50IiwiQ29tcG9zaXRlRGlzcG9zYWJsZSIsImdldE11bHRpRmlsZURpZmYiLCJnZXRGaWxlUGF0Y2hlcyIsIm1hcCIsImZwIiwib25EaWRDaGFuZ2VSZW5kZXJTdGF0dXMiLCJmb3JjZVVwZGF0ZSIsImlzTG9hZGluZyIsImNyZWF0ZUVsZW1lbnQiLCJyZW5kZXIiLCJtb2RlbCIsImZldGNoRGF0YSIsInJlbmRlclJlc3VsdCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZXhwb3J0cyIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJzdHJpbmciLCJpdGVtVHlwZSIsImZ1bmMiXSwic291cmNlcyI6WyJjb21taXQtZGV0YWlsLWNvbnRhaW5lci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB5dWJpa2lyaSBmcm9tICd5dWJpa2lyaSc7XG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2V2ZW50LWtpdCc7XG5cbmltcG9ydCBPYnNlcnZlTW9kZWwgZnJvbSAnLi4vdmlld3Mvb2JzZXJ2ZS1tb2RlbCc7XG5pbXBvcnQgTG9hZGluZ1ZpZXcgZnJvbSAnLi4vdmlld3MvbG9hZGluZy12aWV3JztcbmltcG9ydCBDb21taXREZXRhaWxDb250cm9sbGVyIGZyb20gJy4uL2NvbnRyb2xsZXJzL2NvbW1pdC1kZXRhaWwtY29udHJvbGxlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbW1pdERldGFpbENvbnRhaW5lciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgcmVwb3NpdG9yeTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHNoYTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGl0ZW1UeXBlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmxhc3RDb21taXQgPSBudWxsO1xuICAgIHRoaXMuc3ViID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgfVxuXG4gIGZldGNoRGF0YSA9IHJlcG9zaXRvcnkgPT4ge1xuICAgIHJldHVybiB5dWJpa2lyaSh7XG4gICAgICBjb21taXQ6IHJlcG9zaXRvcnkuZ2V0Q29tbWl0KHRoaXMucHJvcHMuc2hhKSxcbiAgICAgIGN1cnJlbnRCcmFuY2g6IHJlcG9zaXRvcnkuZ2V0Q3VycmVudEJyYW5jaCgpLFxuICAgICAgY3VycmVudFJlbW90ZTogYXN5bmMgcXVlcnkgPT4gcmVwb3NpdG9yeS5nZXRSZW1vdGVGb3JCcmFuY2goKGF3YWl0IHF1ZXJ5LmN1cnJlbnRCcmFuY2gpLmdldE5hbWUoKSksXG4gICAgICBpc0NvbW1pdFB1c2hlZDogcmVwb3NpdG9yeS5pc0NvbW1pdFB1c2hlZCh0aGlzLnByb3BzLnNoYSksXG4gICAgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxPYnNlcnZlTW9kZWwgbW9kZWw9e3RoaXMucHJvcHMucmVwb3NpdG9yeX0gZmV0Y2hEYXRhPXt0aGlzLmZldGNoRGF0YX0+XG4gICAgICAgIHt0aGlzLnJlbmRlclJlc3VsdH1cbiAgICAgIDwvT2JzZXJ2ZU1vZGVsPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJSZXN1bHQgPSBkYXRhID0+IHtcbiAgICBjb25zdCBjdXJyZW50Q29tbWl0ID0gZGF0YSAmJiBkYXRhLmNvbW1pdDtcbiAgICBpZiAoY3VycmVudENvbW1pdCAhPT0gdGhpcy5sYXN0Q29tbWl0KSB7XG4gICAgICB0aGlzLnN1Yi5kaXNwb3NlKCk7XG4gICAgICBpZiAoY3VycmVudENvbW1pdCAmJiBjdXJyZW50Q29tbWl0LmlzUHJlc2VudCgpKSB7XG4gICAgICAgIHRoaXMuc3ViID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoXG4gICAgICAgICAgLi4uY3VycmVudENvbW1pdC5nZXRNdWx0aUZpbGVEaWZmKCkuZ2V0RmlsZVBhdGNoZXMoKS5tYXAoZnAgPT4gZnAub25EaWRDaGFuZ2VSZW5kZXJTdGF0dXMoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICAgICAgICAgIH0pKSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubGFzdENvbW1pdCA9IGN1cnJlbnRDb21taXQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMucmVwb3NpdG9yeS5pc0xvYWRpbmcoKSB8fCBkYXRhID09PSBudWxsIHx8ICFkYXRhLmNvbW1pdC5pc1ByZXNlbnQoKSkge1xuICAgICAgcmV0dXJuIDxMb2FkaW5nVmlldyAvPjtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbW1pdERldGFpbENvbnRyb2xsZXJcbiAgICAgICAgey4uLmRhdGF9XG4gICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5zdWIuZGlzcG9zZSgpO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFVBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLFNBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLFNBQUEsR0FBQUgsT0FBQTtBQUVBLElBQUFJLGFBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLFlBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLHVCQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFBNkUsU0FBQUQsdUJBQUFRLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFBQSxTQUFBRyxTQUFBLElBQUFBLFFBQUEsR0FBQUMsTUFBQSxDQUFBQyxNQUFBLEdBQUFELE1BQUEsQ0FBQUMsTUFBQSxDQUFBQyxJQUFBLGVBQUFDLE1BQUEsYUFBQUMsQ0FBQSxNQUFBQSxDQUFB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