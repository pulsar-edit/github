"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _path = _interopRequireDefault(require("path"));
var _electron = require("electron");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
let headless = null;
class EventLogger {
  constructor(kind) {
    this.kind = kind;
    this.directory = '<unknown>';
    this.shortDirectory = '<unknown>';
    if (headless === null) {
      headless = !_electron.remote.getCurrentWindow().isVisible();
    }
  }
  showStarted(directory, implementation) {
    this.directory = directory;
    this.shortDirectory = directory.split(_path.default.sep).slice(-2).join(_path.default.sep);
    if (!this.isEnabled()) {
      return;
    }
    this.shortLog(`${implementation} watcher started`);
  }
  showEvents(events) {
    if (!this.isEnabled()) {
      return;
    }
    const uniqueRelativeNames = new Set(events.map(event => {
      return _path.default.relative(this.directory, event.path);
    }));
    const fileNames = Array.from(uniqueRelativeNames).slice(0, 3);
    const elipses = uniqueRelativeNames.size > 3 ? '...' : '';
    const summary = `${this.getShortName()}: ${fileNames.join(', ')}${elipses}`;

    /* eslint-disable no-console */
    if (headless) {
      const eventText = events.map(event => {
        if (event.action === 'renamed') {
          return `  ${event.oldPath} => ${event.path} (${event.action})\n`;
        } else {
          return `  ${event.path} (${event.action})\n`;
        }
      }).join('\n');
      console.log(summary + '\n' + eventText);
    } else {
      console.groupCollapsed(summary);
      console.table(events, ['action', 'path', 'oldPath']);
      console.groupEnd();
    }
    /* eslint-enable no-console */
  }
  showFocusEvent() {
    if (!this.isEnabled()) {
      return;
    }
    this.shortLog('focus triggered');
  }
  showWorkdirOrHeadEvents() {
    if (!this.isEnabled()) {
      return;
    }
    this.shortLog('working directory or HEAD change');
  }
  showStopped() {
    if (!this.isEnabled()) {
      return;
    }
    this.shortLog('stopped');
  }
  isEnabled() {
    return process.env.ATOM_GITHUB_FS_EVENT_LOG || atom.config.get('github.filesystemEventDiagnostics');
  }
  getShortName() {
    return `${this.kind} @ ${this.shortDirectory}`;
  }
  shortLog(line) {
    if (headless) {
      // eslint-disable-next-line no-console
      console.log(`${this.getShortName()}: ${line}`);
      return;
    }

    // eslint-disable-next-line no-console
    console.log('%c%s%c: %s', 'font-weight: bold; color: blue;', this.getShortName(), 'font-weight: normal; color: black;', line);
  }
}
exports.default = EventLogger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcGF0aCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2VsZWN0cm9uIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJoZWFkbGVzcyIsIkV2ZW50TG9nZ2VyIiwiY29uc3RydWN0b3IiLCJraW5kIiwiZGlyZWN0b3J5Iiwic2hvcnREaXJlY3RvcnkiLCJyZW1vdGUiLCJnZXRDdXJyZW50V2luZG93IiwiaXNWaXNpYmxlIiwic2hvd1N0YXJ0ZWQiLCJpbXBsZW1lbnRhdGlvbiIsInNwbGl0IiwicGF0aCIsInNlcCIsInNsaWNlIiwiam9pbiIsImlzRW5hYmxlZCIsInNob3J0TG9nIiwic2hvd0V2ZW50cyIsImV2ZW50cyIsInVuaXF1ZVJlbGF0aXZlTmFtZXMiLCJTZXQiLCJtYXAiLCJldmVudCIsInJlbGF0aXZlIiwiZmlsZU5hbWVzIiwiQXJyYXkiLCJmcm9tIiwiZWxpcHNlcyIsInNpemUiLCJzdW1tYXJ5IiwiZ2V0U2hvcnROYW1lIiwiZXZlbnRUZXh0IiwiYWN0aW9uIiwib2xkUGF0aCIsImNvbnNvbGUiLCJsb2ciLCJncm91cENvbGxhcHNlZCIsInRhYmxlIiwiZ3JvdXBFbmQiLCJzaG93Rm9jdXNFdmVudCIsInNob3dXb3JrZGlyT3JIZWFkRXZlbnRzIiwic2hvd1N0b3BwZWQiLCJwcm9jZXNzIiwiZW52IiwiQVRPTV9HSVRIVUJfRlNfRVZFTlRfTE9HIiwiYXRvbSIsImNvbmZpZyIsImdldCIsImxpbmUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiZXZlbnQtbG9nZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtyZW1vdGV9IGZyb20gJ2VsZWN0cm9uJztcblxubGV0IGhlYWRsZXNzID0gbnVsbDtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXZlbnRMb2dnZXIge1xuICBjb25zdHJ1Y3RvcihraW5kKSB7XG4gICAgdGhpcy5raW5kID0ga2luZDtcbiAgICB0aGlzLmRpcmVjdG9yeSA9ICc8dW5rbm93bj4nO1xuICAgIHRoaXMuc2hvcnREaXJlY3RvcnkgPSAnPHVua25vd24+JztcblxuICAgIGlmIChoZWFkbGVzcyA9PT0gbnVsbCkge1xuICAgICAgaGVhZGxlc3MgPSAhcmVtb3RlLmdldEN1cnJlbnRXaW5kb3coKS5pc1Zpc2libGUoKTtcbiAgICB9XG4gIH1cblxuICBzaG93U3RhcnRlZChkaXJlY3RvcnksIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdGhpcy5kaXJlY3RvcnkgPSBkaXJlY3Rvcnk7XG4gICAgdGhpcy5zaG9ydERpcmVjdG9yeSA9IGRpcmVjdG9yeS5zcGxpdChwYXRoLnNlcCkuc2xpY2UoLTIpLmpvaW4ocGF0aC5zZXApO1xuXG4gICAgaWYgKCF0aGlzLmlzRW5hYmxlZCgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zaG9ydExvZyhgJHtpbXBsZW1lbnRhdGlvbn0gd2F0Y2hlciBzdGFydGVkYCk7XG4gIH1cblxuICBzaG93RXZlbnRzKGV2ZW50cykge1xuICAgIGlmICghdGhpcy5pc0VuYWJsZWQoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHVuaXF1ZVJlbGF0aXZlTmFtZXMgPSBuZXcgU2V0KGV2ZW50cy5tYXAoZXZlbnQgPT4ge1xuICAgICAgcmV0dXJuIHBhdGgucmVsYXRpdmUodGhpcy5kaXJlY3RvcnksIGV2ZW50LnBhdGgpO1xuICAgIH0pKTtcblxuICAgIGNvbnN0IGZpbGVOYW1lcyA9IEFycmF5LmZyb20odW5pcXVlUmVsYXRpdmVOYW1lcykuc2xpY2UoMCwgMyk7XG4gICAgY29uc3QgZWxpcHNlcyA9IHVuaXF1ZVJlbGF0aXZlTmFtZXMuc2l6ZSA+IDMgPyAnLi4uJyA6ICcnO1xuICAgIGNvbnN0IHN1bW1hcnkgPSBgJHt0aGlzLmdldFNob3J0TmFtZSgpfTogJHtmaWxlTmFtZXMuam9pbignLCAnKX0ke2VsaXBzZXN9YDtcblxuICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbiAgICBpZiAoaGVhZGxlc3MpIHtcbiAgICAgIGNvbnN0IGV2ZW50VGV4dCA9IGV2ZW50cy5tYXAoZXZlbnQgPT4ge1xuICAgICAgICBpZiAoZXZlbnQuYWN0aW9uID09PSAncmVuYW1lZCcpIHtcbiAgICAgICAgICByZXR1cm4gYCAgJHtldmVudC5vbGRQYXRofSA9PiAke2V2ZW50LnBhdGh9ICgke2V2ZW50LmFjdGlvbn0pXFxuYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gYCAgJHtldmVudC5wYXRofSAoJHtldmVudC5hY3Rpb259KVxcbmA7XG4gICAgICAgIH1cbiAgICAgIH0pLmpvaW4oJ1xcbicpO1xuICAgICAgY29uc29sZS5sb2coc3VtbWFyeSArICdcXG4nICsgZXZlbnRUZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZChzdW1tYXJ5KTtcbiAgICAgIGNvbnNvbGUudGFibGUoZXZlbnRzLCBbJ2FjdGlvbicsICdwYXRoJywgJ29sZFBhdGgnXSk7XG4gICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgfVxuICAgIC8qIGVzbGludC1lbmFibGUgbm8tY29uc29sZSAqL1xuICB9XG5cbiAgc2hvd0ZvY3VzRXZlbnQoKSB7XG4gICAgaWYgKCF0aGlzLmlzRW5hYmxlZCgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zaG9ydExvZygnZm9jdXMgdHJpZ2dlcmVkJyk7XG4gIH1cblxuICBzaG93V29ya2Rpck9ySGVhZEV2ZW50cygpIHtcbiAgICBpZiAoIXRoaXMuaXNFbmFibGVkKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNob3J0TG9nKCd3b3JraW5nIGRpcmVjdG9yeSBvciBIRUFEIGNoYW5nZScpO1xuICB9XG5cbiAgc2hvd1N0b3BwZWQoKSB7XG4gICAgaWYgKCF0aGlzLmlzRW5hYmxlZCgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zaG9ydExvZygnc3RvcHBlZCcpO1xuICB9XG5cbiAgaXNFbmFibGVkKCkge1xuICAgIHJldHVybiBwcm9jZXNzLmVudi5BVE9NX0dJVEhVQl9GU19FVkVOVF9MT0cgfHwgYXRvbS5jb25maWcuZ2V0KCdnaXRodWIuZmlsZXN5c3RlbUV2ZW50RGlhZ25vc3RpY3MnKTtcbiAgfVxuXG4gIGdldFNob3J0TmFtZSgpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5raW5kfSBAICR7dGhpcy5zaG9ydERpcmVjdG9yeX1gO1xuICB9XG5cbiAgc2hvcnRMb2cobGluZSkge1xuICAgIGlmIChoZWFkbGVzcykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuZ2V0U2hvcnROYW1lKCl9OiAke2xpbmV9YCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLmxvZygnJWMlcyVjOiAlcycsXG4gICAgICAnZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiBibHVlOycsXG4gICAgICB0aGlzLmdldFNob3J0TmFtZSgpLFxuICAgICAgJ2ZvbnQtd2VpZ2h0OiBub3JtYWw7IGNvbG9yOiBibGFjazsnLFxuICAgICAgbGluZSxcbiAgICApO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLEtBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFNBQUEsR0FBQUQsT0FBQTtBQUFnQyxTQUFBRCx1QkFBQUcsR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLEtBQUFFLE9BQUEsRUFBQUYsR0FBQTtBQUVoQyxJQUFJRyxRQUFRLEdBQUcsSUFBSTtBQUVKLE1BQU1DLFdBQVcsQ0FBQztFQUMvQkMsV0FBV0EsQ0FBQ0MsSUFBSSxFQUFFO0lBQ2hCLElBQUksQ0FBQ0Es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