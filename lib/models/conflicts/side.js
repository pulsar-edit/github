"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _markerTools = require("./marker-tools");
class Side {
  constructor(editor, marker, blockMarker, source, position, banner, originalText) {
    this.editor = editor;
    this.marker = marker;
    this.blockMarker = blockMarker;
    this.source = source;
    this.position = position;
    this.banner = banner;
    this.originalText = originalText;
  }
  getMarker() {
    return this.marker;
  }
  getBannerMarker() {
    return this.banner.getMarker();
  }
  getSource() {
    return this.source;
  }
  getBlockMarker() {
    return this.blockMarker;
  }
  getBlockPosition() {
    return this.position.when({
      top: () => 'before',
      middle: () => 'before',
      bottom: () => 'after'
    });
  }
  getLineCSSClass() {
    if (this.isModified() || this.isBannerModified()) {
      return 'github-ConflictModified';
    } else {
      return this.source.getCSSClass();
    }
  }
  getBannerCSSClass() {
    if (this.isModified() || this.isBannerModified()) {
      return 'github-ConflictModifiedBanner';
    } else {
      return this.source.getBannerCSSClass();
    }
  }
  getBlockCSSClasses() {
    const cxs = ['github-ConflictBlock'];
    cxs.push(this.source.getBlockCSSClass());
    cxs.push(this.position.getBlockCSSClass());
    if (this.isModified() || this.isBannerModified()) {
      cxs.push('github-ConflictModifiedBlock');
    }
    return cxs.join(' ');
  }
  getPosition() {
    return this.position;
  }
  getRange() {
    const bannerRange = this.banner.getRange();
    const bodyRange = this.marker.getBufferRange();
    return bannerRange.union(bodyRange);
  }
  includesPoint(point) {
    return this.getRange().containsPoint(point);
  }
  getText() {
    return this.editor.getTextInBufferRange(this.getMarker().getBufferRange());
  }
  isBannerModified() {
    return this.banner.isModified();
  }
  isModified() {
    return this.getText() !== this.originalText;
  }
  isEmpty() {
    return this.marker.getBufferRange().isEmpty();
  }
  revertBanner() {
    this.banner.revert();
  }
  revert() {
    const range = this.getMarker().getBufferRange();
    this.editor.setTextInBufferRange(range, this.originalText);
    this.getMarker().setBufferRange(range);
  }
  deleteBanner() {
    this.banner.delete();
  }
  delete() {
    (0, _markerTools.deleteMarkerIn)(this.getMarker(), this.editor);
  }
  appendText(text) {
    const insertionPoint = this.getMarker().getBufferRange().end;
    return this.editor.setTextInBufferRange([insertionPoint, insertionPoint], text);
  }
}
exports.default = Side;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaWRlIiwiY29uc3RydWN0b3IiLCJlZGl0b3IiLCJtYXJrZXIiLCJibG9ja01hcmtlciIsInNvdXJjZSIsInBvc2l0aW9uIiwiYmFubmVyIiwib3JpZ2luYWxUZXh0IiwiZ2V0TWFya2VyIiwiZ2V0QmFubmVyTWFya2VyIiwiZ2V0U291cmNlIiwiZ2V0QmxvY2tNYXJrZXIiLCJnZXRCbG9ja1Bvc2l0aW9uIiwid2hlbiIsInRvcCIsIm1pZGRsZSIsImJvdHRvbSIsImdldExpbmVDU1NDbGFzcyIsImlzTW9kaWZpZWQiLCJpc0Jhbm5lck1vZGlmaWVkIiwiZ2V0Q1NTQ2xhc3MiLCJnZXRCYW5uZXJDU1NDbGFzcyIsImdldEJsb2NrQ1NTQ2xhc3NlcyIsImN4cyIsInB1c2giLCJnZXRCbG9ja0NTU0NsYXNzIiwiam9pbiIsImdldFBvc2l0aW9uIiwiZ2V0UmFuZ2UiLCJiYW5uZXJSYW5nZSIsImJvZHlSYW5nZSIsImdldEJ1ZmZlclJhbmdlIiwidW5pb24iLCJpbmNsdWRlc1BvaW50IiwicG9pbnQiLCJjb250YWluc1BvaW50IiwiZ2V0VGV4dCIsImdldFRleHRJbkJ1ZmZlclJhbmdlIiwiaXNFbXB0eSIsInJldmVydEJhbm5lciIsInJldmVydCIsInJhbmdlIiwic2V0VGV4dEluQnVmZmVyUmFuZ2UiLCJzZXRCdWZmZXJSYW5nZSIsImRlbGV0ZUJhbm5lciIsImRlbGV0ZSIsImRlbGV0ZU1hcmtlckluIiwiYXBwZW5kVGV4dCIsInRleHQiLCJpbnNlcnRpb25Qb2ludCIsImVuZCJdLCJzb3VyY2VzIjpbInNpZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtkZWxldGVNYXJrZXJJbn0gZnJvbSAnLi9tYXJrZXItdG9vbHMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaWRlIHtcbiAgY29uc3RydWN0b3IoZWRpdG9yLCBtYXJrZXIsIGJsb2NrTWFya2VyLCBzb3VyY2UsIHBvc2l0aW9uLCBiYW5uZXIsIG9yaWdpbmFsVGV4dCkge1xuICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICAgIHRoaXMubWFya2VyID0gbWFya2VyO1xuICAgIHRoaXMuYmxvY2tNYXJrZXIgPSBibG9ja01hcmtlcjtcbiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgdGhpcy5iYW5uZXIgPSBiYW5uZXI7XG4gICAgdGhpcy5vcmlnaW5hbFRleHQgPSBvcmlnaW5hbFRleHQ7XG4gIH1cblxuICBnZXRNYXJrZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMubWFya2VyO1xuICB9XG5cbiAgZ2V0QmFubmVyTWFya2VyKCkge1xuICAgIHJldHVybiB0aGlzLmJhbm5lci5nZXRNYXJrZXIoKTtcbiAgfVxuXG4gIGdldFNvdXJjZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zb3VyY2U7XG4gIH1cblxuICBnZXRCbG9ja01hcmtlcigpIHtcbiAgICByZXR1cm4gdGhpcy5ibG9ja01hcmtlcjtcbiAgfVxuXG4gIGdldEJsb2NrUG9zaXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucG9zaXRpb24ud2hlbih7XG4gICAgICB0b3A6ICgpID0+ICdiZWZvcmUnLFxuICAgICAgbWlkZGxlOiAoKSA9PiAnYmVmb3JlJyxcbiAgICAgIGJvdHRvbTogKCkgPT4gJ2FmdGVyJyxcbiAgICB9KTtcbiAgfVxuXG4gIGdldExpbmVDU1NDbGFzcygpIHtcbiAgICBpZiAodGhpcy5pc01vZGlmaWVkKCkgfHwgdGhpcy5pc0Jhbm5lck1vZGlmaWVkKCkpIHtcbiAgICAgIHJldHVybiAnZ2l0aHViLUNvbmZsaWN0TW9kaWZpZWQnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2UuZ2V0Q1NTQ2xhc3MoKTtcbiAgICB9XG4gIH1cblxuICBnZXRCYW5uZXJDU1NDbGFzcygpIHtcbiAgICBpZiAodGhpcy5pc01vZGlmaWVkKCkgfHwgdGhpcy5pc0Jhbm5lck1vZGlmaWVkKCkpIHtcbiAgICAgIHJldHVybiAnZ2l0aHViLUNvbmZsaWN0TW9kaWZpZWRCYW5uZXInO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2UuZ2V0QmFubmVyQ1NTQ2xhc3MoKTtcbiAgICB9XG4gIH1cblxuICBnZXRCbG9ja0NTU0NsYXNzZXMoKSB7XG4gICAgY29uc3QgY3hzID0gWydnaXRodWItQ29uZmxpY3RCbG9jayddO1xuICAgIGN4cy5wdXNoKHRoaXMuc291cmNlLmdldEJsb2NrQ1NTQ2xhc3MoKSk7XG4gICAgY3hzLnB1c2godGhpcy5wb3NpdGlvbi5nZXRCbG9ja0NTU0NsYXNzKCkpO1xuICAgIGlmICh0aGlzLmlzTW9kaWZpZWQoKSB8fCB0aGlzLmlzQmFubmVyTW9kaWZpZWQoKSkge1xuICAgICAgY3hzLnB1c2goJ2dpdGh1Yi1Db25mbGljdE1vZGlmaWVkQmxvY2snKTtcbiAgICB9XG4gICAgcmV0dXJuIGN4cy5qb2luKCcgJyk7XG4gIH1cblxuICBnZXRQb3NpdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5wb3NpdGlvbjtcbiAgfVxuXG4gIGdldFJhbmdlKCkge1xuICAgIGNvbnN0IGJhbm5lclJhbmdlID0gdGhpcy5iYW5uZXIuZ2V0UmFuZ2UoKTtcbiAgICBjb25zdCBib2R5UmFuZ2UgPSB0aGlzLm1hcmtlci5nZXRCdWZmZXJSYW5nZSgpO1xuICAgIHJldHVybiBiYW5uZXJSYW5nZS51bmlvbihib2R5UmFuZ2UpO1xuICB9XG5cbiAgaW5jbHVkZXNQb2ludChwb2ludCkge1xuICAgIHJldHVybiB0aGlzLmdldFJhbmdlKCkuY29udGFpbnNQb2ludChwb2ludCk7XG4gIH1cblxuICBnZXRUZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZSh0aGlzLmdldE1hcmtlcigpLmdldEJ1ZmZlclJhbmdlKCkpO1xuICB9XG5cbiAgaXNCYW5uZXJNb2RpZmllZCgpIHtcbiAgICByZXR1cm4gdGhpcy5iYW5uZXIuaXNNb2RpZmllZCgpO1xuICB9XG5cbiAgaXNNb2RpZmllZCgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRUZXh0KCkgIT09IHRoaXMub3JpZ2luYWxUZXh0O1xuICB9XG5cbiAgaXNFbXB0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXJrZXIuZ2V0QnVmZmVyUmFuZ2UoKS5pc0VtcHR5KCk7XG4gIH1cblxuICByZXZlcnRCYW5uZXIoKSB7XG4gICAgdGhpcy5iYW5uZXIucmV2ZXJ0KCk7XG4gIH1cblxuICByZXZlcnQoKSB7XG4gICAgY29uc3QgcmFuZ2UgPSB0aGlzLmdldE1hcmtlcigpLmdldEJ1ZmZlclJhbmdlKCk7XG4gICAgdGhpcy5lZGl0b3Iuc2V0VGV4dEluQnVmZmVyUmFuZ2UocmFuZ2UsIHRoaXMub3JpZ2luYWxUZXh0KTtcbiAgICB0aGlzLmdldE1hcmtlcigpLnNldEJ1ZmZlclJhbmdlKHJhbmdlKTtcbiAgfVxuXG4gIGRlbGV0ZUJhbm5lcigpIHtcbiAgICB0aGlzLmJhbm5lci5kZWxldGUoKTtcbiAgfVxuXG4gIGRlbGV0ZSgpIHtcbiAgICBkZWxldGVNYXJrZXJJbih0aGlzLmdldE1hcmtlcigpLCB0aGlzLmVkaXRvcik7XG4gIH1cblxuICBhcHBlbmRUZXh0KHRleHQpIHtcbiAgICBjb25zdCBpbnNlcnRpb25Qb2ludCA9IHRoaXMuZ2V0TWFya2VyKCkuZ2V0QnVmZmVyUmFuZ2UoKS5lbmQ7XG4gICAgcmV0dXJuIHRoaXMuZWRpdG9yLnNldFRleHRJbkJ1ZmZlclJhbmdlKFtpbnNlcnRpb25Qb2ludCwgaW5zZXJ0aW9uUG9pbnRdLCB0ZXh0KTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUVlLE1BQU1BLElBQUksQ0FBQztFQUN4QkMsV0FBVyxDQUFDQyxNQUFNLEVBQUVDLE1BQU0sRUFBRUMsV0FBVyxFQUFFQyxNQUFNLEVBQUVDLFFBQVEsRUFBRUMsTUFBTSxFQUFFQyxZQUFZLEVBQUU7SUFDL0UsSUFBSSxDQUFDTixNQUFNLEdBQUdBLE1BQU07SUFDcEIsSUFBSSxDQUFDQyxNQUFNLEdBQUdBLE1BQU07SUFDcEIsSUFBSSxD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