"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _position = require("./position");
var _source = require("./source");
var _side = _interopRequireDefault(require("./side"));
var _banner = _interopRequireDefault(require("./banner"));
var _separator = _interopRequireDefault(require("./separator"));
var _parser = require("./parser");
var _adapter = require("./parser/adapter");
var _noopVisitor = require("./parser/noop-visitor");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
// Regular expression that matches the beginning of a potential conflict.
const CONFLICT_START_REGEX = /^<{7} ([^\r\n]+)\r?\n/g;

/*
 * Conflict parser visitor that marks each buffer range and assembles a Conflict from the
 * pieces.
 */
class ConflictVisitor {
  /*
   * editor - [TextEditor] displaying the conflicting text.
   * layer - [DisplayMarkerLayer] to created conflict markers on.
   */
  constructor(editor, layer) {
    this.editor = editor;
    this.layer = layer;
    this.ours = null;
    this.base = null;
    this.separator = null;
    this.theirs = null;
  }

  /*
   * position - [Position] one of TOP or BOTTOM.
   * bannerRow - [Integer] of the buffer row that contains our side's banner.
   * textRowStart - [Integer] of the first buffer row that contain this side's text.
   * textRowEnd - [Integer] of the first buffer row beyond the extend of this side's text.
   */
  visitOurSide(position, bannerRow, textRowStart, textRowEnd) {
    this.ours = this.markSide(position, _source.OURS, bannerRow, textRowStart, textRowEnd);
  }

  /*
   * bannerRow - [Integer] the buffer row that contains our side's banner.
   * textRowStart - [Integer] first buffer row that contain this side's text.
   * textRowEnd - [Integer] first buffer row beyond the extend of this side's text.
   */
  visitBaseSide(bannerRow, textRowStart, textRowEnd) {
    this.base = this.markSide(_position.MIDDLE, _source.BASE, bannerRow, textRowStart, textRowEnd);
  }

  /*
   * sepRowStart - [Integer] buffer row that contains the "=======" separator.
   */
  visitSeparator(sepRowStart) {
    const marker = this.layer.markBufferRange([[sepRowStart, 0], [sepRowStart + 1, 0]], {
      invalidate: 'surround',
      exclusive: true
    });
    this.separator = new _separator.default(this.editor, marker);
  }

  /*
   * position - [Position] alignment within the conflict marker: TOP or BOTTOM.
   * bannerRow - [Integer] the buffer row that contains our side's banner.
   * textRowStart - [Integer] first buffer row that contain this side's text.
   * textRowEnd - [Integer] first buffer row beyond the extent of this side's text.
   */
  visitTheirSide(position, bannerRow, textRowStart, textRowEnd) {
    this.theirs = this.markSide(position, _source.THEIRS, bannerRow, textRowStart, textRowEnd);
  }
  markSide(position, source, bannerRow, textRowStart, textRowEnd) {
    const blockCol = position.when({
      top: () => 0,
      middle: () => 0,
      bottom: () => this.editor.lineTextForBufferRow(bannerRow).length
    });
    const blockRange = [[bannerRow, blockCol], [bannerRow, blockCol]];
    const blockMarker = this.layer.markBufferRange(blockRange, {
      invalidate: 'surround',
      exclusive: true
    });
    const description = this.sideDescription(bannerRow);
    const bannerRange = [[bannerRow, 0], [bannerRow + 1, 0]];
    const bannerMarker = this.layer.markBufferRange(bannerRange, {
      invalidate: 'surround',
      exclusive: true
    });
    const originalBannerText = this.editor.getTextInBufferRange(bannerRange);
    const banner = new _banner.default(this.editor, bannerMarker, description, originalBannerText);
    const textRange = [[textRowStart, 0], [textRowEnd, 0]];
    const sideMarker = this.layer.markBufferRange(textRange, {
      invalidate: 'surround',
      exclusive: false
    });
    const originalText = this.editor.getTextInBufferRange(textRange);
    return new _side.default(this.editor, sideMarker, blockMarker, source, position, banner, originalText);
  }

  /*
   * Parse the banner description for the current side from a banner row.
   *
   * bannerRow - [Integer] buffer row containing the <, |, or > marker
   */
  sideDescription(bannerRow) {
    return this.editor.lineTextForBufferRow(bannerRow).match(/^[<|>]{7} (.*)$/)[1];
  }
  conflict() {
    return new Conflict(this.ours, this.separator, this.base, this.theirs);
  }
}
class Conflict {
  constructor(ours, separator, base, theirs) {
    this.separator = separator;
    this.bySource = {};
    this.byPosition = {};
    [ours, base, theirs].forEach(side => {
      if (!side) {
        return;
      }
      this.bySource[side.getSource().getName()] = side;
      this.byPosition[side.getPosition().getName()] = side;
    });
    this.resolution = null;
  }
  getKey() {
    return this.getSide(_source.OURS).getMarker().id;
  }
  isResolved() {
    return this.resolution !== null;
  }
  resolveAs(source) {
    this.resolution = this.getSide(source);
  }
  getSides() {
    return ['ours', 'base', 'theirs'].map(sourceName => this.bySource[sourceName]).filter(side => side);
  }
  getChosenSide() {
    return this.resolution;
  }
  getUnchosenSides() {
    return this.getSides().filter(side => side !== this.resolution);
  }
  getSide(source) {
    return this.bySource[source.getName()];
  }

  /*
   * Return a `Side` containing a buffer point, or `undefined` if none do.
   */
  getSideContaining(point) {
    return this.getSides().find(side => side.includesPoint(point));
  }

  /*
   * Return a `Range` that encompasses the entire Conflict region.
   */
  getRange() {
    const topRange = this.byPosition.top.getRange();
    const bottomRange = this.byPosition.bottom.getRange();
    return topRange.union(bottomRange);
  }

  /*
   * Determine whether or not a buffer position is contained within this conflict.
   */
  includesPoint(point) {
    return this.getRange().containsPoint(point);
  }

  /*
   * Return the `DisplayMarker` that immediately follows the `Side` in a given `Position`. Return `null` if no such
   * marker exists.
   */
  markerAfter(position) {
    return position.when({
      top: () => this.byPosition.middle ? this.byPosition.middle.getBannerMarker() : this.getSeparator().getMarker(),
      middle: () => this.getSeparator().getMarker(),
      bottom: () => this.byPosition.bottom.getBannerMarker()
    });
  }
  getSeparator() {
    return this.separator;
  }

  /*
   * Parse any conflict markers in a TextEditor's buffer and return a Conflict that contains markers corresponding to
   * each.
   *
   * editor [TextEditor] The editor to search.
   * layer [DisplayMarkerLayer] Marker layer to create markers on.
   * return [Array<Conflict>] A (possibly empty) collection of parsed Conflicts.
   */
  static allFromEditor(editor, layer, isRebase) {
    const conflicts = [];
    let lastRow = -1;
    editor.getBuffer().scan(CONFLICT_START_REGEX, m => {
      const conflictStartRow = m.range.start.row;
      if (conflictStartRow < lastRow) {
        // Match within an already-parsed conflict.
        return;
      }
      const adapter = new _adapter.EditorAdapter(editor, conflictStartRow);
      const visitor = new ConflictVisitor(editor, layer);
      const parser = new _parser.ConflictParser(adapter, visitor, isRebase);
      if (parser.parse().wasSuccessful()) {
        conflicts.push(visitor.conflict());
      }
      lastRow = adapter.getCurrentRow();
    });
    return conflicts;
  }

  /*
   * Return the number of conflict markers present in a streamed file.
   */
  static countFromStream(stream, isRebase) {
    return new Promise((resolve, reject) => {
      let count = 0;
      let lastResult = null;
      let lastPartialMarker = '';
      stream.on('data', chunk => {
        const adapter = new _adapter.ChunkAdapter(lastPartialMarker + chunk);
        if (!lastResult) {
          if (!adapter.advanceTo(CONFLICT_START_REGEX)) {
            lastPartialMarker = adapter.getLastPartialMarker();
            return;
          }
        }
        do {
          const parser = new _parser.ConflictParser(adapter, new _noopVisitor.NoopVisitor(), isRebase);
          const result = lastResult ? parser.continueFrom(lastResult) : parser.parse();
          if (result.wasSuccessful()) {
            count++;
          } else {
            lastResult = result;
          }
        } while (adapter.advanceTo(CONFLICT_START_REGEX));
        lastPartialMarker = adapter.getLastPartialMarker();
      });
      stream.on('error', reject);
      stream.on('end', () => resolve(count));
    });
  }
}
exports.default = Conflict;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDT05GTElDVF9TVEFSVF9SRUdFWCIsIkNvbmZsaWN0VmlzaXRvciIsImNvbnN0cnVjdG9yIiwiZWRpdG9yIiwibGF5ZXIiLCJvdXJzIiwiYmFzZSIsInNlcGFyYXRvciIsInRoZWlycyIsInZpc2l0T3VyU2lkZSIsInBvc2l0aW9uIiwiYmFubmVyUm93IiwidGV4dFJvd1N0YXJ0IiwidGV4dFJvd0VuZCIsIm1hcmtTaWRlIiwiT1VSUyIsInZpc2l0QmFzZVNpZGUiLCJNSURETEUiLCJCQVNFIiwidmlzaXRTZXBhcmF0b3IiLCJzZXBSb3dTdGFydCIsIm1hcmtlciIsIm1hcmtCdWZmZXJSYW5nZSIsImludmFsaWRhdGUiLCJleGNsdXNpdmUiLCJTZXBhcmF0b3IiLCJ2aXNpdFRoZWlyU2lkZSIsIlRIRUlSUyIsInNvdXJjZSIsImJsb2NrQ29sIiwid2hlbiIsInRvcCIsIm1pZGRsZSIsImJvdHRvbSIsImxpbmVUZXh0Rm9yQnVmZmVyUm93IiwibGVuZ3RoIiwiYmxvY2tSYW5nZSIsImJsb2NrTWFya2VyIiwiZGVzY3JpcHRpb24iLCJzaWRlRGVzY3JpcHRpb24iLCJiYW5uZXJSYW5nZSIsImJhbm5lck1hcmtlciIsIm9yaWdpbmFsQmFubmVyVGV4dCIsImdldFRleHRJbkJ1ZmZlclJhbmdlIiwiYmFubmVyIiwiQmFubmVyIiwidGV4dFJhbmdlIiwic2lkZU1hcmtlciIsIm9yaWdpbmFsVGV4dCIsIlNpZGUiLCJtYXRjaCIsImNvbmZsaWN0IiwiQ29uZmxpY3QiLCJieVNvdXJjZSIsImJ5UG9zaXRpb24iLCJmb3JFYWNoIiwic2lkZSIsImdldFNvdXJjZSIsImdldE5hbWUiLCJnZXRQb3NpdGlvbiIsInJlc29sdXRpb24iLCJnZXRLZXkiLCJnZXRTaWRlIiwiZ2V0TWFya2VyIiwiaWQiLCJpc1Jlc29sdmVkIiwicmVzb2x2ZUFzIiwiZ2V0U2lkZXMiLCJtYXAiLCJzb3VyY2VOYW1lIiwiZmlsdGVyIiwiZ2V0Q2hvc2VuU2lkZSIsImdldFVuY2hvc2VuU2lkZXMiLCJnZXRTaWRlQ29udGFpbmluZyIsInBvaW50IiwiZmluZCIsImluY2x1ZGVzUG9pbnQiLCJnZXRSYW5nZSIsInRvcFJhbmdlIiwiYm90dG9tUmFuZ2UiLCJ1bmlvbiIsImNvbnRhaW5zUG9pbnQiLCJtYXJrZXJBZnRlciIsImdldEJhbm5lck1hcmtlciIsImdldFNlcGFyYXRvciIsImFsbEZyb21FZGl0b3IiLCJpc1JlYmFzZSIsImNvbmZsaWN0cyIsImxhc3RSb3ciLCJnZXRCdWZmZXIiLCJzY2FuIiwibSIsImNvbmZsaWN0U3RhcnRSb3ciLCJyYW5nZSIsInN0YXJ0Iiwicm93IiwiYWRhcHRlciIsIkVkaXRvckFkYXB0ZXIiLCJ2aXNpdG9yIiwicGFyc2VyIiwiQ29uZmxpY3RQYXJzZXIiLCJwYXJzZSIsIndhc1N1Y2Nlc3NmdWwiLCJwdXNoIiwiZ2V0Q3VycmVudFJvdyIsImNvdW50RnJvbVN0cmVhbSIsInN0cmVhbSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiY291bnQiLCJsYXN0UmVzdWx0IiwibGFzdFBhcnRpYWxNYXJrZXIiLCJvbiIsImNodW5rIiwiQ2h1bmtBZGFwdGVyIiwiYWR2YW5jZVRvIiwiZ2V0TGFzdFBhcnRpYWxNYXJrZXIiLCJOb29wVmlzaXRvciIsInJlc3VsdCIsImNvbnRpbnVlRnJvbSJdLCJzb3VyY2VzIjpbImNvbmZsaWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7TUlERExFfSBmcm9tICcuL3Bvc2l0aW9uJztcbmltcG9ydCB7T1VSUywgVEhFSVJTLCBCQVNFfSBmcm9tICcuL3NvdXJjZSc7XG5pbXBvcnQgU2lkZSBmcm9tICcuL3NpZGUnO1xuaW1wb3J0IEJhbm5lciBmcm9tICcuL2Jhbm5lcic7XG5pbXBvcnQgU2VwYXJhdG9yIGZyb20gJy4vc2VwYXJhdG9yJztcblxuaW1wb3J0IHtDb25mbGljdFBhcnNlcn0gZnJvbSAnLi9wYXJzZXInO1xuaW1wb3J0IHtFZGl0b3JBZGFwdGVyLCBDaHVua0FkYXB0ZXJ9IGZyb20gJy4vcGFyc2VyL2FkYXB0ZXInO1xuaW1wb3J0IHtOb29wVmlzaXRvcn0gZnJvbSAnLi9wYXJzZXIvbm9vcC12aXNpdG9yJztcblxuLy8gUmVndWxhciBleHByZXNzaW9uIHRoYXQgbWF0Y2hlcyB0aGUgYmVnaW5uaW5nIG9mIGEgcG90ZW50aWFsIGNvbmZsaWN0LlxuY29uc3QgQ09ORkxJQ1RfU1RBUlRfUkVHRVggPSAvXjx7N30gKFteXFxyXFxuXSspXFxyP1xcbi9nO1xuXG5cbi8qXG4gKiBDb25mbGljdCBwYXJzZXIgdmlzaXRvciB0aGF0IG1hcmtzIGVhY2ggYnVmZmVyIHJhbmdlIGFuZCBhc3NlbWJsZXMgYSBDb25mbGljdCBmcm9tIHRoZVxuICogcGllY2VzLlxuICovXG5jbGFzcyBDb25mbGljdFZpc2l0b3Ige1xuICAvKlxuICAgKiBlZGl0b3IgLSBbVGV4dEVkaXRvcl0gZGlzcGxheWluZyB0aGUgY29uZmxpY3RpbmcgdGV4dC5cbiAgICogbGF5ZXIgLSBbRGlzcGxheU1hcmtlckxheWVyXSB0byBjcmVhdGVkIGNvbmZsaWN0IG1hcmtlcnMgb24uXG4gICAqL1xuICBjb25zdHJ1Y3RvcihlZGl0b3IsIGxheWVyKSB7XG4gICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgdGhpcy5sYXllciA9IGxheWVyO1xuXG4gICAgdGhpcy5vdXJzID0gbnVsbDtcbiAgICB0aGlzLmJhc2UgPSBudWxsO1xuICAgIHRoaXMuc2VwYXJhdG9yID0gbnVsbDtcbiAgICB0aGlzLnRoZWlycyA9IG51bGw7XG4gIH1cblxuICAvKlxuICAgKiBwb3NpdGlvbiAtIFtQb3NpdGlvbl0gb25lIG9mIFRPUCBvciBCT1RUT00uXG4gICAqIGJhbm5lclJvdyAtIFtJbnRlZ2VyXSBvZiB0aGUgYnVmZmVyIHJvdyB0aGF0IGNvbnRhaW5zIG91ciBzaWRlJ3MgYmFubmVyLlxuICAgKiB0ZXh0Um93U3RhcnQgLSBbSW50ZWdlcl0gb2YgdGhlIGZpcnN0IGJ1ZmZlciByb3cgdGhhdCBjb250YWluIHRoaXMgc2lkZSdzIHRleHQuXG4gICAqIHRleHRSb3dFbmQgLSBbSW50ZWdlcl0gb2YgdGhlIGZpcnN0IGJ1ZmZlciByb3cgYmV5b25kIHRoZSBleHRlbmQgb2YgdGhpcyBzaWRlJ3MgdGV4dC5cbiAgICovXG4gIHZpc2l0T3VyU2lkZShwb3NpdGlvbiwgYmFubmVyUm93LCB0ZXh0Um93U3RhcnQsIHRleHRSb3dFbmQpIHtcbiAgICB0aGlzLm91cnMgPSB0aGlzLm1hcmtTaWRlKHBvc2l0aW9uLCBPVVJTLCBiYW5uZXJSb3csIHRleHRSb3dTdGFydCwgdGV4dFJvd0VuZCk7XG4gIH1cblxuICAvKlxuICAgKiBiYW5uZXJSb3cgLSBbSW50ZWdlcl0gdGhlIGJ1ZmZlciByb3cgdGhhdCBjb250YWlucyBvdXIgc2lkZSdzIGJhbm5lci5cbiAgICogdGV4dFJvd1N0YXJ0IC0gW0ludGVnZXJdIGZpcnN0IGJ1ZmZlciByb3cgdGhhdCBjb250YWluIHRoaXMgc2lkZSdzIHRleHQuXG4gICAqIHRleHRSb3dFbmQgLSBbSW50ZWdlcl0gZmlyc3QgYnVmZmVyIHJvdyBiZXlvbmQgdGhlIGV4dGVuZCBvZiB0aGlzIHNpZGUncyB0ZXh0LlxuICAgKi9cbiAgdmlzaXRCYXNlU2lkZShiYW5uZXJSb3csIHRleHRSb3dTdGFydCwgdGV4dFJvd0VuZCkge1xuICAgIHRoaXMuYmFzZSA9IHRoaXMubWFya1NpZGUoTUlERExFLCBCQVNFLCBiYW5uZXJSb3csIHRleHRSb3dTdGFydCwgdGV4dFJvd0VuZCk7XG4gIH1cblxuICAvKlxuICAgKiBzZXBSb3dTdGFydCAtIFtJbnRlZ2VyXSBidWZmZXIgcm93IHRoYXQgY29udGFpbnMgdGhlIFwiPT09PT09PVwiIHNlcGFyYXRvci5cbiAgICovXG4gIHZpc2l0U2VwYXJhdG9yKHNlcFJvd1N0YXJ0KSB7XG4gICAgY29uc3QgbWFya2VyID0gdGhpcy5sYXllci5tYXJrQnVmZmVyUmFuZ2UoW1tzZXBSb3dTdGFydCwgMF0sIFtzZXBSb3dTdGFydCArIDEsIDBdXSwge1xuICAgICAgaW52YWxpZGF0ZTogJ3N1cnJvdW5kJyxcbiAgICAgIGV4Y2x1c2l2ZTogdHJ1ZSxcbiAgICB9KTtcbiAgICB0aGlzLnNlcGFyYXRvciA9IG5ldyBTZXBhcmF0b3IodGhpcy5lZGl0b3IsIG1hcmtlcik7XG4gIH1cblxuICAvKlxuICAgKiBwb3NpdGlvbiAtIFtQb3NpdGlvbl0gYWxpZ25tZW50IHdpdGhpbiB0aGUgY29uZmxpY3QgbWFya2VyOiBUT1Agb3IgQk9UVE9NLlxuICAgKiBiYW5uZXJSb3cgLSBbSW50ZWdlcl0gdGhlIGJ1ZmZlciByb3cgdGhhdCBjb250YWlucyBvdXIgc2lkZSdzIGJhbm5lci5cbiAgICogdGV4dFJvd1N0YXJ0IC0gW0ludGVnZXJdIGZpcnN0IGJ1ZmZlciByb3cgdGhhdCBjb250YWluIHRoaXMgc2lkZSdzIHRleHQuXG4gICAqIHRleHRSb3dFbmQgLSBbSW50ZWdlcl0gZmlyc3QgYnVmZmVyIHJvdyBiZXlvbmQgdGhlIGV4dGVudCBvZiB0aGlzIHNpZGUncyB0ZXh0LlxuICAgKi9cbiAgdmlzaXRUaGVpclNpZGUocG9zaXRpb24sIGJhbm5lclJvdywgdGV4dFJvd1N0YXJ0LCB0ZXh0Um93RW5kKSB7XG4gICAgdGhpcy50aGVpcnMgPSB0aGlzLm1hcmtTaWRlKHBvc2l0aW9uLCBUSEVJUlMsIGJhbm5lclJvdywgdGV4dFJvd1N0YXJ0LCB0ZXh0Um93RW5kKTtcbiAgfVxuXG4gIG1hcmtTaWRlKHBvc2l0aW9uLCBzb3VyY2UsIGJhbm5lclJvdywgdGV4dFJvd1N0YXJ0LCB0ZXh0Um93RW5kKSB7XG4gICAgY29uc3QgYmxvY2tDb2wgPSBwb3NpdGlvbi53aGVuKHtcbiAgICAgIHRvcDogKCkgPT4gMCxcbiAgICAgIG1pZGRsZTogKCkgPT4gMCxcbiAgICAgIGJvdHRvbTogKCkgPT4gdGhpcy5lZGl0b3IubGluZVRleHRGb3JCdWZmZXJSb3coYmFubmVyUm93KS5sZW5ndGgsXG4gICAgfSk7XG4gICAgY29uc3QgYmxvY2tSYW5nZSA9IFtbYmFubmVyUm93LCBibG9ja0NvbF0sIFtiYW5uZXJSb3csIGJsb2NrQ29sXV07XG4gICAgY29uc3QgYmxvY2tNYXJrZXIgPSB0aGlzLmxheWVyLm1hcmtCdWZmZXJSYW5nZShibG9ja1JhbmdlLCB7XG4gICAgICBpbnZhbGlkYXRlOiAnc3Vycm91bmQnLFxuICAgICAgZXhjbHVzaXZlOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSB0aGlzLnNpZGVEZXNjcmlwdGlvbihiYW5uZXJSb3cpO1xuICAgIGNvbnN0IGJhbm5lclJhbmdlID0gW1tiYW5uZXJSb3csIDBdLCBbYmFubmVyUm93ICsgMSwgMF1dO1xuICAgIGNvbnN0IGJhbm5lck1hcmtlciA9IHRoaXMubGF5ZXIubWFya0J1ZmZlclJhbmdlKGJhbm5lclJhbmdlLCB7XG4gICAgICBpbnZhbGlkYXRlOiAnc3Vycm91bmQnLFxuICAgICAgZXhjbHVzaXZlOiB0cnVlLFxuICAgIH0pO1xuICAgIGNvbnN0IG9yaWdpbmFsQmFubmVyVGV4dCA9IHRoaXMuZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlKGJhbm5lclJhbmdlKTtcbiAgICBjb25zdCBiYW5uZXIgPSBuZXcgQmFubmVyKHRoaXMuZWRpdG9yLCBiYW5uZXJNYXJrZXIsIGRlc2NyaXB0aW9uLCBvcmlnaW5hbEJhbm5lclRleHQpO1xuXG4gICAgY29uc3QgdGV4dFJhbmdlID0gW1t0ZXh0Um93U3RhcnQsIDBdLCBbdGV4dFJvd0VuZCwgMF1dO1xuICAgIGNvbnN0IHNpZGVNYXJrZXIgPSB0aGlzLmxheWVyLm1hcmtCdWZmZXJSYW5nZSh0ZXh0UmFuZ2UsIHtcbiAgICAgIGludmFsaWRhdGU6ICdzdXJyb3VuZCcsXG4gICAgICBleGNsdXNpdmU6IGZhbHNlLFxuICAgIH0pO1xuICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHRoaXMuZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlKHRleHRSYW5nZSk7XG5cbiAgICByZXR1cm4gbmV3IFNpZGUodGhpcy5lZGl0b3IsIHNpZGVNYXJrZXIsIGJsb2NrTWFya2VyLCBzb3VyY2UsIHBvc2l0aW9uLCBiYW5uZXIsIG9yaWdpbmFsVGV4dCk7XG4gIH1cblxuICAvKlxuICAgKiBQYXJzZSB0aGUgYmFubmVyIGRlc2NyaXB0aW9uIGZvciB0aGUgY3VycmVudCBzaWRlIGZyb20gYSBiYW5uZXIgcm93LlxuICAgKlxuICAgKiBiYW5uZXJSb3cgLSBbSW50ZWdlcl0gYnVmZmVyIHJvdyBjb250YWluaW5nIHRoZSA8LCB8LCBvciA+IG1hcmtlclxuICAgKi9cbiAgc2lkZURlc2NyaXB0aW9uKGJhbm5lclJvdykge1xuICAgIHJldHVybiB0aGlzLmVkaXRvci5saW5lVGV4dEZvckJ1ZmZlclJvdyhiYW5uZXJSb3cpLm1hdGNoKC9eWzx8Pl17N30gKC4qKSQvKVsxXTtcbiAgfVxuXG4gIGNvbmZsaWN0KCkge1xuICAgIHJldHVybiBuZXcgQ29uZmxpY3QodGhpcy5vdXJzLCB0aGlzLnNlcGFyYXRvciwgdGhpcy5iYXNlLCB0aGlzLnRoZWlycyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uZmxpY3Qge1xuICBjb25zdHJ1Y3RvcihvdXJzLCBzZXBhcmF0b3IsIGJhc2UsIHRoZWlycykge1xuICAgIHRoaXMuc2VwYXJhdG9yID0gc2VwYXJhdG9yO1xuXG4gICAgdGhpcy5ieVNvdXJjZSA9IHt9O1xuICAgIHRoaXMuYnlQb3NpdGlvbiA9IHt9O1xuXG4gICAgW291cnMsIGJhc2UsIHRoZWlyc10uZm9yRWFjaChzaWRlID0+IHtcbiAgICAgIGlmICghc2lkZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYnlTb3VyY2Vbc2lkZS5nZXRTb3VyY2UoKS5nZXROYW1lKCldID0gc2lkZTtcbiAgICAgIHRoaXMuYnlQb3NpdGlvbltzaWRlLmdldFBvc2l0aW9uKCkuZ2V0TmFtZSgpXSA9IHNpZGU7XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlc29sdXRpb24gPSBudWxsO1xuICB9XG5cbiAgZ2V0S2V5KCkge1xuICAgIHJldHVybiB0aGlzLmdldFNpZGUoT1VSUykuZ2V0TWFya2VyKCkuaWQ7XG4gIH1cblxuICBpc1Jlc29sdmVkKCkge1xuICAgIHJldHVybiB0aGlzLnJlc29sdXRpb24gIT09IG51bGw7XG4gIH1cblxuICByZXNvbHZlQXMoc291cmNlKSB7XG4gICAgdGhpcy5yZXNvbHV0aW9uID0gdGhpcy5nZXRTaWRlKHNvdXJjZSk7XG4gIH1cblxuICBnZXRTaWRlcygpIHtcbiAgICByZXR1cm4gWydvdXJzJywgJ2Jhc2UnLCAndGhlaXJzJ10ubWFwKHNvdXJjZU5hbWUgPT4gdGhpcy5ieVNvdXJjZVtzb3VyY2VOYW1lXSkuZmlsdGVyKHNpZGUgPT4gc2lkZSk7XG4gIH1cblxuICBnZXRDaG9zZW5TaWRlKCkge1xuICAgIHJldHVybiB0aGlzLnJlc29sdXRpb247XG4gIH1cblxuICBnZXRVbmNob3NlblNpZGVzKCkge1xuICAgIHJldHVybiB0aGlzLmdldFNpZGVzKCkuZmlsdGVyKHNpZGUgPT4gc2lkZSAhPT0gdGhpcy5yZXNvbHV0aW9uKTtcbiAgfVxuXG4gIGdldFNpZGUoc291cmNlKSB7XG4gICAgcmV0dXJuIHRoaXMuYnlTb3VyY2Vbc291cmNlLmdldE5hbWUoKV07XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm4gYSBgU2lkZWAgY29udGFpbmluZyBhIGJ1ZmZlciBwb2ludCwgb3IgYHVuZGVmaW5lZGAgaWYgbm9uZSBkby5cbiAgICovXG4gIGdldFNpZGVDb250YWluaW5nKHBvaW50KSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U2lkZXMoKS5maW5kKHNpZGUgPT4gc2lkZS5pbmNsdWRlc1BvaW50KHBvaW50KSk7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm4gYSBgUmFuZ2VgIHRoYXQgZW5jb21wYXNzZXMgdGhlIGVudGlyZSBDb25mbGljdCByZWdpb24uXG4gICAqL1xuICBnZXRSYW5nZSgpIHtcbiAgICBjb25zdCB0b3BSYW5nZSA9IHRoaXMuYnlQb3NpdGlvbi50b3AuZ2V0UmFuZ2UoKTtcbiAgICBjb25zdCBib3R0b21SYW5nZSA9IHRoaXMuYnlQb3NpdGlvbi5ib3R0b20uZ2V0UmFuZ2UoKTtcbiAgICByZXR1cm4gdG9wUmFuZ2UudW5pb24oYm90dG9tUmFuZ2UpO1xuICB9XG5cbiAgLypcbiAgICogRGV0ZXJtaW5lIHdoZXRoZXIgb3Igbm90IGEgYnVmZmVyIHBvc2l0aW9uIGlzIGNvbnRhaW5lZCB3aXRoaW4gdGhpcyBjb25mbGljdC5cbiAgICovXG4gIGluY2x1ZGVzUG9pbnQocG9pbnQpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRSYW5nZSgpLmNvbnRhaW5zUG9pbnQocG9pbnQpO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJuIHRoZSBgRGlzcGxheU1hcmtlcmAgdGhhdCBpbW1lZGlhdGVseSBmb2xsb3dzIHRoZSBgU2lkZWAgaW4gYSBnaXZlbiBgUG9zaXRpb25gLiBSZXR1cm4gYG51bGxgIGlmIG5vIHN1Y2hcbiAgICogbWFya2VyIGV4aXN0cy5cbiAgICovXG4gIG1hcmtlckFmdGVyKHBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHBvc2l0aW9uLndoZW4oe1xuICAgICAgdG9wOiAoKSA9PiAodGhpcy5ieVBvc2l0aW9uLm1pZGRsZSA/IHRoaXMuYnlQb3NpdGlvbi5taWRkbGUuZ2V0QmFubmVyTWFya2VyKCkgOiB0aGlzLmdldFNlcGFyYXRvcigpLmdldE1hcmtlcigpKSxcbiAgICAgIG1pZGRsZTogKCkgPT4gdGhpcy5nZXRTZXBhcmF0b3IoKS5nZXRNYXJrZXIoKSxcbiAgICAgIGJvdHRvbTogKCkgPT4gdGhpcy5ieVBvc2l0aW9uLmJvdHRvbS5nZXRCYW5uZXJNYXJrZXIoKSxcbiAgICB9KTtcbiAgfVxuXG4gIGdldFNlcGFyYXRvcigpIHtcbiAgICByZXR1cm4gdGhpcy5zZXBhcmF0b3I7XG4gIH1cblxuICAvKlxuICAgKiBQYXJzZSBhbnkgY29uZmxpY3QgbWFya2VycyBpbiBhIFRleHRFZGl0b3IncyBidWZmZXIgYW5kIHJldHVybiBhIENvbmZsaWN0IHRoYXQgY29udGFpbnMgbWFya2VycyBjb3JyZXNwb25kaW5nIHRvXG4gICAqIGVhY2guXG4gICAqXG4gICAqIGVkaXRvciBbVGV4dEVkaXRvcl0gVGhlIGVkaXRvciB0byBzZWFyY2guXG4gICAqIGxheWVyIFtEaXNwbGF5TWFya2VyTGF5ZXJdIE1hcmtlciBsYXllciB0byBjcmVhdGUgbWFya2VycyBvbi5cbiAgICogcmV0dXJuIFtBcnJheTxDb25mbGljdD5dIEEgKHBvc3NpYmx5IGVtcHR5KSBjb2xsZWN0aW9uIG9mIHBhcnNlZCBDb25mbGljdHMuXG4gICAqL1xuICBzdGF0aWMgYWxsRnJvbUVkaXRvcihlZGl0b3IsIGxheWVyLCBpc1JlYmFzZSkge1xuICAgIGNvbnN0IGNvbmZsaWN0cyA9IFtdO1xuICAgIGxldCBsYXN0Um93ID0gLTE7XG5cbiAgICBlZGl0b3IuZ2V0QnVmZmVyKCkuc2NhbihDT05GTElDVF9TVEFSVF9SRUdFWCwgbSA9PiB7XG4gICAgICBjb25zdCBjb25mbGljdFN0YXJ0Um93ID0gbS5yYW5nZS5zdGFydC5yb3c7XG4gICAgICBpZiAoY29uZmxpY3RTdGFydFJvdyA8IGxhc3RSb3cpIHtcbiAgICAgICAgLy8gTWF0Y2ggd2l0aGluIGFuIGFscmVhZHktcGFyc2VkIGNvbmZsaWN0LlxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFkYXB0ZXIgPSBuZXcgRWRpdG9yQWRhcHRlcihlZGl0b3IsIGNvbmZsaWN0U3RhcnRSb3cpO1xuICAgICAgY29uc3QgdmlzaXRvciA9IG5ldyBDb25mbGljdFZpc2l0b3IoZWRpdG9yLCBsYXllcik7XG4gICAgICBjb25zdCBwYXJzZXIgPSBuZXcgQ29uZmxpY3RQYXJzZXIoYWRhcHRlciwgdmlzaXRvciwgaXNSZWJhc2UpO1xuXG4gICAgICBpZiAocGFyc2VyLnBhcnNlKCkud2FzU3VjY2Vzc2Z1bCgpKSB7XG4gICAgICAgIGNvbmZsaWN0cy5wdXNoKHZpc2l0b3IuY29uZmxpY3QoKSk7XG4gICAgICB9XG5cbiAgICAgIGxhc3RSb3cgPSBhZGFwdGVyLmdldEN1cnJlbnRSb3coKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBjb25mbGljdHM7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBjb25mbGljdCBtYXJrZXJzIHByZXNlbnQgaW4gYSBzdHJlYW1lZCBmaWxlLlxuICAgKi9cbiAgc3RhdGljIGNvdW50RnJvbVN0cmVhbShzdHJlYW0sIGlzUmViYXNlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBsZXQgbGFzdFJlc3VsdCA9IG51bGw7XG4gICAgICBsZXQgbGFzdFBhcnRpYWxNYXJrZXIgPSAnJztcblxuICAgICAgc3RyZWFtLm9uKCdkYXRhJywgY2h1bmsgPT4ge1xuICAgICAgICBjb25zdCBhZGFwdGVyID0gbmV3IENodW5rQWRhcHRlcihsYXN0UGFydGlhbE1hcmtlciArIGNodW5rKTtcbiAgICAgICAgaWYgKCFsYXN0UmVzdWx0KSB7XG4gICAgICAgICAgaWYgKCFhZGFwdGVyLmFkdmFuY2VUbyhDT05GTElDVF9TVEFSVF9SRUdFWCkpIHtcbiAgICAgICAgICAgIGxhc3RQYXJ0aWFsTWFya2VyID0gYWRhcHRlci5nZXRMYXN0UGFydGlhbE1hcmtlcigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkbyB7XG4gICAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IENvbmZsaWN0UGFyc2VyKGFkYXB0ZXIsIG5ldyBOb29wVmlzaXRvcigpLCBpc1JlYmFzZSk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gbGFzdFJlc3VsdCA/IHBhcnNlci5jb250aW51ZUZyb20obGFzdFJlc3VsdCkgOiBwYXJzZXIucGFyc2UoKTtcblxuICAgICAgICAgIGlmIChyZXN1bHQud2FzU3VjY2Vzc2Z1bCgpKSB7XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsYXN0UmVzdWx0ID0gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgfSB3aGlsZSAoYWRhcHRlci5hZHZhbmNlVG8oQ09ORkxJQ1RfU1RBUlRfUkVHRVgpKTtcblxuICAgICAgICBsYXN0UGFydGlhbE1hcmtlciA9IGFkYXB0ZXIuZ2V0TGFzdFBhcnRpYWxNYXJrZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBzdHJlYW0ub24oJ2Vycm9yJywgcmVqZWN0KTtcblxuICAgICAgc3RyZWFtLm9uKCdlbmQnLCAoKSA9PiByZXNvbHZlKGNvdW50KSk7XG4gICAgfSk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFrRDtBQUVsRDtBQUNBLE1BQU1BLG9CQUFvQixHQUFHLHdCQUF3Qjs7QUFHckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxlQUFlLENBQUM7RUFDcEI7QUFDRjtBQUNBO0FBQ0E7RUFDRUMsV0FBVyxDQUFDQyxNQUFNLEVBQUVDLEtBQUssRUFBRTtJQUN6QixJQUFJLENBQUNELE1BQU0sR0FBR0EsTUFBTTtJQUNwQixJQUFJLENBQUNDLEtBQUssR0FBR0EsS0FBSztJQUVsQixJQUFJLENBQUNDLElBQUksR0FBRyxJQUFJO0lBQ2hCLElBQUksQ0FBQ0MsSUFBSSxHQUFHLElBQUk7SUFDaEIsSUFBSSxDQUFDQyxTQUFTLEdBQUcsSUFBSTtJQUNyQixJQUFJLENBQUNDLE1BQU0sR0FBRyxJQUFJO0VBQ3BCOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFQyxZQUFZLENBQUNDLFFBQVEsRUFBRUMsU0FBUyxFQUFFQyxZQUFZLEVBQUVDLFVBQVUsRUFBRTtJQUMxRCxJQUFJLENBQUNSLElBQUksR0FBRyxJQUFJLENBQUNTLFFBQVEsQ0FBQ0osUUFBUSxFQUFFSyxZQUFJLEVBQUVKLFNBQVMsRUFBRUMsWUFBWSxFQUFFQyxVQUFVLENBQUM7RUFDaEY7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFRyxhQUFhLENB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