"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _position = require("./position");
var _source = require("./source");
var _side = _interopRequireDefault(require("./side"));
var _banner = _interopRequireDefault(require("./banner"));
var _separator = _interopRequireDefault(require("./separator"));
var _parser = require("./parser");
var _adapter = require("./parser/adapter");
var _noopVisitor = require("./parser/noop-visitor");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
// Regular expression that matches the beginning of a potential conflict.
const CONFLICT_START_REGEX = /^<{7} ([^\r\n]+)\r?\n/g;

/*
 * Conflict parser visitor that marks each buffer range and assembles a Conflict from the
 * pieces.
 */
class ConflictVisitor {
  /*
   * editor - [TextEditor] displaying the conflicting text.
   * layer - [DisplayMarkerLayer] to created conflict markers on.
   */
  constructor(editor, layer) {
    this.editor = editor;
    this.layer = layer;
    this.ours = null;
    this.base = null;
    this.separator = null;
    this.theirs = null;
  }

  /*
   * position - [Position] one of TOP or BOTTOM.
   * bannerRow - [Integer] of the buffer row that contains our side's banner.
   * textRowStart - [Integer] of the first buffer row that contain this side's text.
   * textRowEnd - [Integer] of the first buffer row beyond the extend of this side's text.
   */
  visitOurSide(position, bannerRow, textRowStart, textRowEnd) {
    this.ours = this.markSide(position, _source.OURS, bannerRow, textRowStart, textRowEnd);
  }

  /*
   * bannerRow - [Integer] the buffer row that contains our side's banner.
   * textRowStart - [Integer] first buffer row that contain this side's text.
   * textRowEnd - [Integer] first buffer row beyond the extend of this side's text.
   */
  visitBaseSide(bannerRow, textRowStart, textRowEnd) {
    this.base = this.markSide(_position.MIDDLE, _source.BASE, bannerRow, textRowStart, textRowEnd);
  }

  /*
   * sepRowStart - [Integer] buffer row that contains the "=======" separator.
   */
  visitSeparator(sepRowStart) {
    const marker = this.layer.markBufferRange([[sepRowStart, 0], [sepRowStart + 1, 0]], {
      invalidate: 'surround',
      exclusive: true
    });
    this.separator = new _separator.default(this.editor, marker);
  }

  /*
   * position - [Position] alignment within the conflict marker: TOP or BOTTOM.
   * bannerRow - [Integer] the buffer row that contains our side's banner.
   * textRowStart - [Integer] first buffer row that contain this side's text.
   * textRowEnd - [Integer] first buffer row beyond the extent of this side's text.
   */
  visitTheirSide(position, bannerRow, textRowStart, textRowEnd) {
    this.theirs = this.markSide(position, _source.THEIRS, bannerRow, textRowStart, textRowEnd);
  }
  markSide(position, source, bannerRow, textRowStart, textRowEnd) {
    const blockCol = position.when({
      top: () => 0,
      middle: () => 0,
      bottom: () => this.editor.lineTextForBufferRow(bannerRow).length
    });
    const blockRange = [[bannerRow, blockCol], [bannerRow, blockCol]];
    const blockMarker = this.layer.markBufferRange(blockRange, {
      invalidate: 'surround',
      exclusive: true
    });
    const description = this.sideDescription(bannerRow);
    const bannerRange = [[bannerRow, 0], [bannerRow + 1, 0]];
    const bannerMarker = this.layer.markBufferRange(bannerRange, {
      invalidate: 'surround',
      exclusive: true
    });
    const originalBannerText = this.editor.getTextInBufferRange(bannerRange);
    const banner = new _banner.default(this.editor, bannerMarker, description, originalBannerText);
    const textRange = [[textRowStart, 0], [textRowEnd, 0]];
    const sideMarker = this.layer.markBufferRange(textRange, {
      invalidate: 'surround',
      exclusive: false
    });
    const originalText = this.editor.getTextInBufferRange(textRange);
    return new _side.default(this.editor, sideMarker, blockMarker, source, position, banner, originalText);
  }

  /*
   * Parse the banner description for the current side from a banner row.
   *
   * bannerRow - [Integer] buffer row containing the <, |, or > marker
   */
  sideDescription(bannerRow) {
    return this.editor.lineTextForBufferRow(bannerRow).match(/^[<|>]{7} (.*)$/)[1];
  }
  conflict() {
    return new Conflict(this.ours, this.separator, this.base, this.theirs);
  }
}
class Conflict {
  constructor(ours, separator, base, theirs) {
    this.separator = separator;
    this.bySource = {};
    this.byPosition = {};
    [ours, base, theirs].forEach(side => {
      if (!side) {
        return;
      }
      this.bySource[side.getSource().getName()] = side;
      this.byPosition[side.getPosition().getName()] = side;
    });
    this.resolution = null;
  }
  getKey() {
    return this.getSide(_source.OURS).getMarker().id;
  }
  isResolved() {
    return this.resolution !== null;
  }
  resolveAs(source) {
    this.resolution = this.getSide(source);
  }
  getSides() {
    return ['ours', 'base', 'theirs'].map(sourceName => this.bySource[sourceName]).filter(side => side);
  }
  getChosenSide() {
    return this.resolution;
  }
  getUnchosenSides() {
    return this.getSides().filter(side => side !== this.resolution);
  }
  getSide(source) {
    return this.bySource[source.getName()];
  }

  /*
   * Return a `Side` containing a buffer point, or `undefined` if none do.
   */
  getSideContaining(point) {
    return this.getSides().find(side => side.includesPoint(point));
  }

  /*
   * Return a `Range` that encompasses the entire Conflict region.
   */
  getRange() {
    const topRange = this.byPosition.top.getRange();
    const bottomRange = this.byPosition.bottom.getRange();
    return topRange.union(bottomRange);
  }

  /*
   * Determine whether or not a buffer position is contained within this conflict.
   */
  includesPoint(point) {
    return this.getRange().containsPoint(point);
  }

  /*
   * Return the `DisplayMarker` that immediately follows the `Side` in a given `Position`. Return `null` if no such
   * marker exists.
   */
  markerAfter(position) {
    return position.when({
      top: () => this.byPosition.middle ? this.byPosition.middle.getBannerMarker() : this.getSeparator().getMarker(),
      middle: () => this.getSeparator().getMarker(),
      bottom: () => this.byPosition.bottom.getBannerMarker()
    });
  }
  getSeparator() {
    return this.separator;
  }

  /*
   * Parse any conflict markers in a TextEditor's buffer and return a Conflict that contains markers corresponding to
   * each.
   *
   * editor [TextEditor] The editor to search.
   * layer [DisplayMarkerLayer] Marker layer to create markers on.
   * return [Array<Conflict>] A (possibly empty) collection of parsed Conflicts.
   */
  static allFromEditor(editor, layer, isRebase) {
    const conflicts = [];
    let lastRow = -1;
    editor.getBuffer().scan(CONFLICT_START_REGEX, m => {
      const conflictStartRow = m.range.start.row;
      if (conflictStartRow < lastRow) {
        // Match within an already-parsed conflict.
        return;
      }
      const adapter = new _adapter.EditorAdapter(editor, conflictStartRow);
      const visitor = new ConflictVisitor(editor, layer);
      const parser = new _parser.ConflictParser(adapter, visitor, isRebase);
      if (parser.parse().wasSuccessful()) {
        conflicts.push(visitor.conflict());
      }
      lastRow = adapter.getCurrentRow();
    });
    return conflicts;
  }

  /*
   * Return the number of conflict markers present in a streamed file.
   */
  static countFromStream(stream, isRebase) {
    return new Promise((resolve, reject) => {
      let count = 0;
      let lastResult = null;
      let lastPartialMarker = '';
      stream.on('data', chunk => {
        const adapter = new _adapter.ChunkAdapter(lastPartialMarker + chunk);
        if (!lastResult) {
          if (!adapter.advanceTo(CONFLICT_START_REGEX)) {
            lastPartialMarker = adapter.getLastPartialMarker();
            return;
          }
        }
        do {
          const parser = new _parser.ConflictParser(adapter, new _noopVisitor.NoopVisitor(), isRebase);
          const result = lastResult ? parser.continueFrom(lastResult) : parser.parse();
          if (result.wasSuccessful()) {
            count++;
          } else {
            lastResult = result;
          }
        } while (adapter.advanceTo(CONFLICT_START_REGEX));
        lastPartialMarker = adapter.getLastPartialMarker();
      });
      stream.on('error', reject);
      stream.on('end', () => resolve(count));
    });
  }
}
exports.default = Conflict;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcG9zaXRpb24iLCJyZXF1aXJlIiwiX3NvdXJjZSIsIl9zaWRlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9iYW5uZXIiLCJfc2VwYXJhdG9yIiwiX3BhcnNlciIsIl9hZGFwdGVyIiwiX25vb3BWaXNpdG9yIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJDT05GTElDVF9TVEFSVF9SRUdFWCIsIkNvbmZsaWN0VmlzaXRvciIsImNvbnN0cnVjdG9yIiwiZWRpdG9yIiwibGF5ZXIiLCJvdXJzIiwiYmFzZSIsInNlcGFyYXRvciIsInRoZWlycyIsInZpc2l0T3VyU2lkZSIsInBvc2l0aW9uIiwiYmFubmVyUm93IiwidGV4dFJvd1N0YXJ0IiwidGV4dFJvd0VuZCIsIm1hcmtTaWRlIiwiT1VSUyIsInZpc2l0QmFzZVNpZGUiLCJNSURETEUiLCJCQVNFIiwidmlzaXRTZXBhcmF0b3IiLCJzZXBSb3dTdGFydCIsIm1hcmtlciIsIm1hcmtCdWZmZXJSYW5nZSIsImludmFsaWRhdGUiLCJleGNsdXNpdmUiLCJTZXBhcmF0b3IiLCJ2aXNpdFRoZWlyU2lkZSIsIlRIRUlSUyIsInNvdXJjZSIsImJsb2NrQ29sIiwid2hlbiIsInRvcCIsIm1pZGRsZSIsImJvdHRvbSIsImxpbmVUZXh0Rm9yQnVmZmVyUm93IiwibGVuZ3RoIiwiYmxvY2tSYW5nZSIsImJsb2NrTWFya2VyIiwiZGVzY3JpcHRpb24iLCJzaWRlRGVzY3JpcHRpb24iLCJiYW5uZXJSYW5nZSIsImJhbm5lck1hcmtlciIsIm9yaWdpbmFsQmFubmVyVGV4dCIsImdldFRleHRJbkJ1ZmZlclJhbmdlIiwiYmFubmVyIiwiQmFubmVyIiwidGV4dFJhbmdlIiwic2lkZU1hcmtlciIsIm9yaWdpbmFsVGV4dCIsIlNpZGUiLCJtYXRjaCIsImNvbmZsaWN0IiwiQ29uZmxpY3QiLCJieVNvdXJjZSIsImJ5UG9zaXRpb24iLCJmb3JFYWNoIiwic2lkZSIsImdldFNvdXJjZSIsImdldE5hbWUiLCJnZXRQb3NpdGlvbiIsInJlc29sdXRpb24iLCJnZXRLZXkiLCJnZXRTaWRlIiwiZ2V0TWFya2VyIiwiaWQiLCJpc1Jlc29sdmVkIiwicmVzb2x2ZUFzIiwiZ2V0U2lkZXMiLCJtYXAiLCJzb3VyY2VOYW1lIiwiZmlsdGVyIiwiZ2V0Q2hvc2VuU2lkZSIsImdldFVuY2hvc2VuU2lkZXMiLCJnZXRTaWRlQ29udGFpbmluZyIsInBvaW50IiwiZmluZCIsImluY2x1ZGVzUG9pbnQiLCJnZXRSYW5nZSIsInRvcFJhbmdlIiwiYm90dG9tUmFuZ2UiLCJ1bmlvbiIsImNvbnRhaW5zUG9pbnQiLCJtYXJrZXJBZnRlciIsImdldEJhbm5lck1hcmtlciIsImdldFNlcGFyYXRvciIsImFsbEZyb21FZGl0b3IiLCJpc1JlYmFzZSIsImNvbmZsaWN0cyIsImxhc3RSb3ciLCJnZXRCdWZmZXIiLCJzY2FuIiwibSIsImNvbmZsaWN0U3RhcnRSb3ciLCJyYW5nZSIsInN0YXJ0Iiwicm93IiwiYWRhcHRlciIsIkVkaXRvckFkYXB0ZXIiLCJ2aXNpdG9yIiwicGFyc2VyIiwiQ29uZmxpY3RQYXJzZXIiLCJwYXJzZSIsIndhc1N1Y2Nlc3NmdWwiLCJwdXNoIiwiZ2V0Q3VycmVudFJvdyIsImNvdW50RnJvbVN0cmVhbSIsInN0cmVhbSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiY291bnQiLCJsYXN0UmVzdWx0IiwibGFzdFBhcnRpYWxNYXJrZXIiLCJvbiIsImNodW5rIiwiQ2h1bmtBZGFwdGVyIiwiYWR2YW5jZVRvIiwiZ2V0TGFzdFBhcnRpYWxNYXJrZXIiLCJOb29wVmlzaXRvciIsInJlc3VsdCIsImNvbnRpbnVlRnJvbSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJjb25mbGljdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge01JRERMRX0gZnJvbSAnLi9wb3NpdGlvbic7XG5pbXBvcnQge09VUlMsIFRIRUlSUywgQkFTRX0gZnJvbSAnLi9zb3VyY2UnO1xuaW1wb3J0IFNpZGUgZnJvbSAnLi9zaWRlJztcbmltcG9ydCBCYW5uZXIgZnJvbSAnLi9iYW5uZXInO1xuaW1wb3J0IFNlcGFyYXRvciBmcm9tICcuL3NlcGFyYXRvcic7XG5cbmltcG9ydCB7Q29uZmxpY3RQYXJzZXJ9IGZyb20gJy4vcGFyc2VyJztcbmltcG9ydCB7RWRpdG9yQWRhcHRlciwgQ2h1bmtBZGFwdGVyfSBmcm9tICcuL3BhcnNlci9hZGFwdGVyJztcbmltcG9ydCB7Tm9vcFZpc2l0b3J9IGZyb20gJy4vcGFyc2VyL25vb3AtdmlzaXRvcic7XG5cbi8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG1hdGNoZXMgdGhlIGJlZ2lubmluZyBvZiBhIHBvdGVudGlhbCBjb25mbGljdC5cbmNvbnN0IENPTkZMSUNUX1NUQVJUX1JFR0VYID0gL148ezd9IChbXlxcclxcbl0rKVxccj9cXG4vZztcblxuXG4vKlxuICogQ29uZmxpY3QgcGFyc2VyIHZpc2l0b3IgdGhhdCBtYXJrcyBlYWNoIGJ1ZmZlciByYW5nZSBhbmQgYXNzZW1ibGVzIGEgQ29uZmxpY3QgZnJvbSB0aGVcbiAqIHBpZWNlcy5cbiAqL1xuY2xhc3MgQ29uZmxpY3RWaXNpdG9yIHtcbiAgLypcbiAgICogZWRpdG9yIC0gW1RleHRFZGl0b3JdIGRpc3BsYXlpbmcgdGhlIGNvbmZsaWN0aW5nIHRleHQuXG4gICAqIGxheWVyIC0gW0Rpc3BsYXlNYXJrZXJMYXllcl0gdG8gY3JlYXRlZCBjb25mbGljdCBtYXJrZXJzIG9uLlxuICAgKi9cbiAgY29uc3RydWN0b3IoZWRpdG9yLCBsYXllcikge1xuICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICAgIHRoaXMubGF5ZXIgPSBsYXllcjtcblxuICAgIHRoaXMub3VycyA9IG51bGw7XG4gICAgdGhpcy5iYXNlID0gbnVsbDtcbiAgICB0aGlzLnNlcGFyYXRvciA9IG51bGw7XG4gICAgdGhpcy50aGVpcnMgPSBudWxsO1xuICB9XG5cbiAgLypcbiAgICogcG9zaXRpb24gLSBbUG9zaXRpb25dIG9uZSBvZiBUT1Agb3IgQk9UVE9NLlxuICAgKiBiYW5uZXJSb3cgLSBbSW50ZWdlcl0gb2YgdGhlIGJ1ZmZlciByb3cgdGhhdCBjb250YWlucyBvdXIgc2lkZSdzIGJhbm5lci5cbiAgICogdGV4dFJvd1N0YXJ0IC0gW0ludGVnZXJdIG9mIHRoZSBmaXJzdCBidWZmZXIgcm93IHRoYXQgY29udGFpbiB0aGlzIHNpZGUncyB0ZXh0LlxuICAgKiB0ZXh0Um93RW5kIC0gW0ludGVnZXJdIG9mIHRoZSBmaXJzdCBidWZmZXIgcm93IGJleW9uZCB0aGUgZXh0ZW5kIG9mIHRoaXMgc2lkZSdzIHRleHQuXG4gICAqL1xuICB2aXNpdE91clNpZGUocG9zaXRpb24sIGJhbm5lclJvdywgdGV4dFJvd1N0YXJ0LCB0ZXh0Um93RW5kKSB7XG4gICAgdGhpcy5vdXJzID0gdGhpcy5tYXJrU2lkZShwb3NpdGlvbiwgT1VSUywgYmFubmVyUm93LCB0ZXh0Um93U3RhcnQsIHRleHRSb3dFbmQpO1xuICB9XG5cbiAgLypcbiAgICogYmFubmVyUm93IC0gW0ludGVnZXJdIHRoZSBidWZmZXIgcm93IHRoYXQgY29udGFpbnMgb3VyIHNpZGUncyBiYW5uZXIuXG4gICAqIHRleHRSb3dTdGFydCAtIFtJbnRlZ2VyXSBmaXJzdCBidWZmZXIgcm93IHRoYXQgY29udGFpbiB0aGlzIHNpZGUncyB0ZXh0LlxuICAgKiB0ZXh0Um93RW5kIC0gW0ludGVnZXJdIGZpcnN0IGJ1ZmZlciByb3cgYmV5b25kIHRoZSBleHRlbmQgb2YgdGhpcyBzaWRlJ3MgdGV4dC5cbiAgICovXG4gIHZpc2l0QmFzZVNpZGUoYmFubmVyUm93LCB0ZXh0Um93U3RhcnQsIHRleHRSb3dFbmQpIHtcbiAgICB0aGlzLmJhc2UgPSB0aGlzLm1hcmtTaWRlKE1JRERMRSwgQkFTRSwgYmFubmVyUm93LCB0ZXh0Um93U3RhcnQsIHRleHRSb3dFbmQpO1xuICB9XG5cbiAgLypcbiAgICogc2VwUm93U3RhcnQgLSBbSW50ZWdlcl0gYnVmZmVyIHJvdyB0aGF0IGNvbnRhaW5zIHRoZSBcIj09PT09PT1cIiBzZXBhcmF0b3IuXG4gICAqL1xuICB2aXNpdFNlcGFyYXRvcihzZXBSb3dTdGFydCkge1xuICAgIGNvbnN0IG1hcmtlciA9IHRoaXMubGF5ZXIubWFya0J1ZmZlclJhbmdlKFtbc2VwUm93U3RhcnQsIDBdLCBbc2VwUm93U3RhcnQgKyAxLCAwXV0sIHtcbiAgICAgIGludmFsaWRhdGU6ICdzdXJyb3VuZCcsXG4gICAgICBleGNsdXNpdmU6IHRydWUsXG4gICAgfSk7XG4gICAgdGhpcy5zZXBhcmF0b3IgPSBuZXcgU2VwYXJhdG9yKHRoaXMuZWRpdG9yLCBtYXJrZXIpO1xuICB9XG5cbiAgLypcbiAgICogcG9zaXRpb24gLSBbUG9zaXRpb25dIGFsaWdubWVudCB3aXRoaW4gdGhlIGNvbmZsaWN0IG1hcmtlcjogVE9QIG9yIEJPVFRPTS5cbiAgICogYmFubmVyUm93IC0gW0ludGVnZXJdIHRoZSBidWZmZXIgcm93IHRoYXQgY29udGFpbnMgb3VyIHNpZGUncyBiYW5uZXIuXG4gICAqIHRleHRSb3dTdGFydCAtIFtJbnRlZ2VyXSBmaXJzdCBidWZmZXIgcm93IHRoYXQgY29udGFpbiB0aGlzIHNpZGUncyB0ZXh0LlxuICAgKiB0ZXh0Um93RW5kIC0gW0ludGVnZXJdIGZpcnN0IGJ1ZmZlciByb3cgYmV5b25kIHRoZSBleHRlbnQgb2YgdGhpcyBzaWRlJ3MgdGV4dC5cbiAgICovXG4gIHZpc2l0VGhlaXJTaWRlKHBvc2l0aW9uLCBiYW5uZXJSb3csIHRleHRSb3dTdGFydCwgdGV4dFJvd0VuZCkge1xuICAgIHRoaXMudGhlaXJzID0gdGhpcy5tYXJrU2lkZShwb3NpdGlvbiwgVEhFSVJTLCBiYW5uZXJSb3csIHRleHRSb3dTdGFydCwgdGV4dFJvd0VuZCk7XG4gIH1cblxuICBtYXJrU2lkZShwb3NpdGlvbiwgc291cmNlLCBiYW5uZXJSb3csIHRleHRSb3dTdGFydCwgdGV4dFJvd0VuZCkge1xuICAgIGNvbnN0IGJsb2NrQ29sID0gcG9zaXRpb24ud2hlbih7XG4gICAgICB0b3A6ICgpID0+IDAsXG4gICAgICBtaWRkbGU6ICgpID0+IDAsXG4gICAgICBib3R0b206ICgpID0+IHRoaXMuZWRpdG9yLmxpbmVUZXh0Rm9yQnVmZmVyUm93KGJhbm5lclJvdykubGVuZ3RoLFxuICAgIH0pO1xuICAgIGNvbnN0IGJsb2NrUmFuZ2UgPSBbW2Jhbm5lclJvdywgYmxvY2tDb2xdLCBbYmFubmVyUm93LCBibG9ja0NvbF1dO1xuICAgIGNvbnN0IGJsb2NrTWFya2VyID0gdGhpcy5sYXllci5tYXJrQnVmZmVyUmFuZ2UoYmxvY2tSYW5nZSwge1xuICAgICAgaW52YWxpZGF0ZTogJ3N1cnJvdW5kJyxcbiAgICAgIGV4Y2x1c2l2ZTogdHJ1ZSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdGhpcy5zaWRlRGVzY3JpcHRpb24oYmFubmVyUm93KTtcbiAgICBjb25zdCBiYW5uZXJSYW5nZSA9IFtbYmFubmVyUm93LCAwXSwgW2Jhbm5lclJvdyArIDEsIDBdXTtcbiAgICBjb25zdCBiYW5uZXJNYXJrZXIgPSB0aGlzLmxheWVyLm1hcmtCdWZmZXJSYW5nZShiYW5uZXJSYW5nZSwge1xuICAgICAgaW52YWxpZGF0ZTogJ3N1cnJvdW5kJyxcbiAgICAgIGV4Y2x1c2l2ZTogdHJ1ZSxcbiAgICB9KTtcbiAgICBjb25zdCBvcmlnaW5hbEJhbm5lclRleHQgPSB0aGlzLmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZShiYW5uZXJSYW5nZSk7XG4gICAgY29uc3QgYmFubmVyID0gbmV3IEJhbm5lcih0aGlzLmVkaXRvciwgYmFubmVyTWFya2VyLCBkZXNjcmlwdGlvbiwgb3JpZ2luYWxCYW5uZXJUZXh0KTtcblxuICAgIGNvbnN0IHRleHRSYW5nZSA9IFtbdGV4dFJvd1N0YXJ0LCAwXSwgW3RleHRSb3dFbmQsIDBdXTtcbiAgICBjb25zdCBzaWRlTWFya2VyID0gdGhpcy5sYXllci5tYXJrQnVmZmVyUmFuZ2UodGV4dFJhbmdlLCB7XG4gICAgICBpbnZhbGlkYXRlOiAnc3Vycm91bmQnLFxuICAgICAgZXhjbHVzaXZlOiBmYWxzZSxcbiAgICB9KTtcbiAgICBjb25zdCBvcmlnaW5hbFRleHQgPSB0aGlzLmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZSh0ZXh0UmFuZ2UpO1xuXG4gICAgcmV0dXJuIG5ldyBTaWRlKHRoaXMuZWRpdG9yLCBzaWRlTWFya2VyLCBibG9ja01hcmtlciwgc291cmNlLCBwb3NpdGlvbiwgYmFubmVyLCBvcmlnaW5hbFRleHQpO1xuICB9XG5cbiAgLypcbiAgICogUGFyc2UgdGhlIGJhbm5lciBkZXNjcmlwdGlvbiBmb3IgdGhlIGN1cnJlbnQgc2lkZSBmcm9tIGEgYmFubmVyIHJvdy5cbiAgICpcbiAgICogYmFubmVyUm93IC0gW0ludGVnZXJdIGJ1ZmZlciByb3cgY29udGFpbmluZyB0aGUgPCwgfCwgb3IgPiBtYXJrZXJcbiAgICovXG4gIHNpZGVEZXNjcmlwdGlvbihiYW5uZXJSb3cpIHtcbiAgICByZXR1cm4gdGhpcy5lZGl0b3IubGluZVRleHRGb3JCdWZmZXJSb3coYmFubmVyUm93KS5tYXRjaCgvXls8fD5dezd9ICguKikkLylbMV07XG4gIH1cblxuICBjb25mbGljdCgpIHtcbiAgICByZXR1cm4gbmV3IENvbmZsaWN0KHRoaXMub3VycywgdGhpcy5zZXBhcmF0b3IsIHRoaXMuYmFzZSwgdGhpcy50aGVpcnMpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbmZsaWN0IHtcbiAgY29uc3RydWN0b3Iob3Vycywgc2VwYXJhdG9yLCBiYXNlLCB0aGVpcnMpIHtcbiAgICB0aGlzLnNlcGFyYXRvciA9IHNlcGFyYXRvcjtcblxuICAgIHRoaXMuYnlTb3VyY2UgPSB7fTtcbiAgICB0aGlzLmJ5UG9zaXRpb24gPSB7fTtcblxuICAgIFtvdXJzLCBiYXNlLCB0aGVpcnNdLmZvckVhY2goc2lkZSA9PiB7XG4gICAgICBpZiAoIXNpZGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmJ5U291cmNlW3NpZGUuZ2V0U291cmNlKCkuZ2V0TmFtZSgpXSA9IHNpZGU7XG4gICAgICB0aGlzLmJ5UG9zaXRpb25bc2lkZS5nZXRQb3NpdGlvbigpLmdldE5hbWUoKV0gPSBzaWRlO1xuICAgIH0pO1xuXG4gICAgdGhpcy5yZXNvbHV0aW9uID0gbnVsbDtcbiAgfVxuXG4gIGdldEtleSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTaWRlKE9VUlMpLmdldE1hcmtlcigpLmlkO1xuICB9XG5cbiAgaXNSZXNvbHZlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXNvbHV0aW9uICE9PSBudWxsO1xuICB9XG5cbiAgcmVzb2x2ZUFzKHNvdXJjZSkge1xuICAgIHRoaXMucmVzb2x1dGlvbiA9IHRoaXMuZ2V0U2lkZShzb3VyY2UpO1xuICB9XG5cbiAgZ2V0U2lkZXMoKSB7XG4gICAgcmV0dXJuIFsnb3VycycsICdiYXNlJywgJ3RoZWlycyddLm1hcChzb3VyY2VOYW1lID0+IHRoaXMuYnlTb3VyY2Vbc291cmNlTmFtZV0pLmZpbHRlcihzaWRlID0+IHNpZGUpO1xuICB9XG5cbiAgZ2V0Q2hvc2VuU2lkZSgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXNvbHV0aW9uO1xuICB9XG5cbiAgZ2V0VW5jaG9zZW5TaWRlcygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTaWRlcygpLmZpbHRlcihzaWRlID0+IHNpZGUgIT09IHRoaXMucmVzb2x1dGlvbik7XG4gIH1cblxuICBnZXRTaWRlKHNvdXJjZSkge1xuICAgIHJldHVybiB0aGlzLmJ5U291cmNlW3NvdXJjZS5nZXROYW1lKCldO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJuIGEgYFNpZGVgIGNvbnRhaW5pbmcgYSBidWZmZXIgcG9pbnQsIG9yIGB1bmRlZmluZWRgIGlmIG5vbmUgZG8uXG4gICAqL1xuICBnZXRTaWRlQ29udGFpbmluZyhwb2ludCkge1xuICAgIHJldHVybiB0aGlzLmdldFNpZGVzKCkuZmluZChzaWRlID0+IHNpZGUuaW5jbHVkZXNQb2ludChwb2ludCkpO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJuIGEgYFJhbmdlYCB0aGF0IGVuY29tcGFzc2VzIHRoZSBlbnRpcmUgQ29uZmxpY3QgcmVnaW9uLlxuICAgKi9cbiAgZ2V0UmFuZ2UoKSB7XG4gICAgY29uc3QgdG9wUmFuZ2UgPSB0aGlzLmJ5UG9zaXRpb24udG9wLmdldFJhbmdlKCk7XG4gICAgY29uc3QgYm90dG9tUmFuZ2UgPSB0aGlzLmJ5UG9zaXRpb24uYm90dG9tLmdldFJhbmdlKCk7XG4gICAgcmV0dXJuIHRvcFJhbmdlLnVuaW9uKGJvdHRvbVJhbmdlKTtcbiAgfVxuXG4gIC8qXG4gICAqIERldGVybWluZSB3aGV0aGVyIG9yIG5vdCBhIGJ1ZmZlciBwb3NpdGlvbiBpcyBjb250YWluZWQgd2l0aGluIHRoaXMgY29uZmxpY3QuXG4gICAqL1xuICBpbmNsdWRlc1BvaW50KHBvaW50KSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UmFuZ2UoKS5jb250YWluc1BvaW50KHBvaW50KTtcbiAgfVxuXG4gIC8qXG4gICAqIFJldHVybiB0aGUgYERpc3BsYXlNYXJrZXJgIHRoYXQgaW1tZWRpYXRlbHkgZm9sbG93cyB0aGUgYFNpZGVgIGluIGEgZ2l2ZW4gYFBvc2l0aW9uYC4gUmV0dXJuIGBudWxsYCBpZiBubyBzdWNoXG4gICAqIG1hcmtlciBleGlzdHMuXG4gICAqL1xuICBtYXJrZXJBZnRlcihwb3NpdGlvbikge1xuICAgIHJldHVybiBwb3NpdGlvbi53aGVuKHtcbiAgICAgIHRvcDogKCkgPT4gKHRoaXMuYnlQb3NpdGlvbi5taWRkbGUgPyB0aGlzLmJ5UG9zaXRpb24ubWlkZGxlLmdldEJhbm5lck1hcmtlcigpIDogdGhpcy5nZXRTZXBhcmF0b3IoKS5nZXRNYXJrZXIoKSksXG4gICAgICBtaWRkbGU6ICgpID0+IHRoaXMuZ2V0U2VwYXJhdG9yKCkuZ2V0TWFya2VyKCksXG4gICAgICBib3R0b206ICgpID0+IHRoaXMuYnlQb3NpdGlvbi5ib3R0b20uZ2V0QmFubmVyTWFya2VyKCksXG4gICAgfSk7XG4gIH1cblxuICBnZXRTZXBhcmF0b3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VwYXJhdG9yO1xuICB9XG5cbiAgLypcbiAgICogUGFyc2UgYW55IGNvbmZsaWN0IG1hcmtlcnMgaW4gYSBUZXh0RWRpdG9yJ3MgYnVmZmVyIGFuZCByZXR1cm4gYSBDb25mbGljdCB0aGF0IGNvbnRhaW5zIG1hcmtlcnMgY29ycmVzcG9uZGluZyB0b1xuICAgKiBlYWNoLlxuICAgKlxuICAgKiBlZGl0b3IgW1RleHRFZGl0b3JdIFRoZSBlZGl0b3IgdG8gc2VhcmNoLlxuICAgKiBsYXllciBbRGlzcGxheU1hcmtlckxheWVyXSBNYXJrZXIgbGF5ZXIgdG8gY3JlYXRlIG1hcmtlcnMgb24uXG4gICAqIHJldHVybiBbQXJyYXk8Q29uZmxpY3Q+XSBBIChwb3NzaWJseSBlbXB0eSkgY29sbGVjdGlvbiBvZiBwYXJzZWQgQ29uZmxpY3RzLlxuICAgKi9cbiAgc3RhdGljIGFsbEZyb21FZGl0b3IoZWRpdG9yLCBsYXllciwgaXNSZWJhc2UpIHtcbiAgICBjb25zdCBjb25mbGljdHMgPSBbXTtcbiAgICBsZXQgbGFzdFJvdyA9IC0xO1xuXG4gICAgZWRpdG9yLmdldEJ1ZmZlcigpLnNjYW4oQ09ORkxJQ1RfU1RBUlRfUkVHRVgsIG0gPT4ge1xuICAgICAgY29uc3QgY29uZmxpY3RTdGFydFJvdyA9IG0ucmFuZ2Uuc3RhcnQucm93O1xuICAgICAgaWYgKGNvbmZsaWN0U3RhcnRSb3cgPCBsYXN0Um93KSB7XG4gICAgICAgIC8vIE1hdGNoIHdpdGhpbiBhbiBhbHJlYWR5LXBhcnNlZCBjb25mbGljdC5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhZGFwdGVyID0gbmV3IEVkaXRvckFkYXB0ZXIoZWRpdG9yLCBjb25mbGljdFN0YXJ0Um93KTtcbiAgICAgIGNvbnN0IHZpc2l0b3IgPSBuZXcgQ29uZmxpY3RWaXNpdG9yKGVkaXRvciwgbGF5ZXIpO1xuICAgICAgY29uc3QgcGFyc2VyID0gbmV3IENvbmZsaWN0UGFyc2VyKGFkYXB0ZXIsIHZpc2l0b3IsIGlzUmViYXNlKTtcblxuICAgICAgaWYgKHBhcnNlci5wYXJzZSgpLndhc1N1Y2Nlc3NmdWwoKSkge1xuICAgICAgICBjb25mbGljdHMucHVzaCh2aXNpdG9yLmNvbmZsaWN0KCkpO1xuICAgICAgfVxuXG4gICAgICBsYXN0Um93ID0gYWRhcHRlci5nZXRDdXJyZW50Um93KCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29uZmxpY3RzO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgY29uZmxpY3QgbWFya2VycyBwcmVzZW50IGluIGEgc3RyZWFtZWQgZmlsZS5cbiAgICovXG4gIHN0YXRpYyBjb3VudEZyb21TdHJlYW0oc3RyZWFtLCBpc1JlYmFzZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgbGV0IGxhc3RSZXN1bHQgPSBudWxsO1xuICAgICAgbGV0IGxhc3RQYXJ0aWFsTWFya2VyID0gJyc7XG5cbiAgICAgIHN0cmVhbS5vbignZGF0YScsIGNodW5rID0+IHtcbiAgICAgICAgY29uc3QgYWRhcHRlciA9IG5ldyBDaHVua0FkYXB0ZXIobGFzdFBhcnRpYWxNYXJrZXIgKyBjaHVuayk7XG4gICAgICAgIGlmICghbGFzdFJlc3VsdCkge1xuICAgICAgICAgIGlmICghYWRhcHRlci5hZHZhbmNlVG8oQ09ORkxJQ1RfU1RBUlRfUkVHRVgpKSB7XG4gICAgICAgICAgICBsYXN0UGFydGlhbE1hcmtlciA9IGFkYXB0ZXIuZ2V0TGFzdFBhcnRpYWxNYXJrZXIoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZG8ge1xuICAgICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBDb25mbGljdFBhcnNlcihhZGFwdGVyLCBuZXcgTm9vcFZpc2l0b3IoKSwgaXNSZWJhc2UpO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGxhc3RSZXN1bHQgPyBwYXJzZXIuY29udGludWVGcm9tKGxhc3RSZXN1bHQpIDogcGFyc2VyLnBhcnNlKCk7XG5cbiAgICAgICAgICBpZiAocmVzdWx0Lndhc1N1Y2Nlc3NmdWwoKSkge1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGFzdFJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gd2hpbGUgKGFkYXB0ZXIuYWR2YW5jZVRvKENPTkZMSUNUX1NUQVJUX1JFR0VYKSk7XG5cbiAgICAgICAgbGFzdFBhcnRpYWxNYXJrZXIgPSBhZGFwdGVyLmdldExhc3RQYXJ0aWFsTWFya2VyKCk7XG4gICAgICB9KTtcblxuICAgICAgc3RyZWFtLm9uKCdlcnJvcicsIHJlamVjdCk7XG5cbiAgICAgIHN0cmVhbS5vbignZW5kJywgKCkgPT4gcmVzb2x2ZShjb3VudCkpO1xuICAgIH0pO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLFNBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLEtBQUEsR0FBQUMsc0JBQUEsQ0FBQUgsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUQsc0JBQUEsQ0FBQUgsT0FBQTtBQUNBLElBQUFLLFVBQUEsR0FBQUYsc0JBQUEsQ0FBQUgsT0FBQTtBQUVBLElBQUFNLE9BQUEsR0FBQU4sT0FBQTtBQUNBLElBQUFPLFFBQUEsR0FBQVAsT0FBQTtBQUNBLElBQUFRLFlBQUEsR0FBQVIsT0FBQTtBQUFrRCxTQUFBRyx1QkFBQU0sR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLEtBQUFFLE9BQUEsRUFBQUYsR0FBQTtBQUVsRDtBQUNBLE1BQU1HLG9CQUFvQixHQUFHLHdCQUF3Qjs7QUFHckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxlQUFlLENBQUM7RUFDcEI7QUFDRjtBQUNBO0FBQ0E7RUFDRUMsV0FBV0EsQ0FBQ0Ms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