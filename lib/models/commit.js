"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.nullCommit = exports.default = void 0;
var _patch = require("./patch");
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
const UNBORN = Symbol('unborn');

// Truncation elipsis styles
const WORD_ELIPSES = '...';
const NEWLINE_ELIPSES = '\n...';
const PARAGRAPH_ELIPSES = '\n\n...';
class Commit {
  static createUnborn() {
    return new Commit({
      unbornRef: UNBORN
    });
  }
  constructor({
    sha,
    author,
    coAuthors,
    authorDate,
    messageSubject,
    messageBody,
    unbornRef,
    patch
  }) {
    this.sha = sha;
    this.author = author;
    this.coAuthors = coAuthors || [];
    this.authorDate = authorDate;
    this.messageSubject = messageSubject;
    this.messageBody = messageBody;
    this.unbornRef = unbornRef === UNBORN;
    this.multiFileDiff = patch ? (0, _patch.buildMultiFilePatch)(patch) : (0, _patch.buildMultiFilePatch)([]);
  }
  getSha() {
    return this.sha;
  }
  getAuthor() {
    return this.author;
  }
  getAuthorEmail() {
    return this.author.getEmail();
  }
  getAuthorAvatarUrl() {
    return this.author.getAvatarUrl();
  }
  getAuthorName() {
    return this.author.getFullName();
  }
  getAuthorDate() {
    return this.authorDate;
  }
  getCoAuthors() {
    return this.coAuthors;
  }
  getMessageSubject() {
    return this.messageSubject;
  }
  getMessageBody() {
    return this.messageBody;
  }
  isBodyLong() {
    if (this.getMessageBody().length > this.constructor.LONG_MESSAGE_THRESHOLD) {
      return true;
    }
    if ((this.getMessageBody().match(/\r?\n/g) || []).length > this.constructor.NEWLINE_THRESHOLD) {
      return true;
    }
    return false;
  }
  getFullMessage() {
    return `${this.getMessageSubject()}\n\n${this.getMessageBody()}`.trim();
  }

  /*
   * Return the messageBody truncated to at most LONG_MESSAGE_THRESHOLD characters or NEWLINE_THRESHOLD newlines,
   * whichever comes first.
   *
   * If NEWLINE_THRESHOLD newlines are encountered before LONG_MESSAGE_THRESHOLD characters, the body will be truncated
   * at the last counted newline and elipses added.
   *
   * If a paragraph boundary is found before LONG_MESSAGE_THRESHOLD characters, the message will be truncated at the end
   * of the previous paragraph and an elipses added. If no paragraph boundary is found, but a word boundary is, the text
   * is truncated at the last word boundary and an elipsis added. If neither are found, the text is truncated hard at
   * LONG_MESSAGE_THRESHOLD - 3 characters and an elipsis is added.
   */
  abbreviatedBody() {
    if (!this.isBodyLong()) {
      return this.getMessageBody();
    }
    const {
      LONG_MESSAGE_THRESHOLD,
      NEWLINE_THRESHOLD
    } = this.constructor;
    let lastNewlineCutoff = null;
    let lastParagraphCutoff = null;
    let lastWordCutoff = null;
    const searchText = this.getMessageBody().substring(0, LONG_MESSAGE_THRESHOLD);
    const boundaryRx = /\s+/g;
    let result;
    let lineCount = 0;
    while ((result = boundaryRx.exec(searchText)) !== null) {
      const newlineCount = (result[0].match(/\r?\n/g) || []).length;
      lineCount += newlineCount;
      if (lineCount > NEWLINE_THRESHOLD) {
        lastNewlineCutoff = result.index;
        break;
      }
      if (newlineCount < 2 && result.index <= LONG_MESSAGE_THRESHOLD - WORD_ELIPSES.length) {
        lastWordCutoff = result.index;
      } else if (result.index < LONG_MESSAGE_THRESHOLD - PARAGRAPH_ELIPSES.length) {
        lastParagraphCutoff = result.index;
      }
    }
    let elipses = WORD_ELIPSES;
    let cutoffIndex = LONG_MESSAGE_THRESHOLD - WORD_ELIPSES.length;
    if (lastNewlineCutoff !== null) {
      elipses = NEWLINE_ELIPSES;
      cutoffIndex = lastNewlineCutoff;
    } else if (lastParagraphCutoff !== null) {
      elipses = PARAGRAPH_ELIPSES;
      cutoffIndex = lastParagraphCutoff;
    } else if (lastWordCutoff !== null) {
      cutoffIndex = lastWordCutoff;
    }
    return this.getMessageBody().substring(0, cutoffIndex) + elipses;
  }
  setMultiFileDiff(multiFileDiff) {
    this.multiFileDiff = multiFileDiff;
  }
  getMultiFileDiff() {
    return this.multiFileDiff;
  }
  isUnbornRef() {
    return this.unbornRef;
  }
  isPresent() {
    return true;
  }
  isEqual(other) {
    // Directly comparable properties
    const properties = ['sha', 'authorDate', 'messageSubject', 'messageBody', 'unbornRef'];
    for (const property of properties) {
      if (this[property] !== other[property]) {
        return false;
      }
    }

    // Author
    if (this.author.getEmail() !== other.getAuthorEmail() || this.author.getFullName() !== other.getAuthorName()) {
      return false;
    }

    // Co-author array
    if (this.coAuthors.length !== other.coAuthors.length) {
      return false;
    }
    for (let i = 0; i < this.coAuthors.length; i++) {
      const thisCoAuthor = this.coAuthors[i];
      const otherCoAuthor = other.coAuthors[i];
      if (thisCoAuthor.getFullName() !== otherCoAuthor.getFullName() || thisCoAuthor.getEmail() !== otherCoAuthor.getEmail()) {
        return false;
      }
    }

    // Multi-file patch
    if (!this.multiFileDiff.isEqual(other.multiFileDiff)) {
      return false;
    }
    return true;
  }
}
exports.default = Commit;
_defineProperty(Commit, "LONG_MESSAGE_THRESHOLD", 400);
_defineProperty(Commit, "NEWLINE_THRESHOLD", 5);
const nullCommit = {
  getSha() {
    return '';
  },
  getMessageSubject() {
    return '';
  },
  isUnbornRef() {
    return false;
  },
  isPresent() {
    return false;
  },
  isBodyLong() {
    return false;
  }
};
exports.nullCommit = nullCommit;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcGF0Y2giLCJyZXF1aXJlIiwiX2RlZmluZVByb3BlcnR5Iiwib2JqIiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwidCIsImkiLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJyIiwiZSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiY2FsbCIsIlR5cGVFcnJvciIsIk51bWJlciIsIlVOQk9STiIsIldPUkRfRUxJUFNFUyIsIk5FV0xJTkVfRUxJUFNFUyIsIlBBUkFHUkFQSF9FTElQU0VTIiwiQ29tbWl0IiwiY3JlYXRlVW5ib3JuIiwidW5ib3JuUmVmIiwiY29uc3RydWN0b3IiLCJzaGEiLCJhdXRob3IiLCJjb0F1dGhvcnMiLCJhdXRob3JEYXRlIiwibWVzc2FnZVN1YmplY3QiLCJtZXNzYWdlQm9keSIsInBhdGNoIiwibXVsdGlGaWxlRGlmZiIsImJ1aWxkTXVsdGlGaWxlUGF0Y2giLCJnZXRTaGEiLCJnZXRBdXRob3IiLCJnZXRBdXRob3JFbWFpbCIsImdldEVtYWlsIiwiZ2V0QXV0aG9yQXZhdGFyVXJsIiwiZ2V0QXZhdGFyVXJsIiwiZ2V0QXV0aG9yTmFtZSIsImdldEZ1bGxOYW1lIiwiZ2V0QXV0aG9yRGF0ZSIsImdldENvQXV0aG9ycyIsImdldE1lc3NhZ2VTdWJqZWN0IiwiZ2V0TWVzc2FnZUJvZHkiLCJpc0JvZHlMb25nIiwibGVuZ3RoIiwiTE9OR19NRVNTQUdFX1RIUkVTSE9MRCIsIm1hdGNoIiwiTkVXTElORV9USFJFU0hPTEQiLCJnZXRGdWxsTWVzc2FnZSIsInRyaW0iLCJhYmJyZXZpYXRlZEJvZHkiLCJsYXN0TmV3bGluZUN1dG9mZiIsImxhc3RQYXJhZ3JhcGhDdXRvZmYiLCJsYXN0V29yZEN1dG9mZiIsInNlYXJjaFRleHQiLCJzdWJzdHJpbmciLCJib3VuZGFyeVJ4IiwicmVzdWx0IiwibGluZUNvdW50IiwiZXhlYyIsIm5ld2xpbmVDb3VudCIsImluZGV4IiwiZWxpcHNlcyIsImN1dG9mZkluZGV4Iiwic2V0TXVsdGlGaWxlRGlmZiIsImdldE11bHRpRmlsZURpZmYiLCJpc1VuYm9yblJlZiIsImlzUHJlc2VudCIsImlzRXF1YWwiLCJvdGhlciIsInByb3BlcnRpZXMiLCJwcm9wZXJ0eSIsInRoaXNDb0F1dGhvciIsIm90aGVyQ29BdXRob3IiLCJleHBvcnRzIiwiZGVmYXVsdCIsIm51bGxDb21taXQiXSwic291cmNlcyI6WyJjb21taXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtidWlsZE11bHRpRmlsZVBhdGNofSBmcm9tICcuL3BhdGNoJztcblxuY29uc3QgVU5CT1JOID0gU3ltYm9sKCd1bmJvcm4nKTtcblxuLy8gVHJ1bmNhdGlvbiBlbGlwc2lzIHN0eWxlc1xuY29uc3QgV09SRF9FTElQU0VTID0gJy4uLic7XG5jb25zdCBORVdMSU5FX0VMSVBTRVMgPSAnXFxuLi4uJztcbmNvbnN0IFBBUkFHUkFQSF9FTElQU0VTID0gJ1xcblxcbi4uLic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbW1pdCB7XG4gIHN0YXRpYyBMT05HX01FU1NBR0VfVEhSRVNIT0xEID0gNDAwO1xuXG4gIHN0YXRpYyBORVdMSU5FX1RIUkVTSE9MRCA9IDU7XG5cbiAgc3RhdGljIGNyZWF0ZVVuYm9ybigpIHtcbiAgICByZXR1cm4gbmV3IENvbW1pdCh7dW5ib3JuUmVmOiBVTkJPUk59KTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHtzaGEsIGF1dGhvciwgY29BdXRob3JzLCBhdXRob3JEYXRlLCBtZXNzYWdlU3ViamVjdCwgbWVzc2FnZUJvZHksIHVuYm9yblJlZiwgcGF0Y2h9KSB7XG4gICAgdGhpcy5zaGEgPSBzaGE7XG4gICAgdGhpcy5hdXRob3IgPSBhdXRob3I7XG4gICAgdGhpcy5jb0F1dGhvcnMgPSBjb0F1dGhvcnMgfHwgW107XG4gICAgdGhpcy5hdXRob3JEYXRlID0gYXV0aG9yRGF0ZTtcbiAgICB0aGlzLm1lc3NhZ2VTdWJqZWN0ID0gbWVzc2FnZVN1YmplY3Q7XG4gICAgdGhpcy5tZXNzYWdlQm9keSA9IG1lc3NhZ2VCb2R5O1xuICAgIHRoaXMudW5ib3JuUmVmID0gdW5ib3JuUmVmID09PSBVTkJPUk47XG5cbiAgICB0aGlzLm11bHRpRmlsZURpZmYgPSBwYXRjaCA/IGJ1aWxkTXVsdGlGaWxlUGF0Y2gocGF0Y2gpIDogYnVpbGRNdWx0aUZpbGVQYXRjaChbXSk7XG4gIH1cblxuICBnZXRTaGEoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2hhO1xuICB9XG5cbiAgZ2V0QXV0aG9yKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhvcjtcbiAgfVxuXG4gIGdldEF1dGhvckVtYWlsKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhvci5nZXRFbWFpbCgpO1xuICB9XG5cbiAgZ2V0QXV0aG9yQXZhdGFyVXJsKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhvci5nZXRBdmF0YXJVcmwoKTtcbiAgfVxuXG4gIGdldEF1dGhvck5hbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXV0aG9yLmdldEZ1bGxOYW1lKCk7XG4gIH1cblxuICBnZXRBdXRob3JEYXRlKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhvckRhdGU7XG4gIH1cblxuICBnZXRDb0F1dGhvcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29BdXRob3JzO1xuICB9XG5cbiAgZ2V0TWVzc2FnZVN1YmplY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZVN1YmplY3Q7XG4gIH1cblxuICBnZXRNZXNzYWdlQm9keSgpIHtcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdlQm9keTtcbiAgfVxuXG4gIGlzQm9keUxvbmcoKSB7XG4gICAgaWYgKHRoaXMuZ2V0TWVzc2FnZUJvZHkoKS5sZW5ndGggPiB0aGlzLmNvbnN0cnVjdG9yLkxPTkdfTUVTU0FHRV9USFJFU0hPTEQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICgodGhpcy5nZXRNZXNzYWdlQm9keSgpLm1hdGNoKC9cXHI/XFxuL2cpIHx8IFtdKS5sZW5ndGggPiB0aGlzLmNvbnN0cnVjdG9yLk5FV0xJTkVfVEhSRVNIT0xEKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXRGdWxsTWVzc2FnZSgpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5nZXRNZXNzYWdlU3ViamVjdCgpfVxcblxcbiR7dGhpcy5nZXRNZXNzYWdlQm9keSgpfWAudHJpbSgpO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJuIHRoZSBtZXNzYWdlQm9keSB0cnVuY2F0ZWQgdG8gYXQgbW9zdCBMT05HX01FU1NBR0VfVEhSRVNIT0xEIGNoYXJhY3RlcnMgb3IgTkVXTElORV9USFJFU0hPTEQgbmV3bGluZXMsXG4gICAqIHdoaWNoZXZlciBjb21lcyBmaXJzdC5cbiAgICpcbiAgICogSWYgTkVXTElORV9USFJFU0hPTEQgbmV3bGluZXMgYXJlIGVuY291bnRlcmVkIGJlZm9yZSBMT05HX01FU1NBR0VfVEhSRVNIT0xEIGNoYXJhY3RlcnMsIHRoZSBib2R5IHdpbGwgYmUgdHJ1bmNhdGVkXG4gICAqIGF0IHRoZSBsYXN0IGNvdW50ZWQgbmV3bGluZSBhbmQgZWxpcHNlcyBhZGRlZC5cbiAgICpcbiAgICogSWYgYSBwYXJhZ3JhcGggYm91bmRhcnkgaXMgZm91bmQgYmVmb3JlIExPTkdfTUVTU0FHRV9USFJFU0hPTEQgY2hhcmFjdGVycywgdGhlIG1lc3NhZ2Ugd2lsbCBiZSB0cnVuY2F0ZWQgYXQgdGhlIGVuZFxuICAgKiBvZiB0aGUgcHJldmlvdXMgcGFyYWdyYXBoIGFuZCBhbiBlbGlwc2VzIGFkZGVkLiBJZiBubyBwYXJhZ3JhcGggYm91bmRhcnkgaXMgZm91bmQsIGJ1dCBhIHdvcmQgYm91bmRhcnkgaXMsIHRoZSB0ZXh0XG4gICAqIGlzIHRydW5jYXRlZCBhdCB0aGUgbGFzdCB3b3JkIGJvdW5kYXJ5IGFuZCBhbiBlbGlwc2lzIGFkZGVkLiBJZiBuZWl0aGVyIGFyZSBmb3VuZCwgdGhlIHRleHQgaXMgdHJ1bmNhdGVkIGhhcmQgYXRcbiAgICogTE9OR19NRVNTQUdFX1RIUkVTSE9MRCAtIDMgY2hhcmFjdGVycyBhbmQgYW4gZWxpcHNpcyBpcyBhZGRlZC5cbiAgICovXG4gIGFiYnJldmlhdGVkQm9keSgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb2R5TG9uZygpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRNZXNzYWdlQm9keSgpO1xuICAgIH1cblxuICAgIGNvbnN0IHtMT05HX01FU1NBR0VfVEhSRVNIT0xELCBORVdMSU5FX1RIUkVTSE9MRH0gPSB0aGlzLmNvbnN0cnVjdG9yO1xuXG4gICAgbGV0IGxhc3ROZXdsaW5lQ3V0b2ZmID0gbnVsbDtcbiAgICBsZXQgbGFzdFBhcmFncmFwaEN1dG9mZiA9IG51bGw7XG4gICAgbGV0IGxhc3RXb3JkQ3V0b2ZmID0gbnVsbDtcblxuICAgIGNvbnN0IHNlYXJjaFRleHQgPSB0aGlzLmdldE1lc3NhZ2VCb2R5KCkuc3Vic3RyaW5nKDAsIExPTkdfTUVTU0FHRV9USFJFU0hPTEQpO1xuICAgIGNvbnN0IGJvdW5kYXJ5UnggPSAvXFxzKy9nO1xuICAgIGxldCByZXN1bHQ7XG4gICAgbGV0IGxpbmVDb3VudCA9IDA7XG4gICAgd2hpbGUgKChyZXN1bHQgPSBib3VuZGFyeVJ4LmV4ZWMoc2VhcmNoVGV4dCkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBuZXdsaW5lQ291bnQgPSAocmVzdWx0WzBdLm1hdGNoKC9cXHI/XFxuL2cpIHx8IFtdKS5sZW5ndGg7XG5cbiAgICAgIGxpbmVDb3VudCArPSBuZXdsaW5lQ291bnQ7XG4gICAgICBpZiAobGluZUNvdW50ID4gTkVXTElORV9USFJFU0hPTEQpIHtcbiAgICAgICAgbGFzdE5ld2xpbmVDdXRvZmYgPSByZXN1bHQuaW5kZXg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBpZiAobmV3bGluZUNvdW50IDwgMiAmJiByZXN1bHQuaW5kZXggPD0gTE9OR19NRVNTQUdFX1RIUkVTSE9MRCAtIFdPUkRfRUxJUFNFUy5sZW5ndGgpIHtcbiAgICAgICAgbGFzdFdvcmRDdXRvZmYgPSByZXN1bHQuaW5kZXg7XG4gICAgICB9IGVsc2UgaWYgKHJlc3VsdC5pbmRleCA8IExPTkdfTUVTU0FHRV9USFJFU0hPTEQgLSBQQVJBR1JBUEhfRUxJUFNFUy5sZW5ndGgpIHtcbiAgICAgICAgbGFzdFBhcmFncmFwaEN1dG9mZiA9IHJlc3VsdC5pbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgZWxpcHNlcyA9IFdPUkRfRUxJUFNFUztcbiAgICBsZXQgY3V0b2ZmSW5kZXggPSBMT05HX01FU1NBR0VfVEhSRVNIT0xEIC0gV09SRF9FTElQU0VTLmxlbmd0aDtcbiAgICBpZiAobGFzdE5ld2xpbmVDdXRvZmYgIT09IG51bGwpIHtcbiAgICAgIGVsaXBzZXMgPSBORVdMSU5FX0VMSVBTRVM7XG4gICAgICBjdXRvZmZJbmRleCA9IGxhc3ROZXdsaW5lQ3V0b2ZmO1xuICAgIH0gZWxzZSBpZiAobGFzdFBhcmFncmFwaEN1dG9mZiAhPT0gbnVsbCkge1xuICAgICAgZWxpcHNlcyA9IFBBUkFHUkFQSF9FTElQU0VTO1xuICAgICAgY3V0b2ZmSW5kZXggPSBsYXN0UGFyYWdyYXBoQ3V0b2ZmO1xuICAgIH0gZWxzZSBpZiAobGFzdFdvcmRDdXRvZmYgIT09IG51bGwpIHtcbiAgICAgIGN1dG9mZkluZGV4ID0gbGFzdFdvcmRDdXRvZmY7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZ2V0TWVzc2FnZUJvZHkoKS5zdWJzdHJpbmcoMCwgY3V0b2ZmSW5kZXgpICsgZWxpcHNlcztcbiAgfVxuXG4gIHNldE11bHRpRmlsZURpZmYobXVsdGlGaWxlRGlmZikge1xuICAgIHRoaXMubXVsdGlGaWxlRGlmZiA9IG11bHRpRmlsZURpZmY7XG4gIH1cblxuICBnZXRNdWx0aUZpbGVEaWZmKCkge1xuICAgIHJldHVybiB0aGlzLm11bHRpRmlsZURpZmY7XG4gIH1cblxuICBpc1VuYm9yblJlZigpIHtcbiAgICByZXR1cm4gdGhpcy51bmJvcm5SZWY7XG4gIH1cblxuICBpc1ByZXNlbnQoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpc0VxdWFsKG90aGVyKSB7XG4gICAgLy8gRGlyZWN0bHkgY29tcGFyYWJsZSBwcm9wZXJ0aWVzXG4gICAgY29uc3QgcHJvcGVydGllcyA9IFsnc2hhJywgJ2F1dGhvckRhdGUnLCAnbWVzc2FnZVN1YmplY3QnLCAnbWVzc2FnZUJvZHknLCAndW5ib3JuUmVmJ107XG4gICAgZm9yIChjb25zdCBwcm9wZXJ0eSBvZiBwcm9wZXJ0aWVzKSB7XG4gICAgICBpZiAodGhpc1twcm9wZXJ0eV0gIT09IG90aGVyW3Byb3BlcnR5XSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQXV0aG9yXG4gICAgaWYgKHRoaXMuYXV0aG9yLmdldEVtYWlsKCkgIT09IG90aGVyLmdldEF1dGhvckVtYWlsKCkgfHwgdGhpcy5hdXRob3IuZ2V0RnVsbE5hbWUoKSAhPT0gb3RoZXIuZ2V0QXV0aG9yTmFtZSgpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ28tYXV0aG9yIGFycmF5XG4gICAgaWYgKHRoaXMuY29BdXRob3JzLmxlbmd0aCAhPT0gb3RoZXIuY29BdXRob3JzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29BdXRob3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0aGlzQ29BdXRob3IgPSB0aGlzLmNvQXV0aG9yc1tpXTtcbiAgICAgIGNvbnN0IG90aGVyQ29BdXRob3IgPSBvdGhlci5jb0F1dGhvcnNbaV07XG5cbiAgICAgIGlmIChcbiAgICAgICAgdGhpc0NvQXV0aG9yLmdldEZ1bGxOYW1lKCkgIT09IG90aGVyQ29BdXRob3IuZ2V0RnVsbE5hbWUoKVxuICAgICAgICB8fCB0aGlzQ29BdXRob3IuZ2V0RW1haWwoKSAhPT0gb3RoZXJDb0F1dGhvci5nZXRFbWFpbCgpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE11bHRpLWZpbGUgcGF0Y2hcbiAgICBpZiAoIXRoaXMubXVsdGlGaWxlRGlmZi5pc0VxdWFsKG90aGVyLm11bHRpRmlsZURpZmYpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IG51bGxDb21taXQgPSB7XG4gIGdldFNoYSgpIHtcbiAgICByZXR1cm4gJyc7XG4gIH0sXG5cbiAgZ2V0TWVzc2FnZVN1YmplY3QoKSB7XG4gICAgcmV0dXJuICcnO1xuICB9LFxuXG4gIGlzVW5ib3JuUmVmKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBpc1ByZXNlbnQoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIGlzQm9keUxvbmcoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxufTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBQTRDLFNBQUFDLGdCQUFBQyxHQUFBLEVBQUFDLEdBQUEsRUFBQUMsS0FBQSxJQUFBRCxHQUFBLEdBQUFFLGNBQUEsQ0FBQUYsR0FBQSxPQUFBQSxHQUFBLElBQUFELEdBQUEsSUFBQUksTUFBQSxDQUFBQyxjQUFBLENBQUFMLEdBQUEsRUFBQUMsR0FBQSxJQUFBQyxLQUFBLEVBQUFBLEtBQUEsRUFBQUksVUFBQSxRQUFBQyxZQUFBLFFBQUFDLFFBQUEsb0JBQUFSLEdBQUEsQ0FBQUMsR0FBQSxJQUFBQyxLQUFBLFdBQUFGLEdBQUE7QUFBQSxTQUFBRyxlQUFBTSxDQUFBLFFBQUFDLENBQUEsR0FBQUMsWUFBQSxDQUFBRixDQUFBLHVDQUFBQyxDQUFBLEdBQUFBLENBQUEsR0FBQUUsTUFBQSxDQUFBRixDQUFBO0FBQUEsU0FBQUMsYUFB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