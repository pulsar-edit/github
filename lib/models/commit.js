"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.nullCommit = exports.default = void 0;
var _patch = require("./patch");
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const UNBORN = Symbol('unborn');

// Truncation elipsis styles
const WORD_ELIPSES = '...';
const NEWLINE_ELIPSES = '\n...';
const PARAGRAPH_ELIPSES = '\n\n...';
class Commit {
  static createUnborn() {
    return new Commit({
      unbornRef: UNBORN
    });
  }
  constructor({
    sha,
    author,
    coAuthors,
    authorDate,
    messageSubject,
    messageBody,
    unbornRef,
    patch
  }) {
    this.sha = sha;
    this.author = author;
    this.coAuthors = coAuthors || [];
    this.authorDate = authorDate;
    this.messageSubject = messageSubject;
    this.messageBody = messageBody;
    this.unbornRef = unbornRef === UNBORN;
    this.multiFileDiff = patch ? (0, _patch.buildMultiFilePatch)(patch) : (0, _patch.buildMultiFilePatch)([]);
  }
  getSha() {
    return this.sha;
  }
  getAuthor() {
    return this.author;
  }
  getAuthorEmail() {
    return this.author.getEmail();
  }
  getAuthorAvatarUrl() {
    return this.author.getAvatarUrl();
  }
  getAuthorName() {
    return this.author.getFullName();
  }
  getAuthorDate() {
    return this.authorDate;
  }
  getCoAuthors() {
    return this.coAuthors;
  }
  getMessageSubject() {
    return this.messageSubject;
  }
  getMessageBody() {
    return this.messageBody;
  }
  isBodyLong() {
    if (this.getMessageBody().length > this.constructor.LONG_MESSAGE_THRESHOLD) {
      return true;
    }
    if ((this.getMessageBody().match(/\r?\n/g) || []).length > this.constructor.NEWLINE_THRESHOLD) {
      return true;
    }
    return false;
  }
  getFullMessage() {
    return `${this.getMessageSubject()}\n\n${this.getMessageBody()}`.trim();
  }

  /*
   * Return the messageBody truncated to at most LONG_MESSAGE_THRESHOLD characters or NEWLINE_THRESHOLD newlines,
   * whichever comes first.
   *
   * If NEWLINE_THRESHOLD newlines are encountered before LONG_MESSAGE_THRESHOLD characters, the body will be truncated
   * at the last counted newline and elipses added.
   *
   * If a paragraph boundary is found before LONG_MESSAGE_THRESHOLD characters, the message will be truncated at the end
   * of the previous paragraph and an elipses added. If no paragraph boundary is found, but a word boundary is, the text
   * is truncated at the last word boundary and an elipsis added. If neither are found, the text is truncated hard at
   * LONG_MESSAGE_THRESHOLD - 3 characters and an elipsis is added.
   */
  abbreviatedBody() {
    if (!this.isBodyLong()) {
      return this.getMessageBody();
    }
    const {
      LONG_MESSAGE_THRESHOLD,
      NEWLINE_THRESHOLD
    } = this.constructor;
    let lastNewlineCutoff = null;
    let lastParagraphCutoff = null;
    let lastWordCutoff = null;
    const searchText = this.getMessageBody().substring(0, LONG_MESSAGE_THRESHOLD);
    const boundaryRx = /\s+/g;
    let result;
    let lineCount = 0;
    while ((result = boundaryRx.exec(searchText)) !== null) {
      const newlineCount = (result[0].match(/\r?\n/g) || []).length;
      lineCount += newlineCount;
      if (lineCount > NEWLINE_THRESHOLD) {
        lastNewlineCutoff = result.index;
        break;
      }
      if (newlineCount < 2 && result.index <= LONG_MESSAGE_THRESHOLD - WORD_ELIPSES.length) {
        lastWordCutoff = result.index;
      } else if (result.index < LONG_MESSAGE_THRESHOLD - PARAGRAPH_ELIPSES.length) {
        lastParagraphCutoff = result.index;
      }
    }
    let elipses = WORD_ELIPSES;
    let cutoffIndex = LONG_MESSAGE_THRESHOLD - WORD_ELIPSES.length;
    if (lastNewlineCutoff !== null) {
      elipses = NEWLINE_ELIPSES;
      cutoffIndex = lastNewlineCutoff;
    } else if (lastParagraphCutoff !== null) {
      elipses = PARAGRAPH_ELIPSES;
      cutoffIndex = lastParagraphCutoff;
    } else if (lastWordCutoff !== null) {
      cutoffIndex = lastWordCutoff;
    }
    return this.getMessageBody().substring(0, cutoffIndex) + elipses;
  }
  setMultiFileDiff(multiFileDiff) {
    this.multiFileDiff = multiFileDiff;
  }
  getMultiFileDiff() {
    return this.multiFileDiff;
  }
  isUnbornRef() {
    return this.unbornRef;
  }
  isPresent() {
    return true;
  }
  isEqual(other) {
    // Directly comparable properties
    const properties = ['sha', 'authorDate', 'messageSubject', 'messageBody', 'unbornRef'];
    for (const property of properties) {
      if (this[property] !== other[property]) {
        return false;
      }
    }

    // Author
    if (this.author.getEmail() !== other.getAuthorEmail() || this.author.getFullName() !== other.getAuthorName()) {
      return false;
    }

    // Co-author array
    if (this.coAuthors.length !== other.coAuthors.length) {
      return false;
    }
    for (let i = 0; i < this.coAuthors.length; i++) {
      const thisCoAuthor = this.coAuthors[i];
      const otherCoAuthor = other.coAuthors[i];
      if (thisCoAuthor.getFullName() !== otherCoAuthor.getFullName() || thisCoAuthor.getEmail() !== otherCoAuthor.getEmail()) {
        return false;
      }
    }

    // Multi-file patch
    if (!this.multiFileDiff.isEqual(other.multiFileDiff)) {
      return false;
    }
    return true;
  }
}
exports.default = Commit;
_defineProperty(Commit, "LONG_MESSAGE_THRESHOLD", 400);
_defineProperty(Commit, "NEWLINE_THRESHOLD", 5);
const nullCommit = {
  getSha() {
    return '';
  },
  getMessageSubject() {
    return '';
  },
  isUnbornRef() {
    return false;
  },
  isPresent() {
    return false;
  },
  isBodyLong() {
    return false;
  }
};
exports.nullCommit = nullCommit;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcGF0Y2giLCJyZXF1aXJlIiwiX2RlZmluZVByb3BlcnR5Iiwib2JqIiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiY2FsbCIsIlR5cGVFcnJvciIsIk51bWJlciIsIlVOQk9STiIsIldPUkRfRUxJUFNFUyIsIk5FV0xJTkVfRUxJUFNFUyIsIlBBUkFHUkFQSF9FTElQU0VTIiwiQ29tbWl0IiwiY3JlYXRlVW5ib3JuIiwidW5ib3JuUmVmIiwiY29uc3RydWN0b3IiLCJzaGEiLCJhdXRob3IiLCJjb0F1dGhvcnMiLCJhdXRob3JEYXRlIiwibWVzc2FnZVN1YmplY3QiLCJtZXNzYWdlQm9keSIsInBhdGNoIiwibXVsdGlGaWxlRGlmZiIsImJ1aWxkTXVsdGlGaWxlUGF0Y2giLCJnZXRTaGEiLCJnZXRBdXRob3IiLCJnZXRBdXRob3JFbWFpbCIsImdldEVtYWlsIiwiZ2V0QXV0aG9yQXZhdGFyVXJsIiwiZ2V0QXZhdGFyVXJsIiwiZ2V0QXV0aG9yTmFtZSIsImdldEZ1bGxOYW1lIiwiZ2V0QXV0aG9yRGF0ZSIsImdldENvQXV0aG9ycyIsImdldE1lc3NhZ2VTdWJqZWN0IiwiZ2V0TWVzc2FnZUJvZHkiLCJpc0JvZHlMb25nIiwibGVuZ3RoIiwiTE9OR19NRVNTQUdFX1RIUkVTSE9MRCIsIm1hdGNoIiwiTkVXTElORV9USFJFU0hPTEQiLCJnZXRGdWxsTWVzc2FnZSIsInRyaW0iLCJhYmJyZXZpYXRlZEJvZHkiLCJsYXN0TmV3bGluZUN1dG9mZiIsImxhc3RQYXJhZ3JhcGhDdXRvZmYiLCJsYXN0V29yZEN1dG9mZiIsInNlYXJjaFRleHQiLCJzdWJzdHJpbmciLCJib3VuZGFyeVJ4IiwicmVzdWx0IiwibGluZUNvdW50IiwiZXhlYyIsIm5ld2xpbmVDb3VudCIsImluZGV4IiwiZWxpcHNlcyIsImN1dG9mZkluZGV4Iiwic2V0TXVsdGlGaWxlRGlmZiIsImdldE11bHRpRmlsZURpZmYiLCJpc1VuYm9yblJlZiIsImlzUHJlc2VudCIsImlzRXF1YWwiLCJvdGhlciIsInByb3BlcnRpZXMiLCJwcm9wZXJ0eSIsImkiLCJ0aGlzQ29BdXRob3IiLCJvdGhlckNvQXV0aG9yIiwiZXhwb3J0cyIsImRlZmF1bHQiLCJudWxsQ29tbWl0Il0sInNvdXJjZXMiOlsiY29tbWl0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YnVpbGRNdWx0aUZpbGVQYXRjaH0gZnJvbSAnLi9wYXRjaCc7XG5cbmNvbnN0IFVOQk9STiA9IFN5bWJvbCgndW5ib3JuJyk7XG5cbi8vIFRydW5jYXRpb24gZWxpcHNpcyBzdHlsZXNcbmNvbnN0IFdPUkRfRUxJUFNFUyA9ICcuLi4nO1xuY29uc3QgTkVXTElORV9FTElQU0VTID0gJ1xcbi4uLic7XG5jb25zdCBQQVJBR1JBUEhfRUxJUFNFUyA9ICdcXG5cXG4uLi4nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21taXQge1xuICBzdGF0aWMgTE9OR19NRVNTQUdFX1RIUkVTSE9MRCA9IDQwMDtcblxuICBzdGF0aWMgTkVXTElORV9USFJFU0hPTEQgPSA1O1xuXG4gIHN0YXRpYyBjcmVhdGVVbmJvcm4oKSB7XG4gICAgcmV0dXJuIG5ldyBDb21taXQoe3VuYm9yblJlZjogVU5CT1JOfSk7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcih7c2hhLCBhdXRob3IsIGNvQXV0aG9ycywgYXV0aG9yRGF0ZSwgbWVzc2FnZVN1YmplY3QsIG1lc3NhZ2VCb2R5LCB1bmJvcm5SZWYsIHBhdGNofSkge1xuICAgIHRoaXMuc2hhID0gc2hhO1xuICAgIHRoaXMuYXV0aG9yID0gYXV0aG9yO1xuICAgIHRoaXMuY29BdXRob3JzID0gY29BdXRob3JzIHx8IFtdO1xuICAgIHRoaXMuYXV0aG9yRGF0ZSA9IGF1dGhvckRhdGU7XG4gICAgdGhpcy5tZXNzYWdlU3ViamVjdCA9IG1lc3NhZ2VTdWJqZWN0O1xuICAgIHRoaXMubWVzc2FnZUJvZHkgPSBtZXNzYWdlQm9keTtcbiAgICB0aGlzLnVuYm9yblJlZiA9IHVuYm9yblJlZiA9PT0gVU5CT1JOO1xuXG4gICAgdGhpcy5tdWx0aUZpbGVEaWZmID0gcGF0Y2ggPyBidWlsZE11bHRpRmlsZVBhdGNoKHBhdGNoKSA6IGJ1aWxkTXVsdGlGaWxlUGF0Y2goW10pO1xuICB9XG5cbiAgZ2V0U2hhKCkge1xuICAgIHJldHVybiB0aGlzLnNoYTtcbiAgfVxuXG4gIGdldEF1dGhvcigpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRob3I7XG4gIH1cblxuICBnZXRBdXRob3JFbWFpbCgpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRob3IuZ2V0RW1haWwoKTtcbiAgfVxuXG4gIGdldEF1dGhvckF2YXRhclVybCgpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRob3IuZ2V0QXZhdGFyVXJsKCk7XG4gIH1cblxuICBnZXRBdXRob3JOYW1lKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhvci5nZXRGdWxsTmFtZSgpO1xuICB9XG5cbiAgZ2V0QXV0aG9yRGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRob3JEYXRlO1xuICB9XG5cbiAgZ2V0Q29BdXRob3JzKCkge1xuICAgIHJldHVybiB0aGlzLmNvQXV0aG9ycztcbiAgfVxuXG4gIGdldE1lc3NhZ2VTdWJqZWN0KCkge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2VTdWJqZWN0O1xuICB9XG5cbiAgZ2V0TWVzc2FnZUJvZHkoKSB7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZUJvZHk7XG4gIH1cblxuICBpc0JvZHlMb25nKCkge1xuICAgIGlmICh0aGlzLmdldE1lc3NhZ2VCb2R5KCkubGVuZ3RoID4gdGhpcy5jb25zdHJ1Y3Rvci5MT05HX01FU1NBR0VfVEhSRVNIT0xEKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoKHRoaXMuZ2V0TWVzc2FnZUJvZHkoKS5tYXRjaCgvXFxyP1xcbi9nKSB8fCBbXSkubGVuZ3RoID4gdGhpcy5jb25zdHJ1Y3Rvci5ORVdMSU5FX1RIUkVTSE9MRCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZ2V0RnVsbE1lc3NhZ2UoKSB7XG4gICAgcmV0dXJuIGAke3RoaXMuZ2V0TWVzc2FnZVN1YmplY3QoKX1cXG5cXG4ke3RoaXMuZ2V0TWVzc2FnZUJvZHkoKX1gLnRyaW0oKTtcbiAgfVxuXG4gIC8qXG4gICAqIFJldHVybiB0aGUgbWVzc2FnZUJvZHkgdHJ1bmNhdGVkIHRvIGF0IG1vc3QgTE9OR19NRVNTQUdFX1RIUkVTSE9MRCBjaGFyYWN0ZXJzIG9yIE5FV0xJTkVfVEhSRVNIT0xEIG5ld2xpbmVzLFxuICAgKiB3aGljaGV2ZXIgY29tZXMgZmlyc3QuXG4gICAqXG4gICAqIElmIE5FV0xJTkVfVEhSRVNIT0xEIG5ld2xpbmVzIGFyZSBlbmNvdW50ZXJlZCBiZWZvcmUgTE9OR19NRVNTQUdFX1RIUkVTSE9MRCBjaGFyYWN0ZXJzLCB0aGUgYm9keSB3aWxsIGJlIHRydW5jYXRlZFxuICAgKiBhdCB0aGUgbGFzdCBjb3VudGVkIG5ld2xpbmUgYW5kIGVsaXBzZXMgYWRkZWQuXG4gICAqXG4gICAqIElmIGEgcGFyYWdyYXBoIGJvdW5kYXJ5IGlzIGZvdW5kIGJlZm9yZSBMT05HX01FU1NBR0VfVEhSRVNIT0xEIGNoYXJhY3RlcnMsIHRoZSBtZXNzYWdlIHdpbGwgYmUgdHJ1bmNhdGVkIGF0IHRoZSBlbmRcbiAgICogb2YgdGhlIHByZXZpb3VzIHBhcmFncmFwaCBhbmQgYW4gZWxpcHNlcyBhZGRlZC4gSWYgbm8gcGFyYWdyYXBoIGJvdW5kYXJ5IGlzIGZvdW5kLCBidXQgYSB3b3JkIGJvdW5kYXJ5IGlzLCB0aGUgdGV4dFxuICAgKiBpcyB0cnVuY2F0ZWQgYXQgdGhlIGxhc3Qgd29yZCBib3VuZGFyeSBhbmQgYW4gZWxpcHNpcyBhZGRlZC4gSWYgbmVpdGhlciBhcmUgZm91bmQsIHRoZSB0ZXh0IGlzIHRydW5jYXRlZCBoYXJkIGF0XG4gICAqIExPTkdfTUVTU0FHRV9USFJFU0hPTEQgLSAzIGNoYXJhY3RlcnMgYW5kIGFuIGVsaXBzaXMgaXMgYWRkZWQuXG4gICAqL1xuICBhYmJyZXZpYXRlZEJvZHkoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm9keUxvbmcoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TWVzc2FnZUJvZHkoKTtcbiAgICB9XG5cbiAgICBjb25zdCB7TE9OR19NRVNTQUdFX1RIUkVTSE9MRCwgTkVXTElORV9USFJFU0hPTER9ID0gdGhpcy5jb25zdHJ1Y3RvcjtcblxuICAgIGxldCBsYXN0TmV3bGluZUN1dG9mZiA9IG51bGw7XG4gICAgbGV0IGxhc3RQYXJhZ3JhcGhDdXRvZmYgPSBudWxsO1xuICAgIGxldCBsYXN0V29yZEN1dG9mZiA9IG51bGw7XG5cbiAgICBjb25zdCBzZWFyY2hUZXh0ID0gdGhpcy5nZXRNZXNzYWdlQm9keSgpLnN1YnN0cmluZygwLCBMT05HX01FU1NBR0VfVEhSRVNIT0xEKTtcbiAgICBjb25zdCBib3VuZGFyeVJ4ID0gL1xccysvZztcbiAgICBsZXQgcmVzdWx0O1xuICAgIGxldCBsaW5lQ291bnQgPSAwO1xuICAgIHdoaWxlICgocmVzdWx0ID0gYm91bmRhcnlSeC5leGVjKHNlYXJjaFRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgbmV3bGluZUNvdW50ID0gKHJlc3VsdFswXS5tYXRjaCgvXFxyP1xcbi9nKSB8fCBbXSkubGVuZ3RoO1xuXG4gICAgICBsaW5lQ291bnQgKz0gbmV3bGluZUNvdW50O1xuICAgICAgaWYgKGxpbmVDb3VudCA+IE5FV0xJTkVfVEhSRVNIT0xEKSB7XG4gICAgICAgIGxhc3ROZXdsaW5lQ3V0b2ZmID0gcmVzdWx0LmluZGV4O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld2xpbmVDb3VudCA8IDIgJiYgcmVzdWx0LmluZGV4IDw9IExPTkdfTUVTU0FHRV9USFJFU0hPTEQgLSBXT1JEX0VMSVBTRVMubGVuZ3RoKSB7XG4gICAgICAgIGxhc3RXb3JkQ3V0b2ZmID0gcmVzdWx0LmluZGV4O1xuICAgICAgfSBlbHNlIGlmIChyZXN1bHQuaW5kZXggPCBMT05HX01FU1NBR0VfVEhSRVNIT0xEIC0gUEFSQUdSQVBIX0VMSVBTRVMubGVuZ3RoKSB7XG4gICAgICAgIGxhc3RQYXJhZ3JhcGhDdXRvZmYgPSByZXN1bHQuaW5kZXg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IGVsaXBzZXMgPSBXT1JEX0VMSVBTRVM7XG4gICAgbGV0IGN1dG9mZkluZGV4ID0gTE9OR19NRVNTQUdFX1RIUkVTSE9MRCAtIFdPUkRfRUxJUFNFUy5sZW5ndGg7XG4gICAgaWYgKGxhc3ROZXdsaW5lQ3V0b2ZmICE9PSBudWxsKSB7XG4gICAgICBlbGlwc2VzID0gTkVXTElORV9FTElQU0VTO1xuICAgICAgY3V0b2ZmSW5kZXggPSBsYXN0TmV3bGluZUN1dG9mZjtcbiAgICB9IGVsc2UgaWYgKGxhc3RQYXJhZ3JhcGhDdXRvZmYgIT09IG51bGwpIHtcbiAgICAgIGVsaXBzZXMgPSBQQVJBR1JBUEhfRUxJUFNFUztcbiAgICAgIGN1dG9mZkluZGV4ID0gbGFzdFBhcmFncmFwaEN1dG9mZjtcbiAgICB9IGVsc2UgaWYgKGxhc3RXb3JkQ3V0b2ZmICE9PSBudWxsKSB7XG4gICAgICBjdXRvZmZJbmRleCA9IGxhc3RXb3JkQ3V0b2ZmO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldE1lc3NhZ2VCb2R5KCkuc3Vic3RyaW5nKDAsIGN1dG9mZkluZGV4KSArIGVsaXBzZXM7XG4gIH1cblxuICBzZXRNdWx0aUZpbGVEaWZmKG11bHRpRmlsZURpZmYpIHtcbiAgICB0aGlzLm11bHRpRmlsZURpZmYgPSBtdWx0aUZpbGVEaWZmO1xuICB9XG5cbiAgZ2V0TXVsdGlGaWxlRGlmZigpIHtcbiAgICByZXR1cm4gdGhpcy5tdWx0aUZpbGVEaWZmO1xuICB9XG5cbiAgaXNVbmJvcm5SZWYoKSB7XG4gICAgcmV0dXJuIHRoaXMudW5ib3JuUmVmO1xuICB9XG5cbiAgaXNQcmVzZW50KCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaXNFcXVhbChvdGhlcikge1xuICAgIC8vIERpcmVjdGx5IGNvbXBhcmFibGUgcHJvcGVydGllc1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbJ3NoYScsICdhdXRob3JEYXRlJywgJ21lc3NhZ2VTdWJqZWN0JywgJ21lc3NhZ2VCb2R5JywgJ3VuYm9yblJlZiddO1xuICAgIGZvciAoY29uc3QgcHJvcGVydHkgb2YgcHJvcGVydGllcykge1xuICAgICAgaWYgKHRoaXNbcHJvcGVydHldICE9PSBvdGhlcltwcm9wZXJ0eV0pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEF1dGhvclxuICAgIGlmICh0aGlzLmF1dGhvci5nZXRFbWFpbCgpICE9PSBvdGhlci5nZXRBdXRob3JFbWFpbCgpIHx8IHRoaXMuYXV0aG9yLmdldEZ1bGxOYW1lKCkgIT09IG90aGVyLmdldEF1dGhvck5hbWUoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIENvLWF1dGhvciBhcnJheVxuICAgIGlmICh0aGlzLmNvQXV0aG9ycy5sZW5ndGggIT09IG90aGVyLmNvQXV0aG9ycy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNvQXV0aG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdGhpc0NvQXV0aG9yID0gdGhpcy5jb0F1dGhvcnNbaV07XG4gICAgICBjb25zdCBvdGhlckNvQXV0aG9yID0gb3RoZXIuY29BdXRob3JzW2ldO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXNDb0F1dGhvci5nZXRGdWxsTmFtZSgpICE9PSBvdGhlckNvQXV0aG9yLmdldEZ1bGxOYW1lKClcbiAgICAgICAgfHwgdGhpc0NvQXV0aG9yLmdldEVtYWlsKCkgIT09IG90aGVyQ29BdXRob3IuZ2V0RW1haWwoKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBNdWx0aS1maWxlIHBhdGNoXG4gICAgaWYgKCF0aGlzLm11bHRpRmlsZURpZmYuaXNFcXVhbChvdGhlci5tdWx0aUZpbGVEaWZmKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBudWxsQ29tbWl0ID0ge1xuICBnZXRTaGEoKSB7XG4gICAgcmV0dXJuICcnO1xuICB9LFxuXG4gIGdldE1lc3NhZ2VTdWJqZWN0KCkge1xuICAgIHJldHVybiAnJztcbiAgfSxcblxuICBpc1VuYm9yblJlZigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgaXNQcmVzZW50KCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBpc0JvZHlMb25nKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUE0QyxTQUFBQyxnQkFBQUMsR0FBQSxFQUFBQyxHQUFBLEVBQUFDLEtBQUEsSUFBQUQsR0FBQSxHQUFBRSxjQUFBLENBQUFGLEdBQUEsT0FBQUEsR0FBQSxJQUFBRCxHQUFBLElBQUFJLE1BQUEsQ0FBQUMsY0FBQSxDQUFBTCxHQUFBLEVBQUFDLEdBQUEsSUFBQUMsS0FBQSxFQUFBQSxLQUFBLEVBQUFJLFVBQUEsUUFBQUMsWUFBQSxRQUFBQyxRQUFBLG9CQUFBUixHQUFBLENBQUFDLEdBQUEsSUFBQUMsS0FBQSxXQUFBRixHQUFBO0FBQUEsU0FBQUcsZUFBQU0sR0FBQSxRQUFBUixHQUFBLEdBQUFTLFlBQUEsQ0FBQUQsR0FBQSwyQkFBQVIsR0FBQSxnQkFBQUEsR0FBQSxH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