"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _helpers = require("../helpers");
const COPY = Symbol('copy');
class ListSelection {
  constructor(options = {}) {
    (0, _helpers.autobind)(this, 'isItemSelectable');
    if (options._copy !== COPY) {
      this.options = {
        isItemSelectable: options.isItemSelectable || (item => !!item)
      };
      this.items = options.items || [];
      this.selections = this.items.length > 0 ? [{
        head: 0,
        tail: 0
      }] : [];
    } else {
      this.options = {
        isItemSelectable: options.isItemSelectable
      };
      this.items = options.items;
      this.selections = options.selections;
    }
  }
  copy(options = {}) {
    return new ListSelection({
      _copy: COPY,
      isItemSelectable: options.isItemSelectable || this.options.isItemSelectable,
      items: options.items || this.items,
      selections: options.selections || this.selections
    });
  }
  isItemSelectable(item) {
    return this.options.isItemSelectable(item);
  }
  setItems(items) {
    let newSelectionIndex;
    if (this.selections.length > 0) {
      const [{
        head,
        tail
      }] = this.selections;
      newSelectionIndex = Math.min(head, tail, items.length - 1);
    } else {
      newSelectionIndex = 0;
    }
    const newSelections = items.length > 0 ? [{
      head: newSelectionIndex,
      tail: newSelectionIndex
    }] : [];
    return this.copy({
      items,
      selections: newSelections
    });
  }
  getItems() {
    return this.items;
  }
  getLastItem() {
    return this.items[this.items.length - 1];
  }
  selectFirstItem(preserveTail) {
    for (let i = 0; i < this.items.length; i++) {
      const item = this.items[i];
      if (this.isItemSelectable(item)) {
        return this.selectItem(item, preserveTail);
      }
    }
    return this;
  }
  selectLastItem(preserveTail) {
    for (let i = this.items.length - 1; i > 0; i--) {
      const item = this.items[i];
      if (this.isItemSelectable(item)) {
        return this.selectItem(item, preserveTail);
      }
    }
    return this;
  }
  selectAllItems() {
    return this.selectFirstItem().selectLastItem(true);
  }
  selectNextItem(preserveTail) {
    if (this.selections.length === 0) {
      return this.selectFirstItem();
    }
    let itemIndex = this.selections[0].head;
    let nextItemIndex = itemIndex;
    while (itemIndex < this.items.length - 1) {
      itemIndex++;
      if (this.isItemSelectable(this.items[itemIndex])) {
        nextItemIndex = itemIndex;
        break;
      }
    }
    return this.selectItem(this.items[nextItemIndex], preserveTail);
  }
  selectPreviousItem(preserveTail) {
    if (this.selections.length === 0) {
      return this.selectLastItem();
    }
    let itemIndex = this.selections[0].head;
    let previousItemIndex = itemIndex;
    while (itemIndex > 0) {
      itemIndex--;
      if (this.isItemSelectable(this.items[itemIndex])) {
        previousItemIndex = itemIndex;
        break;
      }
    }
    return this.selectItem(this.items[previousItemIndex], preserveTail);
  }
  selectItem(item, preserveTail, addOrSubtract) {
    if (addOrSubtract && preserveTail) {
      throw new Error('addOrSubtract and preserveTail cannot both be true at the same time');
    }
    const itemIndex = this.items.indexOf(item);
    if (preserveTail && this.selections[0]) {
      const newSelections = [{
        head: itemIndex,
        tail: this.selections[0].tail,
        negate: this.selections[0].negate
      }, ...this.selections.slice(1)];
      return this.copy({
        selections: newSelections
      });
    } else {
      const selection = {
        head: itemIndex,
        tail: itemIndex
      };
      if (addOrSubtract) {
        if (this.getSelectedItems().has(item)) {
          selection.negate = true;
        }
        return this.copy({
          selections: [selection, ...this.selections]
        });
      } else {
        return this.copy({
          selections: [selection]
        });
      }
    }
  }
  addOrSubtractSelection(item) {
    return this.selectItem(item, false, true);
  }
  coalesce() {
    if (this.selections.length === 0) {
      return this;
    }
    const mostRecent = this.selections[0];
    let mostRecentStart = Math.min(mostRecent.head, mostRecent.tail);
    let mostRecentEnd = Math.max(mostRecent.head, mostRecent.tail);
    while (mostRecentStart > 0 && !this.isItemSelectable(this.items[mostRecentStart - 1])) {
      mostRecentStart--;
    }
    while (mostRecentEnd < this.items.length - 1 && !this.isItemSelectable(this.items[mostRecentEnd + 1])) {
      mostRecentEnd++;
    }
    let changed = false;
    const newSelections = [mostRecent];
    for (let i = 1; i < this.selections.length;) {
      const current = this.selections[i];
      const currentStart = Math.min(current.head, current.tail);
      const currentEnd = Math.max(current.head, current.tail);
      if (mostRecentStart <= currentEnd + 1 && currentStart - 1 <= mostRecentEnd) {
        if (mostRecent.negate) {
          if (current.head > current.tail) {
            if (currentEnd > mostRecentEnd) {
              // suffix
              newSelections.push({
                tail: mostRecentEnd + 1,
                head: currentEnd
              });
            }
            if (currentStart < mostRecentStart) {
              // prefix
              newSelections.push({
                tail: currentStart,
                head: mostRecentStart - 1
              });
            }
          } else {
            if (currentStart < mostRecentStart) {
              // prefix
              newSelections.push({
                head: currentStart,
                tail: mostRecentStart - 1
              });
            }
            if (currentEnd > mostRecentEnd) {
              // suffix
              newSelections.push({
                head: mostRecentEnd + 1,
                tail: currentEnd
              });
            }
          }
          changed = true;
          i++;
        } else {
          mostRecentStart = Math.min(mostRecentStart, currentStart);
          mostRecentEnd = Math.max(mostRecentEnd, currentEnd);
          if (mostRecent.head >= mostRecent.tail) {
            mostRecent.head = mostRecentEnd;
            mostRecent.tail = mostRecentStart;
          } else {
            mostRecent.head = mostRecentStart;
            mostRecent.tail = mostRecentEnd;
          }
          changed = true;
          i++;
        }
      } else {
        newSelections.push(current);
        i++;
      }
    }
    if (mostRecent.negate) {
      changed = true;
      newSelections.shift();
    }
    return changed ? this.copy({
      selections: newSelections
    }) : this;
  }
  getSelectedItems() {
    const selectedItems = new Set();
    for (const {
      head,
      tail,
      negate
    } of this.selections.slice().reverse()) {
      const start = Math.min(head, tail);
      const end = Math.max(head, tail);
      for (let i = start; i <= end; i++) {
        const item = this.items[i];
        if (this.isItemSelectable(item)) {
          if (negate) {
            selectedItems.delete(item);
          } else {
            selectedItems.add(item);
          }
        }
      }
    }
    return selectedItems;
  }
  getHeadItem() {
    return this.selections.length > 0 ? this.items[this.selections[0].head] : null;
  }
  getMostRecentSelectionStartIndex() {
    const selection = this.selections[0];
    return Math.min(selection.head, selection.tail);
  }
  getTailIndex() {
    return this.selections[0] ? this.selections[0].tail : null;
  }
}
exports.default = ListSelection;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDT1BZIiwiU3ltYm9sIiwiTGlzdFNlbGVjdGlvbiIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImF1dG9iaW5kIiwiX2NvcHkiLCJpc0l0ZW1TZWxlY3RhYmxlIiwiaXRlbSIsIml0ZW1zIiwic2VsZWN0aW9ucyIsImxlbmd0aCIsImhlYWQiLCJ0YWlsIiwiY29weSIsInNldEl0ZW1zIiwibmV3U2VsZWN0aW9uSW5kZXgiLCJNYXRoIiwibWluIiwibmV3U2VsZWN0aW9ucyIsImdldEl0ZW1zIiwiZ2V0TGFzdEl0ZW0iLCJzZWxlY3RGaXJzdEl0ZW0iLCJwcmVzZXJ2ZVRhaWwiLCJpIiwic2VsZWN0SXRlbSIsInNlbGVjdExhc3RJdGVtIiwic2VsZWN0QWxsSXRlbXMiLCJzZWxlY3ROZXh0SXRlbSIsIml0ZW1JbmRleCIsIm5leHRJdGVtSW5kZXgiLCJzZWxlY3RQcmV2aW91c0l0ZW0iLCJwcmV2aW91c0l0ZW1JbmRleCIsImFkZE9yU3VidHJhY3QiLCJFcnJvciIsImluZGV4T2YiLCJuZWdhdGUiLCJzbGljZSIsInNlbGVjdGlvbiIsImdldFNlbGVjdGVkSXRlbXMiLCJoYXMiLCJhZGRPclN1YnRyYWN0U2VsZWN0aW9uIiwiY29hbGVzY2UiLCJtb3N0UmVjZW50IiwibW9zdFJlY2VudFN0YXJ0IiwibW9zdFJlY2VudEVuZCIsIm1heCIsImNoYW5nZWQiLCJjdXJyZW50IiwiY3VycmVudFN0YXJ0IiwiY3VycmVudEVuZCIsInB1c2giLCJzaGlmdCIsInNlbGVjdGVkSXRlbXMiLCJTZXQiLCJyZXZlcnNlIiwic3RhcnQiLCJlbmQiLCJkZWxldGUiLCJhZGQiLCJnZXRIZWFkSXRlbSIsImdldE1vc3RSZWNlbnRTZWxlY3Rpb25TdGFydEluZGV4IiwiZ2V0VGFpbEluZGV4Il0sInNvdXJjZXMiOlsibGlzdC1zZWxlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHthdXRvYmluZH0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmNvbnN0IENPUFkgPSBTeW1ib2woJ2NvcHknKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGlzdFNlbGVjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgIGF1dG9iaW5kKHRoaXMsICdpc0l0ZW1TZWxlY3RhYmxlJyk7XG5cbiAgICBpZiAob3B0aW9ucy5fY29weSAhPT0gQ09QWSkge1xuICAgICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgICBpc0l0ZW1TZWxlY3RhYmxlOiBvcHRpb25zLmlzSXRlbVNlbGVjdGFibGUgfHwgKGl0ZW0gPT4gISFpdGVtKSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuaXRlbXMgPSBvcHRpb25zLml0ZW1zIHx8IFtdO1xuICAgICAgdGhpcy5zZWxlY3Rpb25zID0gdGhpcy5pdGVtcy5sZW5ndGggPiAwID8gW3toZWFkOiAwLCB0YWlsOiAwfV0gOiBbXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgICBpc0l0ZW1TZWxlY3RhYmxlOiBvcHRpb25zLmlzSXRlbVNlbGVjdGFibGUsXG4gICAgICB9O1xuICAgICAgdGhpcy5pdGVtcyA9IG9wdGlvbnMuaXRlbXM7XG4gICAgICB0aGlzLnNlbGVjdGlvbnMgPSBvcHRpb25zLnNlbGVjdGlvbnM7XG4gICAgfVxuICB9XG5cbiAgY29weShvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gbmV3IExpc3RTZWxlY3Rpb24oe1xuICAgICAgX2NvcHk6IENPUFksXG4gICAgICBpc0l0ZW1TZWxlY3RhYmxlOiBvcHRpb25zLmlzSXRlbVNlbGVjdGFibGUgfHwgdGhpcy5vcHRpb25zLmlzSXRlbVNlbGVjdGFibGUsXG4gICAgICBpdGVtczogb3B0aW9ucy5pdGVtcyB8fCB0aGlzLml0ZW1zLFxuICAgICAgc2VsZWN0aW9uczogb3B0aW9ucy5zZWxlY3Rpb25zIHx8IHRoaXMuc2VsZWN0aW9ucyxcbiAgICB9KTtcbiAgfVxuXG4gIGlzSXRlbVNlbGVjdGFibGUoaXRlbSkge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaXNJdGVtU2VsZWN0YWJsZShpdGVtKTtcbiAgfVxuXG4gIHNldEl0ZW1zKGl0ZW1zKSB7XG4gICAgbGV0IG5ld1NlbGVjdGlvbkluZGV4O1xuICAgIGlmICh0aGlzLnNlbGVjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgW3toZWFkLCB0YWlsfV0gPSB0aGlzLnNlbGVjdGlvbnM7XG4gICAgICBuZXdTZWxlY3Rpb25JbmRleCA9IE1hdGgubWluKGhlYWQsIHRhaWwsIGl0ZW1zLmxlbmd0aCAtIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTZWxlY3Rpb25JbmRleCA9IDA7XG4gICAgfVxuXG4gICAgY29uc3QgbmV3U2VsZWN0aW9ucyA9IGl0ZW1zLmxlbmd0aCA+IDAgPyBbe2hlYWQ6IG5ld1NlbGVjdGlvbkluZGV4LCB0YWlsOiBuZXdTZWxlY3Rpb25JbmRleH1dIDogW107XG4gICAgcmV0dXJuIHRoaXMuY29weSh7aXRlbXMsIHNlbGVjdGlvbnM6IG5ld1NlbGVjdGlvbnN9KTtcbiAgfVxuXG4gIGdldEl0ZW1zKCkge1xuICAgIHJldHVybiB0aGlzLml0ZW1zO1xuICB9XG5cbiAgZ2V0TGFzdEl0ZW0oKSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXNbdGhpcy5pdGVtcy5sZW5ndGggLSAxXTtcbiAgfVxuXG4gIHNlbGVjdEZpcnN0SXRlbShwcmVzZXJ2ZVRhaWwpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLml0ZW1zW2ldO1xuICAgICAgaWYgKHRoaXMuaXNJdGVtU2VsZWN0YWJsZShpdGVtKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RJdGVtKGl0ZW0sIHByZXNlcnZlVGFpbCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2VsZWN0TGFzdEl0ZW0ocHJlc2VydmVUYWlsKSB7XG4gICAgZm9yIChsZXQgaSA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkge1xuICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbXNbaV07XG4gICAgICBpZiAodGhpcy5pc0l0ZW1TZWxlY3RhYmxlKGl0ZW0pKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdEl0ZW0oaXRlbSwgcHJlc2VydmVUYWlsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWxlY3RBbGxJdGVtcygpIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RGaXJzdEl0ZW0oKS5zZWxlY3RMYXN0SXRlbSh0cnVlKTtcbiAgfVxuXG4gIHNlbGVjdE5leHRJdGVtKHByZXNlcnZlVGFpbCkge1xuICAgIGlmICh0aGlzLnNlbGVjdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RGaXJzdEl0ZW0oKTtcbiAgICB9XG5cbiAgICBsZXQgaXRlbUluZGV4ID0gdGhpcy5zZWxlY3Rpb25zWzBdLmhlYWQ7XG4gICAgbGV0IG5leHRJdGVtSW5kZXggPSBpdGVtSW5kZXg7XG4gICAgd2hpbGUgKGl0ZW1JbmRleCA8IHRoaXMuaXRlbXMubGVuZ3RoIC0gMSkge1xuICAgICAgaXRlbUluZGV4Kys7XG4gICAgICBpZiAodGhpcy5pc0l0ZW1TZWxlY3RhYmxlKHRoaXMuaXRlbXNbaXRlbUluZGV4XSkpIHtcbiAgICAgICAgbmV4dEl0ZW1JbmRleCA9IGl0ZW1JbmRleDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0SXRlbSh0aGlzLml0ZW1zW25leHRJdGVtSW5kZXhdLCBwcmVzZXJ2ZVRhaWwpO1xuICB9XG5cbiAgc2VsZWN0UHJldmlvdXNJdGVtKHByZXNlcnZlVGFpbCkge1xuICAgIGlmICh0aGlzLnNlbGVjdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RMYXN0SXRlbSgpO1xuICAgIH1cblxuICAgIGxldCBpdGVtSW5kZXggPSB0aGlzLnNlbGVjdGlvbnNbMF0uaGVhZDtcbiAgICBsZXQgcHJldmlvdXNJdGVtSW5kZXggPSBpdGVtSW5kZXg7XG5cbiAgICB3aGlsZSAoaXRlbUluZGV4ID4gMCkge1xuICAgICAgaXRlbUluZGV4LS07XG4gICAgICBpZiAodGhpcy5pc0l0ZW1TZWxlY3RhYmxlKHRoaXMuaXRlbXNbaXRlbUluZGV4XSkpIHtcbiAgICAgICAgcHJldmlvdXNJdGVtSW5kZXggPSBpdGVtSW5kZXg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnNlbGVjdEl0ZW0odGhpcy5pdGVtc1twcmV2aW91c0l0ZW1JbmRleF0sIHByZXNlcnZlVGFpbCk7XG4gIH1cblxuICBzZWxlY3RJdGVtKGl0ZW0sIHByZXNlcnZlVGFpbCwgYWRkT3JTdWJ0cmFjdCkge1xuICAgIGlmIChhZGRPclN1YnRyYWN0ICYmIHByZXNlcnZlVGFpbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdhZGRPclN1YnRyYWN0IGFuZCBwcmVzZXJ2ZVRhaWwgY2Fubm90IGJvdGggYmUgdHJ1ZSBhdCB0aGUgc2FtZSB0aW1lJyk7XG4gICAgfVxuXG4gICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5pdGVtcy5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChwcmVzZXJ2ZVRhaWwgJiYgdGhpcy5zZWxlY3Rpb25zWzBdKSB7XG4gICAgICBjb25zdCBuZXdTZWxlY3Rpb25zID0gW1xuICAgICAgICB7aGVhZDogaXRlbUluZGV4LCB0YWlsOiB0aGlzLnNlbGVjdGlvbnNbMF0udGFpbCwgbmVnYXRlOiB0aGlzLnNlbGVjdGlvbnNbMF0ubmVnYXRlfSxcbiAgICAgICAgLi4udGhpcy5zZWxlY3Rpb25zLnNsaWNlKDEpLFxuICAgICAgXTtcbiAgICAgIHJldHVybiB0aGlzLmNvcHkoe3NlbGVjdGlvbnM6IG5ld1NlbGVjdGlvbnN9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc2VsZWN0aW9uID0ge2hlYWQ6IGl0ZW1JbmRleCwgdGFpbDogaXRlbUluZGV4fTtcbiAgICAgIGlmIChhZGRPclN1YnRyYWN0KSB7XG4gICAgICAgIGlmICh0aGlzLmdldFNlbGVjdGVkSXRlbXMoKS5oYXMoaXRlbSkpIHsgc2VsZWN0aW9uLm5lZ2F0ZSA9IHRydWU7IH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY29weSh7c2VsZWN0aW9uczogW3NlbGVjdGlvbiwgLi4udGhpcy5zZWxlY3Rpb25zXX0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29weSh7c2VsZWN0aW9uczogW3NlbGVjdGlvbl19KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhZGRPclN1YnRyYWN0U2VsZWN0aW9uKGl0ZW0pIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RJdGVtKGl0ZW0sIGZhbHNlLCB0cnVlKTtcbiAgfVxuXG4gIGNvYWxlc2NlKCkge1xuICAgIGlmICh0aGlzLnNlbGVjdGlvbnMubGVuZ3RoID09PSAwKSB7IHJldHVybiB0aGlzOyB9XG5cbiAgICBjb25zdCBtb3N0UmVjZW50ID0gdGhpcy5zZWxlY3Rpb25zWzBdO1xuICAgIGxldCBtb3N0UmVjZW50U3RhcnQgPSBNYXRoLm1pbihtb3N0UmVjZW50LmhlYWQsIG1vc3RSZWNlbnQudGFpbCk7XG4gICAgbGV0IG1vc3RSZWNlbnRFbmQgPSBNYXRoLm1heChtb3N0UmVjZW50LmhlYWQsIG1vc3RSZWNlbnQudGFpbCk7XG4gICAgd2hpbGUgKG1vc3RSZWNlbnRTdGFydCA+IDAgJiYgIXRoaXMuaXNJdGVtU2VsZWN0YWJsZSh0aGlzLml0ZW1zW21vc3RSZWNlbnRTdGFydCAtIDFdKSkge1xuICAgICAgbW9zdFJlY2VudFN0YXJ0LS07XG4gICAgfVxuICAgIHdoaWxlIChtb3N0UmVjZW50RW5kIDwgKHRoaXMuaXRlbXMubGVuZ3RoIC0gMSkgJiYgIXRoaXMuaXNJdGVtU2VsZWN0YWJsZSh0aGlzLml0ZW1zW21vc3RSZWNlbnRFbmQgKyAxXSkpIHtcbiAgICAgIG1vc3RSZWNlbnRFbmQrKztcbiAgICB9XG5cbiAgICBsZXQgY2hhbmdlZCA9IGZhbHNlO1xuICAgIGNvbnN0IG5ld1NlbGVjdGlvbnMgPSBbbW9zdFJlY2VudF07XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLnNlbGVjdGlvbnMubGVuZ3RoOykge1xuICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuc2VsZWN0aW9uc1tpXTtcbiAgICAgIGNvbnN0IGN1cnJlbnRTdGFydCA9IE1hdGgubWluKGN1cnJlbnQuaGVhZCwgY3VycmVudC50YWlsKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRFbmQgPSBNYXRoLm1heChjdXJyZW50LmhlYWQsIGN1cnJlbnQudGFpbCk7XG4gICAgICBpZiAobW9zdFJlY2VudFN0YXJ0IDw9IGN1cnJlbnRFbmQgKyAxICYmIGN1cnJlbnRTdGFydCAtIDEgPD0gbW9zdFJlY2VudEVuZCkge1xuICAgICAgICBpZiAobW9zdFJlY2VudC5uZWdhdGUpIHtcbiAgICAgICAgICBpZiAoY3VycmVudC5oZWFkID4gY3VycmVudC50YWlsKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudEVuZCA+IG1vc3RSZWNlbnRFbmQpIHsgLy8gc3VmZml4XG4gICAgICAgICAgICAgIG5ld1NlbGVjdGlvbnMucHVzaCh7dGFpbDogbW9zdFJlY2VudEVuZCArIDEsIGhlYWQ6IGN1cnJlbnRFbmR9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50U3RhcnQgPCBtb3N0UmVjZW50U3RhcnQpIHsgLy8gcHJlZml4XG4gICAgICAgICAgICAgIG5ld1NlbGVjdGlvbnMucHVzaCh7dGFpbDogY3VycmVudFN0YXJ0LCBoZWFkOiBtb3N0UmVjZW50U3RhcnQgLSAxfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50U3RhcnQgPCBtb3N0UmVjZW50U3RhcnQpIHsgLy8gcHJlZml4XG4gICAgICAgICAgICAgIG5ld1NlbGVjdGlvbnMucHVzaCh7aGVhZDogY3VycmVudFN0YXJ0LCB0YWlsOiBtb3N0UmVjZW50U3RhcnQgLSAxfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VycmVudEVuZCA+IG1vc3RSZWNlbnRFbmQpIHsgLy8gc3VmZml4XG4gICAgICAgICAgICAgIG5ld1NlbGVjdGlvbnMucHVzaCh7aGVhZDogbW9zdFJlY2VudEVuZCArIDEsIHRhaWw6IGN1cnJlbnRFbmR9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgaSsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1vc3RSZWNlbnRTdGFydCA9IE1hdGgubWluKG1vc3RSZWNlbnRTdGFydCwgY3VycmVudFN0YXJ0KTtcbiAgICAgICAgICBtb3N0UmVjZW50RW5kID0gTWF0aC5tYXgobW9zdFJlY2VudEVuZCwgY3VycmVudEVuZCk7XG4gICAgICAgICAgaWYgKG1vc3RSZWNlbnQuaGVhZCA+PSBtb3N0UmVjZW50LnRhaWwpIHtcbiAgICAgICAgICAgIG1vc3RSZWNlbnQuaGVhZCA9IG1vc3RSZWNlbnRFbmQ7XG4gICAgICAgICAgICBtb3N0UmVjZW50LnRhaWwgPSBtb3N0UmVjZW50U3RhcnQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1vc3RSZWNlbnQuaGVhZCA9IG1vc3RSZWNlbnRTdGFydDtcbiAgICAgICAgICAgIG1vc3RSZWNlbnQudGFpbCA9IG1vc3RSZWNlbnRFbmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3U2VsZWN0aW9ucy5wdXNoKGN1cnJlbnQpO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1vc3RSZWNlbnQubmVnYXRlKSB7XG4gICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIG5ld1NlbGVjdGlvbnMuc2hpZnQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hhbmdlZCA/IHRoaXMuY29weSh7c2VsZWN0aW9uczogbmV3U2VsZWN0aW9uc30pIDogdGhpcztcbiAgfVxuXG4gIGdldFNlbGVjdGVkSXRlbXMoKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IG5ldyBTZXQoKTtcbiAgICBmb3IgKGNvbnN0IHtoZWFkLCB0YWlsLCBuZWdhdGV9IG9mIHRoaXMuc2VsZWN0aW9ucy5zbGljZSgpLnJldmVyc2UoKSkge1xuICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1pbihoZWFkLCB0YWlsKTtcbiAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWF4KGhlYWQsIHRhaWwpO1xuICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLml0ZW1zW2ldO1xuICAgICAgICBpZiAodGhpcy5pc0l0ZW1TZWxlY3RhYmxlKGl0ZW0pKSB7XG4gICAgICAgICAgaWYgKG5lZ2F0ZSkge1xuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcy5kZWxldGUoaXRlbSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMuYWRkKGl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc2VsZWN0ZWRJdGVtcztcbiAgfVxuXG4gIGdldEhlYWRJdGVtKCkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnMubGVuZ3RoID4gMCA/IHRoaXMuaXRlbXNbdGhpcy5zZWxlY3Rpb25zWzBdLmhlYWRdIDogbnVsbDtcbiAgfVxuXG4gIGdldE1vc3RSZWNlbnRTZWxlY3Rpb25TdGFydEluZGV4KCkge1xuICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uc1swXTtcbiAgICByZXR1cm4gTWF0aC5taW4oc2VsZWN0aW9uLmhlYWQsIHNlbGVjdGlvbi50YWlsKTtcbiAgfVxuXG4gIGdldFRhaWxJbmRleCgpIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zWzBdID8gdGhpcy5zZWxlY3Rpb25zWzBdLnRhaWwgOiBudWxsO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBRUEsTUFBTUEsSUFBSSxHQUFHQyxNQUFNLENBQUMsTUFBTSxDQUFDO0FBRVosTUFBTUMsYUFBYSxDQUFDO0VBQ2pDQyxXQUFXLENBQUNDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN4QixJQUFBQyxpQkFBUSxFQUFDLElBQUksRUFBRSxrQkFBa0IsQ0FBQztJQUVsQyxJQUFJRCxPQUFPLENBQUNFLEtBQUssS0FBS04sSUFBSSxFQUFFO01BQzFCLElBQUksQ0FBQ0ksT0FBTyxHQUFHO1FBQ2JHLGdCQUFnQixFQUFFSCxPQUFPLENBQUNHLGdCQUFnQixLQUFLQyxJQUFJLElBQUksQ0FBQyxDQUFDQSxJQUFJO01BQy9ELENBQUM7TUFFRCxJQUFJLENBQUNDLEtBQUssR0FBR0wsT0FBTyxDQUFDSyxLQUFLLElBQUksRUFBRTtNQUNoQyxJQUFJLENBQUNDLFVBQVUsR0FBRyxJQUFJLENBQUNELEtBQUssQ0FBQ0UsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDO1FBQUNDLElBQUksRUFBRSxDQUFDO1FBQUVDLElBQUksRUFBRTtNQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUU7SUFDckUsQ0FBQyxNQUFNO01BQ0wsSUFBSSxDQUFDVCxPQUFPLEdBQUc7UUFDYkcsZ0JBQWdCLEVBQUVILE9BQU8sQ0FBQ0c7TUFDNUIsQ0FBQztNQUNELElBQUksQ0FBQ0UsS0FBSyxHQUFHTCxPQUFPLENBQUNLLEtBQUs7TUFDMUIsSUFBSSxDQUFDQyxVQUFVLEdBQUdOLE9BQU8sQ0FBQ00sVUFBVTtJQUN0QztFQUNGO0VBRUFJLElBQUksQ0FBQ1YsT0FBTyxHQUFHLENBQUMsQ0FBQyxFQUFFO0lBQ2pCLE9BQU8sSUFBSUYsYUFBYSxDQUFDO01BQ3ZCSSxLQUFL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