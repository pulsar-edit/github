"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _helpers = require("../helpers");
const COPY = Symbol('copy');
class ListSelection {
  constructor(options = {}) {
    (0, _helpers.autobind)(this, 'isItemSelectable');
    if (options._copy !== COPY) {
      this.options = {
        isItemSelectable: options.isItemSelectable || (item => !!item)
      };
      this.items = options.items || [];
      this.selections = this.items.length > 0 ? [{
        head: 0,
        tail: 0
      }] : [];
    } else {
      this.options = {
        isItemSelectable: options.isItemSelectable
      };
      this.items = options.items;
      this.selections = options.selections;
    }
  }
  copy(options = {}) {
    return new ListSelection({
      _copy: COPY,
      isItemSelectable: options.isItemSelectable || this.options.isItemSelectable,
      items: options.items || this.items,
      selections: options.selections || this.selections
    });
  }
  isItemSelectable(item) {
    return this.options.isItemSelectable(item);
  }
  setItems(items) {
    let newSelectionIndex;
    if (this.selections.length > 0) {
      const [{
        head,
        tail
      }] = this.selections;
      newSelectionIndex = Math.min(head, tail, items.length - 1);
    } else {
      newSelectionIndex = 0;
    }
    const newSelections = items.length > 0 ? [{
      head: newSelectionIndex,
      tail: newSelectionIndex
    }] : [];
    return this.copy({
      items,
      selections: newSelections
    });
  }
  getItems() {
    return this.items;
  }
  getLastItem() {
    return this.items[this.items.length - 1];
  }
  selectFirstItem(preserveTail) {
    for (let i = 0; i < this.items.length; i++) {
      const item = this.items[i];
      if (this.isItemSelectable(item)) {
        return this.selectItem(item, preserveTail);
      }
    }
    return this;
  }
  selectLastItem(preserveTail) {
    for (let i = this.items.length - 1; i > 0; i--) {
      const item = this.items[i];
      if (this.isItemSelectable(item)) {
        return this.selectItem(item, preserveTail);
      }
    }
    return this;
  }
  selectAllItems() {
    return this.selectFirstItem().selectLastItem(true);
  }
  selectNextItem(preserveTail) {
    if (this.selections.length === 0) {
      return this.selectFirstItem();
    }
    let itemIndex = this.selections[0].head;
    let nextItemIndex = itemIndex;
    while (itemIndex < this.items.length - 1) {
      itemIndex++;
      if (this.isItemSelectable(this.items[itemIndex])) {
        nextItemIndex = itemIndex;
        break;
      }
    }
    return this.selectItem(this.items[nextItemIndex], preserveTail);
  }
  selectPreviousItem(preserveTail) {
    if (this.selections.length === 0) {
      return this.selectLastItem();
    }
    let itemIndex = this.selections[0].head;
    let previousItemIndex = itemIndex;
    while (itemIndex > 0) {
      itemIndex--;
      if (this.isItemSelectable(this.items[itemIndex])) {
        previousItemIndex = itemIndex;
        break;
      }
    }
    return this.selectItem(this.items[previousItemIndex], preserveTail);
  }
  selectItem(item, preserveTail, addOrSubtract) {
    if (addOrSubtract && preserveTail) {
      throw new Error('addOrSubtract and preserveTail cannot both be true at the same time');
    }
    const itemIndex = this.items.indexOf(item);
    if (preserveTail && this.selections[0]) {
      const newSelections = [{
        head: itemIndex,
        tail: this.selections[0].tail,
        negate: this.selections[0].negate
      }, ...this.selections.slice(1)];
      return this.copy({
        selections: newSelections
      });
    } else {
      const selection = {
        head: itemIndex,
        tail: itemIndex
      };
      if (addOrSubtract) {
        if (this.getSelectedItems().has(item)) {
          selection.negate = true;
        }
        return this.copy({
          selections: [selection, ...this.selections]
        });
      } else {
        return this.copy({
          selections: [selection]
        });
      }
    }
  }
  addOrSubtractSelection(item) {
    return this.selectItem(item, false, true);
  }
  coalesce() {
    if (this.selections.length === 0) {
      return this;
    }
    const mostRecent = this.selections[0];
    let mostRecentStart = Math.min(mostRecent.head, mostRecent.tail);
    let mostRecentEnd = Math.max(mostRecent.head, mostRecent.tail);
    while (mostRecentStart > 0 && !this.isItemSelectable(this.items[mostRecentStart - 1])) {
      mostRecentStart--;
    }
    while (mostRecentEnd < this.items.length - 1 && !this.isItemSelectable(this.items[mostRecentEnd + 1])) {
      mostRecentEnd++;
    }
    let changed = false;
    const newSelections = [mostRecent];
    for (let i = 1; i < this.selections.length;) {
      const current = this.selections[i];
      const currentStart = Math.min(current.head, current.tail);
      const currentEnd = Math.max(current.head, current.tail);
      if (mostRecentStart <= currentEnd + 1 && currentStart - 1 <= mostRecentEnd) {
        if (mostRecent.negate) {
          if (current.head > current.tail) {
            if (currentEnd > mostRecentEnd) {
              // suffix
              newSelections.push({
                tail: mostRecentEnd + 1,
                head: currentEnd
              });
            }
            if (currentStart < mostRecentStart) {
              // prefix
              newSelections.push({
                tail: currentStart,
                head: mostRecentStart - 1
              });
            }
          } else {
            if (currentStart < mostRecentStart) {
              // prefix
              newSelections.push({
                head: currentStart,
                tail: mostRecentStart - 1
              });
            }
            if (currentEnd > mostRecentEnd) {
              // suffix
              newSelections.push({
                head: mostRecentEnd + 1,
                tail: currentEnd
              });
            }
          }
          changed = true;
          i++;
        } else {
          mostRecentStart = Math.min(mostRecentStart, currentStart);
          mostRecentEnd = Math.max(mostRecentEnd, currentEnd);
          if (mostRecent.head >= mostRecent.tail) {
            mostRecent.head = mostRecentEnd;
            mostRecent.tail = mostRecentStart;
          } else {
            mostRecent.head = mostRecentStart;
            mostRecent.tail = mostRecentEnd;
          }
          changed = true;
          i++;
        }
      } else {
        newSelections.push(current);
        i++;
      }
    }
    if (mostRecent.negate) {
      changed = true;
      newSelections.shift();
    }
    return changed ? this.copy({
      selections: newSelections
    }) : this;
  }
  getSelectedItems() {
    const selectedItems = new Set();
    for (const {
      head,
      tail,
      negate
    } of this.selections.slice().reverse()) {
      const start = Math.min(head, tail);
      const end = Math.max(head, tail);
      for (let i = start; i <= end; i++) {
        const item = this.items[i];
        if (this.isItemSelectable(item)) {
          if (negate) {
            selectedItems.delete(item);
          } else {
            selectedItems.add(item);
          }
        }
      }
    }
    return selectedItems;
  }
  getHeadItem() {
    return this.selections.length > 0 ? this.items[this.selections[0].head] : null;
  }
  getMostRecentSelectionStartIndex() {
    const selection = this.selections[0];
    return Math.min(selection.head, selection.tail);
  }
  getTailIndex() {
    return this.selections[0] ? this.selections[0].tail : null;
  }
}
exports.default = ListSelection;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaGVscGVycyIsInJlcXVpcmUiLCJDT1BZIiwiU3ltYm9sIiwiTGlzdFNlbGVjdGlvbiIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImF1dG9iaW5kIiwiX2NvcHkiLCJpc0l0ZW1TZWxlY3RhYmxlIiwiaXRlbSIsIml0ZW1zIiwic2VsZWN0aW9ucyIsImxlbmd0aCIsImhlYWQiLCJ0YWlsIiwiY29weSIsInNldEl0ZW1zIiwibmV3U2VsZWN0aW9uSW5kZXgiLCJNYXRoIiwibWluIiwibmV3U2VsZWN0aW9ucyIsImdldEl0ZW1zIiwiZ2V0TGFzdEl0ZW0iLCJzZWxlY3RGaXJzdEl0ZW0iLCJwcmVzZXJ2ZVRhaWwiLCJpIiwic2VsZWN0SXRlbSIsInNlbGVjdExhc3RJdGVtIiwic2VsZWN0QWxsSXRlbXMiLCJzZWxlY3ROZXh0SXRlbSIsIml0ZW1JbmRleCIsIm5leHRJdGVtSW5kZXgiLCJzZWxlY3RQcmV2aW91c0l0ZW0iLCJwcmV2aW91c0l0ZW1JbmRleCIsImFkZE9yU3VidHJhY3QiLCJFcnJvciIsImluZGV4T2YiLCJuZWdhdGUiLCJzbGljZSIsInNlbGVjdGlvbiIsImdldFNlbGVjdGVkSXRlbXMiLCJoYXMiLCJhZGRPclN1YnRyYWN0U2VsZWN0aW9uIiwiY29hbGVzY2UiLCJtb3N0UmVjZW50IiwibW9zdFJlY2VudFN0YXJ0IiwibW9zdFJlY2VudEVuZCIsIm1heCIsImNoYW5nZWQiLCJjdXJyZW50IiwiY3VycmVudFN0YXJ0IiwiY3VycmVudEVuZCIsInB1c2giLCJzaGlmdCIsInNlbGVjdGVkSXRlbXMiLCJTZXQiLCJyZXZlcnNlIiwic3RhcnQiLCJlbmQiLCJkZWxldGUiLCJhZGQiLCJnZXRIZWFkSXRlbSIsImdldE1vc3RSZWNlbnRTZWxlY3Rpb25TdGFydEluZGV4IiwiZ2V0VGFpbEluZGV4IiwiZXhwb3J0cyIsImRlZmF1bHQiXSwic291cmNlcyI6WyJsaXN0LXNlbGVjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2F1dG9iaW5kfSBmcm9tICcuLi9oZWxwZXJzJztcblxuY29uc3QgQ09QWSA9IFN5bWJvbCgnY29weScpO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0U2VsZWN0aW9uIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgYXV0b2JpbmQodGhpcywgJ2lzSXRlbVNlbGVjdGFibGUnKTtcblxuICAgIGlmIChvcHRpb25zLl9jb3B5ICE9PSBDT1BZKSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgIGlzSXRlbVNlbGVjdGFibGU6IG9wdGlvbnMuaXNJdGVtU2VsZWN0YWJsZSB8fCAoaXRlbSA9PiAhIWl0ZW0pLFxuICAgICAgfTtcblxuICAgICAgdGhpcy5pdGVtcyA9IG9wdGlvbnMuaXRlbXMgfHwgW107XG4gICAgICB0aGlzLnNlbGVjdGlvbnMgPSB0aGlzLml0ZW1zLmxlbmd0aCA+IDAgPyBbe2hlYWQ6IDAsIHRhaWw6IDB9XSA6IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgIGlzSXRlbVNlbGVjdGFibGU6IG9wdGlvbnMuaXNJdGVtU2VsZWN0YWJsZSxcbiAgICAgIH07XG4gICAgICB0aGlzLml0ZW1zID0gb3B0aW9ucy5pdGVtcztcbiAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IG9wdGlvbnMuc2VsZWN0aW9ucztcbiAgICB9XG4gIH1cblxuICBjb3B5KG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiBuZXcgTGlzdFNlbGVjdGlvbih7XG4gICAgICBfY29weTogQ09QWSxcbiAgICAgIGlzSXRlbVNlbGVjdGFibGU6IG9wdGlvbnMuaXNJdGVtU2VsZWN0YWJsZSB8fCB0aGlzLm9wdGlvbnMuaXNJdGVtU2VsZWN0YWJsZSxcbiAgICAgIGl0ZW1zOiBvcHRpb25zLml0ZW1zIHx8IHRoaXMuaXRlbXMsXG4gICAgICBzZWxlY3Rpb25zOiBvcHRpb25zLnNlbGVjdGlvbnMgfHwgdGhpcy5zZWxlY3Rpb25zLFxuICAgIH0pO1xuICB9XG5cbiAgaXNJdGVtU2VsZWN0YWJsZShpdGVtKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pc0l0ZW1TZWxlY3RhYmxlKGl0ZW0pO1xuICB9XG5cbiAgc2V0SXRlbXMoaXRlbXMpIHtcbiAgICBsZXQgbmV3U2VsZWN0aW9uSW5kZXg7XG4gICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBbe2hlYWQsIHRhaWx9XSA9IHRoaXMuc2VsZWN0aW9ucztcbiAgICAgIG5ld1NlbGVjdGlvbkluZGV4ID0gTWF0aC5taW4oaGVhZCwgdGFpbCwgaXRlbXMubGVuZ3RoIC0gMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1NlbGVjdGlvbkluZGV4ID0gMDtcbiAgICB9XG5cbiAgICBjb25zdCBuZXdTZWxlY3Rpb25zID0gaXRlbXMubGVuZ3RoID4gMCA/IFt7aGVhZDogbmV3U2VsZWN0aW9uSW5kZXgsIHRhaWw6IG5ld1NlbGVjdGlvbkluZGV4fV0gOiBbXTtcbiAgICByZXR1cm4gdGhpcy5jb3B5KHtpdGVtcywgc2VsZWN0aW9uczogbmV3U2VsZWN0aW9uc30pO1xuICB9XG5cbiAgZ2V0SXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXM7XG4gIH1cblxuICBnZXRMYXN0SXRlbSgpIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtc1t0aGlzLml0ZW1zLmxlbmd0aCAtIDFdO1xuICB9XG5cbiAgc2VsZWN0Rmlyc3RJdGVtKHByZXNlcnZlVGFpbCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbXNbaV07XG4gICAgICBpZiAodGhpcy5pc0l0ZW1TZWxlY3RhYmxlKGl0ZW0pKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdEl0ZW0oaXRlbSwgcHJlc2VydmVUYWlsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWxlY3RMYXN0SXRlbShwcmVzZXJ2ZVRhaWwpIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBpdGVtID0gdGhpcy5pdGVtc1tpXTtcbiAgICAgIGlmICh0aGlzLmlzSXRlbVNlbGVjdGFibGUoaXRlbSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0SXRlbShpdGVtLCBwcmVzZXJ2ZVRhaWwpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNlbGVjdEFsbEl0ZW1zKCkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdEZpcnN0SXRlbSgpLnNlbGVjdExhc3RJdGVtKHRydWUpO1xuICB9XG5cbiAgc2VsZWN0TmV4dEl0ZW0ocHJlc2VydmVUYWlsKSB7XG4gICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdEZpcnN0SXRlbSgpO1xuICAgIH1cblxuICAgIGxldCBpdGVtSW5kZXggPSB0aGlzLnNlbGVjdGlvbnNbMF0uaGVhZDtcbiAgICBsZXQgbmV4dEl0ZW1JbmRleCA9IGl0ZW1JbmRleDtcbiAgICB3aGlsZSAoaXRlbUluZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGggLSAxKSB7XG4gICAgICBpdGVtSW5kZXgrKztcbiAgICAgIGlmICh0aGlzLmlzSXRlbVNlbGVjdGFibGUodGhpcy5pdGVtc1tpdGVtSW5kZXhdKSkge1xuICAgICAgICBuZXh0SXRlbUluZGV4ID0gaXRlbUluZGV4O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zZWxlY3RJdGVtKHRoaXMuaXRlbXNbbmV4dEl0ZW1JbmRleF0sIHByZXNlcnZlVGFpbCk7XG4gIH1cblxuICBzZWxlY3RQcmV2aW91c0l0ZW0ocHJlc2VydmVUYWlsKSB7XG4gICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdExhc3RJdGVtKCk7XG4gICAgfVxuXG4gICAgbGV0IGl0ZW1JbmRleCA9IHRoaXMuc2VsZWN0aW9uc1swXS5oZWFkO1xuICAgIGxldCBwcmV2aW91c0l0ZW1JbmRleCA9IGl0ZW1JbmRleDtcblxuICAgIHdoaWxlIChpdGVtSW5kZXggPiAwKSB7XG4gICAgICBpdGVtSW5kZXgtLTtcbiAgICAgIGlmICh0aGlzLmlzSXRlbVNlbGVjdGFibGUodGhpcy5pdGVtc1tpdGVtSW5kZXhdKSkge1xuICAgICAgICBwcmV2aW91c0l0ZW1JbmRleCA9IGl0ZW1JbmRleDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0SXRlbSh0aGlzLml0ZW1zW3ByZXZpb3VzSXRlbUluZGV4XSwgcHJlc2VydmVUYWlsKTtcbiAgfVxuXG4gIHNlbGVjdEl0ZW0oaXRlbSwgcHJlc2VydmVUYWlsLCBhZGRPclN1YnRyYWN0KSB7XG4gICAgaWYgKGFkZE9yU3VidHJhY3QgJiYgcHJlc2VydmVUYWlsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2FkZE9yU3VidHJhY3QgYW5kIHByZXNlcnZlVGFpbCBjYW5ub3QgYm90aCBiZSB0cnVlIGF0IHRoZSBzYW1lIHRpbWUnKTtcbiAgICB9XG5cbiAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLml0ZW1zLmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKHByZXNlcnZlVGFpbCAmJiB0aGlzLnNlbGVjdGlvbnNbMF0pIHtcbiAgICAgIGNvbnN0IG5ld1NlbGVjdGlvbnMgPSBbXG4gICAgICAgIHtoZWFkOiBpdGVtSW5kZXgsIHRhaWw6IHRoaXMuc2VsZWN0aW9uc1swXS50YWlsLCBuZWdhdGU6IHRoaXMuc2VsZWN0aW9uc1swXS5uZWdhdGV9LFxuICAgICAgICAuLi50aGlzLnNlbGVjdGlvbnMuc2xpY2UoMSksXG4gICAgICBdO1xuICAgICAgcmV0dXJuIHRoaXMuY29weSh7c2VsZWN0aW9uczogbmV3U2VsZWN0aW9uc30pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSB7aGVhZDogaXRlbUluZGV4LCB0YWlsOiBpdGVtSW5kZXh9O1xuICAgICAgaWYgKGFkZE9yU3VidHJhY3QpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0U2VsZWN0ZWRJdGVtcygpLmhhcyhpdGVtKSkgeyBzZWxlY3Rpb24ubmVnYXRlID0gdHJ1ZTsgfVxuICAgICAgICByZXR1cm4gdGhpcy5jb3B5KHtzZWxlY3Rpb25zOiBbc2VsZWN0aW9uLCAuLi50aGlzLnNlbGVjdGlvbnNdfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5jb3B5KHtzZWxlY3Rpb25zOiBbc2VsZWN0aW9uXX0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFkZE9yU3VidHJhY3RTZWxlY3Rpb24oaXRlbSkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdEl0ZW0oaXRlbSwgZmFsc2UsIHRydWUpO1xuICB9XG5cbiAgY29hbGVzY2UoKSB7XG4gICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5sZW5ndGggPT09IDApIHsgcmV0dXJuIHRoaXM7IH1cblxuICAgIGNvbnN0IG1vc3RSZWNlbnQgPSB0aGlzLnNlbGVjdGlvbnNbMF07XG4gICAgbGV0IG1vc3RSZWNlbnRTdGFydCA9IE1hdGgubWluKG1vc3RSZWNlbnQuaGVhZCwgbW9zdFJlY2VudC50YWlsKTtcbiAgICBsZXQgbW9zdFJlY2VudEVuZCA9IE1hdGgubWF4KG1vc3RSZWNlbnQuaGVhZCwgbW9zdFJlY2VudC50YWlsKTtcbiAgICB3aGlsZSAobW9zdFJlY2VudFN0YXJ0ID4gMCAmJiAhdGhpcy5pc0l0ZW1TZWxlY3RhYmxlKHRoaXMuaXRlbXNbbW9zdFJlY2VudFN0YXJ0IC0gMV0pKSB7XG4gICAgICBtb3N0UmVjZW50U3RhcnQtLTtcbiAgICB9XG4gICAgd2hpbGUgKG1vc3RSZWNlbnRFbmQgPCAodGhpcy5pdGVtcy5sZW5ndGggLSAxKSAmJiAhdGhpcy5pc0l0ZW1TZWxlY3RhYmxlKHRoaXMuaXRlbXNbbW9zdFJlY2VudEVuZCArIDFdKSkge1xuICAgICAgbW9zdFJlY2VudEVuZCsrO1xuICAgIH1cblxuICAgIGxldCBjaGFuZ2VkID0gZmFsc2U7XG4gICAgY29uc3QgbmV3U2VsZWN0aW9ucyA9IFttb3N0UmVjZW50XTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuc2VsZWN0aW9ucy5sZW5ndGg7KSB7XG4gICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5zZWxlY3Rpb25zW2ldO1xuICAgICAgY29uc3QgY3VycmVudFN0YXJ0ID0gTWF0aC5taW4oY3VycmVudC5oZWFkLCBjdXJyZW50LnRhaWwpO1xuICAgICAgY29uc3QgY3VycmVudEVuZCA9IE1hdGgubWF4KGN1cnJlbnQuaGVhZCwgY3VycmVudC50YWlsKTtcbiAgICAgIGlmIChtb3N0UmVjZW50U3RhcnQgPD0gY3VycmVudEVuZCArIDEgJiYgY3VycmVudFN0YXJ0IC0gMSA8PSBtb3N0UmVjZW50RW5kKSB7XG4gICAgICAgIGlmIChtb3N0UmVjZW50Lm5lZ2F0ZSkge1xuICAgICAgICAgIGlmIChjdXJyZW50LmhlYWQgPiBjdXJyZW50LnRhaWwpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50RW5kID4gbW9zdFJlY2VudEVuZCkgeyAvLyBzdWZmaXhcbiAgICAgICAgICAgICAgbmV3U2VsZWN0aW9ucy5wdXNoKHt0YWlsOiBtb3N0UmVjZW50RW5kICsgMSwgaGVhZDogY3VycmVudEVuZH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGFydCA8IG1vc3RSZWNlbnRTdGFydCkgeyAvLyBwcmVmaXhcbiAgICAgICAgICAgICAgbmV3U2VsZWN0aW9ucy5wdXNoKHt0YWlsOiBjdXJyZW50U3RhcnQsIGhlYWQ6IG1vc3RSZWNlbnRTdGFydCAtIDF9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGFydCA8IG1vc3RSZWNlbnRTdGFydCkgeyAvLyBwcmVmaXhcbiAgICAgICAgICAgICAgbmV3U2VsZWN0aW9ucy5wdXNoKHtoZWFkOiBjdXJyZW50U3RhcnQsIHRhaWw6IG1vc3RSZWNlbnRTdGFydCAtIDF9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50RW5kID4gbW9zdFJlY2VudEVuZCkgeyAvLyBzdWZmaXhcbiAgICAgICAgICAgICAgbmV3U2VsZWN0aW9ucy5wdXNoKHtoZWFkOiBtb3N0UmVjZW50RW5kICsgMSwgdGFpbDogY3VycmVudEVuZH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICBpKys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbW9zdFJlY2VudFN0YXJ0ID0gTWF0aC5taW4obW9zdFJlY2VudFN0YXJ0LCBjdXJyZW50U3RhcnQpO1xuICAgICAgICAgIG1vc3RSZWNlbnRFbmQgPSBNYXRoLm1heChtb3N0UmVjZW50RW5kLCBjdXJyZW50RW5kKTtcbiAgICAgICAgICBpZiAobW9zdFJlY2VudC5oZWFkID49IG1vc3RSZWNlbnQudGFpbCkge1xuICAgICAgICAgICAgbW9zdFJlY2VudC5oZWFkID0gbW9zdFJlY2VudEVuZDtcbiAgICAgICAgICAgIG1vc3RSZWNlbnQudGFpbCA9IG1vc3RSZWNlbnRTdGFydDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbW9zdFJlY2VudC5oZWFkID0gbW9zdFJlY2VudFN0YXJ0O1xuICAgICAgICAgICAgbW9zdFJlY2VudC50YWlsID0gbW9zdFJlY2VudEVuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdTZWxlY3Rpb25zLnB1c2goY3VycmVudCk7XG4gICAgICAgIGkrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobW9zdFJlY2VudC5uZWdhdGUpIHtcbiAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgbmV3U2VsZWN0aW9ucy5zaGlmdCgpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGFuZ2VkID8gdGhpcy5jb3B5KHtzZWxlY3Rpb25zOiBuZXdTZWxlY3Rpb25zfSkgOiB0aGlzO1xuICB9XG5cbiAgZ2V0U2VsZWN0ZWRJdGVtcygpIHtcbiAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gbmV3IFNldCgpO1xuICAgIGZvciAoY29uc3Qge2hlYWQsIHRhaWwsIG5lZ2F0ZX0gb2YgdGhpcy5zZWxlY3Rpb25zLnNsaWNlKCkucmV2ZXJzZSgpKSB7XG4gICAgICBjb25zdCBzdGFydCA9IE1hdGgubWluKGhlYWQsIHRhaWwpO1xuICAgICAgY29uc3QgZW5kID0gTWF0aC5tYXgoaGVhZCwgdGFpbCk7XG4gICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbXNbaV07XG4gICAgICAgIGlmICh0aGlzLmlzSXRlbVNlbGVjdGFibGUoaXRlbSkpIHtcbiAgICAgICAgICBpZiAobmVnYXRlKSB7XG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW1zLmRlbGV0ZShpdGVtKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcy5hZGQoaXRlbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzZWxlY3RlZEl0ZW1zO1xuICB9XG5cbiAgZ2V0SGVhZEl0ZW0oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9ucy5sZW5ndGggPiAwID8gdGhpcy5pdGVtc1t0aGlzLnNlbGVjdGlvbnNbMF0uaGVhZF0gOiBudWxsO1xuICB9XG5cbiAgZ2V0TW9zdFJlY2VudFNlbGVjdGlvblN0YXJ0SW5kZXgoKSB7XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb25zWzBdO1xuICAgIHJldHVybiBNYXRoLm1pbihzZWxlY3Rpb24uaGVhZCwgc2VsZWN0aW9uLnRhaWwpO1xuICB9XG5cbiAgZ2V0VGFpbEluZGV4KCkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnNbMF0gPyB0aGlzLnNlbGVjdGlvbnNbMF0udGFpbCA6IG51bGw7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxPQUFBO0FBRUEsTUFBTUMsSUFBSSxHQUFHQyxNQUFNLENBQUMsTUFBTSxDQUFDO0FBRVosTUFBTUMsYUFBYSxDQUFDO0VBQ2pDQyxXQUFXQSxDQUFDQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDeEIsSUFBQUMsaUJBQVEsRUFBQyxJQUFJLEVBQUUsa0JBQWtCLENBQUM7SUFFbEMsSUFBSUQsT0FBTyxDQUFDRSxLQUFLLEtBQUtOLElBQUksRUFBRTtNQUMxQixJQUFJLENBQUNJLE9BQU8sR0FBRztRQUNiRyxnQkFBZ0IsRUFBRUgsT0FBTyxDQUFDRyxnQkFBZ0IsS0FBS0MsSUFBSSxJQUFJLENBQUMsQ0FBQ0EsSUFBSTtNQUMvRCxDQUFDO01BRUQsSUFBSSxDQUFDQyxLQUFLLEdBQUdMLE9BQU8sQ0FBQ0ssS0FBSyxJQUFJLEVBQUU7TUFDaEMsSUFBSSxDQUFDQyxVQUFVLEdBQUcsSUFBSSxDQUFDRCxLQUFLLENBQUNFLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQztRQUFDQyxJQUFJLEVBQUUsQ0FBQztRQUFFQyxJQUFJLEVBQUU7TUFBQyxDQUFDLENBQUMsR0FBRyxFQUFFO0lBQ3JFLENBQUMsTUFBTTtNQUNMLElBQUksQ0FBQ1QsT0FBTyxHQUFHO1FBQ2JHLGdCQUFnQixFQUFFSCxPQUFPLENBQUNHO01BQzVCLENBQUM7TUFDRCxJQUFJLENBQUNFLEtBQUssR0FBR0wsT0FBTyxDQUFDSyxLQUFLO01BQzFCLElBQUksQ0FBQ0MsVUFBVSxHQUFHTixPQUFPLENBQUNNLFVBQVU7SUFDdEM7RUFDRjtFQUVBSSxJQUFJQSxDQUFD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