"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _eventKit = require("event-kit");
var _helpers = require("../helpers");
class StyleCalculator {
  constructor(styles, config) {
    (0, _helpers.autobind)(this, 'updateStyles');
    this.styles = styles;
    this.config = config;
  }
  startWatching(sourcePath, configsToWatch, getStylesheetFn) {
    const subscriptions = new _eventKit.CompositeDisposable();
    const updateStyles = () => {
      this.updateStyles(sourcePath, getStylesheetFn);
    };
    configsToWatch.forEach(configToWatch => {
      subscriptions.add(this.config.onDidChange(configToWatch, updateStyles));
    });
    updateStyles();
    return subscriptions;
  }
  updateStyles(sourcePath, getStylesheetFn) {
    const stylesheet = getStylesheetFn(this.config);
    this.styles.addStyleSheet(stylesheet, {
      sourcePath,
      priority: 0
    });
  }
}
exports.default = StyleCalculator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXZlbnRLaXQiLCJyZXF1aXJlIiwiX2hlbHBlcnMiLCJTdHlsZUNhbGN1bGF0b3IiLCJjb25zdHJ1Y3RvciIsInN0eWxlcyIsImNvbmZpZyIsImF1dG9iaW5kIiwic3RhcnRXYXRjaGluZyIsInNvdXJjZVBhdGgiLCJjb25maWdzVG9XYXRjaCIsImdldFN0eWxlc2hlZXRGbiIsInN1YnNjcmlwdGlvbnMiLCJDb21wb3NpdGVEaXNwb3NhYmxlIiwidXBkYXRlU3R5bGVzIiwiZm9yRWFjaCIsImNvbmZpZ1RvV2F0Y2giLCJhZGQiLCJvbkRpZENoYW5nZSIsInN0eWxlc2hlZXQiLCJhZGRTdHlsZVNoZWV0IiwicHJpb3JpdHkiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbInN0eWxlLWNhbGN1bGF0b3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuXG5pbXBvcnQge2F1dG9iaW5kfSBmcm9tICcuLi9oZWxwZXJzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3R5bGVDYWxjdWxhdG9yIHtcbiAgY29uc3RydWN0b3Ioc3R5bGVzLCBjb25maWcpIHtcbiAgICBhdXRvYmluZCh0aGlzLCAndXBkYXRlU3R5bGVzJyk7XG5cbiAgICB0aGlzLnN0eWxlcyA9IHN0eWxlcztcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIHN0YXJ0V2F0Y2hpbmcoc291cmNlUGF0aCwgY29uZmlnc1RvV2F0Y2gsIGdldFN0eWxlc2hlZXRGbikge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICAgIGNvbnN0IHVwZGF0ZVN0eWxlcyA9ICgpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlU3R5bGVzKHNvdXJjZVBhdGgsIGdldFN0eWxlc2hlZXRGbik7XG4gICAgfTtcbiAgICBjb25maWdzVG9XYXRjaC5mb3JFYWNoKGNvbmZpZ1RvV2F0Y2ggPT4ge1xuICAgICAgc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICAgIHRoaXMuY29uZmlnLm9uRGlkQ2hhbmdlKGNvbmZpZ1RvV2F0Y2gsIHVwZGF0ZVN0eWxlcyksXG4gICAgICApO1xuICAgIH0pO1xuICAgIHVwZGF0ZVN0eWxlcygpO1xuICAgIHJldHVybiBzdWJzY3JpcHRpb25zO1xuICB9XG5cbiAgdXBkYXRlU3R5bGVzKHNvdXJjZVBhdGgsIGdldFN0eWxlc2hlZXRGbikge1xuICAgIGNvbnN0IHN0eWxlc2hlZXQgPSBnZXRTdHlsZXNoZWV0Rm4odGhpcy5jb25maWcpO1xuICAgIHRoaXMuc3R5bGVzLmFkZFN0eWxlU2hlZXQoc3R5bGVzaGVldCwge3NvdXJjZVBhdGgsIHByaW9yaXR5OiAwfSk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsU0FBQSxHQUFBQyxPQUFBO0FBRUEsSUFBQUMsUUFBQSxHQUFBRCxPQUFBO0FBRWUsTUFBTUUsZUFBZSxDQUFDO0VBQ25DQyxXQUFXQSxDQUFDQyxNQUFNLEVBQUVDLE1BQU0sRUFBRTtJQUMxQixJQUFBQyxpQkFBUSxFQUFDLElBQUksRUFBRSxjQUFjLENBQUM7SUFFOUIsSUFBSSxDQUFDRixNQUFNLEdBQUdBLE1BQU07SUFDcEIsSUFBSSxDQUFDQyxNQUFNLEdBQUdBLE1BQU07RUFDdEI7RUFFQUUsYUFBYUEsQ0FBQ0MsVUFBVSxFQUFFQyxjQUFjLEVBQUVDLGVBQWUsRUFBRTtJQUN6RCxNQUFNQyxhQUFhLEdBQUcsSUFBSUMsNkJBQW1CLENBQUMsQ0FBQztJQUMvQyxNQUFNQyxZQUFZLEdBQUdBLENBQUEsS0FBTTtNQUN6QixJQUFJLENBQUNBLFlBQVksQ0FBQ0wsVUFBVSxFQUFFRSxlQUFlLENBQUM7SUFDaEQsQ0FBQztJQUNERCxjQUFjLENBQUNLLE9BQU8sQ0FBQ0MsYUFBYSxJQUFJO01BQ3RDSixhQUFhLENBQUNLLEdBQUcsQ0FDZixJQUFJLENBQUNYLE1BQU0sQ0FBQ1ksV0FBVyxDQUFDRixhQUFhLEVBQUVGLFlBQVksQ0FDckQsQ0FBQztJQUNILENBQUMsQ0FBQztJQUNGQSxZQUFZLENBQUMsQ0FBQztJQUNkLE9BQU9GLGFBQWE7RUFDdEI7RUFFQUUsWUFBWUEsQ0FBQ0wsVUFBVSxFQUFFRSxlQUFlLEVBQUU7SUFDeEMsTUFBTVEsVUFBVSxHQUFHUixlQUFlLENBQUMsSUFBSSxDQUFDTCxNQUFNLENBQUM7SUFDL0MsSUFBSSxDQUFDRCxNQUFNLENBQUNlLGFBQWEsQ0FBQ0QsVUFBVSxFQUFFO01BQUNWLFVBQVU7TUFBRVksUUFBUSxFQUFFO0lBQUMsQ0FBQyxDQUFDO0VBQ2xFO0FBQ0Y7QUFBQ0MsT0FBQSxDQUFBQyxPQUFBLEdBQUFwQixlQUFBIn0=