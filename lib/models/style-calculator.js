"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _eventKit = require("event-kit");
var _helpers = require("../helpers");
class StyleCalculator {
  constructor(styles, config) {
    (0, _helpers.autobind)(this, 'updateStyles');
    this.styles = styles;
    this.config = config;
  }
  startWatching(sourcePath, configsToWatch, getStylesheetFn) {
    const subscriptions = new _eventKit.CompositeDisposable();
    const updateStyles = () => {
      this.updateStyles(sourcePath, getStylesheetFn);
    };
    configsToWatch.forEach(configToWatch => {
      subscriptions.add(this.config.onDidChange(configToWatch, updateStyles));
    });
    updateStyles();
    return subscriptions;
  }
  updateStyles(sourcePath, getStylesheetFn) {
    const stylesheet = getStylesheetFn(this.config);
    this.styles.addStyleSheet(stylesheet, {
      sourcePath,
      priority: 0
    });
  }
}
exports.default = StyleCalculator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHlsZUNhbGN1bGF0b3IiLCJjb25zdHJ1Y3RvciIsInN0eWxlcyIsImNvbmZpZyIsImF1dG9iaW5kIiwic3RhcnRXYXRjaGluZyIsInNvdXJjZVBhdGgiLCJjb25maWdzVG9XYXRjaCIsImdldFN0eWxlc2hlZXRGbiIsInN1YnNjcmlwdGlvbnMiLCJDb21wb3NpdGVEaXNwb3NhYmxlIiwidXBkYXRlU3R5bGVzIiwiZm9yRWFjaCIsImNvbmZpZ1RvV2F0Y2giLCJhZGQiLCJvbkRpZENoYW5nZSIsInN0eWxlc2hlZXQiLCJhZGRTdHlsZVNoZWV0IiwicHJpb3JpdHkiXSwic291cmNlcyI6WyJzdHlsZS1jYWxjdWxhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcblxuaW1wb3J0IHthdXRvYmluZH0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0eWxlQ2FsY3VsYXRvciB7XG4gIGNvbnN0cnVjdG9yKHN0eWxlcywgY29uZmlnKSB7XG4gICAgYXV0b2JpbmQodGhpcywgJ3VwZGF0ZVN0eWxlcycpO1xuXG4gICAgdGhpcy5zdHlsZXMgPSBzdHlsZXM7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICBzdGFydFdhdGNoaW5nKHNvdXJjZVBhdGgsIGNvbmZpZ3NUb1dhdGNoLCBnZXRTdHlsZXNoZWV0Rm4pIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICBjb25zdCB1cGRhdGVTdHlsZXMgPSAoKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVN0eWxlcyhzb3VyY2VQYXRoLCBnZXRTdHlsZXNoZWV0Rm4pO1xuICAgIH07XG4gICAgY29uZmlnc1RvV2F0Y2guZm9yRWFjaChjb25maWdUb1dhdGNoID0+IHtcbiAgICAgIHN1YnNjcmlwdGlvbnMuYWRkKFxuICAgICAgICB0aGlzLmNvbmZpZy5vbkRpZENoYW5nZShjb25maWdUb1dhdGNoLCB1cGRhdGVTdHlsZXMpLFxuICAgICAgKTtcbiAgICB9KTtcbiAgICB1cGRhdGVTdHlsZXMoKTtcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9ucztcbiAgfVxuXG4gIHVwZGF0ZVN0eWxlcyhzb3VyY2VQYXRoLCBnZXRTdHlsZXNoZWV0Rm4pIHtcbiAgICBjb25zdCBzdHlsZXNoZWV0ID0gZ2V0U3R5bGVzaGVldEZuKHRoaXMuY29uZmlnKTtcbiAgICB0aGlzLnN0eWxlcy5hZGRTdHlsZVNoZWV0KHN0eWxlc2hlZXQsIHtzb3VyY2VQYXRoLCBwcmlvcml0eTogMH0pO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBRUE7QUFFZSxNQUFNQSxlQUFlLENBQUM7RUFDbkNDLFdBQVcsQ0FBQ0MsTUFBTSxFQUFFQyxNQUFNLEVBQUU7SUFDMUIsSUFBQUMsaUJBQVEsRUFBQyxJQUFJLEVBQUUsY0FBYyxDQUFDO0lBRTlCLElBQUksQ0FBQ0YsTUFBTSxHQUFHQSxNQUFNO0lBQ3BCLElBQUksQ0FBQ0MsTUFBTSxHQUFHQSxNQUFNO0VBQ3RCO0VBRUFFLGFBQWEsQ0FBQ0MsVUFBVSxFQUFFQyxjQUFjLEVBQUVDLGVBQWUsRUFBRTtJQUN6RCxNQUFNQyxhQUFhLEdBQUcsSUFBSUMsNkJBQW1CLEVBQUU7SUFDL0MsTUFBTUMsWUFBWSxHQUFHLE1BQU07TUFDekIsSUFBSSxDQUFDQSxZQUFZLENBQUNMLFVBQVUsRUFBRUUsZUFBZSxDQUFDO0lBQ2hELENBQUM7SUFDREQsY0FBYyxDQUFDSyxPQUFPLENBQUNDLGFBQWEsSUFBSTtNQUN0Q0osYUFBYSxDQUFDSyxHQUFHLENBQ2YsSUFBSSxDQUFDWCxNQUFNLENBQUNZLFdBQVcsQ0FBQ0YsYUFBYSxFQUFFRixZQUFZLENBQUMsQ0FDckQ7SUFDSCxDQUFDLENBQUM7SUFDRkEsWUFBWSxFQUFFO0lBQ2QsT0FBT0YsYUFBYTtFQUN0QjtFQUVBRSxZQUFZLENBQUNMLFVBQVUsRUFBRUUsZUFBZSxFQUFFO0lBQ3hDLE1BQU1RLFVBQVUsR0FBR1IsZUFBZSxDQUFDLElBQUksQ0FBQ0wsTUFBTSxDQUFDO0lBQy9DLElBQUksQ0FBQ0QsTUFBTSxDQUFDZSxhQUFhLENBQUNELFVBQVUsRUFBRTtNQUFDVixVQUFVO01BQUVZLFFBQVEsRUFBRTtJQUFDLENBQUMsQ0FBQztFQUNsRTtBQUNGO0FBQUMifQ==