"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _url = require("url");
var _moment = _interopRequireDefault(require("moment"));
var _buildStatus = require("./build-status");
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
class Issueish {
  constructor(data) {
    const author = data.author || _helpers.GHOST_USER;
    this.number = data.number;
    this.title = data.title;
    this.url = new _url.URL(data.url);
    this.authorLogin = author.login;
    this.authorAvatarURL = new _url.URL(author.avatarUrl);
    this.createdAt = (0, _moment.default)(data.createdAt, _moment.default.ISO_8601);
    this.headRefName = data.headRefName;
    this.headRepositoryID = data.repository.id;
    this.latestCommit = null;
    this.statusContexts = [];
    this.checkRuns = [];
    if (data.commits.nodes.length > 0) {
      this.latestCommit = data.commits.nodes[0].commit;
    }
    if (this.latestCommit && this.latestCommit.status) {
      this.statusContexts = this.latestCommit.status.contexts;
    }
  }
  getNumber() {
    return this.number;
  }
  getTitle() {
    return this.title;
  }
  getGitHubURL() {
    return this.url.toString();
  }
  getAuthorLogin() {
    return this.authorLogin;
  }
  getAuthorAvatarURL(size = 32) {
    const u = new _url.URL(this.authorAvatarURL.toString());
    u.searchParams.set('s', size);
    return u.toString();
  }
  getCreatedAt() {
    return this.createdAt;
  }
  getHeadRefName() {
    return this.headRefName;
  }
  getHeadRepositoryID() {
    return this.headRepositoryID;
  }
  getLatestCommit() {
    return this.latestCommit;
  }
  setCheckRuns(runsBySuite) {
    this.checkRuns = [];
    for (const [, runs] of runsBySuite) {
      for (const checkRun of runs) {
        this.checkRuns.push(checkRun);
      }
    }
  }
  getStatusCounts() {
    const buildStatuses = [];
    for (const context of this.statusContexts) {
      buildStatuses.push((0, _buildStatus.buildStatusFromStatusContext)(context));
    }
    for (const checkRun of this.checkRuns) {
      buildStatuses.push((0, _buildStatus.buildStatusFromCheckResult)(checkRun));
    }
    const counts = {
      pending: 0,
      failure: 0,
      success: 0,
      neutral: 0
    };
    for (const {
      classSuffix
    } of buildStatuses) {
      counts[classSuffix]++;
    }
    return counts;
  }
}
exports.default = Issueish;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdXJsIiwicmVxdWlyZSIsIl9tb21lbnQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2J1aWxkU3RhdHVzIiwiX2hlbHBlcnMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIklzc3VlaXNoIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiYXV0aG9yIiwiR0hPU1RfVVNFUiIsIm51bWJlciIsInRpdGxlIiwidXJsIiwiVVJMIiwiYXV0aG9yTG9naW4iLCJsb2dpbiIsImF1dGhvckF2YXRhclVSTCIsImF2YXRhclVybCIsImNyZWF0ZWRBdCIsIm1vbWVudCIsIklTT184NjAxIiwiaGVhZFJlZk5hbWUiLCJoZWFkUmVwb3NpdG9yeUlEIiwicmVwb3NpdG9yeSIsImlkIiwibGF0ZXN0Q29tbWl0Iiwic3RhdHVzQ29udGV4dHMiLCJjaGVja1J1bnMiLCJjb21taXRzIiwibm9kZXMiLCJsZW5ndGgiLCJjb21taXQiLCJzdGF0dXMiLCJjb250ZXh0cyIsImdldE51bWJlciIsImdldFRpdGxlIiwiZ2V0R2l0SHViVVJMIiwidG9TdHJpbmciLCJnZXRBdXRob3JMb2dpbiIsImdldEF1dGhvckF2YXRhclVSTCIsInNpemUiLCJ1Iiwic2VhcmNoUGFyYW1zIiwic2V0IiwiZ2V0Q3JlYXRlZEF0IiwiZ2V0SGVhZFJlZk5hbWUiLCJnZXRIZWFkUmVwb3NpdG9yeUlEIiwiZ2V0TGF0ZXN0Q29tbWl0Iiwic2V0Q2hlY2tSdW5zIiwicnVuc0J5U3VpdGUiLCJydW5zIiwiY2hlY2tSdW4iLCJwdXNoIiwiZ2V0U3RhdHVzQ291bnRzIiwiYnVpbGRTdGF0dXNlcyIsImNvbnRleHQiLCJidWlsZFN0YXR1c0Zyb21TdGF0dXNDb250ZXh0IiwiYnVpbGRTdGF0dXNGcm9tQ2hlY2tSZXN1bHQiLCJjb3VudHMiLCJwZW5kaW5nIiwiZmFpbHVyZSIsInN1Y2Nlc3MiLCJuZXV0cmFsIiwiY2xhc3NTdWZmaXgiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaXNzdWVpc2guanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtVUkx9IGZyb20gJ3VybCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5cbmltcG9ydCB7XG4gIGJ1aWxkU3RhdHVzRnJvbVN0YXR1c0NvbnRleHQsXG4gIGJ1aWxkU3RhdHVzRnJvbUNoZWNrUmVzdWx0LFxufSBmcm9tICcuL2J1aWxkLXN0YXR1cyc7XG5pbXBvcnQge0dIT1NUX1VTRVJ9IGZyb20gJy4uL2hlbHBlcnMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJc3N1ZWlzaCB7XG4gIGNvbnN0cnVjdG9yKGRhdGEpIHtcbiAgICBjb25zdCBhdXRob3IgPSBkYXRhLmF1dGhvciB8fCBHSE9TVF9VU0VSO1xuXG4gICAgdGhpcy5udW1iZXIgPSBkYXRhLm51bWJlcjtcbiAgICB0aGlzLnRpdGxlID0gZGF0YS50aXRsZTtcbiAgICB0aGlzLnVybCA9IG5ldyBVUkwoZGF0YS51cmwpO1xuICAgIHRoaXMuYXV0aG9yTG9naW4gPSBhdXRob3IubG9naW47XG4gICAgdGhpcy5hdXRob3JBdmF0YXJVUkwgPSBuZXcgVVJMKGF1dGhvci5hdmF0YXJVcmwpO1xuICAgIHRoaXMuY3JlYXRlZEF0ID0gbW9tZW50KGRhdGEuY3JlYXRlZEF0LCBtb21lbnQuSVNPXzg2MDEpO1xuICAgIHRoaXMuaGVhZFJlZk5hbWUgPSBkYXRhLmhlYWRSZWZOYW1lO1xuICAgIHRoaXMuaGVhZFJlcG9zaXRvcnlJRCA9IGRhdGEucmVwb3NpdG9yeS5pZDtcbiAgICB0aGlzLmxhdGVzdENvbW1pdCA9IG51bGw7XG4gICAgdGhpcy5zdGF0dXNDb250ZXh0cyA9IFtdO1xuICAgIHRoaXMuY2hlY2tSdW5zID0gW107XG5cbiAgICBpZiAoZGF0YS5jb21taXRzLm5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMubGF0ZXN0Q29tbWl0ID0gZGF0YS5jb21taXRzLm5vZGVzWzBdLmNvbW1pdDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sYXRlc3RDb21taXQgJiYgdGhpcy5sYXRlc3RDb21taXQuc3RhdHVzKSB7XG4gICAgICB0aGlzLnN0YXR1c0NvbnRleHRzID0gdGhpcy5sYXRlc3RDb21taXQuc3RhdHVzLmNvbnRleHRzO1xuICAgIH1cbiAgfVxuXG4gIGdldE51bWJlcigpIHtcbiAgICByZXR1cm4gdGhpcy5udW1iZXI7XG4gIH1cblxuICBnZXRUaXRsZSgpIHtcbiAgICByZXR1cm4gdGhpcy50aXRsZTtcbiAgfVxuXG4gIGdldEdpdEh1YlVSTCgpIHtcbiAgICByZXR1cm4gdGhpcy51cmwudG9TdHJpbmcoKTtcbiAgfVxuXG4gIGdldEF1dGhvckxvZ2luKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhvckxvZ2luO1xuICB9XG5cbiAgZ2V0QXV0aG9yQXZhdGFyVVJMKHNpemUgPSAzMikge1xuICAgIGNvbnN0IHUgPSBuZXcgVVJMKHRoaXMuYXV0aG9yQXZhdGFyVVJMLnRvU3RyaW5nKCkpO1xuICAgIHUuc2VhcmNoUGFyYW1zLnNldCgncycsIHNpemUpO1xuICAgIHJldHVybiB1LnRvU3RyaW5nKCk7XG4gIH1cblxuICBnZXRDcmVhdGVkQXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlZEF0O1xuICB9XG5cbiAgZ2V0SGVhZFJlZk5hbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaGVhZFJlZk5hbWU7XG4gIH1cblxuICBnZXRIZWFkUmVwb3NpdG9yeUlEKCkge1xuICAgIHJldHVybiB0aGlzLmhlYWRSZXBvc2l0b3J5SUQ7XG4gIH1cblxuICBnZXRMYXRlc3RDb21taXQoKSB7XG4gICAgcmV0dXJuIHRoaXMubGF0ZXN0Q29tbWl0O1xuICB9XG5cbiAgc2V0Q2hlY2tSdW5zKHJ1bnNCeVN1aXRlKSB7XG4gICAgdGhpcy5jaGVja1J1bnMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IFssIHJ1bnNdIG9mIHJ1bnNCeVN1aXRlKSB7XG4gICAgICBmb3IgKGNvbnN0IGNoZWNrUnVuIG9mIHJ1bnMpIHtcbiAgICAgICAgdGhpcy5jaGVja1J1bnMucHVzaChjaGVja1J1bik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0U3RhdHVzQ291bnRzKCkge1xuICAgIGNvbnN0IGJ1aWxkU3RhdHVzZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGNvbnRleHQgb2YgdGhpcy5zdGF0dXNDb250ZXh0cykge1xuICAgICAgYnVpbGRTdGF0dXNlcy5wdXNoKGJ1aWxkU3RhdHVzRnJvbVN0YXR1c0NvbnRleHQoY29udGV4dCkpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGNoZWNrUnVuIG9mIHRoaXMuY2hlY2tSdW5zKSB7XG4gICAgICBidWlsZFN0YXR1c2VzLnB1c2goYnVpbGRTdGF0dXNGcm9tQ2hlY2tSZXN1bHQoY2hlY2tSdW4pKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb3VudHMgPSB7XG4gICAgICBwZW5kaW5nOiAwLFxuICAgICAgZmFpbHVyZTogMCxcbiAgICAgIHN1Y2Nlc3M6IDAsXG4gICAgICBuZXV0cmFsOiAwLFxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IHtjbGFzc1N1ZmZpeH0gb2YgYnVpbGRTdGF0dXNlcykge1xuICAgICAgY291bnRzW2NsYXNzU3VmZml4XSsrO1xuICAgIH1cblxuICAgIHJldHVybiBjb3VudHM7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsSUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBRUEsSUFBQUcsWUFBQSxHQUFBSCxPQUFBO0FBSUEsSUFBQUksUUFBQSxHQUFBSixPQUFBO0FBQXNDLFNBQUFFLHVCQUFBRyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBRXZCLE1BQU1HLFFBQVEsQ0FBQztFQUM1QkMsV0FBV0EsQ0FBQ0MsSUFBSSxFQUFFO0lBQ2hCLE1BQU1DLE1BQU0sR0FBR0QsSUFBSSxDQUFDQyxNQUFNLElBQUlDLG1CQUFVO0lBRXhDLElBQUksQ0FBQ0MsTUFBTSxHQUFH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