"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.source = void 0;
var _yubikiri = _interopRequireDefault(require("yubikiri"));
var _eventKit = require("event-kit");
var _relayNetworkLayerManager = _interopRequireDefault(require("../relay-network-layer-manager"));
var _author = _interopRequireWildcard(require("./author"));
var _keytarStrategy = require("../shared/keytar-strategy");
var _modelObserver = _interopRequireDefault(require("./model-observer"));
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
// This is a guess about what a reasonable value is. Can adjust if performance is poor.
const MAX_COMMITS = 5000;
const source = {
  PENDING: Symbol('pending'),
  GITLOG: Symbol('git log'),
  GITHUBAPI: Symbol('github API')
};
exports.source = source;
class GraphQLCache {
  // One hour

  constructor() {
    this.bySlug = new Map();
  }
  get(remote) {
    const slug = remote.getSlug();
    const {
      ts,
      data
    } = this.bySlug.get(slug) || {
      ts: -Infinity,
      data: {}
    };
    if (Date.now() - ts > this.constructor.MAX_AGE_MS) {
      this.bySlug.delete(slug);
      return null;
    }
    return data;
  }
  set(remote, data) {
    this.bySlug.set(remote.getSlug(), {
      ts: Date.now(),
      data
    });
  }
}
_defineProperty(GraphQLCache, "MAX_AGE_MS", 3.6e6);
class UserStore {
  constructor({
    repository,
    login,
    config
  }) {
    this.emitter = new _eventKit.Emitter();
    this.subs = new _eventKit.CompositeDisposable();

    // TODO: [ku 3/2018] Consider using Dexie (indexDB wrapper) like Desktop and persist users across sessions
    this.allUsers = new Map();
    this.excludedUsers = new Set();
    this.users = [];
    this.committer = _author.nullAuthor;
    this.last = {
      source: source.PENDING,
      repository: null,
      excludedUsers: this.excludedUsers
    };
    this.cache = new GraphQLCache();
    this.repositoryObserver = new _modelObserver.default({
      fetchData: r => (0, _yubikiri.default)({
        committer: r.getCommitter(),
        authors: r.getAuthors({
          max: MAX_COMMITS
        }),
        remotes: r.getRemotes()
      }),
      didUpdate: () => this.loadUsers()
    });
    this.repositoryObserver.setActiveModel(repository);
    this.loginObserver = new _modelObserver.default({
      didUpdate: () => this.loadUsers()
    });
    this.loginObserver.setActiveModel(login);
    this.subs.add(config.observe('github.excludedUsers', value => {
      this.excludedUsers = new Set((value || '').split(/\s*,\s*/).filter(each => each.length > 0));
      return this.loadUsers();
    }));
  }
  dispose() {
    this.subs.dispose();
    this.emitter.dispose();
  }
  async loadUsers() {
    const data = this.repositoryObserver.getActiveModelData();
    if (!data) {
      return;
    }
    this.setCommitter(data.committer);
    const githubRemotes = Array.from(data.remotes).filter(remote => remote.isGithubRepo());
    if (githubRemotes.length > 0) {
      await this.loadUsersFromGraphQL(githubRemotes);
    } else {
      this.addUsers(data.authors, source.GITLOG);
    }

    // if for whatever reason, no committers can be added, fall back to
    // using git log committers as the last resort
    if (this.allUsers.size === 0) {
      this.addUsers(data.authors, source.GITLOG);
    }
  }
  loadUsersFromGraphQL(remotes) {
    return Promise.all(Array.from(remotes, remote => this.loadMentionableUsers(remote)));
  }
  async getToken(loginModel, loginAccount) {
    if (!loginModel) {
      return null;
    }
    const token = await loginModel.getToken(loginAccount);
    if (token === _keytarStrategy.UNAUTHENTICATED || token === _keytarStrategy.INSUFFICIENT || token instanceof Error) {
      return null;
    }
    return token;
  }
  async loadMentionableUsers(remote) {
    const cached = this.cache.get(remote);
    if (cached !== null) {
      this.addUsers(cached, source.GITHUBAPI);
      return;
    }
    const endpoint = remote.getEndpoint();
    const token = await this.getToken(this.loginObserver.getActiveModel(), endpoint.getLoginAccount());
    if (!token) {
      return;
    }
    const fetchQuery = _relayNetworkLayerManager.default.getFetchQuery(endpoint, token);
    let hasMore = true;
    let cursor = null;
    const remoteUsers = [];
    while (hasMore) {
      const response = await fetchQuery({
        name: 'GetMentionableUsers',
        text: `
          query GetMentionableUsers($owner: String!, $name: String!, $first: Int!, $after: String) {
            repository(owner: $owner, name: $name) {
              mentionableUsers(first: $first, after: $after) {
                nodes {
                  login
                  email
                  name
                }
                pageInfo {
                  hasNextPage
                  endCursor
                }
              }
            }
          }
        `
      }, {
        owner: remote.getOwner(),
        name: remote.getRepo(),
        first: 100,
        after: cursor
      });

      /* istanbul ignore if */
      if (response.errors && response.errors.length > 1) {
        // eslint-disable-next-line no-console
        console.error(`Error fetching mentionable users:\n${response.errors.map(e => e.message).join('\n')}`);
      }
      if (!response.data || !response.data.repository) {
        break;
      }
      const connection = response.data.repository.mentionableUsers;
      const authors = connection.nodes.map(node => {
        if (node.email === '') {
          node.email = `${node.login}@users.noreply.github.com`;
        }
        return new _author.default(node.email, node.name, node.login);
      });
      this.addUsers(authors, source.GITHUBAPI);
      remoteUsers.push(...authors);
      cursor = connection.pageInfo.endCursor;
      hasMore = connection.pageInfo.hasNextPage;
    }
    this.cache.set(remote, remoteUsers);
  }
  addUsers(users, nextSource) {
    let changed = false;
    if (nextSource !== this.last.source || this.repositoryObserver.getActiveModel() !== this.last.repository || this.excludedUsers !== this.last.excludedUsers) {
      changed = true;
      this.allUsers.clear();
    }
    for (const author of users) {
      if (!this.allUsers.has(author.getEmail())) {
        changed = true;
      }
      this.allUsers.set(author.getEmail(), author);
    }
    if (changed) {
      this.finalize();
    }
    this.last.source = nextSource;
    this.last.repository = this.repositoryObserver.getActiveModel();
    this.last.excludedUsers = this.excludedUsers;
  }
  finalize() {
    // TODO: [ku 3/2018] consider sorting based on most recent authors or commit frequency
    const users = [];
    for (const author of this.allUsers.values()) {
      if (author.matches(this.committer)) {
        continue;
      }
      if (author.isNoReply()) {
        continue;
      }
      if (this.excludedUsers.has(author.getEmail())) {
        continue;
      }
      users.push(author);
    }
    users.sort(_author.default.compare);
    this.users = users;
    this.didUpdate();
  }
  setRepository(repository) {
    this.repositoryObserver.setActiveModel(repository);
  }
  setLoginModel(login) {
    this.loginObserver.setActiveModel(login);
  }
  setCommitter(committer) {
    const changed = !this.committer.matches(committer);
    this.committer = committer;
    if (changed) {
      this.finalize();
    }
  }
  didUpdate() {
    this.emitter.emit('did-update', this.getUsers());
  }
  onDidUpdate(callback) {
    return this.emitter.on('did-update', callback);
  }
  getUsers() {
    return this.users;
  }
}
exports.default = UserStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfeXViaWtpcmkiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9ldmVudEtpdCIsIl9yZWxheU5ldHdvcmtMYXllck1hbmFnZXIiLCJfYXV0aG9yIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfa2V5dGFyU3RyYXRlZ3kiLCJfbW9kZWxPYnNlcnZlciIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsIm5vZGVJbnRlcm9wIiwiV2Vha01hcCIsImNhY2hlQmFiZWxJbnRlcm9wIiwiY2FjaGVOb2RlSW50ZXJvcCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiY2FjaGUiLCJoYXMiLCJnZXQiLCJuZXdPYmoiLCJoYXNQcm9wZXJ0eURlc2NyaXB0b3IiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJzZXQiLCJfZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiTUFYX0NPTU1JVFMiLCJzb3VyY2UiLCJQRU5ESU5HIiwiR0lUTE9HIiwiR0lUSFVCQVBJIiwiZXhwb3J0cyIsIkdyYXBoUUxDYWNoZSIsImNvbnN0cnVjdG9yIiwiYnlTbHVnIiwiTWFwIiwicmVtb3RlIiwic2x1ZyIsImdldFNsdWciLCJ0cyIsImRhdGEiLCJJbmZpbml0eSIsIkRhdGUiLCJub3ciLCJNQVhfQUdFX01TIiwiZGVsZXRlIiwiVXNlclN0b3JlIiwicmVwb3NpdG9yeSIsImxvZ2luIiwiY29uZmlnIiwiZW1pdHRlciIsIkVtaXR0ZXIiLCJzdWJzIiwiQ29tcG9zaXRlRGlzcG9zYWJsZSIsImFsbFVzZXJzIiwiZXhjbHVkZWRVc2VycyIsIlNldCIsInVzZXJzIiwiY29tbWl0dGVyIiwibnVsbEF1dGhvciIsImxhc3QiLCJyZXBvc2l0b3J5T2JzZXJ2ZXIiLCJNb2RlbE9ic2VydmVyIiwiZmV0Y2hEYXRhIiwiciIsInl1YmlraXJpIiwiZ2V0Q29tbWl0dGVyIiwiYXV0aG9ycyIsImdldEF1dGhvcnMiLCJtYXgiLCJyZW1vdGVzIiwiZ2V0UmVtb3RlcyIsImRpZFVwZGF0ZSIsImxvYWRVc2VycyIsInNldEFjdGl2ZU1vZGVsIiwibG9naW5PYnNlcnZlciIsImFkZCIsIm9ic2VydmUiLCJzcGxpdCIsImZpbHRlciIsImVhY2giLCJsZW5ndGgiLCJkaXNwb3NlIiwiZ2V0QWN0aXZlTW9kZWxEYXRhIiwic2V0Q29tbWl0dGVyIiwiZ2l0aHViUmVtb3RlcyIsIkFycmF5IiwiZnJvbSIsImlzR2l0aHViUmVwbyIsImxvYWRVc2Vyc0Zyb21HcmFwaFFMIiwiYWRkVXNlcnMiLCJzaXplIiwiUHJvbWlzZSIsImFsbCIsImxvYWRNZW50aW9uYWJsZVVzZXJzIiwiZ2V0VG9rZW4iLCJsb2dpbk1vZGVsIiwibG9naW5BY2NvdW50IiwidG9rZW4iLCJVTkFVVEhFTlRJQ0FURUQiLCJJTlNVRkZJQ0lFTlQiLCJFcnJvciIsImNhY2hlZCIsImVuZHBvaW50IiwiZ2V0RW5kcG9pbnQiLCJnZXRBY3RpdmVNb2RlbCIsImdldExvZ2luQWNjb3VudCIsImZldGNoUXVlcnkiLCJSZWxheU5ldHdvcmtMYXllck1hbmFnZXIiLCJnZXRGZXRjaFF1ZXJ5IiwiaGFzTW9yZSIsImN1cnNvciIsInJlbW90ZVVzZXJzIiwicmVzcG9uc2UiLCJuYW1lIiwidGV4dCIsIm93bmVyIiwiZ2V0T3duZXIiLCJnZXRSZXBvIiwiZmlyc3QiLCJhZnRlciIsImVycm9ycyIsImNvbnNvbGUiLCJlcnJvciIsIm1hcCIsImUiLCJtZXNzYWdlIiwiam9pbiIsImNvbm5lY3Rpb24iLCJtZW50aW9uYWJsZVVzZXJzIiwibm9kZXMiLCJub2RlIiwiZW1haWwiLCJBdXRob3IiLCJwdXNoIiwicGFnZUluZm8iLCJlbmRDdXJzb3IiLCJoYXNOZXh0UGFnZSIsIm5leHRTb3VyY2UiLCJjaGFuZ2VkIiwiY2xlYXIiLCJhdXRob3IiLCJnZXRFbWFpbCIsImZpbmFsaXplIiwidmFsdWVzIiwibWF0Y2hlcyIsImlzTm9SZXBseSIsInNvcnQiLCJjb21wYXJlIiwic2V0UmVwb3NpdG9yeSIsInNldExvZ2luTW9kZWwiLCJlbWl0IiwiZ2V0VXNlcnMiLCJvbkRpZFVwZGF0ZSIsImNhbGxiYWNrIiwib24iXSwic291cmNlcyI6WyJ1c2VyLXN0b3JlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB5dWJpa2lyaSBmcm9tICd5dWJpa2lyaSc7XG5pbXBvcnQge0VtaXR0ZXIsIENvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2V2ZW50LWtpdCc7XG5cbmltcG9ydCBSZWxheU5ldHdvcmtMYXllck1hbmFnZXIgZnJvbSAnLi4vcmVsYXktbmV0d29yay1sYXllci1tYW5hZ2VyJztcbmltcG9ydCBBdXRob3IsIHtudWxsQXV0aG9yfSBmcm9tICcuL2F1dGhvcic7XG5pbXBvcnQge1VOQVVUSEVOVElDQVRFRCwgSU5TVUZGSUNJRU5UfSBmcm9tICcuLi9zaGFyZWQva2V5dGFyLXN0cmF0ZWd5JztcbmltcG9ydCBNb2RlbE9ic2VydmVyIGZyb20gJy4vbW9kZWwtb2JzZXJ2ZXInO1xuXG4vLyBUaGlzIGlzIGEgZ3Vlc3MgYWJvdXQgd2hhdCBhIHJlYXNvbmFibGUgdmFsdWUgaXMuIENhbiBhZGp1c3QgaWYgcGVyZm9ybWFuY2UgaXMgcG9vci5cbmNvbnN0IE1BWF9DT01NSVRTID0gNTAwMDtcblxuZXhwb3J0IGNvbnN0IHNvdXJjZSA9IHtcbiAgUEVORElORzogU3ltYm9sKCdwZW5kaW5nJyksXG4gIEdJVExPRzogU3ltYm9sKCdnaXQgbG9nJyksXG4gIEdJVEhVQkFQSTogU3ltYm9sKCdnaXRodWIgQVBJJyksXG59O1xuXG5jbGFzcyBHcmFwaFFMQ2FjaGUge1xuICAvLyBPbmUgaG91clxuICBzdGF0aWMgTUFYX0FHRV9NUyA9IDMuNmU2XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5ieVNsdWcgPSBuZXcgTWFwKCk7XG4gIH1cblxuICBnZXQocmVtb3RlKSB7XG4gICAgY29uc3Qgc2x1ZyA9IHJlbW90ZS5nZXRTbHVnKCk7XG4gICAgY29uc3Qge3RzLCBkYXRhfSA9IHRoaXMuYnlTbHVnLmdldChzbHVnKSB8fCB7XG4gICAgICB0czogLUluZmluaXR5LFxuICAgICAgZGF0YToge30sXG4gICAgfTtcblxuICAgIGlmIChEYXRlLm5vdygpIC0gdHMgPiB0aGlzLmNvbnN0cnVjdG9yLk1BWF9BR0VfTVMpIHtcbiAgICAgIHRoaXMuYnlTbHVnLmRlbGV0ZShzbHVnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHNldChyZW1vdGUsIGRhdGEpIHtcbiAgICB0aGlzLmJ5U2x1Zy5zZXQocmVtb3RlLmdldFNsdWcoKSwge3RzOiBEYXRlLm5vdygpLCBkYXRhfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlclN0b3JlIHtcbiAgY29uc3RydWN0b3Ioe3JlcG9zaXRvcnksIGxvZ2luLCBjb25maWd9KSB7XG4gICAgdGhpcy5lbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcbiAgICB0aGlzLnN1YnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuXG4gICAgLy8gVE9ETzogW2t1IDMvMjAxOF0gQ29uc2lkZXIgdXNpbmcgRGV4aWUgKGluZGV4REIgd3JhcHBlcikgbGlrZSBEZXNrdG9wIGFuZCBwZXJzaXN0IHVzZXJzIGFjcm9zcyBzZXNzaW9uc1xuICAgIHRoaXMuYWxsVXNlcnMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5leGNsdWRlZFVzZXJzID0gbmV3IFNldCgpO1xuICAgIHRoaXMudXNlcnMgPSBbXTtcbiAgICB0aGlzLmNvbW1pdHRlciA9IG51bGxBdXRob3I7XG5cbiAgICB0aGlzLmxhc3QgPSB7XG4gICAgICBzb3VyY2U6IHNvdXJjZS5QRU5ESU5HLFxuICAgICAgcmVwb3NpdG9yeTogbnVsbCxcbiAgICAgIGV4Y2x1ZGVkVXNlcnM6IHRoaXMuZXhjbHVkZWRVc2VycyxcbiAgICB9O1xuICAgIHRoaXMuY2FjaGUgPSBuZXcgR3JhcGhRTENhY2hlKCk7XG5cbiAgICB0aGlzLnJlcG9zaXRvcnlPYnNlcnZlciA9IG5ldyBNb2RlbE9ic2VydmVyKHtcbiAgICAgIGZldGNoRGF0YTogciA9PiB5dWJpa2lyaSh7XG4gICAgICAgIGNvbW1pdHRlcjogci5nZXRDb21taXR0ZXIoKSxcbiAgICAgICAgYXV0aG9yczogci5nZXRBdXRob3JzKHttYXg6IE1BWF9DT01NSVRTfSksXG4gICAgICAgIHJlbW90ZXM6IHIuZ2V0UmVtb3RlcygpLFxuICAgICAgfSksXG4gICAgICBkaWRVcGRhdGU6ICgpID0+IHRoaXMubG9hZFVzZXJzKCksXG4gICAgfSk7XG4gICAgdGhpcy5yZXBvc2l0b3J5T2JzZXJ2ZXIuc2V0QWN0aXZlTW9kZWwocmVwb3NpdG9yeSk7XG5cbiAgICB0aGlzLmxvZ2luT2JzZXJ2ZXIgPSBuZXcgTW9kZWxPYnNlcnZlcih7XG4gICAgICBkaWRVcGRhdGU6ICgpID0+IHRoaXMubG9hZFVzZXJzKCksXG4gICAgfSk7XG4gICAgdGhpcy5sb2dpbk9ic2VydmVyLnNldEFjdGl2ZU1vZGVsKGxvZ2luKTtcblxuICAgIHRoaXMuc3Vicy5hZGQoXG4gICAgICBjb25maWcub2JzZXJ2ZSgnZ2l0aHViLmV4Y2x1ZGVkVXNlcnMnLCB2YWx1ZSA9PiB7XG4gICAgICAgIHRoaXMuZXhjbHVkZWRVc2VycyA9IG5ldyBTZXQoXG4gICAgICAgICAgKHZhbHVlIHx8ICcnKS5zcGxpdCgvXFxzKixcXHMqLykuZmlsdGVyKGVhY2ggPT4gZWFjaC5sZW5ndGggPiAwKSxcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZFVzZXJzKCk7XG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgZGlzcG9zZSgpIHtcbiAgICB0aGlzLnN1YnMuZGlzcG9zZSgpO1xuICAgIHRoaXMuZW1pdHRlci5kaXNwb3NlKCk7XG4gIH1cblxuICBhc3luYyBsb2FkVXNlcnMoKSB7XG4gICAgY29uc3QgZGF0YSA9IHRoaXMucmVwb3NpdG9yeU9ic2VydmVyLmdldEFjdGl2ZU1vZGVsRGF0YSgpO1xuXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zZXRDb21taXR0ZXIoZGF0YS5jb21taXR0ZXIpO1xuICAgIGNvbnN0IGdpdGh1YlJlbW90ZXMgPSBBcnJheS5mcm9tKGRhdGEucmVtb3RlcykuZmlsdGVyKHJlbW90ZSA9PiByZW1vdGUuaXNHaXRodWJSZXBvKCkpO1xuXG4gICAgaWYgKGdpdGh1YlJlbW90ZXMubGVuZ3RoID4gMCkge1xuICAgICAgYXdhaXQgdGhpcy5sb2FkVXNlcnNGcm9tR3JhcGhRTChnaXRodWJSZW1vdGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hZGRVc2VycyhkYXRhLmF1dGhvcnMsIHNvdXJjZS5HSVRMT0cpO1xuICAgIH1cblxuICAgIC8vIGlmIGZvciB3aGF0ZXZlciByZWFzb24sIG5vIGNvbW1pdHRlcnMgY2FuIGJlIGFkZGVkLCBmYWxsIGJhY2sgdG9cbiAgICAvLyB1c2luZyBnaXQgbG9nIGNvbW1pdHRlcnMgYXMgdGhlIGxhc3QgcmVzb3J0XG4gICAgaWYgKHRoaXMuYWxsVXNlcnMuc2l6ZSA9PT0gMCkge1xuICAgICAgdGhpcy5hZGRVc2VycyhkYXRhLmF1dGhvcnMsIHNvdXJjZS5HSVRMT0cpO1xuICAgIH1cbiAgfVxuXG4gIGxvYWRVc2Vyc0Zyb21HcmFwaFFMKHJlbW90ZXMpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgICBBcnJheS5mcm9tKHJlbW90ZXMsIHJlbW90ZSA9PiB0aGlzLmxvYWRNZW50aW9uYWJsZVVzZXJzKHJlbW90ZSkpLFxuICAgICk7XG4gIH1cblxuICBhc3luYyBnZXRUb2tlbihsb2dpbk1vZGVsLCBsb2dpbkFjY291bnQpIHtcbiAgICBpZiAoIWxvZ2luTW9kZWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGxvZ2luTW9kZWwuZ2V0VG9rZW4obG9naW5BY2NvdW50KTtcbiAgICBpZiAodG9rZW4gPT09IFVOQVVUSEVOVElDQVRFRCB8fCB0b2tlbiA9PT0gSU5TVUZGSUNJRU5UIHx8IHRva2VuIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gdG9rZW47XG4gIH1cblxuICBhc3luYyBsb2FkTWVudGlvbmFibGVVc2VycyhyZW1vdGUpIHtcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmNhY2hlLmdldChyZW1vdGUpO1xuICAgIGlmIChjYWNoZWQgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuYWRkVXNlcnMoY2FjaGVkLCBzb3VyY2UuR0lUSFVCQVBJKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBlbmRwb2ludCA9IHJlbW90ZS5nZXRFbmRwb2ludCgpO1xuICAgIGNvbnN0IHRva2VuID0gYXdhaXQgdGhpcy5nZXRUb2tlbih0aGlzLmxvZ2luT2JzZXJ2ZXIuZ2V0QWN0aXZlTW9kZWwoKSwgZW5kcG9pbnQuZ2V0TG9naW5BY2NvdW50KCkpO1xuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBmZXRjaFF1ZXJ5ID0gUmVsYXlOZXR3b3JrTGF5ZXJNYW5hZ2VyLmdldEZldGNoUXVlcnkoZW5kcG9pbnQsIHRva2VuKTtcblxuICAgIGxldCBoYXNNb3JlID0gdHJ1ZTtcbiAgICBsZXQgY3Vyc29yID0gbnVsbDtcbiAgICBjb25zdCByZW1vdGVVc2VycyA9IFtdO1xuXG4gICAgd2hpbGUgKGhhc01vcmUpIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hRdWVyeSh7XG4gICAgICAgIG5hbWU6ICdHZXRNZW50aW9uYWJsZVVzZXJzJyxcbiAgICAgICAgdGV4dDogYFxuICAgICAgICAgIHF1ZXJ5IEdldE1lbnRpb25hYmxlVXNlcnMoJG93bmVyOiBTdHJpbmchLCAkbmFtZTogU3RyaW5nISwgJGZpcnN0OiBJbnQhLCAkYWZ0ZXI6IFN0cmluZykge1xuICAgICAgICAgICAgcmVwb3NpdG9yeShvd25lcjogJG93bmVyLCBuYW1lOiAkbmFtZSkge1xuICAgICAgICAgICAgICBtZW50aW9uYWJsZVVzZXJzKGZpcnN0OiAkZmlyc3QsIGFmdGVyOiAkYWZ0ZXIpIHtcbiAgICAgICAgICAgICAgICBub2RlcyB7XG4gICAgICAgICAgICAgICAgICBsb2dpblxuICAgICAgICAgICAgICAgICAgZW1haWxcbiAgICAgICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFnZUluZm8ge1xuICAgICAgICAgICAgICAgICAgaGFzTmV4dFBhZ2VcbiAgICAgICAgICAgICAgICAgIGVuZEN1cnNvclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgYCxcbiAgICAgIH0sIHtcbiAgICAgICAgb3duZXI6IHJlbW90ZS5nZXRPd25lcigpLFxuICAgICAgICBuYW1lOiByZW1vdGUuZ2V0UmVwbygpLFxuICAgICAgICBmaXJzdDogMTAwLFxuICAgICAgICBhZnRlcjogY3Vyc29yLFxuICAgICAgfSk7XG5cbiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgICAgaWYgKHJlc3BvbnNlLmVycm9ycyAmJiByZXNwb25zZS5lcnJvcnMubGVuZ3RoID4gMSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmZXRjaGluZyBtZW50aW9uYWJsZSB1c2VyczpcXG4ke3Jlc3BvbnNlLmVycm9ycy5tYXAoZSA9PiBlLm1lc3NhZ2UpLmpvaW4oJ1xcbicpfWApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLmRhdGEgfHwgIXJlc3BvbnNlLmRhdGEucmVwb3NpdG9yeSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29ubmVjdGlvbiA9IHJlc3BvbnNlLmRhdGEucmVwb3NpdG9yeS5tZW50aW9uYWJsZVVzZXJzO1xuICAgICAgY29uc3QgYXV0aG9ycyA9IGNvbm5lY3Rpb24ubm9kZXMubWFwKG5vZGUgPT4ge1xuICAgICAgICBpZiAobm9kZS5lbWFpbCA9PT0gJycpIHtcbiAgICAgICAgICBub2RlLmVtYWlsID0gYCR7bm9kZS5sb2dpbn1AdXNlcnMubm9yZXBseS5naXRodWIuY29tYDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgQXV0aG9yKG5vZGUuZW1haWwsIG5vZGUubmFtZSwgbm9kZS5sb2dpbik7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuYWRkVXNlcnMoYXV0aG9ycywgc291cmNlLkdJVEhVQkFQSSk7XG4gICAgICByZW1vdGVVc2Vycy5wdXNoKC4uLmF1dGhvcnMpO1xuXG4gICAgICBjdXJzb3IgPSBjb25uZWN0aW9uLnBhZ2VJbmZvLmVuZEN1cnNvcjtcbiAgICAgIGhhc01vcmUgPSBjb25uZWN0aW9uLnBhZ2VJbmZvLmhhc05leHRQYWdlO1xuICAgIH1cblxuICAgIHRoaXMuY2FjaGUuc2V0KHJlbW90ZSwgcmVtb3RlVXNlcnMpO1xuICB9XG5cbiAgYWRkVXNlcnModXNlcnMsIG5leHRTb3VyY2UpIHtcbiAgICBsZXQgY2hhbmdlZCA9IGZhbHNlO1xuXG4gICAgaWYgKFxuICAgICAgbmV4dFNvdXJjZSAhPT0gdGhpcy5sYXN0LnNvdXJjZSB8fFxuICAgICAgdGhpcy5yZXBvc2l0b3J5T2JzZXJ2ZXIuZ2V0QWN0aXZlTW9kZWwoKSAhPT0gdGhpcy5sYXN0LnJlcG9zaXRvcnkgfHxcbiAgICAgIHRoaXMuZXhjbHVkZWRVc2VycyAhPT0gdGhpcy5sYXN0LmV4Y2x1ZGVkVXNlcnNcbiAgICApIHtcbiAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgdGhpcy5hbGxVc2Vycy5jbGVhcigpO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgYXV0aG9yIG9mIHVzZXJzKSB7XG4gICAgICBpZiAoIXRoaXMuYWxsVXNlcnMuaGFzKGF1dGhvci5nZXRFbWFpbCgpKSkge1xuICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWxsVXNlcnMuc2V0KGF1dGhvci5nZXRFbWFpbCgpLCBhdXRob3IpO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VkKSB7XG4gICAgICB0aGlzLmZpbmFsaXplKCk7XG4gICAgfVxuICAgIHRoaXMubGFzdC5zb3VyY2UgPSBuZXh0U291cmNlO1xuICAgIHRoaXMubGFzdC5yZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5T2JzZXJ2ZXIuZ2V0QWN0aXZlTW9kZWwoKTtcbiAgICB0aGlzLmxhc3QuZXhjbHVkZWRVc2VycyA9IHRoaXMuZXhjbHVkZWRVc2VycztcbiAgfVxuXG4gIGZpbmFsaXplKCkge1xuICAgIC8vIFRPRE86IFtrdSAzLzIwMThdIGNvbnNpZGVyIHNvcnRpbmcgYmFzZWQgb24gbW9zdCByZWNlbnQgYXV0aG9ycyBvciBjb21taXQgZnJlcXVlbmN5XG4gICAgY29uc3QgdXNlcnMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGF1dGhvciBvZiB0aGlzLmFsbFVzZXJzLnZhbHVlcygpKSB7XG4gICAgICBpZiAoYXV0aG9yLm1hdGNoZXModGhpcy5jb21taXR0ZXIpKSB7IGNvbnRpbnVlOyB9XG4gICAgICBpZiAoYXV0aG9yLmlzTm9SZXBseSgpKSB7IGNvbnRpbnVlOyB9XG4gICAgICBpZiAodGhpcy5leGNsdWRlZFVzZXJzLmhhcyhhdXRob3IuZ2V0RW1haWwoKSkpIHsgY29udGludWU7IH1cblxuICAgICAgdXNlcnMucHVzaChhdXRob3IpO1xuICAgIH1cbiAgICB1c2Vycy5zb3J0KEF1dGhvci5jb21wYXJlKTtcbiAgICB0aGlzLnVzZXJzID0gdXNlcnM7XG4gICAgdGhpcy5kaWRVcGRhdGUoKTtcbiAgfVxuXG4gIHNldFJlcG9zaXRvcnkocmVwb3NpdG9yeSkge1xuICAgIHRoaXMucmVwb3NpdG9yeU9ic2VydmVyLnNldEFjdGl2ZU1vZGVsKHJlcG9zaXRvcnkpO1xuICB9XG5cbiAgc2V0TG9naW5Nb2RlbChsb2dpbikge1xuICAgIHRoaXMubG9naW5PYnNlcnZlci5zZXRBY3RpdmVNb2RlbChsb2dpbik7XG4gIH1cblxuICBzZXRDb21taXR0ZXIoY29tbWl0dGVyKSB7XG4gICAgY29uc3QgY2hhbmdlZCA9ICF0aGlzLmNvbW1pdHRlci5tYXRjaGVzKGNvbW1pdHRlcik7XG4gICAgdGhpcy5jb21taXR0ZXIgPSBjb21taXR0ZXI7XG4gICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgIHRoaXMuZmluYWxpemUoKTtcbiAgICB9XG4gIH1cblxuICBkaWRVcGRhdGUoKSB7XG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC11cGRhdGUnLCB0aGlzLmdldFVzZXJzKCkpO1xuICB9XG5cbiAgb25EaWRVcGRhdGUoY2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCdkaWQtdXBkYXRlJywgY2FsbGJhY2spO1xuICB9XG5cbiAgZ2V0VXNlcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMudXNlcnM7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsU0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRCxPQUFBO0FBRUEsSUFBQUUseUJBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLE9BQUEsR0FBQUMsdUJBQUEsQ0FBQUosT0FBQTtBQUNBLElBQUFLLGVBQUEsR0FBQUwsT0FBQTtBQUNBLElBQUFNLGNBQUEsR0FBQVAsc0JB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