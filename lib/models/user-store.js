"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.source = void 0;
var _yubikiri = _interopRequireDefault(require("yubikiri"));
var _eventKit = require("event-kit");
var _relayNetworkLayerManager = _interopRequireDefault(require("../relay-network-layer-manager"));
var _author = _interopRequireWildcard(require("./author"));
var _keytarStrategy = require("../shared/keytar-strategy");
var _modelObserver = _interopRequireDefault(require("./model-observer"));
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
// This is a guess about what a reasonable value is. Can adjust if performance is poor.
const MAX_COMMITS = 5000;
const source = {
  PENDING: Symbol('pending'),
  GITLOG: Symbol('git log'),
  GITHUBAPI: Symbol('github API')
};
exports.source = source;
class GraphQLCache {
  // One hour

  constructor() {
    this.bySlug = new Map();
  }
  get(remote) {
    const slug = remote.getSlug();
    const {
      ts,
      data
    } = this.bySlug.get(slug) || {
      ts: -Infinity,
      data: {}
    };
    if (Date.now() - ts > this.constructor.MAX_AGE_MS) {
      this.bySlug.delete(slug);
      return null;
    }
    return data;
  }
  set(remote, data) {
    this.bySlug.set(remote.getSlug(), {
      ts: Date.now(),
      data
    });
  }
}
_defineProperty(GraphQLCache, "MAX_AGE_MS", 3.6e6);
class UserStore {
  constructor({
    repository,
    login,
    config
  }) {
    this.emitter = new _eventKit.Emitter();
    this.subs = new _eventKit.CompositeDisposable();

    // TODO: [ku 3/2018] Consider using Dexie (indexDB wrapper) like Desktop and persist users across sessions
    this.allUsers = new Map();
    this.excludedUsers = new Set();
    this.users = [];
    this.committer = _author.nullAuthor;
    this.last = {
      source: source.PENDING,
      repository: null,
      excludedUsers: this.excludedUsers
    };
    this.cache = new GraphQLCache();
    this.repositoryObserver = new _modelObserver.default({
      fetchData: r => (0, _yubikiri.default)({
        committer: r.getCommitter(),
        authors: r.getAuthors({
          max: MAX_COMMITS
        }),
        remotes: r.getRemotes()
      }),
      didUpdate: () => this.loadUsers()
    });
    this.repositoryObserver.setActiveModel(repository);
    this.loginObserver = new _modelObserver.default({
      didUpdate: () => this.loadUsers()
    });
    this.loginObserver.setActiveModel(login);
    this.subs.add(config.observe('github.excludedUsers', value => {
      this.excludedUsers = new Set((value || '').split(/\s*,\s*/).filter(each => each.length > 0));
      return this.loadUsers();
    }));
  }
  dispose() {
    this.subs.dispose();
    this.emitter.dispose();
  }
  async loadUsers() {
    const data = this.repositoryObserver.getActiveModelData();
    if (!data) {
      return;
    }
    this.setCommitter(data.committer);
    const githubRemotes = Array.from(data.remotes).filter(remote => remote.isGithubRepo());
    if (githubRemotes.length > 0) {
      await this.loadUsersFromGraphQL(githubRemotes);
    } else {
      this.addUsers(data.authors, source.GITLOG);
    }

    // if for whatever reason, no committers can be added, fall back to
    // using git log committers as the last resort
    if (this.allUsers.size === 0) {
      this.addUsers(data.authors, source.GITLOG);
    }
  }
  loadUsersFromGraphQL(remotes) {
    return Promise.all(Array.from(remotes, remote => this.loadMentionableUsers(remote)));
  }
  async getToken(loginModel, loginAccount) {
    if (!loginModel) {
      return null;
    }
    const token = await loginModel.getToken(loginAccount);
    if (token === _keytarStrategy.UNAUTHENTICATED || token === _keytarStrategy.INSUFFICIENT || token instanceof Error) {
      return null;
    }
    return token;
  }
  async loadMentionableUsers(remote) {
    const cached = this.cache.get(remote);
    if (cached !== null) {
      this.addUsers(cached, source.GITHUBAPI);
      return;
    }
    const endpoint = remote.getEndpoint();
    const token = await this.getToken(this.loginObserver.getActiveModel(), endpoint.getLoginAccount());
    if (!token) {
      return;
    }
    const fetchQuery = _relayNetworkLayerManager.default.getFetchQuery(endpoint, token);
    let hasMore = true;
    let cursor = null;
    const remoteUsers = [];
    while (hasMore) {
      const response = await fetchQuery({
        name: 'GetMentionableUsers',
        text: `
          query GetMentionableUsers($owner: String!, $name: String!, $first: Int!, $after: String) {
            repository(owner: $owner, name: $name) {
              mentionableUsers(first: $first, after: $after) {
                nodes {
                  login
                  email
                  name
                }
                pageInfo {
                  hasNextPage
                  endCursor
                }
              }
            }
          }
        `
      }, {
        owner: remote.getOwner(),
        name: remote.getRepo(),
        first: 100,
        after: cursor
      });

      /* istanbul ignore if */
      if (response.errors && response.errors.length > 1) {
        // eslint-disable-next-line no-console
        console.error(`Error fetching mentionable users:\n${response.errors.map(e => e.message).join('\n')}`);
      }
      if (!response.data || !response.data.repository) {
        break;
      }
      const connection = response.data.repository.mentionableUsers;
      const authors = connection.nodes.map(node => {
        if (node.email === '') {
          node.email = `${node.login}@users.noreply.github.com`;
        }
        return new _author.default(node.email, node.name, node.login);
      });
      this.addUsers(authors, source.GITHUBAPI);
      remoteUsers.push(...authors);
      cursor = connection.pageInfo.endCursor;
      hasMore = connection.pageInfo.hasNextPage;
    }
    this.cache.set(remote, remoteUsers);
  }
  addUsers(users, nextSource) {
    let changed = false;
    if (nextSource !== this.last.source || this.repositoryObserver.getActiveModel() !== this.last.repository || this.excludedUsers !== this.last.excludedUsers) {
      changed = true;
      this.allUsers.clear();
    }
    for (const author of users) {
      if (!this.allUsers.has(author.getEmail())) {
        changed = true;
      }
      this.allUsers.set(author.getEmail(), author);
    }
    if (changed) {
      this.finalize();
    }
    this.last.source = nextSource;
    this.last.repository = this.repositoryObserver.getActiveModel();
    this.last.excludedUsers = this.excludedUsers;
  }
  finalize() {
    // TODO: [ku 3/2018] consider sorting based on most recent authors or commit frequency
    const users = [];
    for (const author of this.allUsers.values()) {
      if (author.matches(this.committer)) {
        continue;
      }
      if (author.isNoReply()) {
        continue;
      }
      if (this.excludedUsers.has(author.getEmail())) {
        continue;
      }
      users.push(author);
    }
    users.sort(_author.default.compare);
    this.users = users;
    this.didUpdate();
  }
  setRepository(repository) {
    this.repositoryObserver.setActiveModel(repository);
  }
  setLoginModel(login) {
    this.loginObserver.setActiveModel(login);
  }
  setCommitter(committer) {
    const changed = !this.committer.matches(committer);
    this.committer = committer;
    if (changed) {
      this.finalize();
    }
  }
  didUpdate() {
    this.emitter.emit('did-update', this.getUsers());
  }
  onDidUpdate(callback) {
    return this.emitter.on('did-update', callback);
  }
  getUsers() {
    return this.users;
  }
}
exports.default = UserStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfeXViaWtpcmkiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9ldmVudEtpdCIsIl9yZWxheU5ldHdvcmtMYXllck1hbmFnZXIiLCJfYXV0aG9yIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfa2V5dGFyU3RyYXRlZ3kiLCJfbW9kZWxPYnNlcnZlciIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsImUiLCJXZWFrTWFwIiwiciIsInQiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImhhcyIsImdldCIsIm4iLCJfX3Byb3RvX18iLCJhIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJ1IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaSIsInNldCIsIm9iaiIsIl9kZWZpbmVQcm9wZXJ0eSIsImtleSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsIlR5cGVFcnJvciIsIk51bWJlciIsIk1BWF9DT01NSVRTIiwic291cmNlIiwiUEVORElORyIsIkdJVExPRyIsIkdJVEhVQkFQSSIsImV4cG9ydHMiLCJHcmFwaFFMQ2FjaGUiLCJjb25zdHJ1Y3RvciIsImJ5U2x1ZyIsIk1hcCIsInJlbW90ZSIsInNsdWciLCJnZXRTbHVnIiwidHMiLCJkYXRhIiwiSW5maW5pdHkiLCJEYXRlIiwibm93IiwiTUFYX0FHRV9NUyIsImRlbGV0ZSIsIlVzZXJTdG9yZSIsInJlcG9zaXRvcnkiLCJsb2dpbiIsImNvbmZpZyIsImVtaXR0ZXIiLCJFbWl0dGVyIiwic3VicyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJhbGxVc2VycyIsImV4Y2x1ZGVkVXNlcnMiLCJTZXQiLCJ1c2VycyIsImNvbW1pdHRlciIsIm51bGxBdXRob3IiLCJsYXN0IiwiY2FjaGUiLCJyZXBvc2l0b3J5T2JzZXJ2ZXIiLCJNb2RlbE9ic2VydmVyIiwiZmV0Y2hEYXRhIiwieXViaWtpcmkiLCJnZXRDb21taXR0ZXIiLCJhdXRob3JzIiwiZ2V0QXV0aG9ycyIsIm1heCIsInJlbW90ZXMiLCJnZXRSZW1vdGVzIiwiZGlkVXBkYXRlIiwibG9hZFVzZXJzIiwic2V0QWN0aXZlTW9kZWwiLCJsb2dpbk9ic2VydmVyIiwiYWRkIiwib2JzZXJ2ZSIsInNwbGl0IiwiZmlsdGVyIiwiZWFjaCIsImxlbmd0aCIsImRpc3Bvc2UiLCJnZXRBY3RpdmVNb2RlbERhdGEiLCJzZXRDb21taXR0ZXIiLCJnaXRodWJSZW1vdGVzIiwiQXJyYXkiLCJmcm9tIiwiaXNHaXRodWJSZXBvIiwibG9hZFVzZXJzRnJvbUdyYXBoUUwiLCJhZGRVc2VycyIsInNpemUiLCJQcm9taXNlIiwiYWxsIiwibG9hZE1lbnRpb25hYmxlVXNlcnMiLCJnZXRUb2tlbiIsImxvZ2luTW9kZWwiLCJsb2dpbkFjY291bnQiLCJ0b2tlbiIsIlVOQVVUSEVOVElDQVRFRCIsIklOU1VGRklDSUVOVCIsIkVycm9yIiwiY2FjaGVkIiwiZW5kcG9pbnQiLCJnZXRFbmRwb2ludCIsImdldEFjdGl2ZU1vZGVsIiwiZ2V0TG9naW5BY2NvdW50IiwiZmV0Y2hRdWVyeSIsIlJlbGF5TmV0d29ya0xheWVyTWFuYWdlciIsImdldEZldGNoUXVlcnkiLCJoYXNNb3JlIiwiY3Vyc29yIiwicmVtb3RlVXNlcnMiLCJyZXNwb25zZSIsIm5hbWUiLCJ0ZXh0Iiwib3duZXIiLCJnZXRPd25lciIsImdldFJlcG8iLCJmaXJzdCIsImFmdGVyIiwiZXJyb3JzIiwiY29uc29sZSIsImVycm9yIiwibWFwIiwibWVzc2FnZSIsImpvaW4iLCJjb25uZWN0aW9uIiwibWVudGlvbmFibGVVc2VycyIsIm5vZGVzIiwibm9kZSIsImVtYWlsIiwiQXV0aG9yIiwicHVzaCIsInBhZ2VJbmZvIiwiZW5kQ3Vyc29yIiwiaGFzTmV4dFBhZ2UiLCJuZXh0U291cmNlIiwiY2hhbmdlZCIsImNsZWFyIiwiYXV0aG9yIiwiZ2V0RW1haWwiLCJmaW5hbGl6ZSIsInZhbHVlcyIsIm1hdGNoZXMiLCJpc05vUmVwbHkiLCJzb3J0IiwiY29tcGFyZSIsInNldFJlcG9zaXRvcnkiLCJzZXRMb2dpbk1vZGVsIiwiZW1pdCIsImdldFVzZXJzIiwib25EaWRVcGRhdGUiLCJjYWxsYmFjayIsIm9uIl0sInNvdXJjZXMiOlsidXNlci1zdG9yZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeXViaWtpcmkgZnJvbSAneXViaWtpcmknO1xuaW1wb3J0IHtFbWl0dGVyLCBDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuXG5pbXBvcnQgUmVsYXlOZXR3b3JrTGF5ZXJNYW5hZ2VyIGZyb20gJy4uL3JlbGF5LW5ldHdvcmstbGF5ZXItbWFuYWdlcic7XG5pbXBvcnQgQXV0aG9yLCB7bnVsbEF1dGhvcn0gZnJvbSAnLi9hdXRob3InO1xuaW1wb3J0IHtVTkFVVEhFTlRJQ0FURUQsIElOU1VGRklDSUVOVH0gZnJvbSAnLi4vc2hhcmVkL2tleXRhci1zdHJhdGVneSc7XG5pbXBvcnQgTW9kZWxPYnNlcnZlciBmcm9tICcuL21vZGVsLW9ic2VydmVyJztcblxuLy8gVGhpcyBpcyBhIGd1ZXNzIGFib3V0IHdoYXQgYSByZWFzb25hYmxlIHZhbHVlIGlzLiBDYW4gYWRqdXN0IGlmIHBlcmZvcm1hbmNlIGlzIHBvb3IuXG5jb25zdCBNQVhfQ09NTUlUUyA9IDUwMDA7XG5cbmV4cG9ydCBjb25zdCBzb3VyY2UgPSB7XG4gIFBFTkRJTkc6IFN5bWJvbCgncGVuZGluZycpLFxuICBHSVRMT0c6IFN5bWJvbCgnZ2l0IGxvZycpLFxuICBHSVRIVUJBUEk6IFN5bWJvbCgnZ2l0aHViIEFQSScpLFxufTtcblxuY2xhc3MgR3JhcGhRTENhY2hlIHtcbiAgLy8gT25lIGhvdXJcbiAgc3RhdGljIE1BWF9BR0VfTVMgPSAzLjZlNlxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYnlTbHVnID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgZ2V0KHJlbW90ZSkge1xuICAgIGNvbnN0IHNsdWcgPSByZW1vdGUuZ2V0U2x1ZygpO1xuICAgIGNvbnN0IHt0cywgZGF0YX0gPSB0aGlzLmJ5U2x1Zy5nZXQoc2x1ZykgfHwge1xuICAgICAgdHM6IC1JbmZpbml0eSxcbiAgICAgIGRhdGE6IHt9LFxuICAgIH07XG5cbiAgICBpZiAoRGF0ZS5ub3coKSAtIHRzID4gdGhpcy5jb25zdHJ1Y3Rvci5NQVhfQUdFX01TKSB7XG4gICAgICB0aGlzLmJ5U2x1Zy5kZWxldGUoc2x1Zyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBzZXQocmVtb3RlLCBkYXRhKSB7XG4gICAgdGhpcy5ieVNsdWcuc2V0KHJlbW90ZS5nZXRTbHVnKCksIHt0czogRGF0ZS5ub3coKSwgZGF0YX0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJTdG9yZSB7XG4gIGNvbnN0cnVjdG9yKHtyZXBvc2l0b3J5LCBsb2dpbiwgY29uZmlnfSkge1xuICAgIHRoaXMuZW1pdHRlciA9IG5ldyBFbWl0dGVyKCk7XG4gICAgdGhpcy5zdWJzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblxuICAgIC8vIFRPRE86IFtrdSAzLzIwMThdIENvbnNpZGVyIHVzaW5nIERleGllIChpbmRleERCIHdyYXBwZXIpIGxpa2UgRGVza3RvcCBhbmQgcGVyc2lzdCB1c2VycyBhY3Jvc3Mgc2Vzc2lvbnNcbiAgICB0aGlzLmFsbFVzZXJzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuZXhjbHVkZWRVc2VycyA9IG5ldyBTZXQoKTtcbiAgICB0aGlzLnVzZXJzID0gW107XG4gICAgdGhpcy5jb21taXR0ZXIgPSBudWxsQXV0aG9yO1xuXG4gICAgdGhpcy5sYXN0ID0ge1xuICAgICAgc291cmNlOiBzb3VyY2UuUEVORElORyxcbiAgICAgIHJlcG9zaXRvcnk6IG51bGwsXG4gICAgICBleGNsdWRlZFVzZXJzOiB0aGlzLmV4Y2x1ZGVkVXNlcnMsXG4gICAgfTtcbiAgICB0aGlzLmNhY2hlID0gbmV3IEdyYXBoUUxDYWNoZSgpO1xuXG4gICAgdGhpcy5yZXBvc2l0b3J5T2JzZXJ2ZXIgPSBuZXcgTW9kZWxPYnNlcnZlcih7XG4gICAgICBmZXRjaERhdGE6IHIgPT4geXViaWtpcmkoe1xuICAgICAgICBjb21taXR0ZXI6IHIuZ2V0Q29tbWl0dGVyKCksXG4gICAgICAgIGF1dGhvcnM6IHIuZ2V0QXV0aG9ycyh7bWF4OiBNQVhfQ09NTUlUU30pLFxuICAgICAgICByZW1vdGVzOiByLmdldFJlbW90ZXMoKSxcbiAgICAgIH0pLFxuICAgICAgZGlkVXBkYXRlOiAoKSA9PiB0aGlzLmxvYWRVc2VycygpLFxuICAgIH0pO1xuICAgIHRoaXMucmVwb3NpdG9yeU9ic2VydmVyLnNldEFjdGl2ZU1vZGVsKHJlcG9zaXRvcnkpO1xuXG4gICAgdGhpcy5sb2dpbk9ic2VydmVyID0gbmV3IE1vZGVsT2JzZXJ2ZXIoe1xuICAgICAgZGlkVXBkYXRlOiAoKSA9PiB0aGlzLmxvYWRVc2VycygpLFxuICAgIH0pO1xuICAgIHRoaXMubG9naW5PYnNlcnZlci5zZXRBY3RpdmVNb2RlbChsb2dpbik7XG5cbiAgICB0aGlzLnN1YnMuYWRkKFxuICAgICAgY29uZmlnLm9ic2VydmUoJ2dpdGh1Yi5leGNsdWRlZFVzZXJzJywgdmFsdWUgPT4ge1xuICAgICAgICB0aGlzLmV4Y2x1ZGVkVXNlcnMgPSBuZXcgU2V0KFxuICAgICAgICAgICh2YWx1ZSB8fCAnJykuc3BsaXQoL1xccyosXFxzKi8pLmZpbHRlcihlYWNoID0+IGVhY2gubGVuZ3RoID4gMCksXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRVc2VycygpO1xuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy5zdWJzLmRpc3Bvc2UoKTtcbiAgICB0aGlzLmVtaXR0ZXIuZGlzcG9zZSgpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFVzZXJzKCkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLnJlcG9zaXRvcnlPYnNlcnZlci5nZXRBY3RpdmVNb2RlbERhdGEoKTtcblxuICAgIGlmICghZGF0YSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2V0Q29tbWl0dGVyKGRhdGEuY29tbWl0dGVyKTtcbiAgICBjb25zdCBnaXRodWJSZW1vdGVzID0gQXJyYXkuZnJvbShkYXRhLnJlbW90ZXMpLmZpbHRlcihyZW1vdGUgPT4gcmVtb3RlLmlzR2l0aHViUmVwbygpKTtcblxuICAgIGlmIChnaXRodWJSZW1vdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGF3YWl0IHRoaXMubG9hZFVzZXJzRnJvbUdyYXBoUUwoZ2l0aHViUmVtb3Rlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWRkVXNlcnMoZGF0YS5hdXRob3JzLCBzb3VyY2UuR0lUTE9HKTtcbiAgICB9XG5cbiAgICAvLyBpZiBmb3Igd2hhdGV2ZXIgcmVhc29uLCBubyBjb21taXR0ZXJzIGNhbiBiZSBhZGRlZCwgZmFsbCBiYWNrIHRvXG4gICAgLy8gdXNpbmcgZ2l0IGxvZyBjb21taXR0ZXJzIGFzIHRoZSBsYXN0IHJlc29ydFxuICAgIGlmICh0aGlzLmFsbFVzZXJzLnNpemUgPT09IDApIHtcbiAgICAgIHRoaXMuYWRkVXNlcnMoZGF0YS5hdXRob3JzLCBzb3VyY2UuR0lUTE9HKTtcbiAgICB9XG4gIH1cblxuICBsb2FkVXNlcnNGcm9tR3JhcGhRTChyZW1vdGVzKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgQXJyYXkuZnJvbShyZW1vdGVzLCByZW1vdGUgPT4gdGhpcy5sb2FkTWVudGlvbmFibGVVc2VycyhyZW1vdGUpKSxcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgZ2V0VG9rZW4obG9naW5Nb2RlbCwgbG9naW5BY2NvdW50KSB7XG4gICAgaWYgKCFsb2dpbk1vZGVsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgdG9rZW4gPSBhd2FpdCBsb2dpbk1vZGVsLmdldFRva2VuKGxvZ2luQWNjb3VudCk7XG4gICAgaWYgKHRva2VuID09PSBVTkFVVEhFTlRJQ0FURUQgfHwgdG9rZW4gPT09IElOU1VGRklDSUVOVCB8fCB0b2tlbiBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHRva2VuO1xuICB9XG5cbiAgYXN5bmMgbG9hZE1lbnRpb25hYmxlVXNlcnMocmVtb3RlKSB7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5jYWNoZS5nZXQocmVtb3RlKTtcbiAgICBpZiAoY2FjaGVkICE9PSBudWxsKSB7XG4gICAgICB0aGlzLmFkZFVzZXJzKGNhY2hlZCwgc291cmNlLkdJVEhVQkFQSSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZW5kcG9pbnQgPSByZW1vdGUuZ2V0RW5kcG9pbnQoKTtcbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuZ2V0VG9rZW4odGhpcy5sb2dpbk9ic2VydmVyLmdldEFjdGl2ZU1vZGVsKCksIGVuZHBvaW50LmdldExvZ2luQWNjb3VudCgpKTtcbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZmV0Y2hRdWVyeSA9IFJlbGF5TmV0d29ya0xheWVyTWFuYWdlci5nZXRGZXRjaFF1ZXJ5KGVuZHBvaW50LCB0b2tlbik7XG5cbiAgICBsZXQgaGFzTW9yZSA9IHRydWU7XG4gICAgbGV0IGN1cnNvciA9IG51bGw7XG4gICAgY29uc3QgcmVtb3RlVXNlcnMgPSBbXTtcblxuICAgIHdoaWxlIChoYXNNb3JlKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoUXVlcnkoe1xuICAgICAgICBuYW1lOiAnR2V0TWVudGlvbmFibGVVc2VycycsXG4gICAgICAgIHRleHQ6IGBcbiAgICAgICAgICBxdWVyeSBHZXRNZW50aW9uYWJsZVVzZXJzKCRvd25lcjogU3RyaW5nISwgJG5hbWU6IFN0cmluZyEsICRmaXJzdDogSW50ISwgJGFmdGVyOiBTdHJpbmcpIHtcbiAgICAgICAgICAgIHJlcG9zaXRvcnkob3duZXI6ICRvd25lciwgbmFtZTogJG5hbWUpIHtcbiAgICAgICAgICAgICAgbWVudGlvbmFibGVVc2VycyhmaXJzdDogJGZpcnN0LCBhZnRlcjogJGFmdGVyKSB7XG4gICAgICAgICAgICAgICAgbm9kZXMge1xuICAgICAgICAgICAgICAgICAgbG9naW5cbiAgICAgICAgICAgICAgICAgIGVtYWlsXG4gICAgICAgICAgICAgICAgICBuYW1lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhZ2VJbmZvIHtcbiAgICAgICAgICAgICAgICAgIGhhc05leHRQYWdlXG4gICAgICAgICAgICAgICAgICBlbmRDdXJzb3JcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIGAsXG4gICAgICB9LCB7XG4gICAgICAgIG93bmVyOiByZW1vdGUuZ2V0T3duZXIoKSxcbiAgICAgICAgbmFtZTogcmVtb3RlLmdldFJlcG8oKSxcbiAgICAgICAgZmlyc3Q6IDEwMCxcbiAgICAgICAgYWZ0ZXI6IGN1cnNvcixcbiAgICAgIH0pO1xuXG4gICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICAgIGlmIChyZXNwb25zZS5lcnJvcnMgJiYgcmVzcG9uc2UuZXJyb3JzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgbWVudGlvbmFibGUgdXNlcnM6XFxuJHtyZXNwb25zZS5lcnJvcnMubWFwKGUgPT4gZS5tZXNzYWdlKS5qb2luKCdcXG4nKX1gKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFyZXNwb25zZS5kYXRhIHx8ICFyZXNwb25zZS5kYXRhLnJlcG9zaXRvcnkpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSByZXNwb25zZS5kYXRhLnJlcG9zaXRvcnkubWVudGlvbmFibGVVc2VycztcbiAgICAgIGNvbnN0IGF1dGhvcnMgPSBjb25uZWN0aW9uLm5vZGVzLm1hcChub2RlID0+IHtcbiAgICAgICAgaWYgKG5vZGUuZW1haWwgPT09ICcnKSB7XG4gICAgICAgICAgbm9kZS5lbWFpbCA9IGAke25vZGUubG9naW59QHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbWA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IEF1dGhvcihub2RlLmVtYWlsLCBub2RlLm5hbWUsIG5vZGUubG9naW4pO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmFkZFVzZXJzKGF1dGhvcnMsIHNvdXJjZS5HSVRIVUJBUEkpO1xuICAgICAgcmVtb3RlVXNlcnMucHVzaCguLi5hdXRob3JzKTtcblxuICAgICAgY3Vyc29yID0gY29ubmVjdGlvbi5wYWdlSW5mby5lbmRDdXJzb3I7XG4gICAgICBoYXNNb3JlID0gY29ubmVjdGlvbi5wYWdlSW5mby5oYXNOZXh0UGFnZTtcbiAgICB9XG5cbiAgICB0aGlzLmNhY2hlLnNldChyZW1vdGUsIHJlbW90ZVVzZXJzKTtcbiAgfVxuXG4gIGFkZFVzZXJzKHVzZXJzLCBuZXh0U291cmNlKSB7XG4gICAgbGV0IGNoYW5nZWQgPSBmYWxzZTtcblxuICAgIGlmIChcbiAgICAgIG5leHRTb3VyY2UgIT09IHRoaXMubGFzdC5zb3VyY2UgfHxcbiAgICAgIHRoaXMucmVwb3NpdG9yeU9ic2VydmVyLmdldEFjdGl2ZU1vZGVsKCkgIT09IHRoaXMubGFzdC5yZXBvc2l0b3J5IHx8XG4gICAgICB0aGlzLmV4Y2x1ZGVkVXNlcnMgIT09IHRoaXMubGFzdC5leGNsdWRlZFVzZXJzXG4gICAgKSB7XG4gICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIHRoaXMuYWxsVXNlcnMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGF1dGhvciBvZiB1c2Vycykge1xuICAgICAgaWYgKCF0aGlzLmFsbFVzZXJzLmhhcyhhdXRob3IuZ2V0RW1haWwoKSkpIHtcbiAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICB0aGlzLmFsbFVzZXJzLnNldChhdXRob3IuZ2V0RW1haWwoKSwgYXV0aG9yKTtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlZCkge1xuICAgICAgdGhpcy5maW5hbGl6ZSgpO1xuICAgIH1cbiAgICB0aGlzLmxhc3Quc291cmNlID0gbmV4dFNvdXJjZTtcbiAgICB0aGlzLmxhc3QucmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeU9ic2VydmVyLmdldEFjdGl2ZU1vZGVsKCk7XG4gICAgdGhpcy5sYXN0LmV4Y2x1ZGVkVXNlcnMgPSB0aGlzLmV4Y2x1ZGVkVXNlcnM7XG4gIH1cblxuICBmaW5hbGl6ZSgpIHtcbiAgICAvLyBUT0RPOiBba3UgMy8yMDE4XSBjb25zaWRlciBzb3J0aW5nIGJhc2VkIG9uIG1vc3QgcmVjZW50IGF1dGhvcnMgb3IgY29tbWl0IGZyZXF1ZW5jeVxuICAgIGNvbnN0IHVzZXJzID0gW107XG4gICAgZm9yIChjb25zdCBhdXRob3Igb2YgdGhpcy5hbGxVc2Vycy52YWx1ZXMoKSkge1xuICAgICAgaWYgKGF1dGhvci5tYXRjaGVzKHRoaXMuY29tbWl0dGVyKSkgeyBjb250aW51ZTsgfVxuICAgICAgaWYgKGF1dGhvci5pc05vUmVwbHkoKSkgeyBjb250aW51ZTsgfVxuICAgICAgaWYgKHRoaXMuZXhjbHVkZWRVc2Vycy5oYXMoYXV0aG9yLmdldEVtYWlsKCkpKSB7IGNvbnRpbnVlOyB9XG5cbiAgICAgIHVzZXJzLnB1c2goYXV0aG9yKTtcbiAgICB9XG4gICAgdXNlcnMuc29ydChBdXRob3IuY29tcGFyZSk7XG4gICAgdGhpcy51c2VycyA9IHVzZXJzO1xuICAgIHRoaXMuZGlkVXBkYXRlKCk7XG4gIH1cblxuICBzZXRSZXBvc2l0b3J5KHJlcG9zaXRvcnkpIHtcbiAgICB0aGlzLnJlcG9zaXRvcnlPYnNlcnZlci5zZXRBY3RpdmVNb2RlbChyZXBvc2l0b3J5KTtcbiAgfVxuXG4gIHNldExvZ2luTW9kZWwobG9naW4pIHtcbiAgICB0aGlzLmxvZ2luT2JzZXJ2ZXIuc2V0QWN0aXZlTW9kZWwobG9naW4pO1xuICB9XG5cbiAgc2V0Q29tbWl0dGVyKGNvbW1pdHRlcikge1xuICAgIGNvbnN0IGNoYW5nZWQgPSAhdGhpcy5jb21taXR0ZXIubWF0Y2hlcyhjb21taXR0ZXIpO1xuICAgIHRoaXMuY29tbWl0dGVyID0gY29tbWl0dGVyO1xuICAgIGlmIChjaGFuZ2VkKSB7XG4gICAgICB0aGlzLmZpbmFsaXplKCk7XG4gICAgfVxuICB9XG5cbiAgZGlkVXBkYXRlKCkge1xuICAgIHRoaXMuZW1pdHRlci5lbWl0KCdkaWQtdXBkYXRlJywgdGhpcy5nZXRVc2VycygpKTtcbiAgfVxuXG4gIG9uRGlkVXBkYXRlKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuZW1pdHRlci5vbignZGlkLXVwZGF0ZScsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGdldFVzZXJzKCkge1xuICAgIHJldHVybiB0aGlzLnVzZXJzO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFNBQUEsR0FBQUQsT0FBQTtBQUVBLElBQUFFLHlCQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxPQUFBLEdBQUFDLHVCQUFBLENBQUFKLE9BQUE7QUFDQSxJQUFBSyxlQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxjQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFBNkMsU0FBQU8seUJBQUFDLENBQUEsNkJBQUFDLE9BQUEsbUJBQUFDLENBQUEsT0FBQUQsT0FBQSxJQUFBRSxDQUFBLE9BQUFGLE9BQUEsWUFBQUYsd0JBQUEs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