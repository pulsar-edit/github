"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireWildcard(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _uriPattern = _interopRequireWildcard(require("./uri-pattern"));
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
var _stubItem = _interopRequireDefault(require("../items/stub-item"));
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
/**
 * PaneItem registers an opener with the current Atom workspace as long as this component is mounted. The opener will
 * trigger on URIs that match a specified pattern and render a subtree returned by a render prop.
 *
 * The render prop can receive three arguments:
 *
 * * itemHolder: A RefHolder. If used as the target for a ref, the referenced component will be used as the "item" of
 *   the pane item - its `getTitle()`, `getIconName()`, and other methods will be used by the pane.
 * * params: An object containing the named parameters captured by the URI pattern.
 * * uri: The exact, matched URI used to launch this item.
 *
 * render() {
 *   return (
 *     <PaneItem workspace={this.props.workspace} uriPattern='atom-github://host/{id}'>
 *       {({itemHolder, params}) => (
 *         <ItemComponent ref={itemHolder.setter} id={params.id} />
 *       )}
 *     </PaneItem>
 *   );
 * }
 */
class PaneItem extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _helpers.autobind)(this, 'opener');
    const uriPattern = new _uriPattern.default(this.props.uriPattern);
    const currentlyOpen = this.props.workspace.getPaneItems().reduce((arr, item) => {
      const element = item.getElement ? item.getElement() : null;
      const match = item.getURI ? uriPattern.matches(item.getURI()) : _uriPattern.nonURIMatch;
      const stub = item.setRealItem ? item : null;
      if (element && match.ok()) {
        const openItem = new OpenItem(match, element, stub);
        arr.push(openItem);
      }
      return arr;
    }, []);
    this.subs = new _eventKit.CompositeDisposable();
    this.state = {
      uriPattern,
      currentlyOpen
    };
  }
  static getDerivedStateFromProps(nextProps, prevState) {
    if (prevState.uriPattern.getOriginal() === nextProps.uriPattern) {
      return null;
    }
    return {
      uriPattern: new _uriPattern.default(nextProps.uriPattern)
    };
  }
  componentDidMount() {
    // Listen for and adopt StubItems that are added after this component has
    // already been mounted.
    this.subs.add(this.props.workspace.onDidAddPaneItem(({
      item
    }) => {
      if (!item._getStub) {
        return;
      }
      const stub = item._getStub();
      if (stub.getRealItem() !== null) {
        return;
      }
      const match = this.state.uriPattern.matches(item.getURI());
      if (!match.ok()) {
        return;
      }
      const openItem = new OpenItem(match, stub.getElement(), stub);
      openItem.hydrateStub({
        copy: () => this.copyOpenItem(openItem)
      });
      if (this.props.className) {
        openItem.addClassName(this.props.className);
      }
      this.registerCloseListener(item, openItem);
      this.setState(prevState => ({
        currentlyOpen: [...prevState.currentlyOpen, openItem]
      }));
    }));
    for (const openItem of this.state.currentlyOpen) {
      this.registerCloseListener(openItem.stubItem, openItem);
      openItem.hydrateStub({
        copy: () => this.copyOpenItem(openItem)
      });
      if (this.props.className) {
        openItem.addClassName(this.props.className);
      }
    }
    this.subs.add(this.props.workspace.addOpener(this.opener));
  }
  render() {
    return this.state.currentlyOpen.map(item => {
      return _react.default.createElement(_react.Fragment, {
        key: item.getKey()
      }, item.renderPortal(this.props.children));
    });
  }
  componentWillUnmount() {
    this.subs.dispose();
  }
  opener(uri) {
    const m = this.state.uriPattern.matches(uri);
    if (!m.ok()) {
      return undefined;
    }
    const openItem = new OpenItem(m);
    if (this.props.className) {
      openItem.addClassName(this.props.className);
    }
    return new Promise(resolve => {
      this.setState(prevState => ({
        currentlyOpen: [...prevState.currentlyOpen, openItem]
      }), () => {
        const paneItem = openItem.create({
          copy: () => this.copyOpenItem(openItem)
        });
        this.registerCloseListener(paneItem, openItem);
        resolve(paneItem);
      });
    });
  }
  copyOpenItem(openItem) {
    const m = this.state.uriPattern.matches(openItem.getURI());
    if (!m.ok()) {
      return null;
    }
    const stub = _stubItem.default.create('generic', openItem.getStubProps(), openItem.getURI());
    const copiedItem = new OpenItem(m, stub.getElement(), stub);
    this.setState(prevState => ({
      currentlyOpen: [...prevState.currentlyOpen, copiedItem]
    }), () => {
      this.registerCloseListener(stub, copiedItem);
      copiedItem.hydrateStub({
        copy: () => this.copyOpenItem(copiedItem)
      });
    });
    return stub;
  }
  registerCloseListener(paneItem, openItem) {
    const sub = this.props.workspace.onDidDestroyPaneItem(({
      item
    }) => {
      if (item === paneItem) {
        sub.dispose();
        this.subs.remove(sub);
        this.setState(prevState => ({
          currentlyOpen: prevState.currentlyOpen.filter(each => each !== openItem)
        }));
      }
    });
    this.subs.add(sub);
  }
}

/**
 * A subtree rendered through a portal onto a detached DOM node for use as the root as a PaneItem.
 */
exports.default = PaneItem;
_defineProperty(PaneItem, "propTypes", {
  workspace: _propTypes.default.object.isRequired,
  children: _propTypes.default.func.isRequired,
  uriPattern: _propTypes.default.string.isRequired,
  className: _propTypes.default.string
});
class OpenItem {
  constructor(match, element = null, stub = null) {
    this.id = this.constructor.nextID;
    this.constructor.nextID++;
    this.domNode = element || document.createElement('div');
    this.domNode.tabIndex = '-1';
    this.domNode.onfocus = this.onFocus.bind(this);
    this.stubItem = stub;
    this.stubProps = stub ? stub.props : {};
    this.match = match;
    this.itemHolder = new _refHolder.default();
  }
  getURI() {
    return this.match.getURI();
  }
  create(extra = {}) {
    const h = this.itemHolder.isEmpty() ? null : this.itemHolder;
    return (0, _helpers.createItem)(this.domNode, h, this.match.getURI(), extra);
  }
  hydrateStub(extra = {}) {
    if (this.stubItem) {
      this.stubItem.setRealItem(this.create(extra));
      this.stubItem = null;
    }
  }
  addClassName(className) {
    this.domNode.classList.add(className);
  }
  getKey() {
    return this.id;
  }
  getStubProps() {
    const itemProps = this.itemHolder.map(item => ({
      title: item.getTitle ? item.getTitle() : null,
      iconName: item.getIconName ? item.getIconName() : null
    }));
    return _objectSpread({}, this.stubProps, {}, itemProps);
  }
  onFocus() {
    return this.itemHolder.map(item => item.focus && item.focus());
  }
  renderPortal(renderProp) {
    return _reactDom.default.createPortal(renderProp({
      deserialized: this.stubProps,
      itemHolder: this.itemHolder,
      params: this.match.getParams(),
      uri: this.match.getURI()
    }), this.domNode);
  }
}
_defineProperty(OpenItem, "nextID", 0);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcmVhY3REb20iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX3Byb3BUeXBlcyIsIl9ldmVudEtpdCIsIl91cmlQYXR0ZXJuIiwiX3JlZkhvbGRlciIsIl9zdHViSXRlbSIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJub2RlSW50ZXJvcCIsIldlYWtNYXAiLCJjYWNoZUJhYmVsSW50ZXJvcCIsImNhY2hlTm9kZUludGVyb3AiLCJjYWNoZSIsImhhcyIsImdldCIsIm5ld09iaiIsImhhc1Byb3BlcnR5RGVzY3JpcHRvciIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsInNldCIsIm93bktleXMiLCJvYmplY3QiLCJlbnVtZXJhYmxlT25seSIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJzeW1ib2xzIiwiZmlsdGVyIiwic3ltIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiUGFuZUl0ZW0iLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJhdXRvYmluZCIsInVyaVBhdHRlcm4iLCJVUklQYXR0ZXJuIiwiY3VycmVudGx5T3BlbiIsIndvcmtzcGFjZSIsImdldFBhbmVJdGVtcyIsInJlZHVjZSIsImFyciIsIml0ZW0iLCJlbGVtZW50IiwiZ2V0RWxlbWVudCIsIm1hdGNoIiwiZ2V0VVJJIiwibWF0Y2hlcyIsIm5vblVSSU1hdGNoIiwic3R1YiIsInNldFJlYWxJdGVtIiwib2siLCJvcGVuSXRlbSIsIk9wZW5JdGVtIiwic3VicyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJzdGF0ZSIsImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIm5leHRQcm9wcyIsInByZXZTdGF0ZSIsImdldE9yaWdpbmFsIiwiY29tcG9uZW50RGlkTW91bnQiLCJhZGQiLCJvbkRpZEFkZFBhbmVJdGVtIiwiX2dldFN0dWIiLCJnZXRSZWFsSXRlbSIsImh5ZHJhdGVTdHViIiwiY29weSIsImNvcHlPcGVuSXRlbSIsImNsYXNzTmFtZSIsImFkZENsYXNzTmFtZSIsInJlZ2lzdGVyQ2xvc2VMaXN0ZW5lciIsInNldFN0YXRlIiwic3R1Ykl0ZW0iLCJhZGRPcGVuZXIiLCJvcGVuZXIiLCJyZW5kZXIiLCJtYXAiLCJjcmVhdGVFbGVtZW50IiwiRnJhZ21lbnQiLCJnZXRLZXkiLCJyZW5kZXJQb3J0YWwiLCJjaGlsZHJlbiIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsInVyaSIsIm0iLCJQcm9taXNlIiwicmVzb2x2ZSIsInBhbmVJdGVtIiwiY3JlYXRlIiwiU3R1Ykl0ZW0iLCJnZXRTdHViUHJvcHMiLCJjb3BpZWRJdGVtIiwic3ViIiwib25EaWREZXN0cm95UGFuZUl0ZW0iLCJyZW1vdmUiLCJlYWNoIiwiZXhwb3J0cyIsIlByb3BUeXBlcyIsImlzUmVxdWlyZWQiLCJmdW5jIiwic3RyaW5nIiwiaWQiLCJuZXh0SUQiLCJkb21Ob2RlIiwiZG9jdW1lbnQiLCJ0YWJJbmRleCIsIm9uZm9jdXMiLCJvbkZvY3VzIiwiYmluZCIsInN0dWJQcm9wcyIsIml0ZW1Ib2xkZXIiLCJSZWZIb2xkZXIiLCJleHRyYSIsImgiLCJpc0VtcHR5IiwiY3JlYXRlSXRlbSIsImNsYXNzTGlzdCIsIml0ZW1Qcm9wcyIsInRpdGxlIiwiZ2V0VGl0bGUiLCJpY29uTmFtZSIsImdldEljb25OYW1lIiwiZm9jdXMiLCJyZW5kZXJQcm9wIiwiUmVhY3RET00iLCJjcmVhdGVQb3J0YWwiLCJkZXNlcmlhbGl6ZWQiLCJwYXJhbXMiLCJnZXRQYXJhbXMiXSwic291cmNlcyI6WyJwYW5lLWl0ZW0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7RnJhZ21lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcblxuaW1wb3J0IFVSSVBhdHRlcm4sIHtub25VUklNYXRjaH0gZnJvbSAnLi91cmktcGF0dGVybic7XG5pbXBvcnQgUmVmSG9sZGVyIGZyb20gJy4uL21vZGVscy9yZWYtaG9sZGVyJztcbmltcG9ydCBTdHViSXRlbSBmcm9tICcuLi9pdGVtcy9zdHViLWl0ZW0nO1xuaW1wb3J0IHtjcmVhdGVJdGVtLCBhdXRvYmluZH0gZnJvbSAnLi4vaGVscGVycyc7XG5cbi8qKlxuICogUGFuZUl0ZW0gcmVnaXN0ZXJzIGFuIG9wZW5lciB3aXRoIHRoZSBjdXJyZW50IEF0b20gd29ya3NwYWNlIGFzIGxvbmcgYXMgdGhpcyBjb21wb25lbnQgaXMgbW91bnRlZC4gVGhlIG9wZW5lciB3aWxsXG4gKiB0cmlnZ2VyIG9uIFVSSXMgdGhhdCBtYXRjaCBhIHNwZWNpZmllZCBwYXR0ZXJuIGFuZCByZW5kZXIgYSBzdWJ0cmVlIHJldHVybmVkIGJ5IGEgcmVuZGVyIHByb3AuXG4gKlxuICogVGhlIHJlbmRlciBwcm9wIGNhbiByZWNlaXZlIHRocmVlIGFyZ3VtZW50czpcbiAqXG4gKiAqIGl0ZW1Ib2xkZXI6IEEgUmVmSG9sZGVyLiBJZiB1c2VkIGFzIHRoZSB0YXJnZXQgZm9yIGEgcmVmLCB0aGUgcmVmZXJlbmNlZCBjb21wb25lbnQgd2lsbCBiZSB1c2VkIGFzIHRoZSBcIml0ZW1cIiBvZlxuICogICB0aGUgcGFuZSBpdGVtIC0gaXRzIGBnZXRUaXRsZSgpYCwgYGdldEljb25OYW1lKClgLCBhbmQgb3RoZXIgbWV0aG9kcyB3aWxsIGJlIHVzZWQgYnkgdGhlIHBhbmUuXG4gKiAqIHBhcmFtczogQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIG5hbWVkIHBhcmFtZXRlcnMgY2FwdHVyZWQgYnkgdGhlIFVSSSBwYXR0ZXJuLlxuICogKiB1cmk6IFRoZSBleGFjdCwgbWF0Y2hlZCBVUkkgdXNlZCB0byBsYXVuY2ggdGhpcyBpdGVtLlxuICpcbiAqIHJlbmRlcigpIHtcbiAqICAgcmV0dXJuIChcbiAqICAgICA8UGFuZUl0ZW0gd29ya3NwYWNlPXt0aGlzLnByb3BzLndvcmtzcGFjZX0gdXJpUGF0dGVybj0nYXRvbS1naXRodWI6Ly9ob3N0L3tpZH0nPlxuICogICAgICAgeyh7aXRlbUhvbGRlciwgcGFyYW1zfSkgPT4gKFxuICogICAgICAgICA8SXRlbUNvbXBvbmVudCByZWY9e2l0ZW1Ib2xkZXIuc2V0dGVyfSBpZD17cGFyYW1zLmlkfSAvPlxuICogICAgICAgKX1cbiAqICAgICA8L1BhbmVJdGVtPlxuICogICApO1xuICogfVxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYW5lSXRlbSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgd29ya3NwYWNlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgdXJpUGF0dGVybjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGF1dG9iaW5kKHRoaXMsICdvcGVuZXInKTtcblxuICAgIGNvbnN0IHVyaVBhdHRlcm4gPSBuZXcgVVJJUGF0dGVybih0aGlzLnByb3BzLnVyaVBhdHRlcm4pO1xuICAgIGNvbnN0IGN1cnJlbnRseU9wZW4gPSB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRQYW5lSXRlbXMoKVxuICAgICAgLnJlZHVjZSgoYXJyLCBpdGVtKSA9PiB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBpdGVtLmdldEVsZW1lbnQgPyBpdGVtLmdldEVsZW1lbnQoKSA6IG51bGw7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gaXRlbS5nZXRVUkkgPyB1cmlQYXR0ZXJuLm1hdGNoZXMoaXRlbS5nZXRVUkkoKSkgOiBub25VUklNYXRjaDtcbiAgICAgICAgY29uc3Qgc3R1YiA9IGl0ZW0uc2V0UmVhbEl0ZW0gPyBpdGVtIDogbnVsbDtcblxuICAgICAgICBpZiAoZWxlbWVudCAmJiBtYXRjaC5vaygpKSB7XG4gICAgICAgICAgY29uc3Qgb3Blbkl0ZW0gPSBuZXcgT3Blbkl0ZW0obWF0Y2gsIGVsZW1lbnQsIHN0dWIpO1xuICAgICAgICAgIGFyci5wdXNoKG9wZW5JdGVtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcnI7XG4gICAgICB9LCBbXSk7XG5cbiAgICB0aGlzLnN1YnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuc3RhdGUgPSB7dXJpUGF0dGVybiwgY3VycmVudGx5T3Blbn07XG4gIH1cblxuICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzKG5leHRQcm9wcywgcHJldlN0YXRlKSB7XG4gICAgaWYgKHByZXZTdGF0ZS51cmlQYXR0ZXJuLmdldE9yaWdpbmFsKCkgPT09IG5leHRQcm9wcy51cmlQYXR0ZXJuKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJpUGF0dGVybjogbmV3IFVSSVBhdHRlcm4obmV4dFByb3BzLnVyaVBhdHRlcm4pLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAvLyBMaXN0ZW4gZm9yIGFuZCBhZG9wdCBTdHViSXRlbXMgdGhhdCBhcmUgYWRkZWQgYWZ0ZXIgdGhpcyBjb21wb25lbnQgaGFzXG4gICAgLy8gYWxyZWFkeSBiZWVuIG1vdW50ZWQuXG4gICAgdGhpcy5zdWJzLmFkZCh0aGlzLnByb3BzLndvcmtzcGFjZS5vbkRpZEFkZFBhbmVJdGVtKCh7aXRlbX0pID0+IHtcbiAgICAgIGlmICghaXRlbS5fZ2V0U3R1Yikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBzdHViID0gaXRlbS5fZ2V0U3R1YigpO1xuXG4gICAgICBpZiAoc3R1Yi5nZXRSZWFsSXRlbSgpICE9PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWF0Y2ggPSB0aGlzLnN0YXRlLnVyaVBhdHRlcm4ubWF0Y2hlcyhpdGVtLmdldFVSSSgpKTtcbiAgICAgIGlmICghbWF0Y2gub2soKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG9wZW5JdGVtID0gbmV3IE9wZW5JdGVtKG1hdGNoLCBzdHViLmdldEVsZW1lbnQoKSwgc3R1Yik7XG4gICAgICBvcGVuSXRlbS5oeWRyYXRlU3R1Yih7XG4gICAgICAgIGNvcHk6ICgpID0+IHRoaXMuY29weU9wZW5JdGVtKG9wZW5JdGVtKSxcbiAgICAgIH0pO1xuICAgICAgaWYgKHRoaXMucHJvcHMuY2xhc3NOYW1lKSB7XG4gICAgICAgIG9wZW5JdGVtLmFkZENsYXNzTmFtZSh0aGlzLnByb3BzLmNsYXNzTmFtZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnJlZ2lzdGVyQ2xvc2VMaXN0ZW5lcihpdGVtLCBvcGVuSXRlbSk7XG5cbiAgICAgIHRoaXMuc2V0U3RhdGUocHJldlN0YXRlID0+ICh7XG4gICAgICAgIGN1cnJlbnRseU9wZW46IFsuLi5wcmV2U3RhdGUuY3VycmVudGx5T3Blbiwgb3Blbkl0ZW1dLFxuICAgICAgfSkpO1xuICAgIH0pKTtcblxuICAgIGZvciAoY29uc3Qgb3Blbkl0ZW0gb2YgdGhpcy5zdGF0ZS5jdXJyZW50bHlPcGVuKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyQ2xvc2VMaXN0ZW5lcihvcGVuSXRlbS5zdHViSXRlbSwgb3Blbkl0ZW0pO1xuXG4gICAgICBvcGVuSXRlbS5oeWRyYXRlU3R1Yih7XG4gICAgICAgIGNvcHk6ICgpID0+IHRoaXMuY29weU9wZW5JdGVtKG9wZW5JdGVtKSxcbiAgICAgIH0pO1xuICAgICAgaWYgKHRoaXMucHJvcHMuY2xhc3NOYW1lKSB7XG4gICAgICAgIG9wZW5JdGVtLmFkZENsYXNzTmFtZSh0aGlzLnByb3BzLmNsYXNzTmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zdWJzLmFkZCh0aGlzLnByb3BzLndvcmtzcGFjZS5hZGRPcGVuZXIodGhpcy5vcGVuZXIpKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5jdXJyZW50bHlPcGVuLm1hcChpdGVtID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxGcmFnbWVudCBrZXk9e2l0ZW0uZ2V0S2V5KCl9PlxuICAgICAgICAgIHtpdGVtLnJlbmRlclBvcnRhbCh0aGlzLnByb3BzLmNoaWxkcmVuKX1cbiAgICAgICAgPC9GcmFnbWVudD5cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnN1YnMuZGlzcG9zZSgpO1xuICB9XG5cbiAgb3BlbmVyKHVyaSkge1xuICAgIGNvbnN0IG0gPSB0aGlzLnN0YXRlLnVyaVBhdHRlcm4ubWF0Y2hlcyh1cmkpO1xuICAgIGlmICghbS5vaygpKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IG9wZW5JdGVtID0gbmV3IE9wZW5JdGVtKG0pO1xuICAgIGlmICh0aGlzLnByb3BzLmNsYXNzTmFtZSkge1xuICAgICAgb3Blbkl0ZW0uYWRkQ2xhc3NOYW1lKHRoaXMucHJvcHMuY2xhc3NOYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgICBjdXJyZW50bHlPcGVuOiBbLi4ucHJldlN0YXRlLmN1cnJlbnRseU9wZW4sIG9wZW5JdGVtXSxcbiAgICAgIH0pLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhbmVJdGVtID0gb3Blbkl0ZW0uY3JlYXRlKHtcbiAgICAgICAgICBjb3B5OiAoKSA9PiB0aGlzLmNvcHlPcGVuSXRlbShvcGVuSXRlbSksXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyQ2xvc2VMaXN0ZW5lcihwYW5lSXRlbSwgb3Blbkl0ZW0pO1xuICAgICAgICByZXNvbHZlKHBhbmVJdGVtKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgY29weU9wZW5JdGVtKG9wZW5JdGVtKSB7XG4gICAgY29uc3QgbSA9IHRoaXMuc3RhdGUudXJpUGF0dGVybi5tYXRjaGVzKG9wZW5JdGVtLmdldFVSSSgpKTtcbiAgICBpZiAoIW0ub2soKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgc3R1YiA9IFN0dWJJdGVtLmNyZWF0ZSgnZ2VuZXJpYycsIG9wZW5JdGVtLmdldFN0dWJQcm9wcygpLCBvcGVuSXRlbS5nZXRVUkkoKSk7XG5cbiAgICBjb25zdCBjb3BpZWRJdGVtID0gbmV3IE9wZW5JdGVtKG0sIHN0dWIuZ2V0RWxlbWVudCgpLCBzdHViKTtcbiAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgY3VycmVudGx5T3BlbjogWy4uLnByZXZTdGF0ZS5jdXJyZW50bHlPcGVuLCBjb3BpZWRJdGVtXSxcbiAgICB9KSwgKCkgPT4ge1xuICAgICAgdGhpcy5yZWdpc3RlckNsb3NlTGlzdGVuZXIoc3R1YiwgY29waWVkSXRlbSk7XG4gICAgICBjb3BpZWRJdGVtLmh5ZHJhdGVTdHViKHtcbiAgICAgICAgY29weTogKCkgPT4gdGhpcy5jb3B5T3Blbkl0ZW0oY29waWVkSXRlbSksXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdHViO1xuICB9XG5cbiAgcmVnaXN0ZXJDbG9zZUxpc3RlbmVyKHBhbmVJdGVtLCBvcGVuSXRlbSkge1xuICAgIGNvbnN0IHN1YiA9IHRoaXMucHJvcHMud29ya3NwYWNlLm9uRGlkRGVzdHJveVBhbmVJdGVtKCh7aXRlbX0pID0+IHtcbiAgICAgIGlmIChpdGVtID09PSBwYW5lSXRlbSkge1xuICAgICAgICBzdWIuZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLnN1YnMucmVtb3ZlKHN1Yik7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUocHJldlN0YXRlID0+ICh7XG4gICAgICAgICAgY3VycmVudGx5T3BlbjogcHJldlN0YXRlLmN1cnJlbnRseU9wZW4uZmlsdGVyKGVhY2ggPT4gZWFjaCAhPT0gb3Blbkl0ZW0pLFxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnN1YnMuYWRkKHN1Yik7XG4gIH1cbn1cblxuLyoqXG4gKiBBIHN1YnRyZWUgcmVuZGVyZWQgdGhyb3VnaCBhIHBvcnRhbCBvbnRvIGEgZGV0YWNoZWQgRE9NIG5vZGUgZm9yIHVzZSBhcyB0aGUgcm9vdCBhcyBhIFBhbmVJdGVtLlxuICovXG5jbGFzcyBPcGVuSXRlbSB7XG4gIHN0YXRpYyBuZXh0SUQgPSAwXG5cbiAgY29uc3RydWN0b3IobWF0Y2gsIGVsZW1lbnQgPSBudWxsLCBzdHViID0gbnVsbCkge1xuICAgIHRoaXMuaWQgPSB0aGlzLmNvbnN0cnVjdG9yLm5leHRJRDtcbiAgICB0aGlzLmNvbnN0cnVjdG9yLm5leHRJRCsrO1xuXG4gICAgdGhpcy5kb21Ob2RlID0gZWxlbWVudCB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmRvbU5vZGUudGFiSW5kZXggPSAnLTEnO1xuICAgIHRoaXMuZG9tTm9kZS5vbmZvY3VzID0gdGhpcy5vbkZvY3VzLmJpbmQodGhpcyk7XG4gICAgdGhpcy5zdHViSXRlbSA9IHN0dWI7XG4gICAgdGhpcy5zdHViUHJvcHMgPSBzdHViID8gc3R1Yi5wcm9wcyA6IHt9O1xuICAgIHRoaXMubWF0Y2ggPSBtYXRjaDtcbiAgICB0aGlzLml0ZW1Ib2xkZXIgPSBuZXcgUmVmSG9sZGVyKCk7XG4gIH1cblxuICBnZXRVUkkoKSB7XG4gICAgcmV0dXJuIHRoaXMubWF0Y2guZ2V0VVJJKCk7XG4gIH1cblxuICBjcmVhdGUoZXh0cmEgPSB7fSkge1xuICAgIGNvbnN0IGggPSB0aGlzLml0ZW1Ib2xkZXIuaXNFbXB0eSgpID8gbnVsbCA6IHRoaXMuaXRlbUhvbGRlcjtcbiAgICByZXR1cm4gY3JlYXRlSXRlbSh0aGlzLmRvbU5vZGUsIGgsIHRoaXMubWF0Y2guZ2V0VVJJKCksIGV4dHJhKTtcbiAgfVxuXG4gIGh5ZHJhdGVTdHViKGV4dHJhID0ge30pIHtcbiAgICBpZiAodGhpcy5zdHViSXRlbSkge1xuICAgICAgdGhpcy5zdHViSXRlbS5zZXRSZWFsSXRlbSh0aGlzLmNyZWF0ZShleHRyYSkpO1xuICAgICAgdGhpcy5zdHViSXRlbSA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgYWRkQ2xhc3NOYW1lKGNsYXNzTmFtZSkge1xuICAgIHRoaXMuZG9tTm9kZS5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG4gIH1cblxuICBnZXRLZXkoKSB7XG4gICAgcmV0dXJuIHRoaXMuaWQ7XG4gIH1cblxuICBnZXRTdHViUHJvcHMoKSB7XG4gICAgY29uc3QgaXRlbVByb3BzID0gdGhpcy5pdGVtSG9sZGVyLm1hcChpdGVtID0+ICh7XG4gICAgICB0aXRsZTogaXRlbS5nZXRUaXRsZSA/IGl0ZW0uZ2V0VGl0bGUoKSA6IG51bGwsXG4gICAgICBpY29uTmFtZTogaXRlbS5nZXRJY29uTmFtZSA/IGl0ZW0uZ2V0SWNvbk5hbWUoKSA6IG51bGwsXG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMuc3R1YlByb3BzLFxuICAgICAgLi4uaXRlbVByb3BzLFxuICAgIH07XG4gIH1cblxuICBvbkZvY3VzKCkge1xuICAgIHJldHVybiB0aGlzLml0ZW1Ib2xkZXIubWFwKGl0ZW0gPT4gaXRlbS5mb2N1cyAmJiBpdGVtLmZvY3VzKCkpO1xuICB9XG5cbiAgcmVuZGVyUG9ydGFsKHJlbmRlclByb3ApIHtcbiAgICByZXR1cm4gUmVhY3RET00uY3JlYXRlUG9ydGFsKFxuICAgICAgcmVuZGVyUHJvcCh7XG4gICAgICAgIGRlc2VyaWFsaXplZDogdGhpcy5zdHViUHJvcHMsXG4gICAgICAgIGl0ZW1Ib2xkZXI6IHRoaXMuaXRlbUhvbGRlcixcbiAgICAgICAgcGFyYW1zOiB0aGlzLm1hdGNoLmdldFBhcmFtcygpLFxuICAgICAgICB1cmk6IHRoaXMubWF0Y2guZ2V0VVJJKCksXG4gICAgICB9KSxcbiAgICAgIHRoaXMuZG9tTm9kZSxcbiAgICApO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFHLFVBQUEsR0FBQUQsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFJLFNBQUEsR0FBQUosT0FBQTtBQUVBLElBQUFLLFdBQUEsR0FBQU4sdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLFVBQUEsR0FBQUosc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFPLFNBQUEsR0FBQUwsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFRLFFBQUEsR0FBQVIsT0FBQTtBQUFnRCxTQUFBRSx1QkFBQU8sR0FBQSxXQUFB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