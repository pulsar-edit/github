"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireWildcard(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _uriPattern = _interopRequireWildcard(require("./uri-pattern"));
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
var _stubItem = _interopRequireDefault(require("../items/stub-item"));
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
/**
 * PaneItem registers an opener with the current Atom workspace as long as this component is mounted. The opener will
 * trigger on URIs that match a specified pattern and render a subtree returned by a render prop.
 *
 * The render prop can receive three arguments:
 *
 * * itemHolder: A RefHolder. If used as the target for a ref, the referenced component will be used as the "item" of
 *   the pane item - its `getTitle()`, `getIconName()`, and other methods will be used by the pane.
 * * params: An object containing the named parameters captured by the URI pattern.
 * * uri: The exact, matched URI used to launch this item.
 *
 * render() {
 *   return (
 *     <PaneItem workspace={this.props.workspace} uriPattern='atom-github://host/{id}'>
 *       {({itemHolder, params}) => (
 *         <ItemComponent ref={itemHolder.setter} id={params.id} />
 *       )}
 *     </PaneItem>
 *   );
 * }
 */
class PaneItem extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _helpers.autobind)(this, 'opener');
    const uriPattern = new _uriPattern.default(this.props.uriPattern);
    const currentlyOpen = this.props.workspace.getPaneItems().reduce((arr, item) => {
      const element = item.getElement ? item.getElement() : null;
      const match = item.getURI ? uriPattern.matches(item.getURI()) : _uriPattern.nonURIMatch;
      const stub = item.setRealItem ? item : null;
      if (element && match.ok()) {
        const openItem = new OpenItem(match, element, stub);
        arr.push(openItem);
      }
      return arr;
    }, []);
    this.subs = new _eventKit.CompositeDisposable();
    this.state = {
      uriPattern,
      currentlyOpen
    };
  }
  static getDerivedStateFromProps(nextProps, prevState) {
    if (prevState.uriPattern.getOriginal() === nextProps.uriPattern) {
      return null;
    }
    return {
      uriPattern: new _uriPattern.default(nextProps.uriPattern)
    };
  }
  componentDidMount() {
    // Listen for and adopt StubItems that are added after this component has
    // already been mounted.
    this.subs.add(this.props.workspace.onDidAddPaneItem(({
      item
    }) => {
      if (!item._getStub) {
        return;
      }
      const stub = item._getStub();
      if (stub.getRealItem() !== null) {
        return;
      }
      const match = this.state.uriPattern.matches(item.getURI());
      if (!match.ok()) {
        return;
      }
      const openItem = new OpenItem(match, stub.getElement(), stub);
      openItem.hydrateStub({
        copy: () => this.copyOpenItem(openItem)
      });
      if (this.props.className) {
        openItem.addClassName(this.props.className);
      }
      this.registerCloseListener(item, openItem);
      this.setState(prevState => ({
        currentlyOpen: [...prevState.currentlyOpen, openItem]
      }));
    }));
    for (const openItem of this.state.currentlyOpen) {
      this.registerCloseListener(openItem.stubItem, openItem);
      openItem.hydrateStub({
        copy: () => this.copyOpenItem(openItem)
      });
      if (this.props.className) {
        openItem.addClassName(this.props.className);
      }
    }
    this.subs.add(this.props.workspace.addOpener(this.opener));
  }
  render() {
    return this.state.currentlyOpen.map(item => {
      return _react.default.createElement(_react.Fragment, {
        key: item.getKey()
      }, item.renderPortal(this.props.children));
    });
  }
  componentWillUnmount() {
    this.subs.dispose();
  }
  opener(uri) {
    const m = this.state.uriPattern.matches(uri);
    if (!m.ok()) {
      return undefined;
    }
    const openItem = new OpenItem(m);
    if (this.props.className) {
      openItem.addClassName(this.props.className);
    }
    return new Promise(resolve => {
      this.setState(prevState => ({
        currentlyOpen: [...prevState.currentlyOpen, openItem]
      }), () => {
        const paneItem = openItem.create({
          copy: () => this.copyOpenItem(openItem)
        });
        this.registerCloseListener(paneItem, openItem);
        resolve(paneItem);
      });
    });
  }
  copyOpenItem(openItem) {
    const m = this.state.uriPattern.matches(openItem.getURI());
    if (!m.ok()) {
      return null;
    }
    const stub = _stubItem.default.create('generic', openItem.getStubProps(), openItem.getURI());
    const copiedItem = new OpenItem(m, stub.getElement(), stub);
    this.setState(prevState => ({
      currentlyOpen: [...prevState.currentlyOpen, copiedItem]
    }), () => {
      this.registerCloseListener(stub, copiedItem);
      copiedItem.hydrateStub({
        copy: () => this.copyOpenItem(copiedItem)
      });
    });
    return stub;
  }
  registerCloseListener(paneItem, openItem) {
    const sub = this.props.workspace.onDidDestroyPaneItem(({
      item
    }) => {
      if (item === paneItem) {
        sub.dispose();
        this.subs.remove(sub);
        this.setState(prevState => ({
          currentlyOpen: prevState.currentlyOpen.filter(each => each !== openItem)
        }));
      }
    });
    this.subs.add(sub);
  }
}

/**
 * A subtree rendered through a portal onto a detached DOM node for use as the root as a PaneItem.
 */
exports.default = PaneItem;
_defineProperty(PaneItem, "propTypes", {
  workspace: _propTypes.default.object.isRequired,
  children: _propTypes.default.func.isRequired,
  uriPattern: _propTypes.default.string.isRequired,
  className: _propTypes.default.string
});
class OpenItem {
  constructor(match, element = null, stub = null) {
    this.id = this.constructor.nextID;
    this.constructor.nextID++;
    this.domNode = element || document.createElement('div');
    this.domNode.tabIndex = '-1';
    this.domNode.onfocus = this.onFocus.bind(this);
    this.stubItem = stub;
    this.stubProps = stub ? stub.props : {};
    this.match = match;
    this.itemHolder = new _refHolder.default();
  }
  getURI() {
    return this.match.getURI();
  }
  create(extra = {}) {
    const h = this.itemHolder.isEmpty() ? null : this.itemHolder;
    return (0, _helpers.createItem)(this.domNode, h, this.match.getURI(), extra);
  }
  hydrateStub(extra = {}) {
    if (this.stubItem) {
      this.stubItem.setRealItem(this.create(extra));
      this.stubItem = null;
    }
  }
  addClassName(className) {
    this.domNode.classList.add(className);
  }
  getKey() {
    return this.id;
  }
  getStubProps() {
    const itemProps = this.itemHolder.map(item => ({
      title: item.getTitle ? item.getTitle() : null,
      iconName: item.getIconName ? item.getIconName() : null
    }));
    return _objectSpread({}, this.stubProps, {}, itemProps);
  }
  onFocus() {
    return this.itemHolder.map(item => item.focus && item.focus());
  }
  renderPortal(renderProp) {
    return _reactDom.default.createPortal(renderProp({
      deserialized: this.stubProps,
      itemHolder: this.itemHolder,
      params: this.match.getParams(),
      uri: this.match.getURI()
    }), this.domNode);
  }
}
_defineProperty(OpenItem, "nextID", 0);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcmVhY3REb20iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX3Byb3BUeXBlcyIsIl9ldmVudEtpdCIsIl91cmlQYXR0ZXJuIiwiX3JlZkhvbGRlciIsIl9zdHViSXRlbSIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJlIiwiV2Vha01hcCIsInIiLCJ0IiwiaGFzIiwiZ2V0IiwibiIsIl9fcHJvdG9fXyIsImEiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0Iiwib3duS2V5cyIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJrZXkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsIlR5cGVFcnJvciIsIk51bWJlciIsIlBhbmVJdGVtIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiYXV0b2JpbmQiLCJ1cmlQYXR0ZXJuIiwiVVJJUGF0dGVybiIsImN1cnJlbnRseU9wZW4iLCJ3b3Jrc3BhY2UiLCJnZXRQYW5lSXRlbXMiLCJyZWR1Y2UiLCJhcnIiLCJpdGVtIiwiZWxlbWVudCIsImdldEVsZW1lbnQiLCJtYXRjaCIsImdldFVSSSIsIm1hdGNoZXMiLCJub25VUklNYXRjaCIsInN0dWIiLCJzZXRSZWFsSXRlbSIsIm9rIiwib3Blbkl0ZW0iLCJPcGVuSXRlbSIsInN1YnMiLCJDb21wb3NpdGVEaXNwb3NhYmxlIiwic3RhdGUiLCJnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMiLCJuZXh0UHJvcHMiLCJwcmV2U3RhdGUiLCJnZXRPcmlnaW5hbCIsImNvbXBvbmVudERpZE1vdW50IiwiYWRkIiwib25EaWRBZGRQYW5lSXRlbSIsIl9nZXRTdHViIiwiZ2V0UmVhbEl0ZW0iLCJoeWRyYXRlU3R1YiIsImNvcHkiLCJjb3B5T3Blbkl0ZW0iLCJjbGFzc05hbWUiLCJhZGRDbGFzc05hbWUiLCJyZWdpc3RlckNsb3NlTGlzdGVuZXIiLCJzZXRTdGF0ZSIsInN0dWJJdGVtIiwiYWRkT3BlbmVyIiwib3BlbmVyIiwicmVuZGVyIiwibWFwIiwiY3JlYXRlRWxlbWVudCIsIkZyYWdtZW50IiwiZ2V0S2V5IiwicmVuZGVyUG9ydGFsIiwiY2hpbGRyZW4iLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJ1cmkiLCJtIiwidW5kZWZpbmVkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJwYW5lSXRlbSIsImNyZWF0ZSIsIlN0dWJJdGVtIiwiZ2V0U3R1YlByb3BzIiwiY29waWVkSXRlbSIsInN1YiIsIm9uRGlkRGVzdHJveVBhbmVJdGVtIiwicmVtb3ZlIiwiZWFjaCIsImV4cG9ydHMiLCJQcm9wVHlwZXMiLCJvYmplY3QiLCJpc1JlcXVpcmVkIiwiZnVuYyIsInN0cmluZyIsImlkIiwibmV4dElEIiwiZG9tTm9kZSIsImRvY3VtZW50IiwidGFiSW5kZXgiLCJvbmZvY3VzIiwib25Gb2N1cyIsImJpbmQiLCJzdHViUHJvcHMiLCJpdGVtSG9sZGVyIiwiUmVmSG9sZGVyIiwiZXh0cmEiLCJoIiwiaXNFbXB0eSIsImNyZWF0ZUl0ZW0iLCJjbGFzc0xpc3QiLCJpdGVtUHJvcHMiLCJ0aXRsZSIsImdldFRpdGxlIiwiaWNvbk5hbWUiLCJnZXRJY29uTmFtZSIsImZvY3VzIiwicmVuZGVyUHJvcCIsIlJlYWN0RE9NIiwiY3JlYXRlUG9ydGFsIiwiZGVzZXJpYWxpemVkIiwicGFyYW1zIiwiZ2V0UGFyYW1zIl0sInNvdXJjZXMiOlsicGFuZS1pdGVtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge0ZyYWdtZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2V2ZW50LWtpdCc7XG5cbmltcG9ydCBVUklQYXR0ZXJuLCB7bm9uVVJJTWF0Y2h9IGZyb20gJy4vdXJpLXBhdHRlcm4nO1xuaW1wb3J0IFJlZkhvbGRlciBmcm9tICcuLi9tb2RlbHMvcmVmLWhvbGRlcic7XG5pbXBvcnQgU3R1Ykl0ZW0gZnJvbSAnLi4vaXRlbXMvc3R1Yi1pdGVtJztcbmltcG9ydCB7Y3JlYXRlSXRlbSwgYXV0b2JpbmR9IGZyb20gJy4uL2hlbHBlcnMnO1xuXG4vKipcbiAqIFBhbmVJdGVtIHJlZ2lzdGVycyBhbiBvcGVuZXIgd2l0aCB0aGUgY3VycmVudCBBdG9tIHdvcmtzcGFjZSBhcyBsb25nIGFzIHRoaXMgY29tcG9uZW50IGlzIG1vdW50ZWQuIFRoZSBvcGVuZXIgd2lsbFxuICogdHJpZ2dlciBvbiBVUklzIHRoYXQgbWF0Y2ggYSBzcGVjaWZpZWQgcGF0dGVybiBhbmQgcmVuZGVyIGEgc3VidHJlZSByZXR1cm5lZCBieSBhIHJlbmRlciBwcm9wLlxuICpcbiAqIFRoZSByZW5kZXIgcHJvcCBjYW4gcmVjZWl2ZSB0aHJlZSBhcmd1bWVudHM6XG4gKlxuICogKiBpdGVtSG9sZGVyOiBBIFJlZkhvbGRlci4gSWYgdXNlZCBhcyB0aGUgdGFyZ2V0IGZvciBhIHJlZiwgdGhlIHJlZmVyZW5jZWQgY29tcG9uZW50IHdpbGwgYmUgdXNlZCBhcyB0aGUgXCJpdGVtXCIgb2ZcbiAqICAgdGhlIHBhbmUgaXRlbSAtIGl0cyBgZ2V0VGl0bGUoKWAsIGBnZXRJY29uTmFtZSgpYCwgYW5kIG90aGVyIG1ldGhvZHMgd2lsbCBiZSB1c2VkIGJ5IHRoZSBwYW5lLlxuICogKiBwYXJhbXM6IEFuIG9iamVjdCBjb250YWluaW5nIHRoZSBuYW1lZCBwYXJhbWV0ZXJzIGNhcHR1cmVkIGJ5IHRoZSBVUkkgcGF0dGVybi5cbiAqICogdXJpOiBUaGUgZXhhY3QsIG1hdGNoZWQgVVJJIHVzZWQgdG8gbGF1bmNoIHRoaXMgaXRlbS5cbiAqXG4gKiByZW5kZXIoKSB7XG4gKiAgIHJldHVybiAoXG4gKiAgICAgPFBhbmVJdGVtIHdvcmtzcGFjZT17dGhpcy5wcm9wcy53b3Jrc3BhY2V9IHVyaVBhdHRlcm49J2F0b20tZ2l0aHViOi8vaG9zdC97aWR9Jz5cbiAqICAgICAgIHsoe2l0ZW1Ib2xkZXIsIHBhcmFtc30pID0+IChcbiAqICAgICAgICAgPEl0ZW1Db21wb25lbnQgcmVmPXtpdGVtSG9sZGVyLnNldHRlcn0gaWQ9e3BhcmFtcy5pZH0gLz5cbiAqICAgICAgICl9XG4gKiAgICAgPC9QYW5lSXRlbT5cbiAqICAgKTtcbiAqIH1cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFuZUl0ZW0gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHdvcmtzcGFjZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHVyaVBhdHRlcm46IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICBhdXRvYmluZCh0aGlzLCAnb3BlbmVyJyk7XG5cbiAgICBjb25zdCB1cmlQYXR0ZXJuID0gbmV3IFVSSVBhdHRlcm4odGhpcy5wcm9wcy51cmlQYXR0ZXJuKTtcbiAgICBjb25zdCBjdXJyZW50bHlPcGVuID0gdGhpcy5wcm9wcy53b3Jrc3BhY2UuZ2V0UGFuZUl0ZW1zKClcbiAgICAgIC5yZWR1Y2UoKGFyciwgaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gaXRlbS5nZXRFbGVtZW50ID8gaXRlbS5nZXRFbGVtZW50KCkgOiBudWxsO1xuICAgICAgICBjb25zdCBtYXRjaCA9IGl0ZW0uZ2V0VVJJID8gdXJpUGF0dGVybi5tYXRjaGVzKGl0ZW0uZ2V0VVJJKCkpIDogbm9uVVJJTWF0Y2g7XG4gICAgICAgIGNvbnN0IHN0dWIgPSBpdGVtLnNldFJlYWxJdGVtID8gaXRlbSA6IG51bGw7XG5cbiAgICAgICAgaWYgKGVsZW1lbnQgJiYgbWF0Y2gub2soKSkge1xuICAgICAgICAgIGNvbnN0IG9wZW5JdGVtID0gbmV3IE9wZW5JdGVtKG1hdGNoLCBlbGVtZW50LCBzdHViKTtcbiAgICAgICAgICBhcnIucHVzaChvcGVuSXRlbSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXJyO1xuICAgICAgfSwgW10pO1xuXG4gICAgdGhpcy5zdWJzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICB0aGlzLnN0YXRlID0ge3VyaVBhdHRlcm4sIGN1cnJlbnRseU9wZW59O1xuICB9XG5cbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhuZXh0UHJvcHMsIHByZXZTdGF0ZSkge1xuICAgIGlmIChwcmV2U3RhdGUudXJpUGF0dGVybi5nZXRPcmlnaW5hbCgpID09PSBuZXh0UHJvcHMudXJpUGF0dGVybikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVyaVBhdHRlcm46IG5ldyBVUklQYXR0ZXJuKG5leHRQcm9wcy51cmlQYXR0ZXJuKSxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgLy8gTGlzdGVuIGZvciBhbmQgYWRvcHQgU3R1Ykl0ZW1zIHRoYXQgYXJlIGFkZGVkIGFmdGVyIHRoaXMgY29tcG9uZW50IGhhc1xuICAgIC8vIGFscmVhZHkgYmVlbiBtb3VudGVkLlxuICAgIHRoaXMuc3Vicy5hZGQodGhpcy5wcm9wcy53b3Jrc3BhY2Uub25EaWRBZGRQYW5lSXRlbSgoe2l0ZW19KSA9PiB7XG4gICAgICBpZiAoIWl0ZW0uX2dldFN0dWIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3R1YiA9IGl0ZW0uX2dldFN0dWIoKTtcblxuICAgICAgaWYgKHN0dWIuZ2V0UmVhbEl0ZW0oKSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1hdGNoID0gdGhpcy5zdGF0ZS51cmlQYXR0ZXJuLm1hdGNoZXMoaXRlbS5nZXRVUkkoKSk7XG4gICAgICBpZiAoIW1hdGNoLm9rKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcGVuSXRlbSA9IG5ldyBPcGVuSXRlbShtYXRjaCwgc3R1Yi5nZXRFbGVtZW50KCksIHN0dWIpO1xuICAgICAgb3Blbkl0ZW0uaHlkcmF0ZVN0dWIoe1xuICAgICAgICBjb3B5OiAoKSA9PiB0aGlzLmNvcHlPcGVuSXRlbShvcGVuSXRlbSksXG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLnByb3BzLmNsYXNzTmFtZSkge1xuICAgICAgICBvcGVuSXRlbS5hZGRDbGFzc05hbWUodGhpcy5wcm9wcy5jbGFzc05hbWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZWdpc3RlckNsb3NlTGlzdGVuZXIoaXRlbSwgb3Blbkl0ZW0pO1xuXG4gICAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgICBjdXJyZW50bHlPcGVuOiBbLi4ucHJldlN0YXRlLmN1cnJlbnRseU9wZW4sIG9wZW5JdGVtXSxcbiAgICAgIH0pKTtcbiAgICB9KSk7XG5cbiAgICBmb3IgKGNvbnN0IG9wZW5JdGVtIG9mIHRoaXMuc3RhdGUuY3VycmVudGx5T3Blbikge1xuICAgICAgdGhpcy5yZWdpc3RlckNsb3NlTGlzdGVuZXIob3Blbkl0ZW0uc3R1Ykl0ZW0sIG9wZW5JdGVtKTtcblxuICAgICAgb3Blbkl0ZW0uaHlkcmF0ZVN0dWIoe1xuICAgICAgICBjb3B5OiAoKSA9PiB0aGlzLmNvcHlPcGVuSXRlbShvcGVuSXRlbSksXG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLnByb3BzLmNsYXNzTmFtZSkge1xuICAgICAgICBvcGVuSXRlbS5hZGRDbGFzc05hbWUodGhpcy5wcm9wcy5jbGFzc05hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc3Vicy5hZGQodGhpcy5wcm9wcy53b3Jrc3BhY2UuYWRkT3BlbmVyKHRoaXMub3BlbmVyKSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuY3VycmVudGx5T3Blbi5tYXAoaXRlbSA9PiB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8RnJhZ21lbnQga2V5PXtpdGVtLmdldEtleSgpfT5cbiAgICAgICAgICB7aXRlbS5yZW5kZXJQb3J0YWwodGhpcy5wcm9wcy5jaGlsZHJlbil9XG4gICAgICAgIDwvRnJhZ21lbnQ+XG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5zdWJzLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIG9wZW5lcih1cmkpIHtcbiAgICBjb25zdCBtID0gdGhpcy5zdGF0ZS51cmlQYXR0ZXJuLm1hdGNoZXModXJpKTtcbiAgICBpZiAoIW0ub2soKSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb25zdCBvcGVuSXRlbSA9IG5ldyBPcGVuSXRlbShtKTtcbiAgICBpZiAodGhpcy5wcm9wcy5jbGFzc05hbWUpIHtcbiAgICAgIG9wZW5JdGVtLmFkZENsYXNzTmFtZSh0aGlzLnByb3BzLmNsYXNzTmFtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0ZShwcmV2U3RhdGUgPT4gKHtcbiAgICAgICAgY3VycmVudGx5T3BlbjogWy4uLnByZXZTdGF0ZS5jdXJyZW50bHlPcGVuLCBvcGVuSXRlbV0sXG4gICAgICB9KSwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwYW5lSXRlbSA9IG9wZW5JdGVtLmNyZWF0ZSh7XG4gICAgICAgICAgY29weTogKCkgPT4gdGhpcy5jb3B5T3Blbkl0ZW0ob3Blbkl0ZW0pLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckNsb3NlTGlzdGVuZXIocGFuZUl0ZW0sIG9wZW5JdGVtKTtcbiAgICAgICAgcmVzb2x2ZShwYW5lSXRlbSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvcHlPcGVuSXRlbShvcGVuSXRlbSkge1xuICAgIGNvbnN0IG0gPSB0aGlzLnN0YXRlLnVyaVBhdHRlcm4ubWF0Y2hlcyhvcGVuSXRlbS5nZXRVUkkoKSk7XG4gICAgaWYgKCFtLm9rKCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHN0dWIgPSBTdHViSXRlbS5jcmVhdGUoJ2dlbmVyaWMnLCBvcGVuSXRlbS5nZXRTdHViUHJvcHMoKSwgb3Blbkl0ZW0uZ2V0VVJJKCkpO1xuXG4gICAgY29uc3QgY29waWVkSXRlbSA9IG5ldyBPcGVuSXRlbShtLCBzdHViLmdldEVsZW1lbnQoKSwgc3R1Yik7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2U3RhdGUgPT4gKHtcbiAgICAgIGN1cnJlbnRseU9wZW46IFsuLi5wcmV2U3RhdGUuY3VycmVudGx5T3BlbiwgY29waWVkSXRlbV0sXG4gICAgfSksICgpID0+IHtcbiAgICAgIHRoaXMucmVnaXN0ZXJDbG9zZUxpc3RlbmVyKHN0dWIsIGNvcGllZEl0ZW0pO1xuICAgICAgY29waWVkSXRlbS5oeWRyYXRlU3R1Yih7XG4gICAgICAgIGNvcHk6ICgpID0+IHRoaXMuY29weU9wZW5JdGVtKGNvcGllZEl0ZW0pLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3R1YjtcbiAgfVxuXG4gIHJlZ2lzdGVyQ2xvc2VMaXN0ZW5lcihwYW5lSXRlbSwgb3Blbkl0ZW0pIHtcbiAgICBjb25zdCBzdWIgPSB0aGlzLnByb3BzLndvcmtzcGFjZS5vbkRpZERlc3Ryb3lQYW5lSXRlbSgoe2l0ZW19KSA9PiB7XG4gICAgICBpZiAoaXRlbSA9PT0gcGFuZUl0ZW0pIHtcbiAgICAgICAgc3ViLmRpc3Bvc2UoKTtcbiAgICAgICAgdGhpcy5zdWJzLnJlbW92ZShzdWIpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgICAgIGN1cnJlbnRseU9wZW46IHByZXZTdGF0ZS5jdXJyZW50bHlPcGVuLmZpbHRlcihlYWNoID0+IGVhY2ggIT09IG9wZW5JdGVtKSxcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5zdWJzLmFkZChzdWIpO1xuICB9XG59XG5cbi8qKlxuICogQSBzdWJ0cmVlIHJlbmRlcmVkIHRocm91Z2ggYSBwb3J0YWwgb250byBhIGRldGFjaGVkIERPTSBub2RlIGZvciB1c2UgYXMgdGhlIHJvb3QgYXMgYSBQYW5lSXRlbS5cbiAqL1xuY2xhc3MgT3Blbkl0ZW0ge1xuICBzdGF0aWMgbmV4dElEID0gMFxuXG4gIGNvbnN0cnVjdG9yKG1hdGNoLCBlbGVtZW50ID0gbnVsbCwgc3R1YiA9IG51bGwpIHtcbiAgICB0aGlzLmlkID0gdGhpcy5jb25zdHJ1Y3Rvci5uZXh0SUQ7XG4gICAgdGhpcy5jb25zdHJ1Y3Rvci5uZXh0SUQrKztcblxuICAgIHRoaXMuZG9tTm9kZSA9IGVsZW1lbnQgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5kb21Ob2RlLnRhYkluZGV4ID0gJy0xJztcbiAgICB0aGlzLmRvbU5vZGUub25mb2N1cyA9IHRoaXMub25Gb2N1cy5iaW5kKHRoaXMpO1xuICAgIHRoaXMuc3R1Ykl0ZW0gPSBzdHViO1xuICAgIHRoaXMuc3R1YlByb3BzID0gc3R1YiA/IHN0dWIucHJvcHMgOiB7fTtcbiAgICB0aGlzLm1hdGNoID0gbWF0Y2g7XG4gICAgdGhpcy5pdGVtSG9sZGVyID0gbmV3IFJlZkhvbGRlcigpO1xuICB9XG5cbiAgZ2V0VVJJKCkge1xuICAgIHJldHVybiB0aGlzLm1hdGNoLmdldFVSSSgpO1xuICB9XG5cbiAgY3JlYXRlKGV4dHJhID0ge30pIHtcbiAgICBjb25zdCBoID0gdGhpcy5pdGVtSG9sZGVyLmlzRW1wdHkoKSA/IG51bGwgOiB0aGlzLml0ZW1Ib2xkZXI7XG4gICAgcmV0dXJuIGNyZWF0ZUl0ZW0odGhpcy5kb21Ob2RlLCBoLCB0aGlzLm1hdGNoLmdldFVSSSgpLCBleHRyYSk7XG4gIH1cblxuICBoeWRyYXRlU3R1YihleHRyYSA9IHt9KSB7XG4gICAgaWYgKHRoaXMuc3R1Ykl0ZW0pIHtcbiAgICAgIHRoaXMuc3R1Ykl0ZW0uc2V0UmVhbEl0ZW0odGhpcy5jcmVhdGUoZXh0cmEpKTtcbiAgICAgIHRoaXMuc3R1Ykl0ZW0gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFkZENsYXNzTmFtZShjbGFzc05hbWUpIHtcbiAgICB0aGlzLmRvbU5vZGUuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICB9XG5cbiAgZ2V0S2V5KCkge1xuICAgIHJldHVybiB0aGlzLmlkO1xuICB9XG5cbiAgZ2V0U3R1YlByb3BzKCkge1xuICAgIGNvbnN0IGl0ZW1Qcm9wcyA9IHRoaXMuaXRlbUhvbGRlci5tYXAoaXRlbSA9PiAoe1xuICAgICAgdGl0bGU6IGl0ZW0uZ2V0VGl0bGUgPyBpdGVtLmdldFRpdGxlKCkgOiBudWxsLFxuICAgICAgaWNvbk5hbWU6IGl0ZW0uZ2V0SWNvbk5hbWUgPyBpdGVtLmdldEljb25OYW1lKCkgOiBudWxsLFxuICAgIH0pKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi50aGlzLnN0dWJQcm9wcyxcbiAgICAgIC4uLml0ZW1Qcm9wcyxcbiAgICB9O1xuICB9XG5cbiAgb25Gb2N1cygpIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtSG9sZGVyLm1hcChpdGVtID0+IGl0ZW0uZm9jdXMgJiYgaXRlbS5mb2N1cygpKTtcbiAgfVxuXG4gIHJlbmRlclBvcnRhbChyZW5kZXJQcm9wKSB7XG4gICAgcmV0dXJuIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbChcbiAgICAgIHJlbmRlclByb3Aoe1xuICAgICAgICBkZXNlcmlhbGl6ZWQ6IHRoaXMuc3R1YlByb3BzLFxuICAgICAgICBpdGVtSG9sZGVyOiB0aGlzLml0ZW1Ib2xkZXIsXG4gICAgICAgIHBhcmFtczogdGhpcy5tYXRjaC5nZXRQYXJhbXMoKSxcbiAgICAgICAgdXJpOiB0aGlzLm1hdGNoLmdldFVSSSgpLFxuICAgICAgfSksXG4gICAgICB0aGlzLmRvbU5vZGUsXG4gICAgKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxVQUFBLEdBQUFELHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBSSxTQUFBLEdBQUFKLE9BQUE7QUFFQSxJQUFBSyxXQUFBLEdBQUFOLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTSxVQUFBLEdBQUFKLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBTyxTQUFBLEdBQUFMLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBUSxRQUFBLEdBQUFSLE9BQUE7QUFBZ0QsU0FBQUUsdUJBQUFPLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFBQSxTQUFBRyx5QkFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxtQkFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFB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