"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireWildcard(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _uriPattern = _interopRequireWildcard(require("./uri-pattern"));
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
var _stubItem = _interopRequireDefault(require("../items/stub-item"));
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
/**
 * PaneItem registers an opener with the current Atom workspace as long as this component is mounted. The opener will
 * trigger on URIs that match a specified pattern and render a subtree returned by a render prop.
 *
 * The render prop can receive three arguments:
 *
 * * itemHolder: A RefHolder. If used as the target for a ref, the referenced component will be used as the "item" of
 *   the pane item - its `getTitle()`, `getIconName()`, and other methods will be used by the pane.
 * * params: An object containing the named parameters captured by the URI pattern.
 * * uri: The exact, matched URI used to launch this item.
 *
 * render() {
 *   return (
 *     <PaneItem workspace={this.props.workspace} uriPattern='atom-github://host/{id}'>
 *       {({itemHolder, params}) => (
 *         <ItemComponent ref={itemHolder.setter} id={params.id} />
 *       )}
 *     </PaneItem>
 *   );
 * }
 */
class PaneItem extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _helpers.autobind)(this, 'opener');
    const uriPattern = new _uriPattern.default(this.props.uriPattern);
    const currentlyOpen = this.props.workspace.getPaneItems().reduce((arr, item) => {
      const element = item.getElement ? item.getElement() : null;
      const match = item.getURI ? uriPattern.matches(item.getURI()) : _uriPattern.nonURIMatch;
      const stub = item.setRealItem ? item : null;
      if (element && match.ok()) {
        const openItem = new OpenItem(match, element, stub);
        arr.push(openItem);
      }
      return arr;
    }, []);
    this.subs = new _eventKit.CompositeDisposable();
    this.state = {
      uriPattern,
      currentlyOpen
    };
  }
  static getDerivedStateFromProps(nextProps, prevState) {
    if (prevState.uriPattern.getOriginal() === nextProps.uriPattern) {
      return null;
    }
    return {
      uriPattern: new _uriPattern.default(nextProps.uriPattern)
    };
  }
  componentDidMount() {
    // Listen for and adopt StubItems that are added after this component has
    // already been mounted.
    this.subs.add(this.props.workspace.onDidAddPaneItem(({
      item
    }) => {
      if (!item._getStub) {
        return;
      }
      const stub = item._getStub();
      if (stub.getRealItem() !== null) {
        return;
      }
      const match = this.state.uriPattern.matches(item.getURI());
      if (!match.ok()) {
        return;
      }
      const openItem = new OpenItem(match, stub.getElement(), stub);
      openItem.hydrateStub({
        copy: () => this.copyOpenItem(openItem)
      });
      if (this.props.className) {
        openItem.addClassName(this.props.className);
      }
      this.registerCloseListener(item, openItem);
      this.setState(prevState => ({
        currentlyOpen: [...prevState.currentlyOpen, openItem]
      }));
    }));
    for (const openItem of this.state.currentlyOpen) {
      this.registerCloseListener(openItem.stubItem, openItem);
      openItem.hydrateStub({
        copy: () => this.copyOpenItem(openItem)
      });
      if (this.props.className) {
        openItem.addClassName(this.props.className);
      }
    }
    this.subs.add(this.props.workspace.addOpener(this.opener));
  }
  render() {
    return this.state.currentlyOpen.map(item => {
      return _react.default.createElement(_react.Fragment, {
        key: item.getKey()
      }, item.renderPortal(this.props.children));
    });
  }
  componentWillUnmount() {
    this.subs.dispose();
  }
  opener(uri) {
    const m = this.state.uriPattern.matches(uri);
    if (!m.ok()) {
      return undefined;
    }
    const openItem = new OpenItem(m);
    if (this.props.className) {
      openItem.addClassName(this.props.className);
    }
    return new Promise(resolve => {
      this.setState(prevState => ({
        currentlyOpen: [...prevState.currentlyOpen, openItem]
      }), () => {
        const paneItem = openItem.create({
          copy: () => this.copyOpenItem(openItem)
        });
        this.registerCloseListener(paneItem, openItem);
        resolve(paneItem);
      });
    });
  }
  copyOpenItem(openItem) {
    const m = this.state.uriPattern.matches(openItem.getURI());
    if (!m.ok()) {
      return null;
    }
    const stub = _stubItem.default.create('generic', openItem.getStubProps(), openItem.getURI());
    const copiedItem = new OpenItem(m, stub.getElement(), stub);
    this.setState(prevState => ({
      currentlyOpen: [...prevState.currentlyOpen, copiedItem]
    }), () => {
      this.registerCloseListener(stub, copiedItem);
      copiedItem.hydrateStub({
        copy: () => this.copyOpenItem(copiedItem)
      });
    });
    return stub;
  }
  registerCloseListener(paneItem, openItem) {
    const sub = this.props.workspace.onDidDestroyPaneItem(({
      item
    }) => {
      if (item === paneItem) {
        sub.dispose();
        this.subs.remove(sub);
        this.setState(prevState => ({
          currentlyOpen: prevState.currentlyOpen.filter(each => each !== openItem)
        }));
      }
    });
    this.subs.add(sub);
  }
}

/**
 * A subtree rendered through a portal onto a detached DOM node for use as the root as a PaneItem.
 */
exports.default = PaneItem;
_defineProperty(PaneItem, "propTypes", {
  workspace: _propTypes.default.object.isRequired,
  children: _propTypes.default.func.isRequired,
  uriPattern: _propTypes.default.string.isRequired,
  className: _propTypes.default.string
});
class OpenItem {
  constructor(match, element = null, stub = null) {
    this.id = this.constructor.nextID;
    this.constructor.nextID++;
    this.domNode = element || document.createElement('div');
    this.domNode.tabIndex = '-1';
    this.domNode.onfocus = this.onFocus.bind(this);
    this.stubItem = stub;
    this.stubProps = stub ? stub.props : {};
    this.match = match;
    this.itemHolder = new _refHolder.default();
  }
  getURI() {
    return this.match.getURI();
  }
  create(extra = {}) {
    const h = this.itemHolder.isEmpty() ? null : this.itemHolder;
    return (0, _helpers.createItem)(this.domNode, h, this.match.getURI(), extra);
  }
  hydrateStub(extra = {}) {
    if (this.stubItem) {
      this.stubItem.setRealItem(this.create(extra));
      this.stubItem = null;
    }
  }
  addClassName(className) {
    this.domNode.classList.add(className);
  }
  getKey() {
    return this.id;
  }
  getStubProps() {
    const itemProps = this.itemHolder.map(item => ({
      title: item.getTitle ? item.getTitle() : null,
      iconName: item.getIconName ? item.getIconName() : null
    }));
    return _objectSpread({}, this.stubProps, {}, itemProps);
  }
  onFocus() {
    return this.itemHolder.map(item => item.focus && item.focus());
  }
  renderPortal(renderProp) {
    return _reactDom.default.createPortal(renderProp({
      deserialized: this.stubProps,
      itemHolder: this.itemHolder,
      params: this.match.getParams(),
      uri: this.match.getURI()
    }), this.domNode);
  }
}
_defineProperty(OpenItem, "nextID", 0);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcmVhY3REb20iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX3Byb3BUeXBlcyIsIl9ldmVudEtpdCIsIl91cmlQYXR0ZXJuIiwiX3JlZkhvbGRlciIsIl9zdHViSXRlbSIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJlIiwiV2Vha01hcCIsInIiLCJ0IiwiaGFzIiwiZ2V0IiwibiIsIl9fcHJvdG9fXyIsImEiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0Iiwib3duS2V5cyIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJrZXkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJhcmciLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJpbnB1dCIsImhpbnQiLCJwcmltIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJ1bmRlZmluZWQiLCJyZXMiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJQYW5lSXRlbSIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImF1dG9iaW5kIiwidXJpUGF0dGVybiIsIlVSSVBhdHRlcm4iLCJjdXJyZW50bHlPcGVuIiwid29ya3NwYWNlIiwiZ2V0UGFuZUl0ZW1zIiwicmVkdWNlIiwiYXJyIiwiaXRlbSIsImVsZW1lbnQiLCJnZXRFbGVtZW50IiwibWF0Y2giLCJnZXRVUkkiLCJtYXRjaGVzIiwibm9uVVJJTWF0Y2giLCJzdHViIiwic2V0UmVhbEl0ZW0iLCJvayIsIm9wZW5JdGVtIiwiT3Blbkl0ZW0iLCJzdWJzIiwiQ29tcG9zaXRlRGlzcG9zYWJsZSIsInN0YXRlIiwiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwibmV4dFByb3BzIiwicHJldlN0YXRlIiwiZ2V0T3JpZ2luYWwiLCJjb21wb25lbnREaWRNb3VudCIsImFkZCIsIm9uRGlkQWRkUGFuZUl0ZW0iLCJfZ2V0U3R1YiIsImdldFJlYWxJdGVtIiwiaHlkcmF0ZVN0dWIiLCJjb3B5IiwiY29weU9wZW5JdGVtIiwiY2xhc3NOYW1lIiwiYWRkQ2xhc3NOYW1lIiwicmVnaXN0ZXJDbG9zZUxpc3RlbmVyIiwic2V0U3RhdGUiLCJzdHViSXRlbSIsImFkZE9wZW5lciIsIm9wZW5lciIsInJlbmRlciIsIm1hcCIsImNyZWF0ZUVsZW1lbnQiLCJGcmFnbWVudCIsImdldEtleSIsInJlbmRlclBvcnRhbCIsImNoaWxkcmVuIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwidXJpIiwibSIsIlByb21pc2UiLCJyZXNvbHZlIiwicGFuZUl0ZW0iLCJjcmVhdGUiLCJTdHViSXRlbSIsImdldFN0dWJQcm9wcyIsImNvcGllZEl0ZW0iLCJzdWIiLCJvbkRpZERlc3Ryb3lQYW5lSXRlbSIsInJlbW92ZSIsImVhY2giLCJleHBvcnRzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsImZ1bmMiLCJzdHJpbmciLCJpZCIsIm5leHRJRCIsImRvbU5vZGUiLCJkb2N1bWVudCIsInRhYkluZGV4Iiwib25mb2N1cyIsIm9uRm9jdXMiLCJiaW5kIiwic3R1YlByb3BzIiwiaXRlbUhvbGRlciIsIlJlZkhvbGRlciIsImV4dHJhIiwiaCIsImlzRW1wdHkiLCJjcmVhdGVJdGVtIiwiY2xhc3NMaXN0IiwiaXRlbVByb3BzIiwidGl0bGUiLCJnZXRUaXRsZSIsImljb25OYW1lIiwiZ2V0SWNvbk5hbWUiLCJmb2N1cyIsInJlbmRlclByb3AiLCJSZWFjdERPTSIsImNyZWF0ZVBvcnRhbCIsImRlc2VyaWFsaXplZCIsInBhcmFtcyIsImdldFBhcmFtcyJdLCJzb3VyY2VzIjpbInBhbmUtaXRlbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtGcmFnbWVudH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuXG5pbXBvcnQgVVJJUGF0dGVybiwge25vblVSSU1hdGNofSBmcm9tICcuL3VyaS1wYXR0ZXJuJztcbmltcG9ydCBSZWZIb2xkZXIgZnJvbSAnLi4vbW9kZWxzL3JlZi1ob2xkZXInO1xuaW1wb3J0IFN0dWJJdGVtIGZyb20gJy4uL2l0ZW1zL3N0dWItaXRlbSc7XG5pbXBvcnQge2NyZWF0ZUl0ZW0sIGF1dG9iaW5kfSBmcm9tICcuLi9oZWxwZXJzJztcblxuLyoqXG4gKiBQYW5lSXRlbSByZWdpc3RlcnMgYW4gb3BlbmVyIHdpdGggdGhlIGN1cnJlbnQgQXRvbSB3b3Jrc3BhY2UgYXMgbG9uZyBhcyB0aGlzIGNvbXBvbmVudCBpcyBtb3VudGVkLiBUaGUgb3BlbmVyIHdpbGxcbiAqIHRyaWdnZXIgb24gVVJJcyB0aGF0IG1hdGNoIGEgc3BlY2lmaWVkIHBhdHRlcm4gYW5kIHJlbmRlciBhIHN1YnRyZWUgcmV0dXJuZWQgYnkgYSByZW5kZXIgcHJvcC5cbiAqXG4gKiBUaGUgcmVuZGVyIHByb3AgY2FuIHJlY2VpdmUgdGhyZWUgYXJndW1lbnRzOlxuICpcbiAqICogaXRlbUhvbGRlcjogQSBSZWZIb2xkZXIuIElmIHVzZWQgYXMgdGhlIHRhcmdldCBmb3IgYSByZWYsIHRoZSByZWZlcmVuY2VkIGNvbXBvbmVudCB3aWxsIGJlIHVzZWQgYXMgdGhlIFwiaXRlbVwiIG9mXG4gKiAgIHRoZSBwYW5lIGl0ZW0gLSBpdHMgYGdldFRpdGxlKClgLCBgZ2V0SWNvbk5hbWUoKWAsIGFuZCBvdGhlciBtZXRob2RzIHdpbGwgYmUgdXNlZCBieSB0aGUgcGFuZS5cbiAqICogcGFyYW1zOiBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgbmFtZWQgcGFyYW1ldGVycyBjYXB0dXJlZCBieSB0aGUgVVJJIHBhdHRlcm4uXG4gKiAqIHVyaTogVGhlIGV4YWN0LCBtYXRjaGVkIFVSSSB1c2VkIHRvIGxhdW5jaCB0aGlzIGl0ZW0uXG4gKlxuICogcmVuZGVyKCkge1xuICogICByZXR1cm4gKFxuICogICAgIDxQYW5lSXRlbSB3b3Jrc3BhY2U9e3RoaXMucHJvcHMud29ya3NwYWNlfSB1cmlQYXR0ZXJuPSdhdG9tLWdpdGh1YjovL2hvc3Qve2lkfSc+XG4gKiAgICAgICB7KHtpdGVtSG9sZGVyLCBwYXJhbXN9KSA9PiAoXG4gKiAgICAgICAgIDxJdGVtQ29tcG9uZW50IHJlZj17aXRlbUhvbGRlci5zZXR0ZXJ9IGlkPXtwYXJhbXMuaWR9IC8+XG4gKiAgICAgICApfVxuICogICAgIDwvUGFuZUl0ZW0+XG4gKiAgICk7XG4gKiB9XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhbmVJdGVtIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICB3b3Jrc3BhY2U6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICB1cmlQYXR0ZXJuOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgYXV0b2JpbmQodGhpcywgJ29wZW5lcicpO1xuXG4gICAgY29uc3QgdXJpUGF0dGVybiA9IG5ldyBVUklQYXR0ZXJuKHRoaXMucHJvcHMudXJpUGF0dGVybik7XG4gICAgY29uc3QgY3VycmVudGx5T3BlbiA9IHRoaXMucHJvcHMud29ya3NwYWNlLmdldFBhbmVJdGVtcygpXG4gICAgICAucmVkdWNlKChhcnIsIGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGl0ZW0uZ2V0RWxlbWVudCA/IGl0ZW0uZ2V0RWxlbWVudCgpIDogbnVsbDtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBpdGVtLmdldFVSSSA/IHVyaVBhdHRlcm4ubWF0Y2hlcyhpdGVtLmdldFVSSSgpKSA6IG5vblVSSU1hdGNoO1xuICAgICAgICBjb25zdCBzdHViID0gaXRlbS5zZXRSZWFsSXRlbSA/IGl0ZW0gOiBudWxsO1xuXG4gICAgICAgIGlmIChlbGVtZW50ICYmIG1hdGNoLm9rKCkpIHtcbiAgICAgICAgICBjb25zdCBvcGVuSXRlbSA9IG5ldyBPcGVuSXRlbShtYXRjaCwgZWxlbWVudCwgc3R1Yik7XG4gICAgICAgICAgYXJyLnB1c2gob3Blbkl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFycjtcbiAgICAgIH0sIFtdKTtcblxuICAgIHRoaXMuc3VicyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5zdGF0ZSA9IHt1cmlQYXR0ZXJuLCBjdXJyZW50bHlPcGVufTtcbiAgfVxuXG4gIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMobmV4dFByb3BzLCBwcmV2U3RhdGUpIHtcbiAgICBpZiAocHJldlN0YXRlLnVyaVBhdHRlcm4uZ2V0T3JpZ2luYWwoKSA9PT0gbmV4dFByb3BzLnVyaVBhdHRlcm4pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB1cmlQYXR0ZXJuOiBuZXcgVVJJUGF0dGVybihuZXh0UHJvcHMudXJpUGF0dGVybiksXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIC8vIExpc3RlbiBmb3IgYW5kIGFkb3B0IFN0dWJJdGVtcyB0aGF0IGFyZSBhZGRlZCBhZnRlciB0aGlzIGNvbXBvbmVudCBoYXNcbiAgICAvLyBhbHJlYWR5IGJlZW4gbW91bnRlZC5cbiAgICB0aGlzLnN1YnMuYWRkKHRoaXMucHJvcHMud29ya3NwYWNlLm9uRGlkQWRkUGFuZUl0ZW0oKHtpdGVtfSkgPT4ge1xuICAgICAgaWYgKCFpdGVtLl9nZXRTdHViKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN0dWIgPSBpdGVtLl9nZXRTdHViKCk7XG5cbiAgICAgIGlmIChzdHViLmdldFJlYWxJdGVtKCkgIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBtYXRjaCA9IHRoaXMuc3RhdGUudXJpUGF0dGVybi5tYXRjaGVzKGl0ZW0uZ2V0VVJJKCkpO1xuICAgICAgaWYgKCFtYXRjaC5vaygpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3Blbkl0ZW0gPSBuZXcgT3Blbkl0ZW0obWF0Y2gsIHN0dWIuZ2V0RWxlbWVudCgpLCBzdHViKTtcbiAgICAgIG9wZW5JdGVtLmh5ZHJhdGVTdHViKHtcbiAgICAgICAgY29weTogKCkgPT4gdGhpcy5jb3B5T3Blbkl0ZW0ob3Blbkl0ZW0pLFxuICAgICAgfSk7XG4gICAgICBpZiAodGhpcy5wcm9wcy5jbGFzc05hbWUpIHtcbiAgICAgICAgb3Blbkl0ZW0uYWRkQ2xhc3NOYW1lKHRoaXMucHJvcHMuY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVnaXN0ZXJDbG9zZUxpc3RlbmVyKGl0ZW0sIG9wZW5JdGVtKTtcblxuICAgICAgdGhpcy5zZXRTdGF0ZShwcmV2U3RhdGUgPT4gKHtcbiAgICAgICAgY3VycmVudGx5T3BlbjogWy4uLnByZXZTdGF0ZS5jdXJyZW50bHlPcGVuLCBvcGVuSXRlbV0sXG4gICAgICB9KSk7XG4gICAgfSkpO1xuXG4gICAgZm9yIChjb25zdCBvcGVuSXRlbSBvZiB0aGlzLnN0YXRlLmN1cnJlbnRseU9wZW4pIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJDbG9zZUxpc3RlbmVyKG9wZW5JdGVtLnN0dWJJdGVtLCBvcGVuSXRlbSk7XG5cbiAgICAgIG9wZW5JdGVtLmh5ZHJhdGVTdHViKHtcbiAgICAgICAgY29weTogKCkgPT4gdGhpcy5jb3B5T3Blbkl0ZW0ob3Blbkl0ZW0pLFxuICAgICAgfSk7XG4gICAgICBpZiAodGhpcy5wcm9wcy5jbGFzc05hbWUpIHtcbiAgICAgICAgb3Blbkl0ZW0uYWRkQ2xhc3NOYW1lKHRoaXMucHJvcHMuY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnN1YnMuYWRkKHRoaXMucHJvcHMud29ya3NwYWNlLmFkZE9wZW5lcih0aGlzLm9wZW5lcikpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLmN1cnJlbnRseU9wZW4ubWFwKGl0ZW0gPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPEZyYWdtZW50IGtleT17aXRlbS5nZXRLZXkoKX0+XG4gICAgICAgICAge2l0ZW0ucmVuZGVyUG9ydGFsKHRoaXMucHJvcHMuY2hpbGRyZW4pfVxuICAgICAgICA8L0ZyYWdtZW50PlxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuc3Vicy5kaXNwb3NlKCk7XG4gIH1cblxuICBvcGVuZXIodXJpKSB7XG4gICAgY29uc3QgbSA9IHRoaXMuc3RhdGUudXJpUGF0dGVybi5tYXRjaGVzKHVyaSk7XG4gICAgaWYgKCFtLm9rKCkpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3Qgb3Blbkl0ZW0gPSBuZXcgT3Blbkl0ZW0obSk7XG4gICAgaWYgKHRoaXMucHJvcHMuY2xhc3NOYW1lKSB7XG4gICAgICBvcGVuSXRlbS5hZGRDbGFzc05hbWUodGhpcy5wcm9wcy5jbGFzc05hbWUpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUocHJldlN0YXRlID0+ICh7XG4gICAgICAgIGN1cnJlbnRseU9wZW46IFsuLi5wcmV2U3RhdGUuY3VycmVudGx5T3Blbiwgb3Blbkl0ZW1dLFxuICAgICAgfSksICgpID0+IHtcbiAgICAgICAgY29uc3QgcGFuZUl0ZW0gPSBvcGVuSXRlbS5jcmVhdGUoe1xuICAgICAgICAgIGNvcHk6ICgpID0+IHRoaXMuY29weU9wZW5JdGVtKG9wZW5JdGVtKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJDbG9zZUxpc3RlbmVyKHBhbmVJdGVtLCBvcGVuSXRlbSk7XG4gICAgICAgIHJlc29sdmUocGFuZUl0ZW0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBjb3B5T3Blbkl0ZW0ob3Blbkl0ZW0pIHtcbiAgICBjb25zdCBtID0gdGhpcy5zdGF0ZS51cmlQYXR0ZXJuLm1hdGNoZXMob3Blbkl0ZW0uZ2V0VVJJKCkpO1xuICAgIGlmICghbS5vaygpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBzdHViID0gU3R1Ykl0ZW0uY3JlYXRlKCdnZW5lcmljJywgb3Blbkl0ZW0uZ2V0U3R1YlByb3BzKCksIG9wZW5JdGVtLmdldFVSSSgpKTtcblxuICAgIGNvbnN0IGNvcGllZEl0ZW0gPSBuZXcgT3Blbkl0ZW0obSwgc3R1Yi5nZXRFbGVtZW50KCksIHN0dWIpO1xuICAgIHRoaXMuc2V0U3RhdGUocHJldlN0YXRlID0+ICh7XG4gICAgICBjdXJyZW50bHlPcGVuOiBbLi4ucHJldlN0YXRlLmN1cnJlbnRseU9wZW4sIGNvcGllZEl0ZW1dLFxuICAgIH0pLCAoKSA9PiB7XG4gICAgICB0aGlzLnJlZ2lzdGVyQ2xvc2VMaXN0ZW5lcihzdHViLCBjb3BpZWRJdGVtKTtcbiAgICAgIGNvcGllZEl0ZW0uaHlkcmF0ZVN0dWIoe1xuICAgICAgICBjb3B5OiAoKSA9PiB0aGlzLmNvcHlPcGVuSXRlbShjb3BpZWRJdGVtKSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0dWI7XG4gIH1cblxuICByZWdpc3RlckNsb3NlTGlzdGVuZXIocGFuZUl0ZW0sIG9wZW5JdGVtKSB7XG4gICAgY29uc3Qgc3ViID0gdGhpcy5wcm9wcy53b3Jrc3BhY2Uub25EaWREZXN0cm95UGFuZUl0ZW0oKHtpdGVtfSkgPT4ge1xuICAgICAgaWYgKGl0ZW0gPT09IHBhbmVJdGVtKSB7XG4gICAgICAgIHN1Yi5kaXNwb3NlKCk7XG4gICAgICAgIHRoaXMuc3Vicy5yZW1vdmUoc3ViKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShwcmV2U3RhdGUgPT4gKHtcbiAgICAgICAgICBjdXJyZW50bHlPcGVuOiBwcmV2U3RhdGUuY3VycmVudGx5T3Blbi5maWx0ZXIoZWFjaCA9PiBlYWNoICE9PSBvcGVuSXRlbSksXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuc3Vicy5hZGQoc3ViKTtcbiAgfVxufVxuXG4vKipcbiAqIEEgc3VidHJlZSByZW5kZXJlZCB0aHJvdWdoIGEgcG9ydGFsIG9udG8gYSBkZXRhY2hlZCBET00gbm9kZSBmb3IgdXNlIGFzIHRoZSByb290IGFzIGEgUGFuZUl0ZW0uXG4gKi9cbmNsYXNzIE9wZW5JdGVtIHtcbiAgc3RhdGljIG5leHRJRCA9IDBcblxuICBjb25zdHJ1Y3RvcihtYXRjaCwgZWxlbWVudCA9IG51bGwsIHN0dWIgPSBudWxsKSB7XG4gICAgdGhpcy5pZCA9IHRoaXMuY29uc3RydWN0b3IubmV4dElEO1xuICAgIHRoaXMuY29uc3RydWN0b3IubmV4dElEKys7XG5cbiAgICB0aGlzLmRvbU5vZGUgPSBlbGVtZW50IHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuZG9tTm9kZS50YWJJbmRleCA9ICctMSc7XG4gICAgdGhpcy5kb21Ob2RlLm9uZm9jdXMgPSB0aGlzLm9uRm9jdXMuYmluZCh0aGlzKTtcbiAgICB0aGlzLnN0dWJJdGVtID0gc3R1YjtcbiAgICB0aGlzLnN0dWJQcm9wcyA9IHN0dWIgPyBzdHViLnByb3BzIDoge307XG4gICAgdGhpcy5tYXRjaCA9IG1hdGNoO1xuICAgIHRoaXMuaXRlbUhvbGRlciA9IG5ldyBSZWZIb2xkZXIoKTtcbiAgfVxuXG4gIGdldFVSSSgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXRjaC5nZXRVUkkoKTtcbiAgfVxuXG4gIGNyZWF0ZShleHRyYSA9IHt9KSB7XG4gICAgY29uc3QgaCA9IHRoaXMuaXRlbUhvbGRlci5pc0VtcHR5KCkgPyBudWxsIDogdGhpcy5pdGVtSG9sZGVyO1xuICAgIHJldHVybiBjcmVhdGVJdGVtKHRoaXMuZG9tTm9kZSwgaCwgdGhpcy5tYXRjaC5nZXRVUkkoKSwgZXh0cmEpO1xuICB9XG5cbiAgaHlkcmF0ZVN0dWIoZXh0cmEgPSB7fSkge1xuICAgIGlmICh0aGlzLnN0dWJJdGVtKSB7XG4gICAgICB0aGlzLnN0dWJJdGVtLnNldFJlYWxJdGVtKHRoaXMuY3JlYXRlKGV4dHJhKSk7XG4gICAgICB0aGlzLnN0dWJJdGVtID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhZGRDbGFzc05hbWUoY2xhc3NOYW1lKSB7XG4gICAgdGhpcy5kb21Ob2RlLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcbiAgfVxuXG4gIGdldEtleSgpIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxuXG4gIGdldFN0dWJQcm9wcygpIHtcbiAgICBjb25zdCBpdGVtUHJvcHMgPSB0aGlzLml0ZW1Ib2xkZXIubWFwKGl0ZW0gPT4gKHtcbiAgICAgIHRpdGxlOiBpdGVtLmdldFRpdGxlID8gaXRlbS5nZXRUaXRsZSgpIDogbnVsbCxcbiAgICAgIGljb25OYW1lOiBpdGVtLmdldEljb25OYW1lID8gaXRlbS5nZXRJY29uTmFtZSgpIDogbnVsbCxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4udGhpcy5zdHViUHJvcHMsXG4gICAgICAuLi5pdGVtUHJvcHMsXG4gICAgfTtcbiAgfVxuXG4gIG9uRm9jdXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbUhvbGRlci5tYXAoaXRlbSA9PiBpdGVtLmZvY3VzICYmIGl0ZW0uZm9jdXMoKSk7XG4gIH1cblxuICByZW5kZXJQb3J0YWwocmVuZGVyUHJvcCkge1xuICAgIHJldHVybiBSZWFjdERPTS5jcmVhdGVQb3J0YWwoXG4gICAgICByZW5kZXJQcm9wKHtcbiAgICAgICAgZGVzZXJpYWxpemVkOiB0aGlzLnN0dWJQcm9wcyxcbiAgICAgICAgaXRlbUhvbGRlcjogdGhpcy5pdGVtSG9sZGVyLFxuICAgICAgICBwYXJhbXM6IHRoaXMubWF0Y2guZ2V0UGFyYW1zKCksXG4gICAgICAgIHVyaTogdGhpcy5tYXRjaC5nZXRVUkkoKSxcbiAgICAgIH0pLFxuICAgICAgdGhpcy5kb21Ob2RlLFxuICAgICk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyx1QkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsVUFBQSxHQUFBRCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUksU0FBQSxHQUFBSixPQUFBO0FBRUEsSUFBQUssV0FBQSxHQUFBTix1QkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQU0sVUFBQSxHQUFBSixzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQU8sU0FBQSxHQUFBTCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQVEsUUFBQSxHQUFBUixPQUFBO0FBQWdELFNBQUFFLHVCQUFBTyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcseUJBQUFDLENBQUEsNkJBQUFDLE9BQUEsbUJBQUFDLENBQUEsT0FB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