"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _underscorePlus = require("underscore-plus");
var _eventKit = require("event-kit");
var _helpers = require("../helpers");
var _propTypes2 = require("../prop-types");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class Keystroke extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _helpers.autobind)(this, 'didChangeTarget');
    this.sub = new _eventKit.Disposable();
    this.state = {
      keybinding: null
    };
  }
  componentDidMount() {
    this.observeTarget();
  }
  componentDidUpdate(prevProps, prevState) {
    if (this.props.refTarget !== prevProps.refTarget) {
      this.observeTarget();
    } else if (this.props.command !== prevProps.command) {
      this.didChangeTarget(this.props.refTarget.getOr(null));
    }
  }
  componentWillUnmount() {
    this.sub.dispose();
  }
  render() {
    if (!this.state.keybinding) {
      return null;
    }
    return _react.default.createElement("span", {
      className: "keystroke"
    }, (0, _underscorePlus.humanizeKeystroke)(this.state.keybinding.keystrokes));
  }
  observeTarget() {
    this.sub.dispose();
    if (this.props.refTarget) {
      this.sub = this.props.refTarget.observe(this.didChangeTarget);
    } else {
      this.didChangeTarget(null);
    }
  }
  didChangeTarget(target) {
    const [keybinding] = this.props.keymaps.findKeyBindings({
      command: this.props.command,
      target
    });
    this.setState({
      keybinding
    });
  }
}
exports.default = Keystroke;
_defineProperty(Keystroke, "propTypes", {
  keymaps: _propTypes.default.shape({
    findKeyBindings: _propTypes.default.func.isRequired
  }).isRequired,
  command: _propTypes.default.string.isRequired,
  refTarget: _propTypes2.RefHolderPropType
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfdW5kZXJzY29yZVBsdXMiLCJfZXZlbnRLaXQiLCJfaGVscGVycyIsIl9wcm9wVHlwZXMyIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJhcmciLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJpbnB1dCIsImhpbnQiLCJwcmltIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJ1bmRlZmluZWQiLCJyZXMiLCJjYWxsIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiS2V5c3Ryb2tlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiYXV0b2JpbmQiLCJzdWIiLCJEaXNwb3NhYmxlIiwic3RhdGUiLCJrZXliaW5kaW5nIiwiY29tcG9uZW50RGlkTW91bnQiLCJvYnNlcnZlVGFyZ2V0IiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwicHJldlN0YXRlIiwicmVmVGFyZ2V0IiwiY29tbWFuZCIsImRpZENoYW5nZVRhcmdldCIsImdldE9yIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwicmVuZGVyIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsImh1bWFuaXplS2V5c3Ryb2tlIiwia2V5c3Ryb2tlcyIsIm9ic2VydmUiLCJ0YXJnZXQiLCJrZXltYXBzIiwiZmluZEtleUJpbmRpbmdzIiwic2V0U3RhdGUiLCJleHBvcnRzIiwiUHJvcFR5cGVzIiwic2hhcGUiLCJmdW5jIiwiaXNSZXF1aXJlZCIsInN0cmluZyIsIlJlZkhvbGRlclByb3BUeXBlIl0sInNvdXJjZXMiOlsia2V5c3Ryb2tlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtodW1hbml6ZUtleXN0cm9rZX0gZnJvbSAndW5kZXJzY29yZS1wbHVzJztcbmltcG9ydCB7RGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcblxuaW1wb3J0IHthdXRvYmluZH0gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQge1JlZkhvbGRlclByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgS2V5c3Ryb2tlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBrZXltYXBzOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgZmluZEtleUJpbmRpbmdzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgY29tbWFuZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHJlZlRhcmdldDogUmVmSG9sZGVyUHJvcFR5cGUsXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICBhdXRvYmluZCh0aGlzLCAnZGlkQ2hhbmdlVGFyZ2V0Jyk7XG5cbiAgICB0aGlzLnN1YiA9IG5ldyBEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5zdGF0ZSA9IHtrZXliaW5kaW5nOiBudWxsfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMub2JzZXJ2ZVRhcmdldCgpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcywgcHJldlN0YXRlKSB7XG4gICAgaWYgKHRoaXMucHJvcHMucmVmVGFyZ2V0ICE9PSBwcmV2UHJvcHMucmVmVGFyZ2V0KSB7XG4gICAgICB0aGlzLm9ic2VydmVUYXJnZXQoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMuY29tbWFuZCAhPT0gcHJldlByb3BzLmNvbW1hbmQpIHtcbiAgICAgIHRoaXMuZGlkQ2hhbmdlVGFyZ2V0KHRoaXMucHJvcHMucmVmVGFyZ2V0LmdldE9yKG51bGwpKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnN1Yi5kaXNwb3NlKCk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLmtleWJpbmRpbmcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiA8c3BhbiBjbGFzc05hbWU9XCJrZXlzdHJva2VcIj57aHVtYW5pemVLZXlzdHJva2UodGhpcy5zdGF0ZS5rZXliaW5kaW5nLmtleXN0cm9rZXMpfTwvc3Bhbj47XG4gIH1cblxuICBvYnNlcnZlVGFyZ2V0KCkge1xuICAgIHRoaXMuc3ViLmRpc3Bvc2UoKTtcbiAgICBpZiAodGhpcy5wcm9wcy5yZWZUYXJnZXQpIHtcbiAgICAgIHRoaXMuc3ViID0gdGhpcy5wcm9wcy5yZWZUYXJnZXQub2JzZXJ2ZSh0aGlzLmRpZENoYW5nZVRhcmdldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGlkQ2hhbmdlVGFyZ2V0KG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIGRpZENoYW5nZVRhcmdldCh0YXJnZXQpIHtcbiAgICBjb25zdCBba2V5YmluZGluZ10gPSB0aGlzLnByb3BzLmtleW1hcHMuZmluZEtleUJpbmRpbmdzKHtcbiAgICAgIGNvbW1hbmQ6IHRoaXMucHJvcHMuY29tbWFuZCxcbiAgICAgIHRhcmdldCxcbiAgICB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHtrZXliaW5kaW5nfSk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsVUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsZUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSCxPQUFBO0FBRUEsSUFBQUksUUFBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssV0FBQSxHQUFBTCxPQUFBO0FBQWdELFNBQUFELHVCQUFBTyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsZ0JBQUFILEdBQUEsRUFBQUksR0FBQSxFQUFBQyxLQUFBLElBQUFELEdBQUEsR0FBQUUsY0FBQSxDQUFBRixHQUFBLE9BQUFBLEdBQUEsSUFBQUosR0FBQSxJQUFBTyxNQUFBLENBQUFDLGNBQUEsQ0FBQVIsR0FBQSxFQUFBSSxHQUFBLElBQUFDLEtBQUEsRUFBQUEsS0FBQSxFQUFBSSxVQUFBLFFBQUFDLFlBQUEsUUFBQUMsUUFBQSxvQkFBQVgsR0FBQSxDQUFBSSxHQUFBLElBQUFDLEtBQUEsV0FBQUwsR0FBQTtBQUFBLFNBQUFNLGVBQUFNLEdBQUEsUUFBQVIsR0FBQSxHQUFBUyxZQUFBLENBQUFELEdBQUEsMkJBQUFSLEdBQUEsZ0JBQUFBLEdBQUEsR0FBQVUsTUFBQSxDQUFBVixHQUFBO0FBQUEsU0FBQVMsYUFBQUUsS0FBQSxFQUFBQyxJQUFBLGVBQUFELEtBQUEsaUJBQUFBLEtBQUEsa0JBQUFBLEtBQUEsTUFBQUUsSUFBQSxHQUFBRixLQUFBLENBQUFHLE1BQUEsQ0FBQUMsV0FBQSxPQUFBRixJQUFBLEtBQUFHLFNBQUEsUUFBQUMsR0FBQSxHQUFBSixJQUFBLENBQUFLLElBQUEsQ0FBQVAsS0FBQSxFQUFBQyxJQUFBLDJCQUFBSyxHQUFBLHNCQUFBQSxHQUFBLFlBQUFFLFNBQUEsNERBQUFQLElBQUEsZ0JBQUFGLE1BQUEsR0FBQVUsTUFBQSxFQUFBVCxLQUFBO0FBRWpDLE1BQU1VLFNBQVMsU0FBU0MsY0FBSyxDQUFDQyxTQUFTLENBQUM7RUFTckRDLFdBQVdBLENBQUNDLEtBQUssRUFBRTtJQUNqQixLQUFLLENBQUNBLEtBQUssQ0FBQztJQUNaLElBQUFDLGlCQUFRLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDO0lBRWpDLElBQUksQ0FBQ0MsR0FBRyxHQUFHLElBQUlDLG9CQUFVLENBQUMsQ0FBQztJQUMzQixJQUFJLENBQUNDLEtBQUssR0FBRztNQUFDQyxVQUFVLEVBQUU7SUFBSSxDQUFDO0VBQ2pDO0VBRUFDLGlCQUFpQkEsQ0FBQSxFQUFHO0lBQ2xCLElBQUksQ0FBQ0MsYUFBYSxDQUFDLENBQUM7RUFDdEI7RUFFQUMsa0JBQWtCQSxDQUFDQyxTQUFTLEVBQUVDLFNBQVMsRUFBRTtJQUN2QyxJQUFJLElBQUksQ0FBQ1YsS0FBSyxDQUFDVyxTQUFTLEtBQUtGLFNBQVMsQ0FBQ0UsU0FBUyxFQUFFO01BQ2hELElBQUksQ0FBQ0osYUFBYSxDQUFDLENBQUM7SUFDdEIsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDUCxLQUFLLENBQUNZLE9BQU8sS0FBS0gsU0FBUyxDQUFDRyxPQUFPLEVBQUU7TUFDbkQsSUFBSSxDQUFDQyxlQUFlLENBQUMsSUFBSSxDQUFDYixLQUFLLENBQUNXLFNBQVMsQ0FBQ0csS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hEO0VBQ0Y7RUFFQUMsb0JBQW9CQSxDQUFBLEVBQUc7SUFDckIsSUFBSSxDQUFDYixHQUFHLENBQUNjLE9BQU8sQ0FBQyxDQUFDO0VBQ3BCO0VBRUFDLE1BQU1BLENBQUEsRUFBRztJQUNQLElBQUksQ0FBQyxJQUFJLENBQUNiLEtBQUssQ0FBQ0MsVUFBVSxFQUFFO01BQzFCLE9BQU8sSUFBSTtJQUNiO0lBRUEsT0FBTzFDLE1BQUEsQ0FBQVUsT0FBQSxDQUFBNkMsYUFBQTtNQUFNQyxTQUFTLEVBQUM7SUFBVyxHQUFFLElBQUFDLGlDQUFpQixFQUFDLElBQUksQ0FBQ2hCLEtBQUssQ0FBQ0MsVUFBVSxDQUFDZ0IsVUFBVSxDQUFRLENBQUM7RUFDakc7RUFFQWQsYUFBYUEsQ0FBQSxFQUFHO0lBQ2QsSUFBSSxDQUFDTCxHQUFHLENBQUNjLE9BQU8sQ0FBQyxDQUFDO0lBQ2xCLElBQUksSUFBSSxDQUFDaEIsS0FBSyxDQUFDVyxTQUFTLEVBQUU7TUFDeEIsSUFBSSxDQUFDVCxHQUFHLEdBQUcsSUFBSSxDQUFDRixLQUFLLENBQUNXLFNBQVMsQ0FBQ1csT0FBTyxDQUFDLElBQUksQ0FBQ1QsZUFBZSxDQUFDO0lBQy9ELENBQUMsTUFBTTtNQUNMLElBQUksQ0FBQ0EsZUFBZSxDQUFDLElBQUksQ0FBQztJQUM1QjtFQUNGO0VBRUFBLGVBQWVBLENBQUNVLE1BQU0sRUFBRTtJQUN0QixNQUFNLENBQUNsQixVQUFVLENBQUMsR0FBRyxJQUFJLENBQUNMLEtBQUssQ0FBQ3dCLE9BQU8sQ0FBQ0MsZUFBZSxDQUFDO01BQ3REYixPQUFPLEVBQUUsSUFBSSxDQUFDWixLQUFLLENBQUNZLE9BQU87TUFDM0JXO0lBQ0YsQ0FBQyxDQUFDO0lBQ0YsSUFBSSxDQUFDRyxRQUFRLENBQUM7TUFBQ3JCO0lBQVUsQ0FBQyxDQUFDO0VBQzdCO0FBQ0Y7QUFBQ3NCLE9BQUEsQ0FBQXRELE9BQUEsR0FBQXVCLFNBQUE7QUFBQXRCLGVBQUEsQ0F6RG9Cc0IsU0FBUyxlQUNUO0VBQ2pCNEIsT0FBTyxFQUFFSSxrQkFBUyxDQUFDQyxLQUFLLENBQUM7SUFDdkJKLGVBQWUsRUFBRUcsa0JBQVMsQ0FBQ0UsSUFBSSxDQUFDQztFQUNsQyxDQUFDLENBQUMsQ0FBQ0EsVUFBVTtFQUNibkIsT0FBTyxFQUFFZ0Isa0JBQVMsQ0FBQ0ksTUFBTSxDQUFDRCxVQUFVO0VBQ3BDcEIsU0FBUyxFQUFFc0I7QUFDYixDQUFDIn0=