"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Command = exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _propTypes2 = require("../prop-types");
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class Commands extends _react.default.Component {
  render() {
    const {
      registry,
      target
    } = this.props;
    return _react.default.createElement("div", null, _react.default.Children.map(this.props.children, child => {
      return child ? _react.default.cloneElement(child, {
        registry,
        target
      }) : null;
    }));
  }
}
exports.default = Commands;
_defineProperty(Commands, "propTypes", {
  registry: _propTypes.default.object.isRequired,
  target: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes2.DOMNodePropType, _propTypes2.RefHolderPropType]).isRequired,
  children: _propTypes.default.oneOfType([_propTypes.default.element, _propTypes.default.arrayOf(_propTypes.default.element)]).isRequired
});
class Command extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    this.subTarget = new _eventKit.Disposable();
    this.subCommand = new _eventKit.Disposable();
  }
  componentDidMount() {
    this.observeTarget(this.props);
  }
  componentWillReceiveProps(newProps) {
    if (['registry', 'target', 'command', 'callback'].some(p => newProps[p] !== this.props[p])) {
      this.observeTarget(newProps);
    }
  }
  componentWillUnmount() {
    this.subTarget.dispose();
    this.subCommand.dispose();
  }
  observeTarget(props) {
    this.subTarget.dispose();
    this.subTarget = _refHolder.default.on(props.target).observe(t => this.registerCommand(t, props));
  }
  registerCommand(target, {
    registry,
    command,
    callback
  }) {
    this.subCommand.dispose();
    this.subCommand = registry.add(target, command, callback);
  }
  render() {
    return null;
  }
}
exports.Command = Command;
_defineProperty(Command, "propTypes", {
  registry: _propTypes.default.object,
  target: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes2.DOMNodePropType, _propTypes2.RefHolderPropType]),
  command: _propTypes.default.string.isRequired,
  callback: _propTypes.default.func.isRequired
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfZXZlbnRLaXQiLCJfcHJvcFR5cGVzMiIsIl9yZWZIb2xkZXIiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9kZWZpbmVQcm9wZXJ0eSIsImtleSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImFyZyIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsImlucHV0IiwiaGludCIsInByaW0iLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsInVuZGVmaW5lZCIsInJlcyIsImNhbGwiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJDb21tYW5kcyIsIlJlYWN0IiwiQ29tcG9uZW50IiwicmVuZGVyIiwicmVnaXN0cnkiLCJ0YXJnZXQiLCJwcm9wcyIsImNyZWF0ZUVsZW1lbnQiLCJDaGlsZHJlbiIsIm1hcCIsImNoaWxkcmVuIiwiY2hpbGQiLCJjbG9uZUVsZW1lbnQiLCJleHBvcnRzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsIm9uZU9mVHlwZSIsInN0cmluZyIsIkRPTU5vZGVQcm9wVHlwZSIsIlJlZkhvbGRlclByb3BUeXBlIiwiZWxlbWVudCIsImFycmF5T2YiLCJDb21tYW5kIiwiY29uc3RydWN0b3IiLCJjb250ZXh0Iiwic3ViVGFyZ2V0IiwiRGlzcG9zYWJsZSIsInN1YkNvbW1hbmQiLCJjb21wb25lbnREaWRNb3VudCIsIm9ic2VydmVUYXJnZXQiLCJjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwibmV3UHJvcHMiLCJzb21lIiwicCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsIlJlZkhvbGRlciIsIm9uIiwib2JzZXJ2ZSIsInQiLCJyZWdpc3RlckNvbW1hbmQiLCJjb21tYW5kIiwiY2FsbGJhY2siLCJhZGQiLCJmdW5jIl0sInNvdXJjZXMiOlsiY29tbWFuZHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQge0Rpc3Bvc2FibGV9IGZyb20gJ2V2ZW50LWtpdCc7XG5cbmltcG9ydCB7RE9NTm9kZVByb3BUeXBlLCBSZWZIb2xkZXJQcm9wVHlwZX0gZnJvbSAnLi4vcHJvcC10eXBlcyc7XG5pbXBvcnQgUmVmSG9sZGVyIGZyb20gJy4uL21vZGVscy9yZWYtaG9sZGVyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29tbWFuZHMgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHJlZ2lzdHJ5OiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdGFyZ2V0OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICBET01Ob2RlUHJvcFR5cGUsXG4gICAgICBSZWZIb2xkZXJQcm9wVHlwZSxcbiAgICBdKS5pc1JlcXVpcmVkLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIFByb3BUeXBlcy5lbGVtZW50LFxuICAgICAgUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLmVsZW1lbnQpLFxuICAgIF0pLmlzUmVxdWlyZWQsXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge3JlZ2lzdHJ5LCB0YXJnZXR9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdj5cbiAgICAgICAge1JlYWN0LkNoaWxkcmVuLm1hcCh0aGlzLnByb3BzLmNoaWxkcmVuLCBjaGlsZCA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNoaWxkID8gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkLCB7cmVnaXN0cnksIHRhcmdldH0pIDogbnVsbDtcbiAgICAgICAgfSl9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb21tYW5kIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICByZWdpc3RyeTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICB0YXJnZXQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIERPTU5vZGVQcm9wVHlwZSxcbiAgICAgIFJlZkhvbGRlclByb3BUeXBlLFxuICAgIF0pLFxuICAgIGNvbW1hbmQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBjYWxsYmFjazogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuICAgIHRoaXMuc3ViVGFyZ2V0ID0gbmV3IERpc3Bvc2FibGUoKTtcbiAgICB0aGlzLnN1YkNvbW1hbmQgPSBuZXcgRGlzcG9zYWJsZSgpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5vYnNlcnZlVGFyZ2V0KHRoaXMucHJvcHMpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXdQcm9wcykge1xuICAgIGlmIChbJ3JlZ2lzdHJ5JywgJ3RhcmdldCcsICdjb21tYW5kJywgJ2NhbGxiYWNrJ10uc29tZShwID0+IG5ld1Byb3BzW3BdICE9PSB0aGlzLnByb3BzW3BdKSkge1xuICAgICAgdGhpcy5vYnNlcnZlVGFyZ2V0KG5ld1Byb3BzKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnN1YlRhcmdldC5kaXNwb3NlKCk7XG4gICAgdGhpcy5zdWJDb21tYW5kLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIG9ic2VydmVUYXJnZXQocHJvcHMpIHtcbiAgICB0aGlzLnN1YlRhcmdldC5kaXNwb3NlKCk7XG4gICAgdGhpcy5zdWJUYXJnZXQgPSBSZWZIb2xkZXIub24ocHJvcHMudGFyZ2V0KS5vYnNlcnZlKHQgPT4gdGhpcy5yZWdpc3RlckNvbW1hbmQodCwgcHJvcHMpKTtcbiAgfVxuXG4gIHJlZ2lzdGVyQ29tbWFuZCh0YXJnZXQsIHtyZWdpc3RyeSwgY29tbWFuZCwgY2FsbGJhY2t9KSB7XG4gICAgdGhpcy5zdWJDb21tYW5kLmRpc3Bvc2UoKTtcbiAgICB0aGlzLnN1YkNvbW1hbmQgPSByZWdpc3RyeS5hZGQodGFyZ2V0LCBjb21tYW5kLCBjYWxsYmFjayk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsVUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsU0FBQSxHQUFBRixPQUFBO0FBRUEsSUFBQUcsV0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksVUFBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQTZDLFNBQUFELHVCQUFBTSxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsZ0JBQUFILEdBQUEsRUFBQUksR0FBQSxFQUFBQyxLQUFBLElBQUFELEdBQUEsR0FBQUUsY0FBQSxDQUFBRixHQUFBLE9BQUFBLEdBQUEsSUFBQUosR0FBQSxJQUFBTyxNQUFBLENBQUFDLGNBQUEsQ0FBQVIsR0FBQSxFQUFBSSxHQUFBLElBQUFDLEtBQUEsRUFBQUEsS0FBQSxFQUFBSSxVQUFBLFFBQUFDLFlBQUEsUUFBQUMsUUFBQSxvQkFBQVgsR0FBQSxDQUFBSSxHQUFBLElBQUFDLEtBQUEsV0FBQUwsR0FBQTtBQUFBLFNBQUFNLGVBQUFNLEdBQUEsUUFBQVIsR0FBQSxHQUFBUyxZQUFBLENB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