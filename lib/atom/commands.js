"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Command = exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _propTypes2 = require("../prop-types");
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
class Commands extends _react.default.Component {
  render() {
    const {
      registry,
      target
    } = this.props;
    return _react.default.createElement("div", null, _react.default.Children.map(this.props.children, child => {
      return child ? _react.default.cloneElement(child, {
        registry,
        target
      }) : null;
    }));
  }
}
exports.default = Commands;
_defineProperty(Commands, "propTypes", {
  registry: _propTypes.default.object.isRequired,
  target: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes2.DOMNodePropType, _propTypes2.RefHolderPropType]).isRequired,
  children: _propTypes.default.oneOfType([_propTypes.default.element, _propTypes.default.arrayOf(_propTypes.default.element)]).isRequired
});
class Command extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    this.subTarget = new _eventKit.Disposable();
    this.subCommand = new _eventKit.Disposable();
  }
  componentDidMount() {
    this.observeTarget(this.props);
  }
  componentWillReceiveProps(newProps) {
    if (['registry', 'target', 'command', 'callback'].some(p => newProps[p] !== this.props[p])) {
      this.observeTarget(newProps);
    }
  }
  componentWillUnmount() {
    this.subTarget.dispose();
    this.subCommand.dispose();
  }
  observeTarget(props) {
    this.subTarget.dispose();
    this.subTarget = _refHolder.default.on(props.target).observe(t => this.registerCommand(t, props));
  }
  registerCommand(target, {
    registry,
    command,
    callback
  }) {
    this.subCommand.dispose();
    this.subCommand = registry.add(target, command, callback);
  }
  render() {
    return null;
  }
}
exports.Command = Command;
_defineProperty(Command, "propTypes", {
  registry: _propTypes.default.object,
  target: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes2.DOMNodePropType, _propTypes2.RefHolderPropType]),
  command: _propTypes.default.string.isRequired,
  callback: _propTypes.default.func.isRequired
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfZXZlbnRLaXQiLCJfcHJvcFR5cGVzMiIsIl9yZWZIb2xkZXIiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9kZWZpbmVQcm9wZXJ0eSIsImtleSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsInQiLCJpIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiciIsImUiLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsImNhbGwiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJDb21tYW5kcyIsIlJlYWN0IiwiQ29tcG9uZW50IiwicmVuZGVyIiwicmVnaXN0cnkiLCJ0YXJnZXQiLCJwcm9wcyIsImNyZWF0ZUVsZW1lbnQiLCJDaGlsZHJlbiIsIm1hcCIsImNoaWxkcmVuIiwiY2hpbGQiLCJjbG9uZUVsZW1lbnQiLCJleHBvcnRzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsIm9uZU9mVHlwZSIsInN0cmluZyIsIkRPTU5vZGVQcm9wVHlwZSIsIlJlZkhvbGRlclByb3BUeXBlIiwiZWxlbWVudCIsImFycmF5T2YiLCJDb21tYW5kIiwiY29uc3RydWN0b3IiLCJjb250ZXh0Iiwic3ViVGFyZ2V0IiwiRGlzcG9zYWJsZSIsInN1YkNvbW1hbmQiLCJjb21wb25lbnREaWRNb3VudCIsIm9ic2VydmVUYXJnZXQiLCJjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwibmV3UHJvcHMiLCJzb21lIiwicCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsIlJlZkhvbGRlciIsIm9uIiwib2JzZXJ2ZSIsInJlZ2lzdGVyQ29tbWFuZCIsImNvbW1hbmQiLCJjYWxsYmFjayIsImFkZCIsImZ1bmMiXSwic291cmNlcyI6WyJjb21tYW5kcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7RGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcblxuaW1wb3J0IHtET01Ob2RlUHJvcFR5cGUsIFJlZkhvbGRlclByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcbmltcG9ydCBSZWZIb2xkZXIgZnJvbSAnLi4vbW9kZWxzL3JlZi1ob2xkZXInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21tYW5kcyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgcmVnaXN0cnk6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB0YXJnZXQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIERPTU5vZGVQcm9wVHlwZSxcbiAgICAgIFJlZkhvbGRlclByb3BUeXBlLFxuICAgIF0pLmlzUmVxdWlyZWQsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLmVsZW1lbnQsXG4gICAgICBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuZWxlbWVudCksXG4gICAgXSkuaXNSZXF1aXJlZCxcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7cmVnaXN0cnksIHRhcmdldH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2PlxuICAgICAgICB7UmVhY3QuQ2hpbGRyZW4ubWFwKHRoaXMucHJvcHMuY2hpbGRyZW4sIGNoaWxkID0+IHtcbiAgICAgICAgICByZXR1cm4gY2hpbGQgPyBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGQsIHtyZWdpc3RyeSwgdGFyZ2V0fSkgOiBudWxsO1xuICAgICAgICB9KX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbW1hbmQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHJlZ2lzdHJ5OiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHRhcmdldDogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgRE9NTm9kZVByb3BUeXBlLFxuICAgICAgUmVmSG9sZGVyUHJvcFR5cGUsXG4gICAgXSksXG4gICAgY29tbWFuZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGNhbGxiYWNrOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG4gICAgdGhpcy5zdWJUYXJnZXQgPSBuZXcgRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuc3ViQ29tbWFuZCA9IG5ldyBEaXNwb3NhYmxlKCk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLm9ic2VydmVUYXJnZXQodGhpcy5wcm9wcyk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5ld1Byb3BzKSB7XG4gICAgaWYgKFsncmVnaXN0cnknLCAndGFyZ2V0JywgJ2NvbW1hbmQnLCAnY2FsbGJhY2snXS5zb21lKHAgPT4gbmV3UHJvcHNbcF0gIT09IHRoaXMucHJvcHNbcF0pKSB7XG4gICAgICB0aGlzLm9ic2VydmVUYXJnZXQobmV3UHJvcHMpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuc3ViVGFyZ2V0LmRpc3Bvc2UoKTtcbiAgICB0aGlzLnN1YkNvbW1hbmQuZGlzcG9zZSgpO1xuICB9XG5cbiAgb2JzZXJ2ZVRhcmdldChwcm9wcykge1xuICAgIHRoaXMuc3ViVGFyZ2V0LmRpc3Bvc2UoKTtcbiAgICB0aGlzLnN1YlRhcmdldCA9IFJlZkhvbGRlci5vbihwcm9wcy50YXJnZXQpLm9ic2VydmUodCA9PiB0aGlzLnJlZ2lzdGVyQ29tbWFuZCh0LCBwcm9wcykpO1xuICB9XG5cbiAgcmVnaXN0ZXJDb21tYW5kKHRhcmdldCwge3JlZ2lzdHJ5LCBjb21tYW5kLCBjYWxsYmFja30pIHtcbiAgICB0aGlzLnN1YkNvbW1hbmQuZGlzcG9zZSgpO1xuICAgIHRoaXMuc3ViQ29tbWFuZCA9IHJlZ2lzdHJ5LmFkZCh0YXJnZXQsIGNvbW1hbmQsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxVQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxTQUFBLEdBQUFGLE9BQUE7QUFFQSxJQUFBRyxXQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxVQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFBNkMsU0FBQUQsdUJBQUFNLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFBQSxTQUFBRyxnQkFBQUgsR0FBQSxFQUFBSSxHQUFBLEVBQUFDLEtBQUEsSUFBQUQsR0FBQSxHQUFBRSxjQUFBLENBQUFGLEdBQUEsT0FBQUEsR0FBQSxJQUFBSixHQUFBLElBQUFPLE1BQUEsQ0FBQUMsY0FBQSxDQUFBUixHQUFBLEVBQUFJLEdBQUEsSUFBQUMsS0FBQSxFQUFBQSxLQUFBLEVBQUFJLFVBQUEsUUFBQUMsWUFBQSxRQUFBQyxRQUFBLG9CQUFBWCxHQUFBLENBQUFJLEdBQUEsSUFBQUMsS0FBQSxXQUFBTCxHQUFBO0FBQUEsU0FBQU0sZUFBQU0sQ0FBQSxRQUFBQyxDQUFBLEdBQUFDLFlBQUEsQ0FBQUYsQ0FBQSx1Q0FBQUMsQ0FBQSxHQUFBQSxDQUFBLEdB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