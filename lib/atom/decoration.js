"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _classnames = _interopRequireDefault(require("classnames"));
var _helpers = require("../helpers");
var _propTypes2 = require("../prop-types");
var _atomTextEditor = require("./atom-text-editor");
var _marker = require("./marker");
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const decorationPropTypes = {
  type: _propTypes.default.oneOf(['line', 'line-number', 'highlight', 'overlay', 'gutter', 'block']).isRequired,
  className: _propTypes.default.string,
  style: _propTypes.default.string,
  onlyHead: _propTypes.default.bool,
  onlyEmpty: _propTypes.default.bool,
  onlyNonEmpty: _propTypes.default.bool,
  omitEmptyLastRow: _propTypes.default.bool,
  position: _propTypes.default.oneOf(['head', 'tail', 'before', 'after']),
  order: _propTypes.default.number,
  avoidOverflow: _propTypes.default.bool,
  gutterName: _propTypes.default.string
};
class BareDecoration extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "observeParents", () => {
      this.decorationHolder.map(decoration => decoration.destroy());
      const editorValid = this.props.editorHolder.map(editor => !editor.isDestroyed()).getOr(false);
      const decorableValid = this.props.decorableHolder.map(decorable => !decorable.isDestroyed()).getOr(false);

      // Ensure the Marker or MarkerLayer corresponds to the context's TextEditor
      const decorableMatches = this.props.decorableHolder.map(decorable => this.props.editorHolder.map(editor => {
        const layer = decorable.layer || decorable;
        const displayLayer = editor.getMarkerLayer(layer.id);
        if (!displayLayer) {
          return false;
        }
        if (displayLayer !== layer && displayLayer.bufferMarkerLayer !== layer) {
          return false;
        }
        return true;
      }).getOr(false)).getOr(false);
      if (!editorValid || !decorableValid || !decorableMatches) {
        return;
      }

      // delay decoration creation when it's a gutter type;
      // instead wait for the Gutter to be added to the editor first
      if (this.props.type === 'gutter') {
        if (!this.props.gutterName) {
          throw new Error('You are trying to decorate a gutter but did not supply gutterName prop.');
        }
        this.props.editorHolder.map(editor => {
          this.gutterSub = editor.observeGutters(gutter => {
            if (gutter.name === this.props.gutterName) {
              this.createDecoration();
            }
          });
          return null;
        });
        return;
      }
      this.createDecoration();
    });
    this.decorationHolder = new _refHolder.default();
    this.editorSub = new _eventKit.Disposable();
    this.decorableSub = new _eventKit.Disposable();
    this.gutterSub = new _eventKit.Disposable();
    this.domNode = null;
    this.item = null;
    if (['gutter', 'overlay', 'block'].includes(this.props.type)) {
      this.domNode = document.createElement('div');
      this.domNode.className = (0, _classnames.default)('react-atom-decoration', this.props.className);
    }
  }
  usesItem() {
    return this.domNode !== null;
  }
  componentDidMount() {
    this.editorSub = this.props.editorHolder.observe(this.observeParents);
    this.decorableSub = this.props.decorableHolder.observe(this.observeParents);
  }
  componentDidUpdate(prevProps) {
    if (this.props.editorHolder !== prevProps.editorHolder) {
      this.editorSub.dispose();
      this.editorSub = this.props.editorHolder.observe(this.observeParents);
    }
    if (this.props.decorableHolder !== prevProps.decorableHolder) {
      this.decorableSub.dispose();
      this.decorableSub = this.props.decorableHolder.observe(this.observeParents);
    }
    if (Object.keys(decorationPropTypes).some(key => this.props[key] !== prevProps[key])) {
      this.decorationHolder.map(decoration => decoration.destroy());
      this.createDecoration();
    }
  }
  render() {
    if (this.usesItem()) {
      return _reactDom.default.createPortal(this.props.children, this.domNode);
    } else {
      return null;
    }
  }
  createDecoration() {
    if (this.usesItem() && !this.item) {
      this.item = (0, _helpers.createItem)(this.domNode, this.props.itemHolder);
    }
    const opts = this.getDecorationOpts(this.props);
    const editor = this.props.editorHolder.get();
    const decorable = this.props.decorableHolder.get();
    this.decorationHolder.setter(editor[this.props.decorateMethod](decorable, opts));
  }
  componentWillUnmount() {
    this.decorationHolder.map(decoration => decoration.destroy());
    this.editorSub.dispose();
    this.decorableSub.dispose();
    this.gutterSub.dispose();
  }
  getDecorationOpts(props) {
    return _objectSpread({}, (0, _helpers.extractProps)(props, decorationPropTypes, {
      className: 'class'
    }), {
      item: this.item
    });
  }
}
_defineProperty(BareDecoration, "propTypes", _objectSpread({
  editorHolder: _propTypes2.RefHolderPropType.isRequired,
  decorableHolder: _propTypes2.RefHolderPropType.isRequired,
  decorateMethod: _propTypes.default.oneOf(['decorateMarker', 'decorateMarkerLayer']),
  itemHolder: _propTypes2.RefHolderPropType,
  children: _propTypes.default.node
}, decorationPropTypes));
_defineProperty(BareDecoration, "defaultProps", {
  decorateMethod: 'decorateMarker'
});
class Decoration extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = {
      editorHolder: _refHolder.default.on(this.props.editor),
      decorableHolder: _refHolder.default.on(this.props.decorable)
    };
  }
  static getDerivedStateFromProps(props, state) {
    const editorChanged = state.editorHolder.map(editor => editor !== props.editor).getOr(props.editor !== undefined);
    const decorableChanged = state.decorableHolder.map(decorable => decorable !== props.decorable).getOr(props.decorable !== undefined);
    if (!editorChanged && !decorableChanged) {
      return null;
    }
    const nextState = {};
    if (editorChanged) {
      nextState.editorHolder = _refHolder.default.on(props.editor);
    }
    if (decorableChanged) {
      nextState.decorableHolder = _refHolder.default.on(props.decorable);
    }
    return nextState;
  }
  render() {
    return _react.default.createElement(_atomTextEditor.TextEditorContext.Consumer, null, editorHolder => _react.default.createElement(_marker.DecorableContext.Consumer, null, decorable => {
      let holder = null;
      let decorateMethod = null;
      if (!this.state.decorableHolder.isEmpty()) {
        holder = this.state.decorableHolder;
        decorateMethod = this.props.decorateMethod;
      } else {
        holder = decorable.holder;
        decorateMethod = decorable.decorateMethod;
      }
      return _react.default.createElement(BareDecoration, _extends({
        editorHolder: editorHolder || this.state.editorHolder,
        decorableHolder: holder,
        decorateMethod: decorateMethod
      }, this.props));
    }));
  }
}
exports.default = Decoration;
_defineProperty(Decoration, "propTypes", {
  editor: _propTypes.default.object,
  decorable: _propTypes.default.object,
  decorateMethod: _propTypes.default.oneOf(['decorateMarker', 'decorateMarkerLayer'])
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZWNvcmF0aW9uUHJvcFR5cGVzIiwidHlwZSIsIlByb3BUeXBlcyIsIm9uZU9mIiwiaXNSZXF1aXJlZCIsImNsYXNzTmFtZSIsInN0cmluZyIsInN0eWxlIiwib25seUhlYWQiLCJib29sIiwib25seUVtcHR5Iiwib25seU5vbkVtcHR5Iiwib21pdEVtcHR5TGFzdFJvdyIsInBvc2l0aW9uIiwib3JkZXIiLCJudW1iZXIiLCJhdm9pZE92ZXJmbG93IiwiZ3V0dGVyTmFtZSIsIkJhcmVEZWNvcmF0aW9uIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsImRlY29yYXRpb25Ib2xkZXIiLCJtYXAiLCJkZWNvcmF0aW9uIiwiZGVzdHJveSIsImVkaXRvclZhbGlkIiwiZWRpdG9ySG9sZGVyIiwiZWRpdG9yIiwiaXNEZXN0cm95ZWQiLCJnZXRPciIsImRlY29yYWJsZVZhbGlkIiwiZGVjb3JhYmxlSG9sZGVyIiwiZGVjb3JhYmxlIiwiZGVjb3JhYmxlTWF0Y2hlcyIsImxheWVyIiwiZGlzcGxheUxheWVyIiwiZ2V0TWFya2VyTGF5ZXIiLCJpZCIsImJ1ZmZlck1hcmtlckxheWVyIiwiRXJyb3IiLCJndXR0ZXJTdWIiLCJvYnNlcnZlR3V0dGVycyIsImd1dHRlciIsIm5hbWUiLCJjcmVhdGVEZWNvcmF0aW9uIiwiUmVmSG9sZGVyIiwiZWRpdG9yU3ViIiwiRGlzcG9zYWJsZSIsImRlY29yYWJsZVN1YiIsImRvbU5vZGUiLCJpdGVtIiwiaW5jbHVkZXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjeCIsInVzZXNJdGVtIiwiY29tcG9uZW50RGlkTW91bnQiLCJvYnNlcnZlIiwib2JzZXJ2ZVBhcmVudHMiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJkaXNwb3NlIiwiT2JqZWN0Iiwia2V5cyIsInNvbWUiLCJrZXkiLCJyZW5kZXIiLCJSZWFjdERPTSIsImNyZWF0ZVBvcnRhbCIsImNoaWxkcmVuIiwiY3JlYXRlSXRlbSIsIml0ZW1Ib2xkZXIiLCJvcHRzIiwiZ2V0RGVjb3JhdGlvbk9wdHMiLCJnZXQiLCJzZXR0ZXIiLCJkZWNvcmF0ZU1ldGhvZCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZXh0cmFjdFByb3BzIiwiUmVmSG9sZGVyUHJvcFR5cGUiLCJub2RlIiwiRGVjb3JhdGlvbiIsInN0YXRlIiwib24iLCJnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMiLCJlZGl0b3JDaGFuZ2VkIiwidW5kZWZpbmVkIiwiZGVjb3JhYmxlQ2hhbmdlZCIsIm5leHRTdGF0ZSIsImhvbGRlciIsImlzRW1wdHkiLCJvYmplY3QiXSwic291cmNlcyI6WyJkZWNvcmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQge0Rpc3Bvc2FibGV9IGZyb20gJ2V2ZW50LWtpdCc7XG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcyc7XG5cbmltcG9ydCB7Y3JlYXRlSXRlbSwgZXh0cmFjdFByb3BzfSBmcm9tICcuLi9oZWxwZXJzJztcbmltcG9ydCB7UmVmSG9sZGVyUHJvcFR5cGV9IGZyb20gJy4uL3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtUZXh0RWRpdG9yQ29udGV4dH0gZnJvbSAnLi9hdG9tLXRleHQtZWRpdG9yJztcbmltcG9ydCB7RGVjb3JhYmxlQ29udGV4dH0gZnJvbSAnLi9tYXJrZXInO1xuaW1wb3J0IFJlZkhvbGRlciBmcm9tICcuLi9tb2RlbHMvcmVmLWhvbGRlcic7XG5cbmNvbnN0IGRlY29yYXRpb25Qcm9wVHlwZXMgPSB7XG4gIHR5cGU6IFByb3BUeXBlcy5vbmVPZihbJ2xpbmUnLCAnbGluZS1udW1iZXInLCAnaGlnaGxpZ2h0JywgJ292ZXJsYXknLCAnZ3V0dGVyJywgJ2Jsb2NrJ10pLmlzUmVxdWlyZWQsXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgc3R5bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIG9ubHlIZWFkOiBQcm9wVHlwZXMuYm9vbCxcbiAgb25seUVtcHR5OiBQcm9wVHlwZXMuYm9vbCxcbiAgb25seU5vbkVtcHR5OiBQcm9wVHlwZXMuYm9vbCxcbiAgb21pdEVtcHR5TGFzdFJvdzogUHJvcFR5cGVzLmJvb2wsXG4gIHBvc2l0aW9uOiBQcm9wVHlwZXMub25lT2YoWydoZWFkJywgJ3RhaWwnLCAnYmVmb3JlJywgJ2FmdGVyJ10pLFxuICBvcmRlcjogUHJvcFR5cGVzLm51bWJlcixcbiAgYXZvaWRPdmVyZmxvdzogUHJvcFR5cGVzLmJvb2wsXG4gIGd1dHRlck5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG59O1xuXG5jbGFzcyBCYXJlRGVjb3JhdGlvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZWRpdG9ySG9sZGVyOiBSZWZIb2xkZXJQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgIGRlY29yYWJsZUhvbGRlcjogUmVmSG9sZGVyUHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICBkZWNvcmF0ZU1ldGhvZDogUHJvcFR5cGVzLm9uZU9mKFsnZGVjb3JhdGVNYXJrZXInLCAnZGVjb3JhdGVNYXJrZXJMYXllciddKSxcbiAgICBpdGVtSG9sZGVyOiBSZWZIb2xkZXJQcm9wVHlwZSxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG4gICAgLi4uZGVjb3JhdGlvblByb3BUeXBlcyxcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgZGVjb3JhdGVNZXRob2Q6ICdkZWNvcmF0ZU1hcmtlcicsXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcywgY29udGV4dCkge1xuICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcblxuICAgIHRoaXMuZGVjb3JhdGlvbkhvbGRlciA9IG5ldyBSZWZIb2xkZXIoKTtcbiAgICB0aGlzLmVkaXRvclN1YiA9IG5ldyBEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5kZWNvcmFibGVTdWIgPSBuZXcgRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuZ3V0dGVyU3ViID0gbmV3IERpc3Bvc2FibGUoKTtcblxuICAgIHRoaXMuZG9tTm9kZSA9IG51bGw7XG4gICAgdGhpcy5pdGVtID0gbnVsbDtcblxuICAgIGlmIChbJ2d1dHRlcicsICdvdmVybGF5JywgJ2Jsb2NrJ10uaW5jbHVkZXModGhpcy5wcm9wcy50eXBlKSkge1xuICAgICAgdGhpcy5kb21Ob2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICB0aGlzLmRvbU5vZGUuY2xhc3NOYW1lID0gY3goJ3JlYWN0LWF0b20tZGVjb3JhdGlvbicsIHRoaXMucHJvcHMuY2xhc3NOYW1lKTtcbiAgICB9XG4gIH1cblxuICB1c2VzSXRlbSgpIHtcbiAgICByZXR1cm4gdGhpcy5kb21Ob2RlICE9PSBudWxsO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5lZGl0b3JTdWIgPSB0aGlzLnByb3BzLmVkaXRvckhvbGRlci5vYnNlcnZlKHRoaXMub2JzZXJ2ZVBhcmVudHMpO1xuICAgIHRoaXMuZGVjb3JhYmxlU3ViID0gdGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIub2JzZXJ2ZSh0aGlzLm9ic2VydmVQYXJlbnRzKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIgIT09IHByZXZQcm9wcy5lZGl0b3JIb2xkZXIpIHtcbiAgICAgIHRoaXMuZWRpdG9yU3ViLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuZWRpdG9yU3ViID0gdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIub2JzZXJ2ZSh0aGlzLm9ic2VydmVQYXJlbnRzKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIgIT09IHByZXZQcm9wcy5kZWNvcmFibGVIb2xkZXIpIHtcbiAgICAgIHRoaXMuZGVjb3JhYmxlU3ViLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuZGVjb3JhYmxlU3ViID0gdGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIub2JzZXJ2ZSh0aGlzLm9ic2VydmVQYXJlbnRzKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBPYmplY3Qua2V5cyhkZWNvcmF0aW9uUHJvcFR5cGVzKS5zb21lKGtleSA9PiB0aGlzLnByb3BzW2tleV0gIT09IHByZXZQcm9wc1trZXldKVxuICAgICkge1xuICAgICAgdGhpcy5kZWNvcmF0aW9uSG9sZGVyLm1hcChkZWNvcmF0aW9uID0+IGRlY29yYXRpb24uZGVzdHJveSgpKTtcbiAgICAgIHRoaXMuY3JlYXRlRGVjb3JhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy51c2VzSXRlbSgpKSB7XG4gICAgICByZXR1cm4gUmVhY3RET00uY3JlYXRlUG9ydGFsKFxuICAgICAgICB0aGlzLnByb3BzLmNoaWxkcmVuLFxuICAgICAgICB0aGlzLmRvbU5vZGUsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBvYnNlcnZlUGFyZW50cyA9ICgpID0+IHtcbiAgICB0aGlzLmRlY29yYXRpb25Ib2xkZXIubWFwKGRlY29yYXRpb24gPT4gZGVjb3JhdGlvbi5kZXN0cm95KCkpO1xuXG4gICAgY29uc3QgZWRpdG9yVmFsaWQgPSB0aGlzLnByb3BzLmVkaXRvckhvbGRlci5tYXAoZWRpdG9yID0+ICFlZGl0b3IuaXNEZXN0cm95ZWQoKSkuZ2V0T3IoZmFsc2UpO1xuICAgIGNvbnN0IGRlY29yYWJsZVZhbGlkID0gdGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIubWFwKGRlY29yYWJsZSA9PiAhZGVjb3JhYmxlLmlzRGVzdHJveWVkKCkpLmdldE9yKGZhbHNlKTtcblxuICAgIC8vIEVuc3VyZSB0aGUgTWFya2VyIG9yIE1hcmtlckxheWVyIGNvcnJlc3BvbmRzIHRvIHRoZSBjb250ZXh0J3MgVGV4dEVkaXRvclxuICAgIGNvbnN0IGRlY29yYWJsZU1hdGNoZXMgPSB0aGlzLnByb3BzLmRlY29yYWJsZUhvbGRlci5tYXAoZGVjb3JhYmxlID0+IHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLm1hcChlZGl0b3IgPT4ge1xuICAgICAgY29uc3QgbGF5ZXIgPSBkZWNvcmFibGUubGF5ZXIgfHwgZGVjb3JhYmxlO1xuICAgICAgY29uc3QgZGlzcGxheUxheWVyID0gZWRpdG9yLmdldE1hcmtlckxheWVyKGxheWVyLmlkKTtcbiAgICAgIGlmICghZGlzcGxheUxheWVyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChkaXNwbGF5TGF5ZXIgIT09IGxheWVyICYmIGRpc3BsYXlMYXllci5idWZmZXJNYXJrZXJMYXllciAhPT0gbGF5ZXIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSkuZ2V0T3IoZmFsc2UpKS5nZXRPcihmYWxzZSk7XG5cbiAgICBpZiAoIWVkaXRvclZhbGlkIHx8ICFkZWNvcmFibGVWYWxpZCB8fCAhZGVjb3JhYmxlTWF0Y2hlcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGRlbGF5IGRlY29yYXRpb24gY3JlYXRpb24gd2hlbiBpdCdzIGEgZ3V0dGVyIHR5cGU7XG4gICAgLy8gaW5zdGVhZCB3YWl0IGZvciB0aGUgR3V0dGVyIHRvIGJlIGFkZGVkIHRvIHRoZSBlZGl0b3IgZmlyc3RcbiAgICBpZiAodGhpcy5wcm9wcy50eXBlID09PSAnZ3V0dGVyJykge1xuICAgICAgaWYgKCF0aGlzLnByb3BzLmd1dHRlck5hbWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgYXJlIHRyeWluZyB0byBkZWNvcmF0ZSBhIGd1dHRlciBidXQgZGlkIG5vdCBzdXBwbHkgZ3V0dGVyTmFtZSBwcm9wLicpO1xuICAgICAgfVxuICAgICAgdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIubWFwKGVkaXRvciA9PiB7XG4gICAgICAgIHRoaXMuZ3V0dGVyU3ViID0gZWRpdG9yLm9ic2VydmVHdXR0ZXJzKGd1dHRlciA9PiB7XG4gICAgICAgICAgaWYgKGd1dHRlci5uYW1lID09PSB0aGlzLnByb3BzLmd1dHRlck5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGVjb3JhdGlvbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jcmVhdGVEZWNvcmF0aW9uKCk7XG4gIH1cblxuICBjcmVhdGVEZWNvcmF0aW9uKCkge1xuICAgIGlmICh0aGlzLnVzZXNJdGVtKCkgJiYgIXRoaXMuaXRlbSkge1xuICAgICAgdGhpcy5pdGVtID0gY3JlYXRlSXRlbSh0aGlzLmRvbU5vZGUsIHRoaXMucHJvcHMuaXRlbUhvbGRlcik7XG4gICAgfVxuXG4gICAgY29uc3Qgb3B0cyA9IHRoaXMuZ2V0RGVjb3JhdGlvbk9wdHModGhpcy5wcm9wcyk7XG4gICAgY29uc3QgZWRpdG9yID0gdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIuZ2V0KCk7XG4gICAgY29uc3QgZGVjb3JhYmxlID0gdGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIuZ2V0KCk7XG4gICAgdGhpcy5kZWNvcmF0aW9uSG9sZGVyLnNldHRlcihcbiAgICAgIGVkaXRvclt0aGlzLnByb3BzLmRlY29yYXRlTWV0aG9kXShkZWNvcmFibGUsIG9wdHMpLFxuICAgICk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLmRlY29yYXRpb25Ib2xkZXIubWFwKGRlY29yYXRpb24gPT4gZGVjb3JhdGlvbi5kZXN0cm95KCkpO1xuICAgIHRoaXMuZWRpdG9yU3ViLmRpc3Bvc2UoKTtcbiAgICB0aGlzLmRlY29yYWJsZVN1Yi5kaXNwb3NlKCk7XG4gICAgdGhpcy5ndXR0ZXJTdWIuZGlzcG9zZSgpO1xuICB9XG5cbiAgZ2V0RGVjb3JhdGlvbk9wdHMocHJvcHMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZXh0cmFjdFByb3BzKHByb3BzLCBkZWNvcmF0aW9uUHJvcFR5cGVzLCB7Y2xhc3NOYW1lOiAnY2xhc3MnfSksXG4gICAgICBpdGVtOiB0aGlzLml0ZW0sXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZWNvcmF0aW9uIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBlZGl0b3I6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZGVjb3JhYmxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRlY29yYXRlTWV0aG9kOiBQcm9wVHlwZXMub25lT2YoWydkZWNvcmF0ZU1hcmtlcicsICdkZWNvcmF0ZU1hcmtlckxheWVyJ10pLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgZWRpdG9ySG9sZGVyOiBSZWZIb2xkZXIub24odGhpcy5wcm9wcy5lZGl0b3IpLFxuICAgICAgZGVjb3JhYmxlSG9sZGVyOiBSZWZIb2xkZXIub24odGhpcy5wcm9wcy5kZWNvcmFibGUpLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzKHByb3BzLCBzdGF0ZSkge1xuICAgIGNvbnN0IGVkaXRvckNoYW5nZWQgPSBzdGF0ZS5lZGl0b3JIb2xkZXJcbiAgICAgIC5tYXAoZWRpdG9yID0+IGVkaXRvciAhPT0gcHJvcHMuZWRpdG9yKVxuICAgICAgLmdldE9yKHByb3BzLmVkaXRvciAhPT0gdW5kZWZpbmVkKTtcbiAgICBjb25zdCBkZWNvcmFibGVDaGFuZ2VkID0gc3RhdGUuZGVjb3JhYmxlSG9sZGVyXG4gICAgICAubWFwKGRlY29yYWJsZSA9PiBkZWNvcmFibGUgIT09IHByb3BzLmRlY29yYWJsZSlcbiAgICAgIC5nZXRPcihwcm9wcy5kZWNvcmFibGUgIT09IHVuZGVmaW5lZCk7XG5cbiAgICBpZiAoIWVkaXRvckNoYW5nZWQgJiYgIWRlY29yYWJsZUNoYW5nZWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG5leHRTdGF0ZSA9IHt9O1xuICAgIGlmIChlZGl0b3JDaGFuZ2VkKSB7XG4gICAgICBuZXh0U3RhdGUuZWRpdG9ySG9sZGVyID0gUmVmSG9sZGVyLm9uKHByb3BzLmVkaXRvcik7XG4gICAgfVxuICAgIGlmIChkZWNvcmFibGVDaGFuZ2VkKSB7XG4gICAgICBuZXh0U3RhdGUuZGVjb3JhYmxlSG9sZGVyID0gUmVmSG9sZGVyLm9uKHByb3BzLmRlY29yYWJsZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXh0U3RhdGU7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxUZXh0RWRpdG9yQ29udGV4dC5Db25zdW1lcj5cbiAgICAgICAge2VkaXRvckhvbGRlciA9PiAoXG4gICAgICAgICAgPERlY29yYWJsZUNvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgICAgICB7ZGVjb3JhYmxlID0+IHtcbiAgICAgICAgICAgICAgbGV0IGhvbGRlciA9IG51bGw7XG4gICAgICAgICAgICAgIGxldCBkZWNvcmF0ZU1ldGhvZCA9IG51bGw7XG4gICAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5kZWNvcmFibGVIb2xkZXIuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgaG9sZGVyID0gdGhpcy5zdGF0ZS5kZWNvcmFibGVIb2xkZXI7XG4gICAgICAgICAgICAgICAgZGVjb3JhdGVNZXRob2QgPSB0aGlzLnByb3BzLmRlY29yYXRlTWV0aG9kO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGhvbGRlciA9IGRlY29yYWJsZS5ob2xkZXI7XG4gICAgICAgICAgICAgICAgZGVjb3JhdGVNZXRob2QgPSBkZWNvcmFibGUuZGVjb3JhdGVNZXRob2Q7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxCYXJlRGVjb3JhdGlvblxuICAgICAgICAgICAgICAgICAgZWRpdG9ySG9sZGVyPXtlZGl0b3JIb2xkZXIgfHwgdGhpcy5zdGF0ZS5lZGl0b3JIb2xkZXJ9XG4gICAgICAgICAgICAgICAgICBkZWNvcmFibGVIb2xkZXI9e2hvbGRlcn1cbiAgICAgICAgICAgICAgICAgIGRlY29yYXRlTWV0aG9kPXtkZWNvcmF0ZU1ldGhvZH1cbiAgICAgICAgICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9fVxuICAgICAgICAgIDwvRGVjb3JhYmxlQ29udGV4dC5Db25zdW1lcj5cbiAgICAgICAgKX1cbiAgICAgIDwvVGV4dEVkaXRvckNvbnRleHQuQ29uc3VtZXI+XG4gICAgKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUE2QztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUU3QyxNQUFNQSxtQkFBbUIsR0FBRztFQUMxQkMsSUFBSSxFQUFFQyxrQkFBUyxDQUFDQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUNDLFVBQVU7RUFDcEdDLFNBQVMsRUFBRUgsa0JBQVMsQ0FBQ0ksTUFBTTtFQUMzQkMsS0FBSyxFQUFFTCxrQkFBUyxDQUFDSSxNQUFNO0VBQ3ZCRSxRQUFRLEVBQUVOLGtCQUFTLENBQUNPLElBQUk7RUFDeEJDLFNBQVMsRUFBRVIsa0JBQVMsQ0FBQ08sSUFBSTtFQUN6QkUsWUFBWSxF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