"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _classnames = _interopRequireDefault(require("classnames"));
var _helpers = require("../helpers");
var _propTypes2 = require("../prop-types");
var _atomTextEditor = require("./atom-text-editor");
var _marker = require("./marker");
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
const decorationPropTypes = {
  type: _propTypes.default.oneOf(['line', 'line-number', 'highlight', 'overlay', 'gutter', 'block']).isRequired,
  className: _propTypes.default.string,
  style: _propTypes.default.string,
  onlyHead: _propTypes.default.bool,
  onlyEmpty: _propTypes.default.bool,
  onlyNonEmpty: _propTypes.default.bool,
  omitEmptyLastRow: _propTypes.default.bool,
  position: _propTypes.default.oneOf(['head', 'tail', 'before', 'after']),
  order: _propTypes.default.number,
  avoidOverflow: _propTypes.default.bool,
  gutterName: _propTypes.default.string
};
class BareDecoration extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "observeParents", () => {
      this.decorationHolder.map(decoration => decoration.destroy());
      const editorValid = this.props.editorHolder.map(editor => !editor.isDestroyed()).getOr(false);
      const decorableValid = this.props.decorableHolder.map(decorable => !decorable.isDestroyed()).getOr(false);

      // Ensure the Marker or MarkerLayer corresponds to the context's TextEditor
      const decorableMatches = this.props.decorableHolder.map(decorable => this.props.editorHolder.map(editor => {
        const layer = decorable.layer || decorable;
        const displayLayer = editor.getMarkerLayer(layer.id);
        if (!displayLayer) {
          return false;
        }
        if (displayLayer !== layer && displayLayer.bufferMarkerLayer !== layer) {
          return false;
        }
        return true;
      }).getOr(false)).getOr(false);
      if (!editorValid || !decorableValid || !decorableMatches) {
        return;
      }

      // delay decoration creation when it's a gutter type;
      // instead wait for the Gutter to be added to the editor first
      if (this.props.type === 'gutter') {
        if (!this.props.gutterName) {
          throw new Error('You are trying to decorate a gutter but did not supply gutterName prop.');
        }
        this.props.editorHolder.map(editor => {
          this.gutterSub = editor.observeGutters(gutter => {
            if (gutter.name === this.props.gutterName) {
              this.createDecoration();
            }
          });
          return null;
        });
        return;
      }
      this.createDecoration();
    });
    this.decorationHolder = new _refHolder.default();
    this.editorSub = new _eventKit.Disposable();
    this.decorableSub = new _eventKit.Disposable();
    this.gutterSub = new _eventKit.Disposable();
    this.domNode = null;
    this.item = null;
    if (['gutter', 'overlay', 'block'].includes(this.props.type)) {
      this.domNode = document.createElement('div');
      this.domNode.className = (0, _classnames.default)('react-atom-decoration', this.props.className);
    }
  }
  usesItem() {
    return this.domNode !== null;
  }
  componentDidMount() {
    this.editorSub = this.props.editorHolder.observe(this.observeParents);
    this.decorableSub = this.props.decorableHolder.observe(this.observeParents);
  }
  componentDidUpdate(prevProps) {
    if (this.props.editorHolder !== prevProps.editorHolder) {
      this.editorSub.dispose();
      this.editorSub = this.props.editorHolder.observe(this.observeParents);
    }
    if (this.props.decorableHolder !== prevProps.decorableHolder) {
      this.decorableSub.dispose();
      this.decorableSub = this.props.decorableHolder.observe(this.observeParents);
    }
    if (Object.keys(decorationPropTypes).some(key => this.props[key] !== prevProps[key])) {
      this.decorationHolder.map(decoration => decoration.destroy());
      this.createDecoration();
    }
  }
  render() {
    if (this.usesItem()) {
      return _reactDom.default.createPortal(this.props.children, this.domNode);
    } else {
      return null;
    }
  }
  createDecoration() {
    if (this.usesItem() && !this.item) {
      this.item = (0, _helpers.createItem)(this.domNode, this.props.itemHolder);
    }
    const opts = this.getDecorationOpts(this.props);
    const editor = this.props.editorHolder.get();
    const decorable = this.props.decorableHolder.get();
    this.decorationHolder.setter(editor[this.props.decorateMethod](decorable, opts));
  }
  componentWillUnmount() {
    this.decorationHolder.map(decoration => decoration.destroy());
    this.editorSub.dispose();
    this.decorableSub.dispose();
    this.gutterSub.dispose();
  }
  getDecorationOpts(props) {
    return _objectSpread({}, (0, _helpers.extractProps)(props, decorationPropTypes, {
      className: 'class'
    }), {
      item: this.item
    });
  }
}
_defineProperty(BareDecoration, "propTypes", _objectSpread({
  editorHolder: _propTypes2.RefHolderPropType.isRequired,
  decorableHolder: _propTypes2.RefHolderPropType.isRequired,
  decorateMethod: _propTypes.default.oneOf(['decorateMarker', 'decorateMarkerLayer']),
  itemHolder: _propTypes2.RefHolderPropType,
  children: _propTypes.default.node
}, decorationPropTypes));
_defineProperty(BareDecoration, "defaultProps", {
  decorateMethod: 'decorateMarker'
});
class Decoration extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = {
      editorHolder: _refHolder.default.on(this.props.editor),
      decorableHolder: _refHolder.default.on(this.props.decorable)
    };
  }
  static getDerivedStateFromProps(props, state) {
    const editorChanged = state.editorHolder.map(editor => editor !== props.editor).getOr(props.editor !== undefined);
    const decorableChanged = state.decorableHolder.map(decorable => decorable !== props.decorable).getOr(props.decorable !== undefined);
    if (!editorChanged && !decorableChanged) {
      return null;
    }
    const nextState = {};
    if (editorChanged) {
      nextState.editorHolder = _refHolder.default.on(props.editor);
    }
    if (decorableChanged) {
      nextState.decorableHolder = _refHolder.default.on(props.decorable);
    }
    return nextState;
  }
  render() {
    return _react.default.createElement(_atomTextEditor.TextEditorContext.Consumer, null, editorHolder => _react.default.createElement(_marker.DecorableContext.Consumer, null, decorable => {
      let holder = null;
      let decorateMethod = null;
      if (!this.state.decorableHolder.isEmpty()) {
        holder = this.state.decorableHolder;
        decorateMethod = this.props.decorateMethod;
      } else {
        holder = decorable.holder;
        decorateMethod = decorable.decorateMethod;
      }
      return _react.default.createElement(BareDecoration, _extends({
        editorHolder: editorHolder || this.state.editorHolder,
        decorableHolder: holder,
        decorateMethod: decorateMethod
      }, this.props));
    }));
  }
}
exports.default = Decoration;
_defineProperty(Decoration, "propTypes", {
  editor: _propTypes.default.object,
  decorable: _propTypes.default.object,
  decorateMethod: _propTypes.default.oneOf(['decorateMarker', 'decorateMarkerLayer'])
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdERvbSIsIl9wcm9wVHlwZXMiLCJfZXZlbnRLaXQiLCJfY2xhc3NuYW1lcyIsIl9oZWxwZXJzIiwiX3Byb3BUeXBlczIiLCJfYXRvbVRleHRFZGl0b3IiLCJfbWFya2VyIiwiX3JlZkhvbGRlciIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX2V4dGVuZHMiLCJPYmplY3QiLCJhc3NpZ24iLCJiaW5kIiwidGFyZ2V0IiwiaSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInNvdXJjZSIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImFwcGx5Iiwib3duS2V5cyIsImUiLCJyIiwidCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJfb2JqZWN0U3ByZWFkIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsIlR5cGVFcnJvciIsIk51bWJlciIsImRlY29yYXRpb25Qcm9wVHlwZXMiLCJ0eXBlIiwiUHJvcFR5cGVzIiwib25lT2YiLCJpc1JlcXVpcmVkIiwiY2xhc3NOYW1lIiwic3RyaW5nIiwic3R5bGUiLCJvbmx5SGVhZCIsImJvb2wiLCJvbmx5RW1wdHkiLCJvbmx5Tm9uRW1wdHkiLCJvbWl0RW1wdHlMYXN0Um93IiwicG9zaXRpb24iLCJvcmRlciIsIm51bWJlciIsImF2b2lkT3ZlcmZsb3ciLCJndXR0ZXJOYW1lIiwiQmFyZURlY29yYXRpb24iLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjb250ZXh0IiwiZGVjb3JhdGlvbkhvbGRlciIsIm1hcCIsImRlY29yYXRpb24iLCJkZXN0cm95IiwiZWRpdG9yVmFsaWQiLCJlZGl0b3JIb2xkZXIiLCJlZGl0b3IiLCJpc0Rlc3Ryb3llZCIsImdldE9yIiwiZGVjb3JhYmxlVmFsaWQiLCJkZWNvcmFibGVIb2xkZXIiLCJkZWNvcmFibGUiLCJkZWNvcmFibGVNYXRjaGVzIiwibGF5ZXIiLCJkaXNwbGF5TGF5ZXIiLCJnZXRNYXJrZXJMYXllciIsImlkIiwiYnVmZmVyTWFya2VyTGF5ZXIiLCJFcnJvciIsImd1dHRlclN1YiIsIm9ic2VydmVHdXR0ZXJzIiwiZ3V0dGVyIiwibmFtZSIsImNyZWF0ZURlY29yYXRpb24iLCJSZWZIb2xkZXIiLCJlZGl0b3JTdWIiLCJEaXNwb3NhYmxlIiwiZGVjb3JhYmxlU3ViIiwiZG9tTm9kZSIsIml0ZW0iLCJpbmNsdWRlcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImN4IiwidXNlc0l0ZW0iLCJjb21wb25lbnREaWRNb3VudCIsIm9ic2VydmUiLCJvYnNlcnZlUGFyZW50cyIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsImRpc3Bvc2UiLCJzb21lIiwicmVuZGVyIiwiUmVhY3RET00iLCJjcmVhdGVQb3J0YWwiLCJjaGlsZHJlbiIsImNyZWF0ZUl0ZW0iLCJpdGVtSG9sZGVyIiwib3B0cyIsImdldERlY29yYXRpb25PcHRzIiwiZ2V0Iiwic2V0dGVyIiwiZGVjb3JhdGVNZXRob2QiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImV4dHJhY3RQcm9wcyIsIlJlZkhvbGRlclByb3BUeXBlIiwibm9kZSIsIkRlY29yYXRpb24iLCJzdGF0ZSIsIm9uIiwiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwiZWRpdG9yQ2hhbmdlZCIsInVuZGVmaW5lZCIsImRlY29yYWJsZUNoYW5nZWQiLCJuZXh0U3RhdGUiLCJUZXh0RWRpdG9yQ29udGV4dCIsIkNvbnN1bWVyIiwiRGVjb3JhYmxlQ29udGV4dCIsImhvbGRlciIsImlzRW1wdHkiLCJleHBvcnRzIiwib2JqZWN0Il0sInNvdXJjZXMiOlsiZGVjb3JhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnO1xuXG5pbXBvcnQge2NyZWF0ZUl0ZW0sIGV4dHJhY3RQcm9wc30gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQge1JlZkhvbGRlclByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcbmltcG9ydCB7VGV4dEVkaXRvckNvbnRleHR9IGZyb20gJy4vYXRvbS10ZXh0LWVkaXRvcic7XG5pbXBvcnQge0RlY29yYWJsZUNvbnRleHR9IGZyb20gJy4vbWFya2VyJztcbmltcG9ydCBSZWZIb2xkZXIgZnJvbSAnLi4vbW9kZWxzL3JlZi1ob2xkZXInO1xuXG5jb25zdCBkZWNvcmF0aW9uUHJvcFR5cGVzID0ge1xuICB0eXBlOiBQcm9wVHlwZXMub25lT2YoWydsaW5lJywgJ2xpbmUtbnVtYmVyJywgJ2hpZ2hsaWdodCcsICdvdmVybGF5JywgJ2d1dHRlcicsICdibG9jayddKS5pc1JlcXVpcmVkLFxuICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHN0eWxlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBvbmx5SGVhZDogUHJvcFR5cGVzLmJvb2wsXG4gIG9ubHlFbXB0eTogUHJvcFR5cGVzLmJvb2wsXG4gIG9ubHlOb25FbXB0eTogUHJvcFR5cGVzLmJvb2wsXG4gIG9taXRFbXB0eUxhc3RSb3c6IFByb3BUeXBlcy5ib29sLFxuICBwb3NpdGlvbjogUHJvcFR5cGVzLm9uZU9mKFsnaGVhZCcsICd0YWlsJywgJ2JlZm9yZScsICdhZnRlciddKSxcbiAgb3JkZXI6IFByb3BUeXBlcy5udW1iZXIsXG4gIGF2b2lkT3ZlcmZsb3c6IFByb3BUeXBlcy5ib29sLFxuICBndXR0ZXJOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxufTtcblxuY2xhc3MgQmFyZURlY29yYXRpb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGVkaXRvckhvbGRlcjogUmVmSG9sZGVyUHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICBkZWNvcmFibGVIb2xkZXI6IFJlZkhvbGRlclByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgZGVjb3JhdGVNZXRob2Q6IFByb3BUeXBlcy5vbmVPZihbJ2RlY29yYXRlTWFya2VyJywgJ2RlY29yYXRlTWFya2VyTGF5ZXInXSksXG4gICAgaXRlbUhvbGRlcjogUmVmSG9sZGVyUHJvcFR5cGUsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuICAgIC4uLmRlY29yYXRpb25Qcm9wVHlwZXMsXG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGRlY29yYXRlTWV0aG9kOiAnZGVjb3JhdGVNYXJrZXInLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICB0aGlzLmRlY29yYXRpb25Ib2xkZXIgPSBuZXcgUmVmSG9sZGVyKCk7XG4gICAgdGhpcy5lZGl0b3JTdWIgPSBuZXcgRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuZGVjb3JhYmxlU3ViID0gbmV3IERpc3Bvc2FibGUoKTtcbiAgICB0aGlzLmd1dHRlclN1YiA9IG5ldyBEaXNwb3NhYmxlKCk7XG5cbiAgICB0aGlzLmRvbU5vZGUgPSBudWxsO1xuICAgIHRoaXMuaXRlbSA9IG51bGw7XG5cbiAgICBpZiAoWydndXR0ZXInLCAnb3ZlcmxheScsICdibG9jayddLmluY2x1ZGVzKHRoaXMucHJvcHMudHlwZSkpIHtcbiAgICAgIHRoaXMuZG9tTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdGhpcy5kb21Ob2RlLmNsYXNzTmFtZSA9IGN4KCdyZWFjdC1hdG9tLWRlY29yYXRpb24nLCB0aGlzLnByb3BzLmNsYXNzTmFtZSk7XG4gICAgfVxuICB9XG5cbiAgdXNlc0l0ZW0oKSB7XG4gICAgcmV0dXJuIHRoaXMuZG9tTm9kZSAhPT0gbnVsbDtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuZWRpdG9yU3ViID0gdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIub2JzZXJ2ZSh0aGlzLm9ic2VydmVQYXJlbnRzKTtcbiAgICB0aGlzLmRlY29yYWJsZVN1YiA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLm9ic2VydmUodGhpcy5vYnNlcnZlUGFyZW50cyk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyICE9PSBwcmV2UHJvcHMuZWRpdG9ySG9sZGVyKSB7XG4gICAgICB0aGlzLmVkaXRvclN1Yi5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmVkaXRvclN1YiA9IHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLm9ic2VydmUodGhpcy5vYnNlcnZlUGFyZW50cyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyICE9PSBwcmV2UHJvcHMuZGVjb3JhYmxlSG9sZGVyKSB7XG4gICAgICB0aGlzLmRlY29yYWJsZVN1Yi5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmRlY29yYWJsZVN1YiA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLm9ic2VydmUodGhpcy5vYnNlcnZlUGFyZW50cyk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgT2JqZWN0LmtleXMoZGVjb3JhdGlvblByb3BUeXBlcykuc29tZShrZXkgPT4gdGhpcy5wcm9wc1trZXldICE9PSBwcmV2UHJvcHNba2V5XSlcbiAgICApIHtcbiAgICAgIHRoaXMuZGVjb3JhdGlvbkhvbGRlci5tYXAoZGVjb3JhdGlvbiA9PiBkZWNvcmF0aW9uLmRlc3Ryb3koKSk7XG4gICAgICB0aGlzLmNyZWF0ZURlY29yYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgaWYgKHRoaXMudXNlc0l0ZW0oKSkge1xuICAgICAgcmV0dXJuIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbChcbiAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlbixcbiAgICAgICAgdGhpcy5kb21Ob2RlLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgb2JzZXJ2ZVBhcmVudHMgPSAoKSA9PiB7XG4gICAgdGhpcy5kZWNvcmF0aW9uSG9sZGVyLm1hcChkZWNvcmF0aW9uID0+IGRlY29yYXRpb24uZGVzdHJveSgpKTtcblxuICAgIGNvbnN0IGVkaXRvclZhbGlkID0gdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIubWFwKGVkaXRvciA9PiAhZWRpdG9yLmlzRGVzdHJveWVkKCkpLmdldE9yKGZhbHNlKTtcbiAgICBjb25zdCBkZWNvcmFibGVWYWxpZCA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLm1hcChkZWNvcmFibGUgPT4gIWRlY29yYWJsZS5pc0Rlc3Ryb3llZCgpKS5nZXRPcihmYWxzZSk7XG5cbiAgICAvLyBFbnN1cmUgdGhlIE1hcmtlciBvciBNYXJrZXJMYXllciBjb3JyZXNwb25kcyB0byB0aGUgY29udGV4dCdzIFRleHRFZGl0b3JcbiAgICBjb25zdCBkZWNvcmFibGVNYXRjaGVzID0gdGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIubWFwKGRlY29yYWJsZSA9PiB0aGlzLnByb3BzLmVkaXRvckhvbGRlci5tYXAoZWRpdG9yID0+IHtcbiAgICAgIGNvbnN0IGxheWVyID0gZGVjb3JhYmxlLmxheWVyIHx8IGRlY29yYWJsZTtcbiAgICAgIGNvbnN0IGRpc3BsYXlMYXllciA9IGVkaXRvci5nZXRNYXJrZXJMYXllcihsYXllci5pZCk7XG4gICAgICBpZiAoIWRpc3BsYXlMYXllcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoZGlzcGxheUxheWVyICE9PSBsYXllciAmJiBkaXNwbGF5TGF5ZXIuYnVmZmVyTWFya2VyTGF5ZXIgIT09IGxheWVyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pLmdldE9yKGZhbHNlKSkuZ2V0T3IoZmFsc2UpO1xuXG4gICAgaWYgKCFlZGl0b3JWYWxpZCB8fCAhZGVjb3JhYmxlVmFsaWQgfHwgIWRlY29yYWJsZU1hdGNoZXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBkZWxheSBkZWNvcmF0aW9uIGNyZWF0aW9uIHdoZW4gaXQncyBhIGd1dHRlciB0eXBlO1xuICAgIC8vIGluc3RlYWQgd2FpdCBmb3IgdGhlIEd1dHRlciB0byBiZSBhZGRlZCB0byB0aGUgZWRpdG9yIGZpcnN0XG4gICAgaWYgKHRoaXMucHJvcHMudHlwZSA9PT0gJ2d1dHRlcicpIHtcbiAgICAgIGlmICghdGhpcy5wcm9wcy5ndXR0ZXJOYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGFyZSB0cnlpbmcgdG8gZGVjb3JhdGUgYSBndXR0ZXIgYnV0IGRpZCBub3Qgc3VwcGx5IGd1dHRlck5hbWUgcHJvcC4nKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLm1hcChlZGl0b3IgPT4ge1xuICAgICAgICB0aGlzLmd1dHRlclN1YiA9IGVkaXRvci5vYnNlcnZlR3V0dGVycyhndXR0ZXIgPT4ge1xuICAgICAgICAgIGlmIChndXR0ZXIubmFtZSA9PT0gdGhpcy5wcm9wcy5ndXR0ZXJOYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZURlY29yYXRpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY3JlYXRlRGVjb3JhdGlvbigpO1xuICB9XG5cbiAgY3JlYXRlRGVjb3JhdGlvbigpIHtcbiAgICBpZiAodGhpcy51c2VzSXRlbSgpICYmICF0aGlzLml0ZW0pIHtcbiAgICAgIHRoaXMuaXRlbSA9IGNyZWF0ZUl0ZW0odGhpcy5kb21Ob2RlLCB0aGlzLnByb3BzLml0ZW1Ib2xkZXIpO1xuICAgIH1cblxuICAgIGNvbnN0IG9wdHMgPSB0aGlzLmdldERlY29yYXRpb25PcHRzKHRoaXMucHJvcHMpO1xuICAgIGNvbnN0IGVkaXRvciA9IHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLmdldCgpO1xuICAgIGNvbnN0IGRlY29yYWJsZSA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLmdldCgpO1xuICAgIHRoaXMuZGVjb3JhdGlvbkhvbGRlci5zZXR0ZXIoXG4gICAgICBlZGl0b3JbdGhpcy5wcm9wcy5kZWNvcmF0ZU1ldGhvZF0oZGVjb3JhYmxlLCBvcHRzKSxcbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5kZWNvcmF0aW9uSG9sZGVyLm1hcChkZWNvcmF0aW9uID0+IGRlY29yYXRpb24uZGVzdHJveSgpKTtcbiAgICB0aGlzLmVkaXRvclN1Yi5kaXNwb3NlKCk7XG4gICAgdGhpcy5kZWNvcmFibGVTdWIuZGlzcG9zZSgpO1xuICAgIHRoaXMuZ3V0dGVyU3ViLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIGdldERlY29yYXRpb25PcHRzKHByb3BzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmV4dHJhY3RQcm9wcyhwcm9wcywgZGVjb3JhdGlvblByb3BUeXBlcywge2NsYXNzTmFtZTogJ2NsYXNzJ30pLFxuICAgICAgaXRlbTogdGhpcy5pdGVtLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGVjb3JhdGlvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZWRpdG9yOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRlY29yYWJsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBkZWNvcmF0ZU1ldGhvZDogUHJvcFR5cGVzLm9uZU9mKFsnZGVjb3JhdGVNYXJrZXInLCAnZGVjb3JhdGVNYXJrZXJMYXllciddKSxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGVkaXRvckhvbGRlcjogUmVmSG9sZGVyLm9uKHRoaXMucHJvcHMuZWRpdG9yKSxcbiAgICAgIGRlY29yYWJsZUhvbGRlcjogUmVmSG9sZGVyLm9uKHRoaXMucHJvcHMuZGVjb3JhYmxlKSxcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHtcbiAgICBjb25zdCBlZGl0b3JDaGFuZ2VkID0gc3RhdGUuZWRpdG9ySG9sZGVyXG4gICAgICAubWFwKGVkaXRvciA9PiBlZGl0b3IgIT09IHByb3BzLmVkaXRvcilcbiAgICAgIC5nZXRPcihwcm9wcy5lZGl0b3IgIT09IHVuZGVmaW5lZCk7XG4gICAgY29uc3QgZGVjb3JhYmxlQ2hhbmdlZCA9IHN0YXRlLmRlY29yYWJsZUhvbGRlclxuICAgICAgLm1hcChkZWNvcmFibGUgPT4gZGVjb3JhYmxlICE9PSBwcm9wcy5kZWNvcmFibGUpXG4gICAgICAuZ2V0T3IocHJvcHMuZGVjb3JhYmxlICE9PSB1bmRlZmluZWQpO1xuXG4gICAgaWYgKCFlZGl0b3JDaGFuZ2VkICYmICFkZWNvcmFibGVDaGFuZ2VkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBuZXh0U3RhdGUgPSB7fTtcbiAgICBpZiAoZWRpdG9yQ2hhbmdlZCkge1xuICAgICAgbmV4dFN0YXRlLmVkaXRvckhvbGRlciA9IFJlZkhvbGRlci5vbihwcm9wcy5lZGl0b3IpO1xuICAgIH1cbiAgICBpZiAoZGVjb3JhYmxlQ2hhbmdlZCkge1xuICAgICAgbmV4dFN0YXRlLmRlY29yYWJsZUhvbGRlciA9IFJlZkhvbGRlci5vbihwcm9wcy5kZWNvcmFibGUpO1xuICAgIH1cbiAgICByZXR1cm4gbmV4dFN0YXRlO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8VGV4dEVkaXRvckNvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgIHtlZGl0b3JIb2xkZXIgPT4gKFxuICAgICAgICAgIDxEZWNvcmFibGVDb250ZXh0LkNvbnN1bWVyPlxuICAgICAgICAgICAge2RlY29yYWJsZSA9PiB7XG4gICAgICAgICAgICAgIGxldCBob2xkZXIgPSBudWxsO1xuICAgICAgICAgICAgICBsZXQgZGVjb3JhdGVNZXRob2QgPSBudWxsO1xuICAgICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuZGVjb3JhYmxlSG9sZGVyLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGhvbGRlciA9IHRoaXMuc3RhdGUuZGVjb3JhYmxlSG9sZGVyO1xuICAgICAgICAgICAgICAgIGRlY29yYXRlTWV0aG9kID0gdGhpcy5wcm9wcy5kZWNvcmF0ZU1ldGhvZDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBob2xkZXIgPSBkZWNvcmFibGUuaG9sZGVyO1xuICAgICAgICAgICAgICAgIGRlY29yYXRlTWV0aG9kID0gZGVjb3JhYmxlLmRlY29yYXRlTWV0aG9kO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8QmFyZURlY29yYXRpb25cbiAgICAgICAgICAgICAgICAgIGVkaXRvckhvbGRlcj17ZWRpdG9ySG9sZGVyIHx8IHRoaXMuc3RhdGUuZWRpdG9ySG9sZGVyfVxuICAgICAgICAgICAgICAgICAgZGVjb3JhYmxlSG9sZGVyPXtob2xkZXJ9XG4gICAgICAgICAgICAgICAgICBkZWNvcmF0ZU1ldGhvZD17ZGVjb3JhdGVNZXRob2R9XG4gICAgICAgICAgICAgICAgICB7Li4udGhpcy5wcm9wc31cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICA8L0RlY29yYWJsZUNvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgICl9XG4gICAgICA8L1RleHRFZGl0b3JDb250ZXh0LkNvbnN1bWVyPlxuICAgICk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsVUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksV0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUssUUFBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0sV0FBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sZUFBQSxHQUFBUCxPQUFBO0FBQ0EsSUFBQVEsT0FBQSxHQUFBUixPQUFBO0FBQ0EsSUFBQVMsVUFBQSxHQUFBVixzQkFBQSxDQUFBQyxPQUFBO0FBQTZDLFNBQUFELHVCQUFBVyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsU0FBQSxJQUFBQSxRQUFBLEdBQUFDLE1BQUEsQ0FBQUMsTUFBQSxHQUFBRCxNQUFBLENBQUFDLE1BQUEsQ0FBQUMsSUFBQSxlQUFBQyxNQUFBLGFBQUFDLENBQUEsTUFBQUEsQ0FBQSxHQUFBQyxTQUFBLENBQUFDLE1BQUEsRUFBQUYsQ0FBQSxVQUFBRyxNQUFBLEdBQUFGLFNB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