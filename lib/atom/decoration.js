"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _classnames = _interopRequireDefault(require("classnames"));
var _helpers = require("../helpers");
var _propTypes2 = require("../prop-types");
var _atomTextEditor = require("./atom-text-editor");
var _marker = require("./marker");
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const decorationPropTypes = {
  type: _propTypes.default.oneOf(['line', 'line-number', 'highlight', 'overlay', 'gutter', 'block']).isRequired,
  className: _propTypes.default.string,
  style: _propTypes.default.string,
  onlyHead: _propTypes.default.bool,
  onlyEmpty: _propTypes.default.bool,
  onlyNonEmpty: _propTypes.default.bool,
  omitEmptyLastRow: _propTypes.default.bool,
  position: _propTypes.default.oneOf(['head', 'tail', 'before', 'after']),
  order: _propTypes.default.number,
  avoidOverflow: _propTypes.default.bool,
  gutterName: _propTypes.default.string
};
class BareDecoration extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "observeParents", () => {
      this.decorationHolder.map(decoration => decoration.destroy());
      const editorValid = this.props.editorHolder.map(editor => !editor.isDestroyed()).getOr(false);
      const decorableValid = this.props.decorableHolder.map(decorable => !decorable.isDestroyed()).getOr(false);

      // Ensure the Marker or MarkerLayer corresponds to the context's TextEditor
      const decorableMatches = this.props.decorableHolder.map(decorable => this.props.editorHolder.map(editor => {
        const layer = decorable.layer || decorable;
        const displayLayer = editor.getMarkerLayer(layer.id);
        if (!displayLayer) {
          return false;
        }
        if (displayLayer !== layer && displayLayer.bufferMarkerLayer !== layer) {
          return false;
        }
        return true;
      }).getOr(false)).getOr(false);
      if (!editorValid || !decorableValid || !decorableMatches) {
        return;
      }

      // delay decoration creation when it's a gutter type;
      // instead wait for the Gutter to be added to the editor first
      if (this.props.type === 'gutter') {
        if (!this.props.gutterName) {
          throw new Error('You are trying to decorate a gutter but did not supply gutterName prop.');
        }
        this.props.editorHolder.map(editor => {
          this.gutterSub = editor.observeGutters(gutter => {
            if (gutter.name === this.props.gutterName) {
              this.createDecoration();
            }
          });
          return null;
        });
        return;
      }
      this.createDecoration();
    });
    this.decorationHolder = new _refHolder.default();
    this.editorSub = new _eventKit.Disposable();
    this.decorableSub = new _eventKit.Disposable();
    this.gutterSub = new _eventKit.Disposable();
    this.domNode = null;
    this.item = null;
    if (['gutter', 'overlay', 'block'].includes(this.props.type)) {
      this.domNode = document.createElement('div');
      this.domNode.className = (0, _classnames.default)('react-atom-decoration', this.props.className);
    }
  }
  usesItem() {
    return this.domNode !== null;
  }
  componentDidMount() {
    this.editorSub = this.props.editorHolder.observe(this.observeParents);
    this.decorableSub = this.props.decorableHolder.observe(this.observeParents);
  }
  componentDidUpdate(prevProps) {
    if (this.props.editorHolder !== prevProps.editorHolder) {
      this.editorSub.dispose();
      this.editorSub = this.props.editorHolder.observe(this.observeParents);
    }
    if (this.props.decorableHolder !== prevProps.decorableHolder) {
      this.decorableSub.dispose();
      this.decorableSub = this.props.decorableHolder.observe(this.observeParents);
    }
    if (Object.keys(decorationPropTypes).some(key => this.props[key] !== prevProps[key])) {
      this.decorationHolder.map(decoration => decoration.destroy());
      this.createDecoration();
    }
  }
  render() {
    if (this.usesItem()) {
      return _reactDom.default.createPortal(this.props.children, this.domNode);
    } else {
      return null;
    }
  }
  createDecoration() {
    if (this.usesItem() && !this.item) {
      this.item = (0, _helpers.createItem)(this.domNode, this.props.itemHolder);
    }
    const opts = this.getDecorationOpts(this.props);
    const editor = this.props.editorHolder.get();
    const decorable = this.props.decorableHolder.get();
    this.decorationHolder.setter(editor[this.props.decorateMethod](decorable, opts));
  }
  componentWillUnmount() {
    this.decorationHolder.map(decoration => decoration.destroy());
    this.editorSub.dispose();
    this.decorableSub.dispose();
    this.gutterSub.dispose();
  }
  getDecorationOpts(props) {
    return _objectSpread({}, (0, _helpers.extractProps)(props, decorationPropTypes, {
      className: 'class'
    }), {
      item: this.item
    });
  }
}
_defineProperty(BareDecoration, "propTypes", _objectSpread({
  editorHolder: _propTypes2.RefHolderPropType.isRequired,
  decorableHolder: _propTypes2.RefHolderPropType.isRequired,
  decorateMethod: _propTypes.default.oneOf(['decorateMarker', 'decorateMarkerLayer']),
  itemHolder: _propTypes2.RefHolderPropType,
  children: _propTypes.default.node
}, decorationPropTypes));
_defineProperty(BareDecoration, "defaultProps", {
  decorateMethod: 'decorateMarker'
});
class Decoration extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = {
      editorHolder: _refHolder.default.on(this.props.editor),
      decorableHolder: _refHolder.default.on(this.props.decorable)
    };
  }
  static getDerivedStateFromProps(props, state) {
    const editorChanged = state.editorHolder.map(editor => editor !== props.editor).getOr(props.editor !== undefined);
    const decorableChanged = state.decorableHolder.map(decorable => decorable !== props.decorable).getOr(props.decorable !== undefined);
    if (!editorChanged && !decorableChanged) {
      return null;
    }
    const nextState = {};
    if (editorChanged) {
      nextState.editorHolder = _refHolder.default.on(props.editor);
    }
    if (decorableChanged) {
      nextState.decorableHolder = _refHolder.default.on(props.decorable);
    }
    return nextState;
  }
  render() {
    return _react.default.createElement(_atomTextEditor.TextEditorContext.Consumer, null, editorHolder => _react.default.createElement(_marker.DecorableContext.Consumer, null, decorable => {
      let holder = null;
      let decorateMethod = null;
      if (!this.state.decorableHolder.isEmpty()) {
        holder = this.state.decorableHolder;
        decorateMethod = this.props.decorateMethod;
      } else {
        holder = decorable.holder;
        decorateMethod = decorable.decorateMethod;
      }
      return _react.default.createElement(BareDecoration, _extends({
        editorHolder: editorHolder || this.state.editorHolder,
        decorableHolder: holder,
        decorateMethod: decorateMethod
      }, this.props));
    }));
  }
}
exports.default = Decoration;
_defineProperty(Decoration, "propTypes", {
  editor: _propTypes.default.object,
  decorable: _propTypes.default.object,
  decorateMethod: _propTypes.default.oneOf(['decorateMarker', 'decorateMarkerLayer'])
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdERvbSIsIl9wcm9wVHlwZXMiLCJfZXZlbnRLaXQiLCJfY2xhc3NuYW1lcyIsIl9oZWxwZXJzIiwiX3Byb3BUeXBlczIiLCJfYXRvbVRleHRFZGl0b3IiLCJfbWFya2VyIiwiX3JlZkhvbGRlciIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX2V4dGVuZHMiLCJPYmplY3QiLCJhc3NpZ24iLCJiaW5kIiwidGFyZ2V0IiwiaSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInNvdXJjZSIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImFwcGx5Iiwib3duS2V5cyIsIm9iamVjdCIsImVudW1lcmFibGVPbmx5Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsInN5bWJvbHMiLCJmaWx0ZXIiLCJzeW0iLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsIl9vYmplY3RTcHJlYWQiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImFyZyIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsImlucHV0IiwiaGludCIsInByaW0iLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsInVuZGVmaW5lZCIsInJlcyIsIlR5cGVFcnJvciIsIk51bWJlciIsImRlY29yYXRpb25Qcm9wVHlwZXMiLCJ0eXBlIiwiUHJvcFR5cGVzIiwib25lT2YiLCJpc1JlcXVpcmVkIiwiY2xhc3NOYW1lIiwic3RyaW5nIiwic3R5bGUiLCJvbmx5SGVhZCIsImJvb2wiLCJvbmx5RW1wdHkiLCJvbmx5Tm9uRW1wdHkiLCJvbWl0RW1wdHlMYXN0Um93IiwicG9zaXRpb24iLCJvcmRlciIsIm51bWJlciIsImF2b2lkT3ZlcmZsb3ciLCJndXR0ZXJOYW1lIiwiQmFyZURlY29yYXRpb24iLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjb250ZXh0IiwiZGVjb3JhdGlvbkhvbGRlciIsIm1hcCIsImRlY29yYXRpb24iLCJkZXN0cm95IiwiZWRpdG9yVmFsaWQiLCJlZGl0b3JIb2xkZXIiLCJlZGl0b3IiLCJpc0Rlc3Ryb3llZCIsImdldE9yIiwiZGVjb3JhYmxlVmFsaWQiLCJkZWNvcmFibGVIb2xkZXIiLCJkZWNvcmFibGUiLCJkZWNvcmFibGVNYXRjaGVzIiwibGF5ZXIiLCJkaXNwbGF5TGF5ZXIiLCJnZXRNYXJrZXJMYXllciIsImlkIiwiYnVmZmVyTWFya2VyTGF5ZXIiLCJFcnJvciIsImd1dHRlclN1YiIsIm9ic2VydmVHdXR0ZXJzIiwiZ3V0dGVyIiwibmFtZSIsImNyZWF0ZURlY29yYXRpb24iLCJSZWZIb2xkZXIiLCJlZGl0b3JTdWIiLCJEaXNwb3NhYmxlIiwiZGVjb3JhYmxlU3ViIiwiZG9tTm9kZSIsIml0ZW0iLCJpbmNsdWRlcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImN4IiwidXNlc0l0ZW0iLCJjb21wb25lbnREaWRNb3VudCIsIm9ic2VydmUiLCJvYnNlcnZlUGFyZW50cyIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsImRpc3Bvc2UiLCJzb21lIiwicmVuZGVyIiwiUmVhY3RET00iLCJjcmVhdGVQb3J0YWwiLCJjaGlsZHJlbiIsImNyZWF0ZUl0ZW0iLCJpdGVtSG9sZGVyIiwib3B0cyIsImdldERlY29yYXRpb25PcHRzIiwiZ2V0Iiwic2V0dGVyIiwiZGVjb3JhdGVNZXRob2QiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImV4dHJhY3RQcm9wcyIsIlJlZkhvbGRlclByb3BUeXBlIiwibm9kZSIsIkRlY29yYXRpb24iLCJzdGF0ZSIsIm9uIiwiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwiZWRpdG9yQ2hhbmdlZCIsImRlY29yYWJsZUNoYW5nZWQiLCJuZXh0U3RhdGUiLCJUZXh0RWRpdG9yQ29udGV4dCIsIkNvbnN1bWVyIiwiRGVjb3JhYmxlQ29udGV4dCIsImhvbGRlciIsImlzRW1wdHkiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiZGVjb3JhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnO1xuXG5pbXBvcnQge2NyZWF0ZUl0ZW0sIGV4dHJhY3RQcm9wc30gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQge1JlZkhvbGRlclByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcbmltcG9ydCB7VGV4dEVkaXRvckNvbnRleHR9IGZyb20gJy4vYXRvbS10ZXh0LWVkaXRvcic7XG5pbXBvcnQge0RlY29yYWJsZUNvbnRleHR9IGZyb20gJy4vbWFya2VyJztcbmltcG9ydCBSZWZIb2xkZXIgZnJvbSAnLi4vbW9kZWxzL3JlZi1ob2xkZXInO1xuXG5jb25zdCBkZWNvcmF0aW9uUHJvcFR5cGVzID0ge1xuICB0eXBlOiBQcm9wVHlwZXMub25lT2YoWydsaW5lJywgJ2xpbmUtbnVtYmVyJywgJ2hpZ2hsaWdodCcsICdvdmVybGF5JywgJ2d1dHRlcicsICdibG9jayddKS5pc1JlcXVpcmVkLFxuICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHN0eWxlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBvbmx5SGVhZDogUHJvcFR5cGVzLmJvb2wsXG4gIG9ubHlFbXB0eTogUHJvcFR5cGVzLmJvb2wsXG4gIG9ubHlOb25FbXB0eTogUHJvcFR5cGVzLmJvb2wsXG4gIG9taXRFbXB0eUxhc3RSb3c6IFByb3BUeXBlcy5ib29sLFxuICBwb3NpdGlvbjogUHJvcFR5cGVzLm9uZU9mKFsnaGVhZCcsICd0YWlsJywgJ2JlZm9yZScsICdhZnRlciddKSxcbiAgb3JkZXI6IFByb3BUeXBlcy5udW1iZXIsXG4gIGF2b2lkT3ZlcmZsb3c6IFByb3BUeXBlcy5ib29sLFxuICBndXR0ZXJOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxufTtcblxuY2xhc3MgQmFyZURlY29yYXRpb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGVkaXRvckhvbGRlcjogUmVmSG9sZGVyUHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICBkZWNvcmFibGVIb2xkZXI6IFJlZkhvbGRlclByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgZGVjb3JhdGVNZXRob2Q6IFByb3BUeXBlcy5vbmVPZihbJ2RlY29yYXRlTWFya2VyJywgJ2RlY29yYXRlTWFya2VyTGF5ZXInXSksXG4gICAgaXRlbUhvbGRlcjogUmVmSG9sZGVyUHJvcFR5cGUsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuICAgIC4uLmRlY29yYXRpb25Qcm9wVHlwZXMsXG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGRlY29yYXRlTWV0aG9kOiAnZGVjb3JhdGVNYXJrZXInLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICB0aGlzLmRlY29yYXRpb25Ib2xkZXIgPSBuZXcgUmVmSG9sZGVyKCk7XG4gICAgdGhpcy5lZGl0b3JTdWIgPSBuZXcgRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuZGVjb3JhYmxlU3ViID0gbmV3IERpc3Bvc2FibGUoKTtcbiAgICB0aGlzLmd1dHRlclN1YiA9IG5ldyBEaXNwb3NhYmxlKCk7XG5cbiAgICB0aGlzLmRvbU5vZGUgPSBudWxsO1xuICAgIHRoaXMuaXRlbSA9IG51bGw7XG5cbiAgICBpZiAoWydndXR0ZXInLCAnb3ZlcmxheScsICdibG9jayddLmluY2x1ZGVzKHRoaXMucHJvcHMudHlwZSkpIHtcbiAgICAgIHRoaXMuZG9tTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdGhpcy5kb21Ob2RlLmNsYXNzTmFtZSA9IGN4KCdyZWFjdC1hdG9tLWRlY29yYXRpb24nLCB0aGlzLnByb3BzLmNsYXNzTmFtZSk7XG4gICAgfVxuICB9XG5cbiAgdXNlc0l0ZW0oKSB7XG4gICAgcmV0dXJuIHRoaXMuZG9tTm9kZSAhPT0gbnVsbDtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuZWRpdG9yU3ViID0gdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIub2JzZXJ2ZSh0aGlzLm9ic2VydmVQYXJlbnRzKTtcbiAgICB0aGlzLmRlY29yYWJsZVN1YiA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLm9ic2VydmUodGhpcy5vYnNlcnZlUGFyZW50cyk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyICE9PSBwcmV2UHJvcHMuZWRpdG9ySG9sZGVyKSB7XG4gICAgICB0aGlzLmVkaXRvclN1Yi5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmVkaXRvclN1YiA9IHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLm9ic2VydmUodGhpcy5vYnNlcnZlUGFyZW50cyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyICE9PSBwcmV2UHJvcHMuZGVjb3JhYmxlSG9sZGVyKSB7XG4gICAgICB0aGlzLmRlY29yYWJsZVN1Yi5kaXNwb3NlKCk7XG4gICAgICB0aGlzLmRlY29yYWJsZVN1YiA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLm9ic2VydmUodGhpcy5vYnNlcnZlUGFyZW50cyk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgT2JqZWN0LmtleXMoZGVjb3JhdGlvblByb3BUeXBlcykuc29tZShrZXkgPT4gdGhpcy5wcm9wc1trZXldICE9PSBwcmV2UHJvcHNba2V5XSlcbiAgICApIHtcbiAgICAgIHRoaXMuZGVjb3JhdGlvbkhvbGRlci5tYXAoZGVjb3JhdGlvbiA9PiBkZWNvcmF0aW9uLmRlc3Ryb3koKSk7XG4gICAgICB0aGlzLmNyZWF0ZURlY29yYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgaWYgKHRoaXMudXNlc0l0ZW0oKSkge1xuICAgICAgcmV0dXJuIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbChcbiAgICAgICAgdGhpcy5wcm9wcy5jaGlsZHJlbixcbiAgICAgICAgdGhpcy5kb21Ob2RlLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgb2JzZXJ2ZVBhcmVudHMgPSAoKSA9PiB7XG4gICAgdGhpcy5kZWNvcmF0aW9uSG9sZGVyLm1hcChkZWNvcmF0aW9uID0+IGRlY29yYXRpb24uZGVzdHJveSgpKTtcblxuICAgIGNvbnN0IGVkaXRvclZhbGlkID0gdGhpcy5wcm9wcy5lZGl0b3JIb2xkZXIubWFwKGVkaXRvciA9PiAhZWRpdG9yLmlzRGVzdHJveWVkKCkpLmdldE9yKGZhbHNlKTtcbiAgICBjb25zdCBkZWNvcmFibGVWYWxpZCA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLm1hcChkZWNvcmFibGUgPT4gIWRlY29yYWJsZS5pc0Rlc3Ryb3llZCgpKS5nZXRPcihmYWxzZSk7XG5cbiAgICAvLyBFbnN1cmUgdGhlIE1hcmtlciBvciBNYXJrZXJMYXllciBjb3JyZXNwb25kcyB0byB0aGUgY29udGV4dCdzIFRleHRFZGl0b3JcbiAgICBjb25zdCBkZWNvcmFibGVNYXRjaGVzID0gdGhpcy5wcm9wcy5kZWNvcmFibGVIb2xkZXIubWFwKGRlY29yYWJsZSA9PiB0aGlzLnByb3BzLmVkaXRvckhvbGRlci5tYXAoZWRpdG9yID0+IHtcbiAgICAgIGNvbnN0IGxheWVyID0gZGVjb3JhYmxlLmxheWVyIHx8IGRlY29yYWJsZTtcbiAgICAgIGNvbnN0IGRpc3BsYXlMYXllciA9IGVkaXRvci5nZXRNYXJrZXJMYXllcihsYXllci5pZCk7XG4gICAgICBpZiAoIWRpc3BsYXlMYXllcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoZGlzcGxheUxheWVyICE9PSBsYXllciAmJiBkaXNwbGF5TGF5ZXIuYnVmZmVyTWFya2VyTGF5ZXIgIT09IGxheWVyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pLmdldE9yKGZhbHNlKSkuZ2V0T3IoZmFsc2UpO1xuXG4gICAgaWYgKCFlZGl0b3JWYWxpZCB8fCAhZGVjb3JhYmxlVmFsaWQgfHwgIWRlY29yYWJsZU1hdGNoZXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBkZWxheSBkZWNvcmF0aW9uIGNyZWF0aW9uIHdoZW4gaXQncyBhIGd1dHRlciB0eXBlO1xuICAgIC8vIGluc3RlYWQgd2FpdCBmb3IgdGhlIEd1dHRlciB0byBiZSBhZGRlZCB0byB0aGUgZWRpdG9yIGZpcnN0XG4gICAgaWYgKHRoaXMucHJvcHMudHlwZSA9PT0gJ2d1dHRlcicpIHtcbiAgICAgIGlmICghdGhpcy5wcm9wcy5ndXR0ZXJOYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGFyZSB0cnlpbmcgdG8gZGVjb3JhdGUgYSBndXR0ZXIgYnV0IGRpZCBub3Qgc3VwcGx5IGd1dHRlck5hbWUgcHJvcC4nKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLm1hcChlZGl0b3IgPT4ge1xuICAgICAgICB0aGlzLmd1dHRlclN1YiA9IGVkaXRvci5vYnNlcnZlR3V0dGVycyhndXR0ZXIgPT4ge1xuICAgICAgICAgIGlmIChndXR0ZXIubmFtZSA9PT0gdGhpcy5wcm9wcy5ndXR0ZXJOYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZURlY29yYXRpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY3JlYXRlRGVjb3JhdGlvbigpO1xuICB9XG5cbiAgY3JlYXRlRGVjb3JhdGlvbigpIHtcbiAgICBpZiAodGhpcy51c2VzSXRlbSgpICYmICF0aGlzLml0ZW0pIHtcbiAgICAgIHRoaXMuaXRlbSA9IGNyZWF0ZUl0ZW0odGhpcy5kb21Ob2RlLCB0aGlzLnByb3BzLml0ZW1Ib2xkZXIpO1xuICAgIH1cblxuICAgIGNvbnN0IG9wdHMgPSB0aGlzLmdldERlY29yYXRpb25PcHRzKHRoaXMucHJvcHMpO1xuICAgIGNvbnN0IGVkaXRvciA9IHRoaXMucHJvcHMuZWRpdG9ySG9sZGVyLmdldCgpO1xuICAgIGNvbnN0IGRlY29yYWJsZSA9IHRoaXMucHJvcHMuZGVjb3JhYmxlSG9sZGVyLmdldCgpO1xuICAgIHRoaXMuZGVjb3JhdGlvbkhvbGRlci5zZXR0ZXIoXG4gICAgICBlZGl0b3JbdGhpcy5wcm9wcy5kZWNvcmF0ZU1ldGhvZF0oZGVjb3JhYmxlLCBvcHRzKSxcbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5kZWNvcmF0aW9uSG9sZGVyLm1hcChkZWNvcmF0aW9uID0+IGRlY29yYXRpb24uZGVzdHJveSgpKTtcbiAgICB0aGlzLmVkaXRvclN1Yi5kaXNwb3NlKCk7XG4gICAgdGhpcy5kZWNvcmFibGVTdWIuZGlzcG9zZSgpO1xuICAgIHRoaXMuZ3V0dGVyU3ViLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIGdldERlY29yYXRpb25PcHRzKHByb3BzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmV4dHJhY3RQcm9wcyhwcm9wcywgZGVjb3JhdGlvblByb3BUeXBlcywge2NsYXNzTmFtZTogJ2NsYXNzJ30pLFxuICAgICAgaXRlbTogdGhpcy5pdGVtLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGVjb3JhdGlvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZWRpdG9yOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRlY29yYWJsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBkZWNvcmF0ZU1ldGhvZDogUHJvcFR5cGVzLm9uZU9mKFsnZGVjb3JhdGVNYXJrZXInLCAnZGVjb3JhdGVNYXJrZXJMYXllciddKSxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGVkaXRvckhvbGRlcjogUmVmSG9sZGVyLm9uKHRoaXMucHJvcHMuZWRpdG9yKSxcbiAgICAgIGRlY29yYWJsZUhvbGRlcjogUmVmSG9sZGVyLm9uKHRoaXMucHJvcHMuZGVjb3JhYmxlKSxcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHtcbiAgICBjb25zdCBlZGl0b3JDaGFuZ2VkID0gc3RhdGUuZWRpdG9ySG9sZGVyXG4gICAgICAubWFwKGVkaXRvciA9PiBlZGl0b3IgIT09IHByb3BzLmVkaXRvcilcbiAgICAgIC5nZXRPcihwcm9wcy5lZGl0b3IgIT09IHVuZGVmaW5lZCk7XG4gICAgY29uc3QgZGVjb3JhYmxlQ2hhbmdlZCA9IHN0YXRlLmRlY29yYWJsZUhvbGRlclxuICAgICAgLm1hcChkZWNvcmFibGUgPT4gZGVjb3JhYmxlICE9PSBwcm9wcy5kZWNvcmFibGUpXG4gICAgICAuZ2V0T3IocHJvcHMuZGVjb3JhYmxlICE9PSB1bmRlZmluZWQpO1xuXG4gICAgaWYgKCFlZGl0b3JDaGFuZ2VkICYmICFkZWNvcmFibGVDaGFuZ2VkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBuZXh0U3RhdGUgPSB7fTtcbiAgICBpZiAoZWRpdG9yQ2hhbmdlZCkge1xuICAgICAgbmV4dFN0YXRlLmVkaXRvckhvbGRlciA9IFJlZkhvbGRlci5vbihwcm9wcy5lZGl0b3IpO1xuICAgIH1cbiAgICBpZiAoZGVjb3JhYmxlQ2hhbmdlZCkge1xuICAgICAgbmV4dFN0YXRlLmRlY29yYWJsZUhvbGRlciA9IFJlZkhvbGRlci5vbihwcm9wcy5kZWNvcmFibGUpO1xuICAgIH1cbiAgICByZXR1cm4gbmV4dFN0YXRlO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8VGV4dEVkaXRvckNvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgIHtlZGl0b3JIb2xkZXIgPT4gKFxuICAgICAgICAgIDxEZWNvcmFibGVDb250ZXh0LkNvbnN1bWVyPlxuICAgICAgICAgICAge2RlY29yYWJsZSA9PiB7XG4gICAgICAgICAgICAgIGxldCBob2xkZXIgPSBudWxsO1xuICAgICAgICAgICAgICBsZXQgZGVjb3JhdGVNZXRob2QgPSBudWxsO1xuICAgICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuZGVjb3JhYmxlSG9sZGVyLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGhvbGRlciA9IHRoaXMuc3RhdGUuZGVjb3JhYmxlSG9sZGVyO1xuICAgICAgICAgICAgICAgIGRlY29yYXRlTWV0aG9kID0gdGhpcy5wcm9wcy5kZWNvcmF0ZU1ldGhvZDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBob2xkZXIgPSBkZWNvcmFibGUuaG9sZGVyO1xuICAgICAgICAgICAgICAgIGRlY29yYXRlTWV0aG9kID0gZGVjb3JhYmxlLmRlY29yYXRlTWV0aG9kO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8QmFyZURlY29yYXRpb25cbiAgICAgICAgICAgICAgICAgIGVkaXRvckhvbGRlcj17ZWRpdG9ySG9sZGVyIHx8IHRoaXMuc3RhdGUuZWRpdG9ySG9sZGVyfVxuICAgICAgICAgICAgICAgICAgZGVjb3JhYmxlSG9sZGVyPXtob2xkZXJ9XG4gICAgICAgICAgICAgICAgICBkZWNvcmF0ZU1ldGhvZD17ZGVjb3JhdGVNZXRob2R9XG4gICAgICAgICAgICAgICAgICB7Li4udGhpcy5wcm9wc31cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICA8L0RlY29yYWJsZUNvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgICl9XG4gICAgICA8L1RleHRFZGl0b3JDb250ZXh0LkNvbnN1bWVyPlxuICAgICk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsVUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksV0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUssUUFBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0sV0FBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sZUFBQSxHQUFBUCxPQUFBO0FBQ0EsSUFBQVEsT0FBQSxHQUFBUixPQUFBO0FBQ0EsSUFBQVMsVUFBQSxHQUFBVixzQkFBQSxDQUFBQyxPQUFBO0FBQTZDLFNBQUFELHVCQUFBVyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsU0FBQSxJQUFBQSxRQUFBLEdBQUFDLE1BQUEsQ0FBQUMsTUFBQSxHQUFBRCxNQUFBLENBQUFDLE1BQUEsQ0FBQUMsSUFBQSxlQUFBQyxNQUFBLGFBQUFDLENBQUEsTUFBQUEsQ0FBQSxH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