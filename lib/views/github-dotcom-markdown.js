"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BareGithubDotcomMarkdown = void 0;
var _react = _interopRequireDefault(require("react"));
var _reactDom = _interopRequireDefault(require("react-dom"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _issueishLink = require("./issueish-link");
var _userMentionTooltipItem = _interopRequireDefault(require("../items/user-mention-tooltip-item"));
var _issueishTooltipItem = _interopRequireDefault(require("../items/issueish-tooltip-item"));
var _relayEnvironment = _interopRequireDefault(require("./relay-environment"));
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class BareGithubDotcomMarkdown extends _react.default.Component {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "handleClick", event => {
      if (event.target.dataset.url) {
        return this.props.handleClickEvent(event, event.target.dataset.url);
      } else {
        return null;
      }
    });
    _defineProperty(this, "openLinkInNewTab", event => {
      return this.props.openIssueishLinkInNewTab(event.target.dataset.url);
    });
    _defineProperty(this, "openLinkInThisTab", event => {
      const {
        repoOwner,
        repoName,
        issueishNumber
      } = (0, _issueishLink.getDataFromGithubUrl)(event.target.dataset.url);
      this.props.switchToIssueish(repoOwner, repoName, issueishNumber);
    });
    _defineProperty(this, "openLinkInBrowser", event => {
      return this.props.openLinkInBrowser(event.target.getAttribute('href'));
    });
  }
  componentDidMount() {
    this.commandSubscriptions = atom.commands.add(_reactDom.default.findDOMNode(this), {
      'github:open-link-in-new-tab': this.openLinkInNewTab,
      'github:open-link-in-browser': this.openLinkInBrowser,
      'github:open-link-in-this-tab': this.openLinkInThisTab
    });
    this.setupComponentHandlers();
    this.setupTooltipHandlers();
  }
  componentDidUpdate() {
    this.setupTooltipHandlers();
  }
  setupComponentHandlers() {
    this.component.addEventListener('click', this.handleClick);
    this.componentHandlers = new _eventKit.Disposable(() => {
      this.component.removeEventListener('click', this.handleClick);
    });
  }
  setupTooltipHandlers() {
    if (this.tooltipSubscriptions) {
      this.tooltipSubscriptions.dispose();
    }
    this.tooltipSubscriptions = new _eventKit.CompositeDisposable();
    this.component.querySelectorAll('.user-mention').forEach(node => {
      const item = new _userMentionTooltipItem.default(node.textContent, this.props.relayEnvironment);
      this.tooltipSubscriptions.add(atom.tooltips.add(node, {
        trigger: 'hover',
        delay: 0,
        class: 'github-Popover',
        item
      }));
      this.tooltipSubscriptions.add(new _eventKit.Disposable(() => item.destroy()));
    });
    this.component.querySelectorAll('.issue-link').forEach(node => {
      const item = new _issueishTooltipItem.default(node.getAttribute('href'), this.props.relayEnvironment);
      this.tooltipSubscriptions.add(atom.tooltips.add(node, {
        trigger: 'hover',
        delay: 0,
        class: 'github-Popover',
        item
      }));
      this.tooltipSubscriptions.add(new _eventKit.Disposable(() => item.destroy()));
    });
  }
  componentWillUnmount() {
    this.commandSubscriptions.dispose();
    this.componentHandlers.dispose();
    this.tooltipSubscriptions && this.tooltipSubscriptions.dispose();
  }
  render() {
    return _react.default.createElement("div", {
      className: `github-DotComMarkdownHtml native-key-bindings ${this.props.className}`,
      tabIndex: "-1",
      ref: c => {
        this.component = c;
      },
      dangerouslySetInnerHTML: {
        __html: this.props.html
      }
    });
  }
}
exports.BareGithubDotcomMarkdown = BareGithubDotcomMarkdown;
_defineProperty(BareGithubDotcomMarkdown, "propTypes", {
  relayEnvironment: _propTypes.default.object.isRequired,
  className: _propTypes.default.string,
  html: _propTypes.default.string.isRequired,
  switchToIssueish: _propTypes.default.func.isRequired,
  handleClickEvent: _propTypes.default.func,
  openIssueishLinkInNewTab: _propTypes.default.func,
  openLinkInBrowser: _propTypes.default.func
});
_defineProperty(BareGithubDotcomMarkdown, "defaultProps", {
  className: '',
  handleClickEvent: _issueishLink.handleClickEvent,
  openIssueishLinkInNewTab: _issueishLink.openIssueishLinkInNewTab,
  openLinkInBrowser: _issueishLink.openLinkInBrowser
});
class GithubDotcomMarkdown extends _react.default.Component {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "state", {
      lastMarkdown: null,
      html: null
    });
  }
  static getDerivedStateFromProps(props, state) {
    if (props.html) {
      return {
        html: props.html
      };
    }
    if (props.markdown && props.markdown !== state.lastMarkdown) {
      return {
        html: (0, _helpers.renderMarkdown)(props.markdown),
        lastMarkdown: props.markdown
      };
    }
    return null;
  }
  render() {
    return _react.default.createElement(_relayEnvironment.default.Consumer, null, relayEnvironment => _react.default.createElement(BareGithubDotcomMarkdown, _extends({
      relayEnvironment: relayEnvironment
    }, this.props, {
      html: this.state.html
    })));
  }
}
exports.default = GithubDotcomMarkdown;
_defineProperty(GithubDotcomMarkdown, "propTypes", {
  markdown: _propTypes.default.string,
  html: _propTypes.default.string
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdERvbSIsIl9wcm9wVHlwZXMiLCJfZXZlbnRLaXQiLCJfaXNzdWVpc2hMaW5rIiwiX3VzZXJNZW50aW9uVG9vbHRpcEl0ZW0iLCJfaXNzdWVpc2hUb29sdGlwSXRlbSIsIl9yZWxheUVudmlyb25tZW50IiwiX2hlbHBlcnMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9leHRlbmRzIiwiT2JqZWN0IiwiYXNzaWduIiwiYmluZCIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsIl9kZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImFyZyIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsImlucHV0IiwiaGludCIsInByaW0iLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsInVuZGVmaW5lZCIsInJlcyIsIlR5cGVFcnJvciIsIk51bWJlciIsIkJhcmVHaXRodWJEb3Rjb21NYXJrZG93biIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJhcmdzIiwiZXZlbnQiLCJkYXRhc2V0IiwidXJsIiwicHJvcHMiLCJoYW5kbGVDbGlja0V2ZW50Iiwib3Blbklzc3VlaXNoTGlua0luTmV3VGFiIiwicmVwb093bmVyIiwicmVwb05hbWUiLCJpc3N1ZWlzaE51bWJlciIsImdldERhdGFGcm9tR2l0aHViVXJsIiwic3dpdGNoVG9Jc3N1ZWlzaCIsIm9wZW5MaW5rSW5Ccm93c2VyIiwiZ2V0QXR0cmlidXRlIiwiY29tcG9uZW50RGlkTW91bnQiLCJjb21tYW5kU3Vic2NyaXB0aW9ucyIsImF0b20iLCJjb21tYW5kcyIsImFkZCIsIlJlYWN0RG9tIiwiZmluZERPTU5vZGUiLCJvcGVuTGlua0luTmV3VGFiIiwib3BlbkxpbmtJblRoaXNUYWIiLCJzZXR1cENvbXBvbmVudEhhbmRsZXJzIiwic2V0dXBUb29sdGlwSGFuZGxlcnMiLCJjb21wb25lbnREaWRVcGRhdGUiLCJjb21wb25lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlQ2xpY2siLCJjb21wb25lbnRIYW5kbGVycyIsIkRpc3Bvc2FibGUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidG9vbHRpcFN1YnNjcmlwdGlvbnMiLCJkaXNwb3NlIiwiQ29tcG9zaXRlRGlzcG9zYWJsZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibm9kZSIsIml0ZW0iLCJVc2VyTWVudGlvblRvb2x0aXBJdGVtIiwidGV4dENvbnRlbnQiLCJyZWxheUVudmlyb25tZW50IiwidG9vbHRpcHMiLCJ0cmlnZ2VyIiwiZGVsYXkiLCJjbGFzcyIsImRlc3Ryb3kiLCJJc3N1ZWlzaFRvb2x0aXBJdGVtIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZW5kZXIiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwidGFiSW5kZXgiLCJyZWYiLCJjIiwiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiLCJfX2h0bWwiLCJodG1sIiwiZXhwb3J0cyIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJzdHJpbmciLCJmdW5jIiwiR2l0aHViRG90Y29tTWFya2Rvd24iLCJsYXN0TWFya2Rvd24iLCJnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMiLCJzdGF0ZSIsIm1hcmtkb3duIiwicmVuZGVyTWFya2Rvd24iLCJDb25zdW1lciJdLCJzb3VyY2VzIjpbImdpdGh1Yi1kb3Rjb20tbWFya2Rvd24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERvbSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgRGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcblxuaW1wb3J0IHtoYW5kbGVDbGlja0V2ZW50LCBvcGVuSXNzdWVpc2hMaW5rSW5OZXdUYWIsIG9wZW5MaW5rSW5Ccm93c2VyLCBnZXREYXRhRnJvbUdpdGh1YlVybH0gZnJvbSAnLi9pc3N1ZWlzaC1saW5rJztcbmltcG9ydCBVc2VyTWVudGlvblRvb2x0aXBJdGVtIGZyb20gJy4uL2l0ZW1zL3VzZXItbWVudGlvbi10b29sdGlwLWl0ZW0nO1xuaW1wb3J0IElzc3VlaXNoVG9vbHRpcEl0ZW0gZnJvbSAnLi4vaXRlbXMvaXNzdWVpc2gtdG9vbHRpcC1pdGVtJztcbmltcG9ydCBSZWxheUVudmlyb25tZW50IGZyb20gJy4vcmVsYXktZW52aXJvbm1lbnQnO1xuaW1wb3J0IHtyZW5kZXJNYXJrZG93bn0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmV4cG9ydCBjbGFzcyBCYXJlR2l0aHViRG90Y29tTWFya2Rvd24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHJlbGF5RW52aXJvbm1lbnQ6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgICBodG1sOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cbiAgICBzd2l0Y2hUb0lzc3VlaXNoOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGhhbmRsZUNsaWNrRXZlbnQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9wZW5Jc3N1ZWlzaExpbmtJbk5ld1RhYjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb3BlbkxpbmtJbkJyb3dzZXI6IFByb3BUeXBlcy5mdW5jLFxuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBjbGFzc05hbWU6ICcnLFxuICAgIGhhbmRsZUNsaWNrRXZlbnQsXG4gICAgb3Blbklzc3VlaXNoTGlua0luTmV3VGFiLFxuICAgIG9wZW5MaW5rSW5Ccm93c2VyLFxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5jb21tYW5kU3Vic2NyaXB0aW9ucyA9IGF0b20uY29tbWFuZHMuYWRkKFJlYWN0RG9tLmZpbmRET01Ob2RlKHRoaXMpLCB7XG4gICAgICAnZ2l0aHViOm9wZW4tbGluay1pbi1uZXctdGFiJzogdGhpcy5vcGVuTGlua0luTmV3VGFiLFxuICAgICAgJ2dpdGh1YjpvcGVuLWxpbmstaW4tYnJvd3Nlcic6IHRoaXMub3BlbkxpbmtJbkJyb3dzZXIsXG4gICAgICAnZ2l0aHViOm9wZW4tbGluay1pbi10aGlzLXRhYic6IHRoaXMub3BlbkxpbmtJblRoaXNUYWIsXG4gICAgfSk7XG4gICAgdGhpcy5zZXR1cENvbXBvbmVudEhhbmRsZXJzKCk7XG4gICAgdGhpcy5zZXR1cFRvb2x0aXBIYW5kbGVycygpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIHRoaXMuc2V0dXBUb29sdGlwSGFuZGxlcnMoKTtcbiAgfVxuXG4gIHNldHVwQ29tcG9uZW50SGFuZGxlcnMoKSB7XG4gICAgdGhpcy5jb21wb25lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKTtcbiAgICB0aGlzLmNvbXBvbmVudEhhbmRsZXJzID0gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xuICAgICAgdGhpcy5jb21wb25lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldHVwVG9vbHRpcEhhbmRsZXJzKCkge1xuICAgIGlmICh0aGlzLnRvb2x0aXBTdWJzY3JpcHRpb25zKSB7XG4gICAgICB0aGlzLnRvb2x0aXBTdWJzY3JpcHRpb25zLmRpc3Bvc2UoKTtcbiAgICB9XG5cbiAgICB0aGlzLnRvb2x0aXBTdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICB0aGlzLmNvbXBvbmVudC5xdWVyeVNlbGVjdG9yQWxsKCcudXNlci1tZW50aW9uJykuZm9yRWFjaChub2RlID0+IHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgVXNlck1lbnRpb25Ub29sdGlwSXRlbShub2RlLnRleHRDb250ZW50LCB0aGlzLnByb3BzLnJlbGF5RW52aXJvbm1lbnQpO1xuICAgICAgdGhpcy50b29sdGlwU3Vic2NyaXB0aW9ucy5hZGQoYXRvbS50b29sdGlwcy5hZGQobm9kZSwge1xuICAgICAgICB0cmlnZ2VyOiAnaG92ZXInLFxuICAgICAgICBkZWxheTogMCxcbiAgICAgICAgY2xhc3M6ICdnaXRodWItUG9wb3ZlcicsXG4gICAgICAgIGl0ZW0sXG4gICAgICB9KSk7XG4gICAgICB0aGlzLnRvb2x0aXBTdWJzY3JpcHRpb25zLmFkZChuZXcgRGlzcG9zYWJsZSgoKSA9PiBpdGVtLmRlc3Ryb3koKSkpO1xuICAgIH0pO1xuICAgIHRoaXMuY29tcG9uZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pc3N1ZS1saW5rJykuZm9yRWFjaChub2RlID0+IHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgSXNzdWVpc2hUb29sdGlwSXRlbShub2RlLmdldEF0dHJpYnV0ZSgnaHJlZicpLCB0aGlzLnByb3BzLnJlbGF5RW52aXJvbm1lbnQpO1xuICAgICAgdGhpcy50b29sdGlwU3Vic2NyaXB0aW9ucy5hZGQoYXRvbS50b29sdGlwcy5hZGQobm9kZSwge1xuICAgICAgICB0cmlnZ2VyOiAnaG92ZXInLFxuICAgICAgICBkZWxheTogMCxcbiAgICAgICAgY2xhc3M6ICdnaXRodWItUG9wb3ZlcicsXG4gICAgICAgIGl0ZW0sXG4gICAgICB9KSk7XG4gICAgICB0aGlzLnRvb2x0aXBTdWJzY3JpcHRpb25zLmFkZChuZXcgRGlzcG9zYWJsZSgoKSA9PiBpdGVtLmRlc3Ryb3koKSkpO1xuICAgIH0pO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5jb21tYW5kU3Vic2NyaXB0aW9ucy5kaXNwb3NlKCk7XG4gICAgdGhpcy5jb21wb25lbnRIYW5kbGVycy5kaXNwb3NlKCk7XG4gICAgdGhpcy50b29sdGlwU3Vic2NyaXB0aW9ucyAmJiB0aGlzLnRvb2x0aXBTdWJzY3JpcHRpb25zLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9e2BnaXRodWItRG90Q29tTWFya2Rvd25IdG1sIG5hdGl2ZS1rZXktYmluZGluZ3MgJHt0aGlzLnByb3BzLmNsYXNzTmFtZX1gfVxuICAgICAgICB0YWJJbmRleD1cIi0xXCJcbiAgICAgICAgcmVmPXtjID0+IHsgdGhpcy5jb21wb25lbnQgPSBjOyB9fVxuICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTD17e19faHRtbDogdGhpcy5wcm9wcy5odG1sfX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIGhhbmRsZUNsaWNrID0gZXZlbnQgPT4ge1xuICAgIGlmIChldmVudC50YXJnZXQuZGF0YXNldC51cmwpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLmhhbmRsZUNsaWNrRXZlbnQoZXZlbnQsIGV2ZW50LnRhcmdldC5kYXRhc2V0LnVybCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIG9wZW5MaW5rSW5OZXdUYWIgPSBldmVudCA9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMub3Blbklzc3VlaXNoTGlua0luTmV3VGFiKGV2ZW50LnRhcmdldC5kYXRhc2V0LnVybCk7XG4gIH1cblxuICBvcGVuTGlua0luVGhpc1RhYiA9IGV2ZW50ID0+IHtcbiAgICBjb25zdCB7cmVwb093bmVyLCByZXBvTmFtZSwgaXNzdWVpc2hOdW1iZXJ9ID0gZ2V0RGF0YUZyb21HaXRodWJVcmwoZXZlbnQudGFyZ2V0LmRhdGFzZXQudXJsKTtcbiAgICB0aGlzLnByb3BzLnN3aXRjaFRvSXNzdWVpc2gocmVwb093bmVyLCByZXBvTmFtZSwgaXNzdWVpc2hOdW1iZXIpO1xuICB9XG5cbiAgb3BlbkxpbmtJbkJyb3dzZXIgPSBldmVudCA9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMub3BlbkxpbmtJbkJyb3dzZXIoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHaXRodWJEb3Rjb21NYXJrZG93biBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgbWFya2Rvd246IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgaHRtbDogUHJvcFR5cGVzLnN0cmluZyxcbiAgfVxuXG4gIHN0YXRlID0ge1xuICAgIGxhc3RNYXJrZG93bjogbnVsbCxcbiAgICBodG1sOiBudWxsLFxuICB9XG5cbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHtcbiAgICBpZiAocHJvcHMuaHRtbCkge1xuICAgICAgcmV0dXJuIHtodG1sOiBwcm9wcy5odG1sfTtcbiAgICB9XG5cbiAgICBpZiAocHJvcHMubWFya2Rvd24gJiYgcHJvcHMubWFya2Rvd24gIT09IHN0YXRlLmxhc3RNYXJrZG93bikge1xuICAgICAgcmV0dXJuIHtodG1sOiByZW5kZXJNYXJrZG93bihwcm9wcy5tYXJrZG93biksIGxhc3RNYXJrZG93bjogcHJvcHMubWFya2Rvd259O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8UmVsYXlFbnZpcm9ubWVudC5Db25zdW1lcj5cbiAgICAgICAge3JlbGF5RW52aXJvbm1lbnQgPT4gKFxuICAgICAgICAgIDxCYXJlR2l0aHViRG90Y29tTWFya2Rvd25cbiAgICAgICAgICAgIHJlbGF5RW52aXJvbm1lbnQ9e3JlbGF5RW52aXJvbm1lbnR9XG4gICAgICAgICAgICB7Li4udGhpcy5wcm9wc31cbiAgICAgICAgICAgIGh0bWw9e3RoaXMuc3RhdGUuaHRtbH1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgPC9SZWxheUVudmlyb25tZW50LkNvbnN1bWVyPlxuICAgICk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsVUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSCxPQUFBO0FBRUEsSUFBQUksYUFBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssdUJBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLG9CQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTyxpQkFBQSxHQUFBUixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQVEsUUFBQSxHQUFBUixPQUFBO0FBQTBDLFNBQUFELHVCQUFBVSxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsU0FBQSxJQUFBQSxRQUFBLEdBQUFDLE1BQUEsQ0FBQUMsTUFBQSxHQUFBRCxNQUFBLENBQUFDLE1BQUEsQ0FBQUMsSUFBQSxlQUFBQyxNQUFBLGFBQUFDLENBQUEsTUFBQUEsQ0FBQSxHQUFBQyxTQUFBLENBQUFDLE1BQUEsRUFBQUYsQ0FBQSxVQUFBRyxNQUFBLEdBQUFGLFNBQUEsQ0FBQUQsQ0FBQSxZQUFBSSxHQUFBLElBQUFELE1BQUEsUUFBQVAsTUFBQSxDQUFBUyxTQUFBLENBQUFDLGNBQUEsQ0FBQUMsSUFBQSxDQUFBSixNQUFBLEVBQUFDLEdBQUEsS0FBQUwsTUFBQSxDQUFBSyxHQUFBLElBQUFELE1BQUEsQ0FBQUMsR0FBQSxnQkFBQUwsTUFBQSxZQUFB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