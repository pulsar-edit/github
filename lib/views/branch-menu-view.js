"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _classnames = _interopRequireDefault(require("classnames"));
var _commands = _interopRequireWildcard(require("../atom/commands"));
var _propTypes2 = require("../prop-types");
var _gitShellOutStrategy = require("../git-shell-out-strategy");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class BranchMenuView extends _react.default.Component {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "state", {
      createNew: false,
      checkedOutBranch: null
    });
    _defineProperty(this, "didSelectItem", async event => {
      const branchName = event.target.value;
      await this.checkout(branchName);
    });
    _defineProperty(this, "createBranch", async () => {
      if (this.state.createNew) {
        const branchName = this.editorElement.getModel().getText().trim();
        await this.checkout(branchName, {
          createNew: true
        });
      } else {
        await new Promise(resolve => {
          this.setState({
            createNew: true
          }, () => {
            this.editorElement.focus();
            resolve();
          });
        });
      }
    });
    _defineProperty(this, "checkout", async (branchName, options) => {
      this.editorElement.classList.remove('is-focused');
      await new Promise(resolve => {
        this.setState({
          checkedOutBranch: branchName
        }, resolve);
      });
      try {
        await this.props.checkout(branchName, options);
        await new Promise(resolve => {
          this.setState({
            checkedOutBranch: null,
            createNew: false
          }, resolve);
        });
        this.editorElement.getModel().setText('');
      } catch (error) {
        this.editorElement.classList.add('is-focused');
        await new Promise(resolve => {
          this.setState({
            checkedOutBranch: null
          }, resolve);
        });
        if (!(error instanceof _gitShellOutStrategy.GitError)) {
          throw error;
        }
      }
    });
    _defineProperty(this, "cancelCreateNewBranch", () => {
      this.setState({
        createNew: false
      });
    });
  }
  render() {
    const branchNames = this.props.branches.getNames().filter(Boolean);
    let currentBranchName = this.props.currentBranch.isDetached() ? 'detached' : this.props.currentBranch.getName();
    if (this.state.checkedOutBranch) {
      currentBranchName = this.state.checkedOutBranch;
      if (branchNames.indexOf(this.state.checkedOutBranch) === -1) {
        branchNames.push(this.state.checkedOutBranch);
      }
    }
    const disableControls = !!this.state.checkedOutBranch;
    const branchEditorClasses = (0, _classnames.default)('github-BranchMenuView-item', 'github-BranchMenuView-editor', {
      hidden: !this.state.createNew
    });
    const branchSelectListClasses = (0, _classnames.default)('github-BranchMenuView-item', 'github-BranchMenuView-select', 'input-select', {
      hidden: !!this.state.createNew
    });
    const iconClasses = (0, _classnames.default)('github-BranchMenuView-item', 'icon', {
      'icon-git-branch': !disableControls,
      'icon-sync': disableControls
    });
    const newBranchEditor = _react.default.createElement("div", {
      className: branchEditorClasses
    }, _react.default.createElement("atom-text-editor", {
      ref: e => {
        this.editorElement = e;
      },
      mini: true,
      readonly: disableControls ? true : undefined
    }));
    const selectBranchView = /* eslint-disable jsx-a11y/no-onchange */
    _react.default.createElement("select", {
      className: branchSelectListClasses,
      onChange: this.didSelectItem,
      disabled: disableControls,
      value: currentBranchName
    }, this.props.currentBranch.isDetached() && _react.default.createElement("option", {
      key: "detached",
      value: "detached",
      disabled: true
    }, this.props.currentBranch.getName()), branchNames.map(branchName => {
      return _react.default.createElement("option", {
        key: `branch-${branchName}`,
        value: branchName
      }, branchName);
    }));
    return _react.default.createElement("div", {
      className: "github-BranchMenuView"
    }, _react.default.createElement(_commands.default, {
      registry: this.props.commands,
      target: ".github-BranchMenuView-editor atom-text-editor[mini]"
    }, _react.default.createElement(_commands.Command, {
      command: "tool-panel:unfocus",
      callback: this.cancelCreateNewBranch
    }), _react.default.createElement(_commands.Command, {
      command: "core:cancel",
      callback: this.cancelCreateNewBranch
    }), _react.default.createElement(_commands.Command, {
      command: "core:confirm",
      callback: this.createBranch
    })), _react.default.createElement("div", {
      className: "github-BranchMenuView-selector"
    }, _react.default.createElement("span", {
      className: iconClasses
    }), newBranchEditor, selectBranchView, _react.default.createElement("button", {
      className: "github-BranchMenuView-item github-BranchMenuView-button btn",
      onClick: this.createBranch,
      disabled: disableControls
    }, " New Branch ")));
  }
}
exports.default = BranchMenuView;
_defineProperty(BranchMenuView, "propTypes", {
  // Atom environment
  workspace: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  notificationManager: _propTypes.default.object.isRequired,
  // Model
  repository: _propTypes.default.object,
  branches: _propTypes2.BranchSetPropType.isRequired,
  currentBranch: _propTypes2.BranchPropType.isRequired,
  checkout: _propTypes.default.func
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfY2xhc3NuYW1lcyIsIl9jb21tYW5kcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX3Byb3BUeXBlczIiLCJfZ2l0U2hlbGxPdXRTdHJhdGVneSIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsImUiLCJXZWFrTWFwIiwiciIsInQiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImhhcyIsImdldCIsIm4iLCJfX3Byb3RvX18iLCJhIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJ1IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaSIsInNldCIsIm9iaiIsIl9kZWZpbmVQcm9wZXJ0eSIsImtleSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJhcmciLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJpbnB1dCIsImhpbnQiLCJwcmltIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJ1bmRlZmluZWQiLCJyZXMiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJCcmFuY2hNZW51VmlldyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJhcmdzIiwiY3JlYXRlTmV3IiwiY2hlY2tlZE91dEJyYW5jaCIsImV2ZW50IiwiYnJhbmNoTmFtZSIsInRhcmdldCIsImNoZWNrb3V0Iiwic3RhdGUiLCJlZGl0b3JFbGVtZW50IiwiZ2V0TW9kZWwiLCJnZXRUZXh0IiwidHJpbSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0U3RhdGUiLCJmb2N1cyIsIm9wdGlvbnMiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJwcm9wcyIsInNldFRleHQiLCJlcnJvciIsImFkZCIsIkdpdEVycm9yIiwicmVuZGVyIiwiYnJhbmNoTmFtZXMiLCJicmFuY2hlcyIsImdldE5hbWVzIiwiZmlsdGVyIiwiQm9vbGVhbiIsImN1cnJlbnRCcmFuY2hOYW1lIiwiY3VycmVudEJyYW5jaCIsImlzRGV0YWNoZWQiLCJnZXROYW1lIiwiaW5kZXhPZiIsInB1c2giLCJkaXNhYmxlQ29udHJvbHMiLCJicmFuY2hFZGl0b3JDbGFzc2VzIiwiY3giLCJoaWRkZW4iLCJicmFuY2hTZWxlY3RMaXN0Q2xhc3NlcyIsImljb25DbGFzc2VzIiwibmV3QnJhbmNoRWRpdG9yIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInJlZiIsIm1pbmkiLCJyZWFkb25seSIsInNlbGVjdEJyYW5jaFZpZXciLCJvbkNoYW5nZSIsImRpZFNlbGVjdEl0ZW0iLCJkaXNhYmxlZCIsIm1hcCIsInJlZ2lzdHJ5IiwiY29tbWFuZHMiLCJDb21tYW5kIiwiY29tbWFuZCIsImNhbGxiYWNrIiwiY2FuY2VsQ3JlYXRlTmV3QnJhbmNoIiwiY3JlYXRlQnJhbmNoIiwib25DbGljayIsImV4cG9ydHMiLCJ3b3Jrc3BhY2UiLCJQcm9wVHlwZXMiLCJvYmplY3QiLCJpc1JlcXVpcmVkIiwibm90aWZpY2F0aW9uTWFuYWdlciIsInJlcG9zaXRvcnkiLCJCcmFuY2hTZXRQcm9wVHlwZSIsIkJyYW5jaFByb3BUeXBlIiwiZnVuYyJdLCJzb3VyY2VzIjpbImJyYW5jaC1tZW51LXZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcyc7XG5cbmltcG9ydCBDb21tYW5kcywge0NvbW1hbmR9IGZyb20gJy4uL2F0b20vY29tbWFuZHMnO1xuaW1wb3J0IHtCcmFuY2hQcm9wVHlwZSwgQnJhbmNoU2V0UHJvcFR5cGV9IGZyb20gJy4uL3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtHaXRFcnJvcn0gZnJvbSAnLi4vZ2l0LXNoZWxsLW91dC1zdHJhdGVneSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJyYW5jaE1lbnVWaWV3IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyBBdG9tIGVudmlyb25tZW50XG4gICAgd29ya3NwYWNlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY29tbWFuZHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBub3RpZmljYXRpb25NYW5hZ2VyOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG5cbiAgICAvLyBNb2RlbFxuICAgIHJlcG9zaXRvcnk6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgYnJhbmNoZXM6IEJyYW5jaFNldFByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgY3VycmVudEJyYW5jaDogQnJhbmNoUHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICBjaGVja291dDogUHJvcFR5cGVzLmZ1bmMsXG4gIH1cblxuICBzdGF0ZSA9IHtcbiAgICBjcmVhdGVOZXc6IGZhbHNlLFxuICAgIGNoZWNrZWRPdXRCcmFuY2g6IG51bGwsXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgYnJhbmNoTmFtZXMgPSB0aGlzLnByb3BzLmJyYW5jaGVzLmdldE5hbWVzKCkuZmlsdGVyKEJvb2xlYW4pO1xuICAgIGxldCBjdXJyZW50QnJhbmNoTmFtZSA9IHRoaXMucHJvcHMuY3VycmVudEJyYW5jaC5pc0RldGFjaGVkKCkgPyAnZGV0YWNoZWQnIDogdGhpcy5wcm9wcy5jdXJyZW50QnJhbmNoLmdldE5hbWUoKTtcbiAgICBpZiAodGhpcy5zdGF0ZS5jaGVja2VkT3V0QnJhbmNoKSB7XG4gICAgICBjdXJyZW50QnJhbmNoTmFtZSA9IHRoaXMuc3RhdGUuY2hlY2tlZE91dEJyYW5jaDtcbiAgICAgIGlmIChicmFuY2hOYW1lcy5pbmRleE9mKHRoaXMuc3RhdGUuY2hlY2tlZE91dEJyYW5jaCkgPT09IC0xKSB7XG4gICAgICAgIGJyYW5jaE5hbWVzLnB1c2godGhpcy5zdGF0ZS5jaGVja2VkT3V0QnJhbmNoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkaXNhYmxlQ29udHJvbHMgPSAhIXRoaXMuc3RhdGUuY2hlY2tlZE91dEJyYW5jaDtcblxuICAgIGNvbnN0IGJyYW5jaEVkaXRvckNsYXNzZXMgPSBjeCgnZ2l0aHViLUJyYW5jaE1lbnVWaWV3LWl0ZW0nLCAnZ2l0aHViLUJyYW5jaE1lbnVWaWV3LWVkaXRvcicsIHtcbiAgICAgIGhpZGRlbjogIXRoaXMuc3RhdGUuY3JlYXRlTmV3LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYnJhbmNoU2VsZWN0TGlzdENsYXNzZXMgPSBjeCgnZ2l0aHViLUJyYW5jaE1lbnVWaWV3LWl0ZW0nLCAnZ2l0aHViLUJyYW5jaE1lbnVWaWV3LXNlbGVjdCcsICdpbnB1dC1zZWxlY3QnLCB7XG4gICAgICBoaWRkZW46ICEhdGhpcy5zdGF0ZS5jcmVhdGVOZXcsXG4gICAgfSk7XG5cbiAgICBjb25zdCBpY29uQ2xhc3NlcyA9IGN4KCdnaXRodWItQnJhbmNoTWVudVZpZXctaXRlbScsICdpY29uJywge1xuICAgICAgJ2ljb24tZ2l0LWJyYW5jaCc6ICFkaXNhYmxlQ29udHJvbHMsXG4gICAgICAnaWNvbi1zeW5jJzogZGlzYWJsZUNvbnRyb2xzLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbmV3QnJhbmNoRWRpdG9yID0gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2JyYW5jaEVkaXRvckNsYXNzZXN9PlxuICAgICAgICA8YXRvbS10ZXh0LWVkaXRvclxuICAgICAgICAgIHJlZj17ZSA9PiB7IHRoaXMuZWRpdG9yRWxlbWVudCA9IGU7IH19XG4gICAgICAgICAgbWluaT17dHJ1ZX1cbiAgICAgICAgICByZWFkb25seT17ZGlzYWJsZUNvbnRyb2xzID8gdHJ1ZSA6IHVuZGVmaW5lZH1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG5cbiAgICBjb25zdCBzZWxlY3RCcmFuY2hWaWV3ID0gKFxuICAgICAgLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvbm8tb25jaGFuZ2UgKi9cbiAgICAgIDxzZWxlY3RcbiAgICAgICAgY2xhc3NOYW1lPXticmFuY2hTZWxlY3RMaXN0Q2xhc3Nlc31cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMuZGlkU2VsZWN0SXRlbX1cbiAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVDb250cm9sc31cbiAgICAgICAgdmFsdWU9e2N1cnJlbnRCcmFuY2hOYW1lfT5cbiAgICAgICAge3RoaXMucHJvcHMuY3VycmVudEJyYW5jaC5pc0RldGFjaGVkKCkgJiZcbiAgICAgICAgICA8b3B0aW9uIGtleT1cImRldGFjaGVkXCIgdmFsdWU9XCJkZXRhY2hlZFwiIGRpc2FibGVkPnt0aGlzLnByb3BzLmN1cnJlbnRCcmFuY2guZ2V0TmFtZSgpfTwvb3B0aW9uPlxuICAgICAgICB9XG4gICAgICAgIHticmFuY2hOYW1lcy5tYXAoYnJhbmNoTmFtZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIDxvcHRpb24ga2V5PXtgYnJhbmNoLSR7YnJhbmNoTmFtZX1gfSB2YWx1ZT17YnJhbmNoTmFtZX0+e2JyYW5jaE5hbWV9PC9vcHRpb24+O1xuICAgICAgICB9KX1cbiAgICAgIDwvc2VsZWN0PlxuICAgICk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJnaXRodWItQnJhbmNoTWVudVZpZXdcIj5cbiAgICAgICAgPENvbW1hbmRzIHJlZ2lzdHJ5PXt0aGlzLnByb3BzLmNvbW1hbmRzfSB0YXJnZXQ9XCIuZ2l0aHViLUJyYW5jaE1lbnVWaWV3LWVkaXRvciBhdG9tLXRleHQtZWRpdG9yW21pbmldXCI+XG4gICAgICAgICAgPENvbW1hbmQgY29tbWFuZD1cInRvb2wtcGFuZWw6dW5mb2N1c1wiIGNhbGxiYWNrPXt0aGlzLmNhbmNlbENyZWF0ZU5ld0JyYW5jaH0gLz5cbiAgICAgICAgICA8Q29tbWFuZCBjb21tYW5kPVwiY29yZTpjYW5jZWxcIiBjYWxsYmFjaz17dGhpcy5jYW5jZWxDcmVhdGVOZXdCcmFuY2h9IC8+XG4gICAgICAgICAgPENvbW1hbmQgY29tbWFuZD1cImNvcmU6Y29uZmlybVwiIGNhbGxiYWNrPXt0aGlzLmNyZWF0ZUJyYW5jaH0gLz5cbiAgICAgICAgPC9Db21tYW5kcz5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJnaXRodWItQnJhbmNoTWVudVZpZXctc2VsZWN0b3JcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e2ljb25DbGFzc2VzfSAvPlxuICAgICAgICAgIHtuZXdCcmFuY2hFZGl0b3J9XG4gICAgICAgICAge3NlbGVjdEJyYW5jaFZpZXd9XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJnaXRodWItQnJhbmNoTWVudVZpZXctaXRlbSBnaXRodWItQnJhbmNoTWVudVZpZXctYnV0dG9uIGJ0blwiXG4gICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmNyZWF0ZUJyYW5jaH0gZGlzYWJsZWQ9e2Rpc2FibGVDb250cm9sc30+IE5ldyBCcmFuY2ggPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIGRpZFNlbGVjdEl0ZW0gPSBhc3luYyBldmVudCA9PiB7XG4gICAgY29uc3QgYnJhbmNoTmFtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICBhd2FpdCB0aGlzLmNoZWNrb3V0KGJyYW5jaE5hbWUpO1xuICB9XG5cbiAgY3JlYXRlQnJhbmNoID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICh0aGlzLnN0YXRlLmNyZWF0ZU5ldykge1xuICAgICAgY29uc3QgYnJhbmNoTmFtZSA9IHRoaXMuZWRpdG9yRWxlbWVudC5nZXRNb2RlbCgpLmdldFRleHQoKS50cmltKCk7XG4gICAgICBhd2FpdCB0aGlzLmNoZWNrb3V0KGJyYW5jaE5hbWUsIHtjcmVhdGVOZXc6IHRydWV9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe2NyZWF0ZU5ldzogdHJ1ZX0sICgpID0+IHtcbiAgICAgICAgICB0aGlzLmVkaXRvckVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY2hlY2tvdXQgPSBhc3luYyAoYnJhbmNoTmFtZSwgb3B0aW9ucykgPT4ge1xuICAgIHRoaXMuZWRpdG9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1mb2N1c2VkJyk7XG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtjaGVja2VkT3V0QnJhbmNoOiBicmFuY2hOYW1lfSwgcmVzb2x2ZSk7XG4gICAgfSk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMucHJvcHMuY2hlY2tvdXQoYnJhbmNoTmFtZSwgb3B0aW9ucyk7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7Y2hlY2tlZE91dEJyYW5jaDogbnVsbCwgY3JlYXRlTmV3OiBmYWxzZX0sIHJlc29sdmUpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmVkaXRvckVsZW1lbnQuZ2V0TW9kZWwoKS5zZXRUZXh0KCcnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5lZGl0b3JFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2lzLWZvY3VzZWQnKTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtjaGVja2VkT3V0QnJhbmNoOiBudWxsfSwgcmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgR2l0RXJyb3IpKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNhbmNlbENyZWF0ZU5ld0JyYW5jaCA9ICgpID0+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