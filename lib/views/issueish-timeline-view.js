"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.collectionRenderer = collectionRenderer;
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _propTypes2 = require("../prop-types");
var _helpers = require("../helpers");
var _octicon = _interopRequireDefault(require("../atom/octicon"));
var _commitsView = _interopRequireDefault(require("./timeline-items/commits-view.js"));
var _issueCommentView = _interopRequireDefault(require("./timeline-items/issue-comment-view.js"));
var _mergedEventView = _interopRequireDefault(require("./timeline-items/merged-event-view.js"));
var _headRefForcePushedEventView = _interopRequireDefault(require("./timeline-items/head-ref-force-pushed-event-view.js"));
var _crossReferencedEventsView = _interopRequireDefault(require("./timeline-items/cross-referenced-events-view.js"));
var _commitCommentThreadView = _interopRequireDefault(require("./timeline-items/commit-comment-thread-view"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function collectionRenderer(Component, styleAsTimelineItem = true) {
  var _class;
  return _class = class GroupedComponent extends _react.default.Component {
    static getFragment(fragName, ...args) {
      const frag = fragName === 'nodes' ? 'item' : fragName;
      return Component.getFragment(frag, ...args);
    }
    constructor(props) {
      super(props);
      (0, _helpers.autobind)(this, 'renderNode');
    }
    render() {
      return _react.default.createElement("div", {
        className: styleAsTimelineItem ? 'timeline-item' : ''
      }, this.props.nodes.map(this.renderNode));
    }
    renderNode(node, i) {
      return _react.default.createElement(Component, {
        key: i,
        item: node,
        issueish: this.props.issueish,
        switchToIssueish: this.props.switchToIssueish
      });
    }
  }, _defineProperty(_class, "displayName", `Grouped(${Component.render ? Component.render.displayName : Component.displayName})`), _defineProperty(_class, "propTypes", {
    nodes: _propTypes.default.array.isRequired,
    issueish: _propTypes.default.object.isRequired,
    switchToIssueish: _propTypes.default.func.isRequired
  }), _class;
}
const timelineItems = {
  PullRequestCommit: _commitsView.default,
  PullRequestCommitCommentThread: collectionRenderer(_commitCommentThreadView.default, false),
  IssueComment: collectionRenderer(_issueCommentView.default, false),
  MergedEvent: collectionRenderer(_mergedEventView.default),
  HeadRefForcePushedEvent: collectionRenderer(_headRefForcePushedEventView.default),
  CrossReferencedEvent: _crossReferencedEventsView.default
};
const TimelineConnectionPropType = (0, _propTypes2.RelayConnectionPropType)(_propTypes.default.shape({
  __typename: _propTypes.default.string.isRequired
})).isRequired;
class IssueishTimelineView extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _helpers.autobind)(this, 'loadMore');
  }
  loadMore() {
    this.props.relay.loadMore(10, () => {
      this.forceUpdate();
    });
    this.forceUpdate();
  }
  render() {
    const issueish = this.props.issue || this.props.pullRequest;
    const groupedEdges = this.groupEdges(issueish.timelineItems.edges);
    return _react.default.createElement("div", {
      className: "github-PrTimeline"
    }, groupedEdges.map(({
      type,
      edges
    }) => {
      const Component = timelineItems[type];
      const propsForCommits = {
        onBranch: this.props.onBranch,
        openCommit: this.props.openCommit
      };
      if (Component) {
        return _react.default.createElement(Component, _extends({
          key: `${type}-${edges[0].cursor}`,
          nodes: edges.map(e => e.node),
          issueish: issueish,
          switchToIssueish: this.props.switchToIssueish
        }, Component === _commitsView.default && propsForCommits));
      } else {
        // eslint-disable-next-line no-console
        console.warn(`unrecognized timeline event type: ${type}`);
        return null;
      }
    }), this.renderLoadMore());
  }
  renderLoadMore() {
    if (!this.props.relay.hasMore()) {
      return null;
    }
    return _react.default.createElement("div", {
      className: "github-PrTimeline-loadMore"
    }, _react.default.createElement("button", {
      className: "github-PrTimeline-loadMoreButton btn",
      onClick: this.loadMore
    }, this.props.relay.isLoading() ? _react.default.createElement(_octicon.default, {
      icon: "ellipsis"
    }) : 'Load More'));
  }
  groupEdges(edges) {
    let currentGroup;
    const groupedEdges = [];
    let lastEdgeType;
    edges.forEach(({
      node,
      cursor
    }) => {
      const currentEdgeType = node.__typename;
      if (currentEdgeType === lastEdgeType) {
        currentGroup.edges.push({
          node,
          cursor
        });
      } else {
        currentGroup = {
          type: currentEdgeType,
          edges: [{
            node,
            cursor
          }]
        };
        groupedEdges.push(currentGroup);
      }
      lastEdgeType = currentEdgeType;
    });
    return groupedEdges;
  }
}
exports.default = IssueishTimelineView;
_defineProperty(IssueishTimelineView, "propTypes", {
  switchToIssueish: _propTypes.default.func.isRequired,
  relay: _propTypes.default.shape({
    hasMore: _propTypes.default.func.isRequired,
    loadMore: _propTypes.default.func.isRequired,
    isLoading: _propTypes.default.func.isRequired
  }).isRequired,
  issue: _propTypes.default.shape({
    timelineItems: TimelineConnectionPropType
  }),
  pullRequest: _propTypes.default.shape({
    timelineItems: TimelineConnectionPropType
  }),
  onBranch: _propTypes.default.bool,
  openCommit: _propTypes.default.func
});
_defineProperty(IssueishTimelineView, "defaultProps", {
  onBranch: false,
  openCommit: () => {}
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfcHJvcFR5cGVzMiIsIl9oZWxwZXJzIiwiX29jdGljb24iLCJfY29tbWl0c1ZpZXciLCJfaXNzdWVDb21tZW50VmlldyIsIl9tZXJnZWRFdmVudFZpZXciLCJfaGVhZFJlZkZvcmNlUHVzaGVkRXZlbnRWaWV3IiwiX2Nyb3NzUmVmZXJlbmNlZEV2ZW50c1ZpZXciLCJfY29tbWl0Q29tbWVudFRocmVhZFZpZXciLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9leHRlbmRzIiwiT2JqZWN0IiwiYXNzaWduIiwiYmluZCIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsIl9kZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsInQiLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJyIiwiZSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiY29sbGVjdGlvblJlbmRlcmVyIiwiQ29tcG9uZW50Iiwic3R5bGVBc1RpbWVsaW5lSXRlbSIsIl9jbGFzcyIsIkdyb3VwZWRDb21wb25lbnQiLCJSZWFjdCIsImdldEZyYWdtZW50IiwiZnJhZ05hbWUiLCJhcmdzIiwiZnJhZyIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJhdXRvYmluZCIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJub2RlcyIsIm1hcCIsInJlbmRlck5vZGUiLCJub2RlIiwiaXRlbSIsImlzc3VlaXNoIiwic3dpdGNoVG9Jc3N1ZWlzaCIsImRpc3BsYXlOYW1lIiwiUHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwib2JqZWN0IiwiZnVuYyIsInRpbWVsaW5lSXRlbXMiLCJQdWxsUmVxdWVzdENvbW1pdCIsIkNvbW1pdHNWaWV3IiwiUHVsbFJlcXVlc3RDb21taXRDb21tZW50VGhyZWFkIiwiQ29tbWl0Q29tbWVudFRocmVhZFZpZXciLCJJc3N1ZUNvbW1lbnQiLCJJc3N1ZUNvbW1lbnRWaWV3IiwiTWVyZ2VkRXZlbnQiLCJNZXJnZWRFdmVudFZpZXciLCJIZWFkUmVmRm9yY2VQdXNoZWRFdmVudCIsIkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50VmlldyIsIkNyb3NzUmVmZXJlbmNlZEV2ZW50IiwiQ3Jvc3NSZWZlcmVuY2VkRXZlbnRzVmlldyIsIlRpbWVsaW5lQ29ubmVjdGlvblByb3BUeXBlIiwiUmVsYXlDb25uZWN0aW9uUHJvcFR5cGUiLCJzaGFwZSIsIl9fdHlwZW5hbWUiLCJzdHJpbmciLCJJc3N1ZWlzaFRpbWVsaW5lVmlldyIsImxvYWRNb3JlIiwicmVsYXkiLCJmb3JjZVVwZGF0ZSIsImlzc3VlIiwicHVsbFJlcXVlc3QiLCJncm91cGVkRWRnZXMiLCJncm91cEVkZ2VzIiwiZWRnZXMiLCJ0eXBlIiwicHJvcHNGb3JDb21taXRzIiwib25CcmFuY2giLCJvcGVuQ29tbWl0IiwiY3Vyc29yIiwiY29uc29sZSIsIndhcm4iLCJyZW5kZXJMb2FkTW9yZSIsImhhc01vcmUiLCJvbkNsaWNrIiwiaXNMb2FkaW5nIiwiaWNvbiIsImN1cnJlbnRHcm91cCIsImxhc3RFZGdlVHlwZSIsImZvckVhY2giLCJjdXJyZW50RWRnZVR5cGUiLCJwdXNoIiwiZXhwb3J0cyIsImJvb2wiXSwic291cmNlcyI6WyJpc3N1ZWlzaC10aW1lbGluZS12aWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuXG5pbXBvcnQge1JlbGF5Q29ubmVjdGlvblByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcbmltcG9ydCB7YXV0b2JpbmR9IGZyb20gJy4uL2hlbHBlcnMnO1xuaW1wb3J0IE9jdGljb24gZnJvbSAnLi4vYXRvbS9vY3RpY29uJztcbmltcG9ydCBDb21taXRzVmlldyBmcm9tICcuL3RpbWVsaW5lLWl0ZW1zL2NvbW1pdHMtdmlldy5qcyc7XG5pbXBvcnQgSXNzdWVDb21tZW50VmlldyBmcm9tICcuL3RpbWVsaW5lLWl0ZW1zL2lzc3VlLWNvbW1lbnQtdmlldy5qcyc7XG5pbXBvcnQgTWVyZ2VkRXZlbnRWaWV3IGZyb20gJy4vdGltZWxpbmUtaXRlbXMvbWVyZ2VkLWV2ZW50LXZpZXcuanMnO1xuaW1wb3J0IEhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50VmlldyBmcm9tICcuL3RpbWVsaW5lLWl0ZW1zL2hlYWQtcmVmLWZvcmNlLXB1c2hlZC1ldmVudC12aWV3LmpzJztcbmltcG9ydCBDcm9zc1JlZmVyZW5jZWRFdmVudHNWaWV3IGZyb20gJy4vdGltZWxpbmUtaXRlbXMvY3Jvc3MtcmVmZXJlbmNlZC1ldmVudHMtdmlldy5qcyc7XG5pbXBvcnQgQ29tbWl0Q29tbWVudFRocmVhZFZpZXcgZnJvbSAnLi90aW1lbGluZS1pdGVtcy9jb21taXQtY29tbWVudC10aHJlYWQtdmlldyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2xsZWN0aW9uUmVuZGVyZXIoQ29tcG9uZW50LCBzdHlsZUFzVGltZWxpbmVJdGVtID0gdHJ1ZSkge1xuICByZXR1cm4gY2xhc3MgR3JvdXBlZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgc3RhdGljIGRpc3BsYXlOYW1lID0gYEdyb3VwZWQoJHtDb21wb25lbnQucmVuZGVyID8gQ29tcG9uZW50LnJlbmRlci5kaXNwbGF5TmFtZSA6IENvbXBvbmVudC5kaXNwbGF5TmFtZX0pYFxuXG4gICAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAgIG5vZGVzOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICAgIGlzc3VlaXNoOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgICBzd2l0Y2hUb0lzc3VlaXNoOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRGcmFnbWVudChmcmFnTmFtZSwgLi4uYXJncykge1xuICAgICAgY29uc3QgZnJhZyA9IGZyYWdOYW1lID09PSAnbm9kZXMnID8gJ2l0ZW0nIDogZnJhZ05hbWU7XG4gICAgICByZXR1cm4gQ29tcG9uZW50LmdldEZyYWdtZW50KGZyYWcsIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICBzdXBlcihwcm9wcyk7XG4gICAgICBhdXRvYmluZCh0aGlzLCAncmVuZGVyTm9kZScpO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT17c3R5bGVBc1RpbWVsaW5lSXRlbSA/ICd0aW1lbGluZS1pdGVtJyA6ICcnfT57dGhpcy5wcm9wcy5ub2Rlcy5tYXAodGhpcy5yZW5kZXJOb2RlKX08L2Rpdj47XG4gICAgfVxuXG4gICAgcmVuZGVyTm9kZShub2RlLCBpKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Q29tcG9uZW50XG4gICAgICAgICAga2V5PXtpfVxuICAgICAgICAgIGl0ZW09e25vZGV9XG4gICAgICAgICAgaXNzdWVpc2g9e3RoaXMucHJvcHMuaXNzdWVpc2h9XG4gICAgICAgICAgc3dpdGNoVG9Jc3N1ZWlzaD17dGhpcy5wcm9wcy5zd2l0Y2hUb0lzc3VlaXNofVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gIH07XG59XG5cbmNvbnN0IHRpbWVsaW5lSXRlbXMgPSB7XG4gIFB1bGxSZXF1ZXN0Q29tbWl0OiBDb21taXRzVmlldyxcbiAgUHVsbFJlcXVlc3RDb21taXRDb21tZW50VGhyZWFkOiBjb2xsZWN0aW9uUmVuZGVyZXIoQ29tbWl0Q29tbWVudFRocmVhZFZpZXcsIGZhbHNlKSxcbiAgSXNzdWVDb21tZW50OiBjb2xsZWN0aW9uUmVuZGVyZXIoSXNzdWVDb21tZW50VmlldywgZmFsc2UpLFxuICBNZXJnZWRFdmVudDogY29sbGVjdGlvblJlbmRlcmVyKE1lcmdlZEV2ZW50VmlldyksXG4gIEhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50OiBjb2xsZWN0aW9uUmVuZGVyZXIoSGVhZFJlZkZvcmNlUHVzaGVkRXZlbnRWaWV3KSxcbiAgQ3Jvc3NSZWZlcmVuY2VkRXZlbnQ6IENyb3NzUmVmZXJlbmNlZEV2ZW50c1ZpZXcsXG59O1xuXG5jb25zdCBUaW1lbGluZUNvbm5lY3Rpb25Qcm9wVHlwZSA9IFJlbGF5Q29ubmVjdGlvblByb3BUeXBlKFxuICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIF9fdHlwZW5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgfSksXG4pLmlzUmVxdWlyZWQ7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIElzc3VlaXNoVGltZWxpbmVWaWV3IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBzd2l0Y2hUb0lzc3VlaXNoOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHJlbGF5OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgaGFzTW9yZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgIGxvYWRNb3JlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgaXNMb2FkaW5nOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgaXNzdWU6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICB0aW1lbGluZUl0ZW1zOiBUaW1lbGluZUNvbm5lY3Rpb25Qcm9wVHlwZSxcbiAgICB9KSxcbiAgICBwdWxsUmVxdWVzdDogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIHRpbWVsaW5lSXRlbXM6IFRpbWVsaW5lQ29ubmVjdGlvblByb3BUeXBlLFxuICAgIH0pLFxuICAgIG9uQnJhbmNoOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBvcGVuQ29tbWl0OiBQcm9wVHlwZXMuZnVuYyxcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgb25CcmFuY2g6IGZhbHNlLFxuICAgIG9wZW5Db21taXQ6ICgpID0+IHt9LFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgYXV0b2JpbmQodGhpcywgJ2xvYWRNb3JlJyk7XG4gIH1cblxuICBsb2FkTW9yZSgpIHtcbiAgICB0aGlzLnByb3BzLnJlbGF5LmxvYWRNb3JlKDEwLCAoKSA9PiB7XG4gICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgfSk7XG4gICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IGlzc3VlaXNoID0gdGhpcy5wcm9wcy5pc3N1ZSB8fCB0aGlzLnByb3BzLnB1bGxSZXF1ZXN0O1xuICAgIGNvbnN0IGdyb3VwZWRFZGdlcyA9IHRoaXMuZ3JvdXBFZGdlcyhpc3N1ZWlzaC50aW1lbGluZUl0ZW1zLmVkZ2VzKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJnaXRodWItUHJUaW1lbGluZVwiPlxuICAgICAgICB7Z3JvdXBlZEVkZ2VzLm1hcCgoe3R5cGUsIGVkZ2VzfSkgPT4ge1xuICAgICAgICAgIGNvbnN0IENvbXBvbmVudCA9IHRpbWVsaW5lSXRlbXNbdHlwZV07XG4gICAgICAgICAgY29uc3QgcHJvcHNGb3JDb21taXRzID0ge1xuICAgICAgICAgICAgb25CcmFuY2g6IHRoaXMucHJvcHMub25CcmFuY2gsXG4gICAgICAgICAgICBvcGVuQ29tbWl0OiB0aGlzLnByb3BzLm9wZW5Db21taXQsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAoQ29tcG9uZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICA8Q29tcG9uZW50XG4gICAgICAgICAgICAgICAga2V5PXtgJHt0eXBlfS0ke2VkZ2VzWzBdLmN1cnNvcn1gfVxuICAgICAgICAgICAgICAgIG5vZGVzPXtlZGdlcy5tYXAoZSA9PiBlLm5vZGUpfVxuICAgICAgICAgICAgICAgIGlzc3VlaXNoPXtpc3N1ZWlzaH1cbiAgICAgICAgICAgICAgICBzd2l0Y2hUb0lzc3VlaXNoPXt0aGlzLnByb3BzLnN3aXRjaFRvSXNzdWVpc2h9XG4gICAgICAgICAgICAgICAgey4uLihDb21wb25lbnQgPT09IENvbW1pdHNWaWV3ICYmIHByb3BzRm9yQ29tbWl0cyl9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgICAgY29uc29sZS53YXJuKGB1bnJlY29nbml6ZWQgdGltZWxpbmUgZXZlbnQgdHlwZTogJHt0eXBlfWApO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9KX1cbiAgICAgICAge3RoaXMucmVuZGVyTG9hZE1vcmUoKX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJMb2FkTW9yZSgpIHtcbiAgICBpZiAoIXRoaXMucHJvcHMucmVsYXkuaGFzTW9yZSgpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJnaXRodWItUHJUaW1lbGluZS1sb2FkTW9yZVwiPlxuICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImdpdGh1Yi1QclRpbWVsaW5lLWxvYWRNb3JlQnV0dG9uIGJ0blwiIG9uQ2xpY2s9e3RoaXMubG9hZE1vcmV9PlxuICAgICAgICAgIHt0aGlzLnByb3BzLnJlbGF5LmlzTG9hZGluZygpID8gPE9jdGljb24gaWNvbj1cImVsbGlwc2lzXCIgLz4gOiAnTG9hZCBNb3JlJ31cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgZ3JvdXBFZGdlcyhlZGdlcykge1xuICAgIGxldCBjdXJyZW50R3JvdXA7XG4gICAgY29uc3QgZ3JvdXBlZEVkZ2VzID0gW107XG4gICAgbGV0IGxhc3RFZGdlVHlwZTtcbiAgICBlZGdlcy5mb3JFYWNoKCh7bm9kZSwgY3Vyc29yfSkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudEVkZ2VUeXBlID0gbm9kZS5fX3R5cGVuYW1lO1xuICAgICAgaWYgKGN1cnJlbnRFZGdlVHlwZSA9PT0gbGFzdEVkZ2VUeXBlKSB7XG4gICAgICAgIGN1cnJlbnRHcm91cC5lZGdlcy5wdXNoKHtub2RlLCBjdXJzb3J9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRHcm91cCA9IHtcbiAgICAgICAgICB0eXBlOiBjdXJyZW50RWRnZVR5cGUsXG4gICAgICAgICAgZWRnZXM6IFt7bm9kZSwgY3Vyc29yfV0sXG4gICAgICAgIH07XG4gICAgICAgIGdyb3VwZWRFZGdlcy5wdXNoKGN1cnJlbnRHcm91cCk7XG4gICAgICB9XG4gICAgICBsYXN0RWRnZVR5cGUgPSBjdXJyZW50RWRnZVR5cGU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGdyb3VwZWRFZGdlcztcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsVUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUUsV0FBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsUUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksUUFBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssWUFBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQU0saUJBQUEsR0FBQVAsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFPLGdCQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBUSw0QkFBQSxHQUFBVCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQVMsMEJBQUEsR0FBQVYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFVLHdCQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUFBa0YsU0FBQUQsdUJBQUFZLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFBQSxTQUFBRyxTQUFBLElBQUFBLFFBQUEsR0FBQUMsTUFBQSxDQUFBQyxNQUFBLEdBQUFELE1BQUEsQ0FBQUMsTUFBQSxDQUFBQyxJQUFBLGVBQUFDLE1BQUEsYUFBQUMsQ0FBQSxNQUFBQSxDQUFBLEdBQUFDLFNBQUEsQ0FBQUMsTUFBQSxFQUFBRixDQUFBLFVBQUFHLE1BQUEsR0FBQUYsU0FBQSxDQUFBRCxDQUFBLFlBQUFJLEdBQUEsSUFBQUQsTUFBQSxRQUFBUCxNQUFBLENBQUFTLFNBQUEsQ0FBQUMsY0FBQSxDQUFBQyxJQUFBLENBQUFKLE1BQUEsRUFBQUMsR0FBQSxLQUFBTCxNQUFBLENBQUFLLEdBQUEsSUFBQUQsTUFBQSxDQUFBQyxHQUFBLGdCQUFBTCxNQUFBLFlBQUFKLFFBQUEsQ0FBQWEsS0FBQSxPQUFBUCxTQUFBO0FBQUEsU0FBQVEsZ0JBQUFqQixHQUFBLEVBQUFZLEdBQUEsRUFBQU0sS0FBQSxJQUFBTixHQUFBLEdBQUFPLGNBQUEsQ0FBQVAsR0FBQSxPQUFBQSxHQUFBLElBQUFaLEdBQUEsSUFBQUksTUFBQSxDQUFBZ0IsY0FBQSxDQUFBcEIsR0FBQSxFQUFBWSxHQUFBLElBQUFNLEtBQUEsRUFBQUEsS0FBQSxFQUFBRyxVQUFBLFFBQUFDLFlBQUEsUUFBQUMsUUFBQSxvQkFBQXZCLEdBQUEsQ0FBQVksR0FBQSxJQUFBTSxLQUFBLFdBQUFsQixHQUFBO0FBQUEsU0FBQW1CLGVBQUFLLENBQUEsUUFBQWhCLENBQUEsR0FBQWlCLFlBQUEsQ0FBQUQsQ0FBQSx1Q0FBQWhCLENBQUEsR0FBQUEsQ0FBQSxHQUFBa0IsTUFBQSxDQUFBbEIsQ0FBQTtBQUFBLFNBQUFpQixhQUFBRCxDQUFBLEVBQUFHLENBQUEsMkJBQUFILENBQUEsS0FBQUEsQ0FBQSxTQUFBQSxDQUFBLE1BQUFJLENBQUEsR0FBQUosQ0FBQSxDQUFBSyxNQUFBLENBQUFDLFdBQUEsa0JBQUFGLENBQUEsUUFBQXBCLENBQUEsR0FBQW9CLENBQUEsQ0FBQWIsSUFBQSxDQUFBUyxDQUFBLEVBQUFHLENBQUEsdUNBQUFuQixDQUFBLFNBQUFBLENBQUEsWUFBQXVCLFNBQUEseUVBQUFKLENBQUEsR0FBQUQsTUFBQSxHQUFBTSxNQUFBLEVBQUFSLENBQUE7QUFFM0UsU0FBU1Msa0JBQWtCQSxDQUFDQyxTQUFTLEVBQUVDLG1CQUFtQixHQUFHLElBQUksRUFBRTtFQUFBLElBQUFDLE1BQUE7RUFDeEUsT0FBQUEsTUFBQSxHQUFPLE1BQU1DLGdCQUFnQixTQUFTQyxjQUFLLENBQUNKLFNBQVMsQ0FBQztJQVNwRCxPQUFPSyxXQUFXQSxDQUFDQyxRQUFRLEVBQUUsR0FBR0MsSUFBSSxFQUFFO01BQ3BDLE1BQU1DLElBQUksR0FBR0YsUUFBUSxLQUFLLE9BQU8sR0FBRyxNQUFNLEdBQUdBLFFBQVE7TUFDckQsT0FBT04sU0FBUyxDQUFDSyxXQUFXLENBQUNHLElBQUksRUFBRSxHQUFHRCxJQUFJLENBQUM7SUFDN0M7SUFFQUUsV0FBV0EsQ0FBQ0MsS0FBSyxFQUFFO01BQ2pCLEtBQUssQ0FBQ0EsS0FBSyxDQUFDO01BQ1osSUFBQUMsaUJBQVEsRUFBQyxJQUFJLEVBQUUsWUFBWSxDQUFDO0lBQzlCO0lBRUFDLE1BQU1BLENBQUEsRUFBRztNQUNQLE9BQU8zRCxNQUFBLENBQUFlLE9BQUEsQ0FBQTZDLGFBQUE7UUFBS0MsU0FBUyxFQUFFYixtQkFBbUIsR0FBRyxlQUFlLEdBQUc7TUFBRyxHQUFFLElBQUksQ0FBQ1MsS0FBSyxDQUFDSyxLQUFLLENBQUNDLEdBQUcsQ0FBQyxJQUFJLENBQUNDLFVBQVUsQ0FBTyxDQUFDO0lBQ2xIO0lBRUFBLFVBQVVBLENBQUNDLElBQUksRUFBRTVDLENBQUMsRUFBRTtNQUNsQixPQUNFckIsTUFBQSxDQUFBZSxPQUFBLENBQUE2QyxhQUFBLENBQUNiLFNBQVM7UUFDUnRCLEdBQUcsRUFBRUosQ0FBRTtRQUNQNkMsSUFBSSxFQUFFRCxJQUFLO1FBQ1hFLFFBQVEsRUFBRSxJQUFJLENBQUNWLEtBQUssQ0FBQ1UsUUFBUztRQUM5QkMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDWCxLQUFLLENBQUNXO01BQWlCLENBQy9DLENBQUM7SUFFTjtFQUNGLENBQUMsRUFBQXRDLGVBQUEsQ0FBQW1CLE1BQUEsaUJBaEN1QixXQUFVRixTQUFTLENBQUNZLE1BQU0sR0FBR1osU0FBUyxDQUFDWSxNQUFNLENBQUNVLFdBQVcsR0FBR3RCLFNBQVMsQ0FBQ3NCLFdBQVksR0FBRSxHQUFBdkMsZUFBQSxDQUFBbUIsTUFBQSxlQUV2RjtJQUNqQmEsS0FBSyxFQUFFUSxrQkFBUyxDQUFDQyxLQUFLLENBQUNDLFVBQVU7SUFDakNMLFFBQVEsRUFBRUcsa0JBQVMsQ0FBQ0csTUFBTSxDQUFDRCxVQUFVO0lBQ3JDSixnQkFBZ0IsRUFBRUUsa0JBQVMsQ0FBQ0ksSUFBSSxDQUFDRjtFQUNuQyxDQUFDLEdBQUF2QixNQUFBO0FBMkJMO0FBRUEsTUFBTTBCLGFBQWEsR0FBRztFQUNwQkMsaUJBQWlCLEVBQUVDLG9CQUFXO0VBQzlCQyw4QkFBOEIsRUFBRWhDLGtCQUFrQixDQUFDaUMsZ0NBQXVCLEVBQUUsS0FBSyxDQUFDO0VBQ2xGQyxZQUFZLEVBQUVsQyxrQkFBa0IsQ0FBQ21DLHlCQUFnQixFQUFFLEtBQUssQ0FBQztFQUN6REMsV0FBVyxFQUFFcEMsa0JBQWtCLENBQUNxQyx3QkFBZSxDQUFDO0VBQ2hEQyx1QkFBdUIsRUFBRXRDLGtCQUFrQixDQUFDdUMsb0NBQTJCLENBQUM7RUFDeEVDLG9CQUFvQixFQUFFQztBQUN4QixDQUFDO0FBRUQsTUFBTUMsMEJBQTBCLEdBQUcsSUFBQUMsbUNBQXVCLEVBQ3hEbkIsa0JBQVMsQ0FBQ29CLEtBQUssQ0FBQztFQUNkQyxVQUFVLEVBQUVyQixrQkFBUyxDQUFDc0IsTUFBTSxDQUFDcEI7QUFDL0IsQ0FBQyxDQUNILENBQUMsQ0FBQ0EsVUFBVTtBQUVHLE1BQU1xQixvQkFBb0IsU0FBUzFDLGNBQUssQ0FBQ0osU0FBUyxDQUFDO0VBdUJoRVMsV0FBV0EsQ0FBQ0MsS0FBSyxFQUFFO0lBQ2pCLEtBQUssQ0FBQ0EsS0FBSyxDQUFDO0lBQ1osSUFBQUMsaUJBQVEsRUFBQyxJQUFJLEVBQUUsVUFBVSxDQUFDO0VBQzVCO0VBRUFvQyxRQUFRQSxDQUFBLEVBQUc7SUFDVCxJQUFJLENBQUNyQyxLQUFLLENBQUNzQyxLQUFLLENBQUNELFFBQVEsQ0FBQyxFQUFFLEVBQUUsTUFBTTtNQUNsQyxJQUFJLENBQUNFLFdBQVcsQ0FBQyxDQUFDO0lBQ3BCLENBQUMsQ0FBQztJQUNGLElBQUksQ0FBQ0EsV0FBVyxDQUFDLENBQUM7RUFDcEI7RUFFQXJDLE1BQU1BLENBQUEsRUFBRztJQUNQLE1BQU1RLFFBQVEsR0FBRyxJQUFJLENBQUNWLEtBQUssQ0FBQ3dDLEtBQUssSUFBSSxJQUFJLENBQUN4QyxLQUFLLENBQUN5QyxXQUFXO0lBQzNELE1BQU1DLFlBQVksR0FBRyxJQUFJLENBQUNDLFVBQVUsQ0FBQ2pDLFFBQVEsQ0FBQ1EsYUFBYSxDQUFDMEIsS0FBSyxDQUFDO0lBQ2xFLE9BQ0VyRyxNQUFBLENBQUFlLE9BQUEsQ0FBQTZDLGFBQUE7TUFBS0MsU0FBUyxFQUFDO0lBQW1CLEdBQy9Cc0MsWUFBWSxDQUFDcEMsR0FBRyxDQUFDLENBQUM7TUFBQ3VDLElBQUk7TUFBRUQ7SUFBSyxDQUFDLEtBQUs7TUFDbkMsTUFBTXRELFNBQVMsR0FBRzRCLGFBQWEsQ0FBQzJCLElBQUksQ0FBQztNQUNyQyxNQUFNQyxlQUFlLEdBQUc7UUFDdEJDLFFBQVEsRUFBRSxJQUFJLENBQUMvQyxLQUFLLENBQUMrQyxRQUFRO1FBQzdCQyxVQUFVLEVBQUUsSUFBSSxDQUFDaEQsS0FBSyxDQUFDZ0Q7TUFDekIsQ0FBQztNQUNELElBQUkxRCxTQUFTLEVBQUU7UUFDYixPQUNFL0MsTUFBQSxDQUFBZSxPQUFBLENBQUE2QyxhQUFBLENBQUNiLFNBQVMsRUFBQS9CLFFBQUE7VUFDUlMsR0FBRyxFQUFHLEdBQUU2RSxJQUFLLElBQUdELEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQ0ssTUFBTyxFQUFFO1VBQ2xDNUMsS0FBSyxFQUFFdUMsS0FBSyxDQUFDdEMsR0FBRyxDQUFDdEIsQ0FBQyxJQUFJQSxDQUFDLENBQUN3QixJQUFJLENBQUU7VUFDOUJFLFFBQVEsRUFBRUEsUUFBUztVQUNuQkMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDWCxLQUFLLENBQUNXO1FBQWlCLEdBQ3pDckIsU0FBUyxLQUFLOEIsb0JBQVcsSUFBSTBCLGVBQWUsQ0FDbEQsQ0FBQztNQUVOLENBQUMsTUFBTTtRQUNMO1FBQ0FJLE9BQU8sQ0FBQ0MsSUFBSSxDQUFFLHFDQUFvQ04sSUFBSyxFQUFDLENBQUM7UUFDekQsT0FBTyxJQUFJO01BQ2I7SUFDRixDQUFDLENBQUMsRUFDRCxJQUFJLENBQUNPLGNBQWMsQ0FBQyxDQUNsQixDQUFDO0VBRVY7RUFFQUEsY0FBY0EsQ0FBQSxFQUFHO0lBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQ3BELEtBQUssQ0FBQ3NDLEtBQUssQ0FBQ2UsT0FBTyxDQUFDLENBQUMsRUFBRTtNQUMvQixPQUFPLElBQUk7SUFDYjtJQUVBLE9BQ0U5RyxNQUFBLENBQUFlLE9BQUEsQ0FBQTZDLGFBQUE7TUFBS0MsU0FBUyxFQUFDO0lBQTRCLEdBQ3pDN0QsTUFBQSxDQUFBZSxPQUFBLENBQUE2QyxhQUFBO01BQVFDLFNBQVMsRUFBQyxzQ0FBc0M7TUFBQ2tELE9BQU8sRUFBRSxJQUFJLENBQUNqQjtJQUFTLEdBQzdFLElBQUksQ0FBQ3JDLEtBQUssQ0FBQ3NDLEtBQUssQ0FBQ2lCLFNBQVMsQ0FBQyxDQUFDLEdBQUdoSCxNQUFBLENBQUFlLE9BQUEsQ0FBQTZDLGFBQUEsQ0FBQ3RELFFBQUEsQ0FBQVMsT0FBTztNQUFDa0csSUFBSSxFQUFDO0lBQVUsQ0FBRSxDQUFDLEdBQUcsV0FDeEQsQ0FDTCxDQUFDO0VBRVY7RUFFQWIsVUFBVUEsQ0FBQ0MsS0FBSyxFQUFFO0lBQ2hCLElBQUlhLFlBQVk7SUFDaEIsTUFBTWYsWUFBWSxHQUFHLEVBQUU7SUFDdkIsSUFBSWdCLFlBQVk7SUFDaEJkLEtBQUssQ0FBQ2UsT0FBTyxDQUFDLENBQUM7TUFBQ25ELElBQUk7TUFBRXlDO0lBQU0sQ0FBQyxLQUFLO01BQ2hDLE1BQU1XLGVBQWUsR0FBR3BELElBQUksQ0FBQzBCLFVBQVU7TUFDdkMsSUFBSTBCLGVBQWUsS0FBS0YsWUFBWSxFQUFFO1FBQ3BDRCxZQUFZLENBQUNiLEtBQUssQ0FBQ2lCLElBQUksQ0FBQztVQUFDckQsSUFBSTtVQUFFeUM7UUFBTSxDQUFDLENBQUM7TUFDekMsQ0FBQyxNQUFNO1FBQ0xRLFlBQVksR0FBRztVQUNiWixJQUFJLEVBQUVlLGVBQWU7VUFDckJoQixLQUFLLEVBQUUsQ0FBQztZQUFDcEMsSUFBSTtZQUFFeUM7VUFBTSxDQUFDO1FBQ3hCLENBQUM7UUFDRFAsWUFBWSxDQUFDbUIsSUFBSSxDQUFDSixZQUFZLENBQUM7TUFDakM7TUFDQUMsWUFBWSxHQUFHRSxlQUFlO0lBQ2hDLENBQUMsQ0FBQztJQUNGLE9BQU9sQixZQUFZO0VBQ3JCO0FBQ0Y7QUFBQ29CLE9BQUEsQ0FBQXhHLE9BQUEsR0FBQThFLG9CQUFBO0FBQUEvRCxlQUFBLENBcEdvQitELG9CQUFvQixlQUNwQjtFQUNqQnpCLGdCQUFnQixFQUFFRSxrQkFBUyxDQUFDSSxJQUFJLENBQUNGLFVBQVU7RUFDM0N1QixLQUFLLEVBQUV6QixrQkFBUyxDQUFDb0IsS0FBSyxDQUFDO0lBQ3JCb0IsT0FBTyxFQUFFeEMsa0JBQVMsQ0FBQ0ksSUFBSSxDQUFDRixVQUFVO0lBQ2xDc0IsUUFBUSxFQUFFeEIsa0JBQVMsQ0FBQ0ksSUFBSSxDQUFDRixVQUFVO0lBQ25Dd0MsU0FBUyxFQUFFMUMsa0JBQVMsQ0FBQ0ksSUFBSSxDQUFDRjtFQUM1QixDQUFDLENBQUMsQ0FBQ0EsVUFBVTtFQUNieUIsS0FBSyxFQUFFM0Isa0JBQVMsQ0FBQ29CLEtBQUssQ0FBQztJQUNyQmYsYUFBYSxFQUFFYTtFQUNqQixDQUFDLENBQUM7RUFDRlUsV0FBVyxFQUFFNUIsa0JBQVMsQ0FBQ29CLEtBQUssQ0FBQztJQUMzQmYsYUFBYSxFQUFFYTtFQUNqQixDQUFDLENBQUM7RUFDRmdCLFFBQVEsRUFBRWxDLGtCQUFTLENBQUNrRCxJQUFJO0VBQ3hCZixVQUFVLEVBQUVuQyxrQkFBUyxDQUFDSTtBQUN4QixDQUFDO0FBQUE1QyxlQUFBLENBaEJrQitELG9CQUFvQixrQkFrQmpCO0VBQ3BCVyxRQUFRLEVBQUUsS0FBSztFQUNmQyxVQUFVLEVBQUVBLENBQUEsS0FBTSxDQUFDO0FBQ3JCLENBQUMifQ==