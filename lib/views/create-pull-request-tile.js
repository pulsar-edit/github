"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _octicon = _interopRequireDefault(require("../atom/octicon"));
var _propTypes2 = require("../prop-types");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
class CreatePullRequestTile extends _react.default.Component {
  render() {
    if (this.isRepositoryNotFound()) {
      return _react.default.createElement("div", {
        className: "github-CreatePullRequestTile-message"
      }, _react.default.createElement("strong", null, "Repository not found"), " for the remote ", _react.default.createElement("code", null, this.props.remote.getName()), ".", _react.default.createElement("hr", {
        className: "github-CreatePullRequestTile-divider"
      }), _react.default.createElement(_octicon.default, {
        icon: "link"
      }), "Do you need to update your ", _react.default.createElement("strong", null, "remote URL"), "?");
    }
    if (this.isDetachedHead()) {
      return _react.default.createElement("div", {
        className: "github-CreatePullRequestTile-message"
      }, "You are not currently on ", _react.default.createElement("strong", null, "any branch"), ".", _react.default.createElement("hr", {
        className: "github-CreatePullRequestTile-divider"
      }), _react.default.createElement(_octicon.default, {
        icon: "git-branch"
      }), _react.default.createElement("strong", null, "Create a new branch"), "\xA0 to share your work with a pull request.");
    }
    if (this.hasNoDefaultRef()) {
      return _react.default.createElement("div", {
        className: "github-CreatePullRequestTile-message"
      }, "The repository at remote ", _react.default.createElement("code", null, this.props.remote.getName()), " is ", _react.default.createElement("strong", null, "empty"), ".", _react.default.createElement("hr", {
        className: "github-CreatePullRequestTile-divider"
      }), _react.default.createElement(_octicon.default, {
        icon: "arrow-up"
      }), _react.default.createElement("strong", null, "Push a main branch"), " to begin sharing your work.");
    }
    if (this.isOnDefaultRef()) {
      return _react.default.createElement("div", {
        className: "github-CreatePullRequestTile-message"
      }, "You are currently on your repository's ", _react.default.createElement("strong", null, "default branch"), ".", _react.default.createElement("hr", {
        className: "github-CreatePullRequestTile-divider"
      }), _react.default.createElement(_octicon.default, {
        icon: "git-branch"
      }), _react.default.createElement("strong", null, "Checkout or create a new branch"), "\xA0 to share your work with a pull request.");
    }
    if (this.isSameAsDefaultRef()) {
      return _react.default.createElement("div", {
        className: "github-CreatePullRequestTile-message"
      }, "Your current branch ", _react.default.createElement("strong", null, "has not moved"), " from the repository's default branch.", _react.default.createElement("hr", {
        className: "github-CreatePullRequestTile-divider"
      }), _react.default.createElement(_octicon.default, {
        icon: "git-commit"
      }), _react.default.createElement("strong", null, "Make some commits"), "\xA0 to share your work with a pull request.");
    }
    let message = 'Open new pull request';
    let disable = false;
    const differentRemote = this.pushesToDifferentRemote();
    if (this.props.pushInProgress) {
      message = 'Pushing...';
      disable = true;
    } else if (!this.hasUpstreamBranch() || differentRemote) {
      message = 'Publish + open new pull request';
    } else if (this.props.aheadCount > 0) {
      message = 'Push + open new pull request';
    }
    return _react.default.createElement("div", null, differentRemote && _react.default.createElement("div", {
      className: "github-CreatePullRequestTile-message"
    }, "Your current branch is ", _react.default.createElement("strong", null, "configured"), " to push to the remote ", _react.default.createElement("code", null, this.props.branches.getHeadBranch().getPush().getRemoteName()), ".", _react.default.createElement("hr", {
      className: "github-CreatePullRequestTile-divider"
    }), _react.default.createElement(_octicon.default, {
      icon: "cloud-upload"
    }), _react.default.createElement("strong", null, "Publish"), " it to ", _react.default.createElement("code", null, this.props.remote.getName()), " instead?"), _react.default.createElement("div", {
      className: "github-CreatePullRequestTile-controls"
    }, _react.default.createElement("button", {
      className: "github-CreatePullRequestTile-createPr btn btn-primary",
      onClick: this.props.onCreatePr,
      disabled: disable
    }, message)));
  }
  isRepositoryNotFound() {
    return !this.props.repository;
  }
  isDetachedHead() {
    return !this.props.branches.getHeadBranch().isPresent();
  }
  hasNoDefaultRef() {
    return !this.props.repository.defaultBranchRef;
  }
  isOnDefaultRef() {
    /* istanbul ignore if */
    if (!this.props.repository) {
      return false;
    }
    const defaultRef = this.props.repository.defaultBranchRef;
    /* istanbul ignore if */
    if (!defaultRef) {
      return false;
    }
    const currentBranch = this.props.branches.getHeadBranch();
    return currentBranch.getPush().getRemoteRef() === `${defaultRef.prefix}${defaultRef.name}`;
  }
  isSameAsDefaultRef() {
    /* istanbul ignore if */
    if (!this.props.repository) {
      return false;
    }
    const defaultRef = this.props.repository.defaultBranchRef;
    /* istanbul ignore if */
    if (!defaultRef) {
      return false;
    }
    const currentBranch = this.props.branches.getHeadBranch();
    const mainBranches = this.props.branches.getPushSources(this.props.remote.getName(), `${defaultRef.prefix}${defaultRef.name}`);
    return mainBranches.some(branch => branch.getSha() === currentBranch.getSha());
  }
  pushesToDifferentRemote() {
    const p = this.props.branches.getHeadBranch().getPush();
    if (!p.isRemoteTracking()) {
      return false;
    }
    const pushRemoteName = p.getRemoteName();
    return pushRemoteName !== this.props.remote.getName();
  }
  hasUpstreamBranch() {
    return this.props.branches.getHeadBranch().getUpstream().isPresent();
  }
}
exports.default = CreatePullRequestTile;
_defineProperty(CreatePullRequestTile, "propTypes", {
  repository: _propTypes.default.shape({
    defaultBranchRef: _propTypes.default.shape({
      prefix: _propTypes.default.string.isRequired,
      name: _propTypes.default.string.isRequired
    })
  }),
  remote: _propTypes2.RemotePropType.isRequired,
  branches: _propTypes2.BranchSetPropType.isRequired,
  aheadCount: _propTypes.default.number,
  pushInProgress: _propTypes.default.bool.isRequired,
  onCreatePr: _propTypes.default.func.isRequired
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wcm9wVHlwZXMiLCJfb2N0aWNvbiIsIl9wcm9wVHlwZXMyIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJ0IiwiaSIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsInIiLCJlIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJjYWxsIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiQ3JlYXRlUHVsbFJlcXVlc3RUaWxlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJyZW5kZXIiLCJpc1JlcG9zaXRvcnlOb3RGb3VuZCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJwcm9wcyIsInJlbW90ZSIsImdldE5hbWUiLCJpY29uIiwiaXNEZXRhY2hlZEhlYWQiLCJoYXNOb0RlZmF1bHRSZWYiLCJpc09uRGVmYXVsdFJlZiIsImlzU2FtZUFzRGVmYXVsdFJlZiIsIm1lc3NhZ2UiLCJkaXNhYmxlIiwiZGlmZmVyZW50UmVtb3RlIiwicHVzaGVzVG9EaWZmZXJlbnRSZW1vdGUiLCJwdXNoSW5Qcm9ncmVzcyIsImhhc1Vwc3RyZWFtQnJhbmNoIiwiYWhlYWRDb3VudCIsImJyYW5jaGVzIiwiZ2V0SGVhZEJyYW5jaCIsImdldFB1c2giLCJnZXRSZW1vdGVOYW1lIiwib25DbGljayIsIm9uQ3JlYXRlUHIiLCJkaXNhYmxlZCIsInJlcG9zaXRvcnkiLCJpc1ByZXNlbnQiLCJkZWZhdWx0QnJhbmNoUmVmIiwiZGVmYXVsdFJlZiIsImN1cnJlbnRCcmFuY2giLCJnZXRSZW1vdGVSZWYiLCJwcmVmaXgiLCJuYW1lIiwibWFpbkJyYW5jaGVzIiwiZ2V0UHVzaFNvdXJjZXMiLCJzb21lIiwiYnJhbmNoIiwiZ2V0U2hhIiwicCIsImlzUmVtb3RlVHJhY2tpbmciLCJwdXNoUmVtb3RlTmFtZSIsImdldFVwc3RyZWFtIiwiZXhwb3J0cyIsIlByb3BUeXBlcyIsInNoYXBlIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsIlJlbW90ZVByb3BUeXBlIiwiQnJhbmNoU2V0UHJvcFR5cGUiLCJudW1iZXIiLCJib29sIiwiZnVuYyJdLCJzb3VyY2VzIjpbImNyZWF0ZS1wdWxsLXJlcXVlc3QtdGlsZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBPY3RpY29uIGZyb20gJy4uL2F0b20vb2N0aWNvbic7XG5cbmltcG9ydCB7UmVtb3RlUHJvcFR5cGUsIEJyYW5jaFNldFByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3JlYXRlUHVsbFJlcXVlc3RUaWxlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICByZXBvc2l0b3J5OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgZGVmYXVsdEJyYW5jaFJlZjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgcHJlZml4OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgIH0pLFxuICAgIH0pLFxuXG4gICAgcmVtb3RlOiBSZW1vdGVQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgIGJyYW5jaGVzOiBCcmFuY2hTZXRQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgIGFoZWFkQ291bnQ6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgcHVzaEluUHJvZ3Jlc3M6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG5cbiAgICBvbkNyZWF0ZVByOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLmlzUmVwb3NpdG9yeU5vdEZvdW5kKCkpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1tZXNzYWdlXCI+XG4gICAgICAgICAgPHN0cm9uZz5SZXBvc2l0b3J5IG5vdCBmb3VuZDwvc3Ryb25nPiBmb3IgdGhlIHJlbW90ZSA8Y29kZT57dGhpcy5wcm9wcy5yZW1vdGUuZ2V0TmFtZSgpfTwvY29kZT4uXG4gICAgICAgICAgPGhyIGNsYXNzTmFtZT1cImdpdGh1Yi1DcmVhdGVQdWxsUmVxdWVzdFRpbGUtZGl2aWRlclwiIC8+XG4gICAgICAgICAgPE9jdGljb24gaWNvbj1cImxpbmtcIiAvPlxuICAgICAgICAgIERvIHlvdSBuZWVkIHRvIHVwZGF0ZSB5b3VyIDxzdHJvbmc+cmVtb3RlIFVSTDwvc3Ryb25nPj9cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzRGV0YWNoZWRIZWFkKCkpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1tZXNzYWdlXCI+XG4gICAgICAgICAgWW91IGFyZSBub3QgY3VycmVudGx5IG9uIDxzdHJvbmc+YW55IGJyYW5jaDwvc3Ryb25nPi5cbiAgICAgICAgICA8aHIgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1kaXZpZGVyXCIgLz5cbiAgICAgICAgICA8T2N0aWNvbiBpY29uPVwiZ2l0LWJyYW5jaFwiIC8+XG4gICAgICAgICAgPHN0cm9uZz5DcmVhdGUgYSBuZXcgYnJhbmNoPC9zdHJvbmc+Jm5ic3A7XG4gICAgICAgICAgdG8gc2hhcmUgeW91ciB3b3JrIHdpdGggYSBwdWxsIHJlcXVlc3QuXG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5oYXNOb0RlZmF1bHRSZWYoKSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJnaXRodWItQ3JlYXRlUHVsbFJlcXVlc3RUaWxlLW1lc3NhZ2VcIj5cbiAgICAgICAgICBUaGUgcmVwb3NpdG9yeSBhdCByZW1vdGUgPGNvZGU+e3RoaXMucHJvcHMucmVtb3RlLmdldE5hbWUoKX08L2NvZGU+IGlzIDxzdHJvbmc+ZW1wdHk8L3N0cm9uZz4uXG4gICAgICAgICAgPGhyIGNsYXNzTmFtZT1cImdpdGh1Yi1DcmVhdGVQdWxsUmVxdWVzdFRpbGUtZGl2aWRlclwiIC8+XG4gICAgICAgICAgPE9jdGljb24gaWNvbj1cImFycm93LXVwXCIgLz5cbiAgICAgICAgICA8c3Ryb25nPlB1c2ggYSBtYWluIGJyYW5jaDwvc3Ryb25nPiB0byBiZWdpbiBzaGFyaW5nIHlvdXIgd29yay5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzT25EZWZhdWx0UmVmKCkpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1tZXNzYWdlXCI+XG4gICAgICAgICAgWW91IGFyZSBjdXJyZW50bHkgb24geW91ciByZXBvc2l0b3J5J3MgPHN0cm9uZz5kZWZhdWx0IGJyYW5jaDwvc3Ryb25nPi5cbiAgICAgICAgICA8aHIgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1kaXZpZGVyXCIgLz5cbiAgICAgICAgICA8T2N0aWNvbiBpY29uPVwiZ2l0LWJyYW5jaFwiIC8+XG4gICAgICAgICAgPHN0cm9uZz5DaGVja291dCBvciBjcmVhdGUgYSBuZXcgYnJhbmNoPC9zdHJvbmc+Jm5ic3A7XG4gICAgICAgICAgdG8gc2hhcmUgeW91ciB3b3JrIHdpdGggYSBwdWxsIHJlcXVlc3QuXG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1NhbWVBc0RlZmF1bHRSZWYoKSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJnaXRodWItQ3JlYXRlUHVsbFJlcXVlc3RUaWxlLW1lc3NhZ2VcIj5cbiAgICAgICAgICBZb3VyIGN1cnJlbnQgYnJhbmNoIDxzdHJvbmc+aGFzIG5vdCBtb3ZlZDwvc3Ryb25nPiBmcm9tIHRoZSByZXBvc2l0b3J5J3MgZGVmYXVsdCBicmFuY2guXG4gICAgICAgICAgPGhyIGNsYXNzTmFtZT1cImdpdGh1Yi1DcmVhdGVQdWxsUmVxdWVzdFRpbGUtZGl2aWRlclwiIC8+XG4gICAgICAgICAgPE9jdGljb24gaWNvbj1cImdpdC1jb21taXRcIiAvPlxuICAgICAgICAgIDxzdHJvbmc+TWFrZSBzb21lIGNvbW1pdHM8L3N0cm9uZz4mbmJzcDtcbiAgICAgICAgICB0byBzaGFyZSB5b3VyIHdvcmsgd2l0aCBhIHB1bGwgcmVxdWVzdC5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cblxuICAgIGxldCBtZXNzYWdlID0gJ09wZW4gbmV3IHB1bGwgcmVxdWVzdCc7XG4gICAgbGV0IGRpc2FibGUgPSBmYWxzZTtcbiAgICBjb25zdCBkaWZmZXJlbnRSZW1vdGUgPSB0aGlzLnB1c2hlc1RvRGlmZmVyZW50UmVtb3RlKCk7XG4gICAgaWYgKHRoaXMucHJvcHMucHVzaEluUHJvZ3Jlc3MpIHtcbiAgICAgIG1lc3NhZ2UgPSAnUHVzaGluZy4uLic7XG4gICAgICBkaXNhYmxlID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmhhc1Vwc3RyZWFtQnJhbmNoKCkgfHwgZGlmZmVyZW50UmVtb3RlKSB7XG4gICAgICBtZXNzYWdlID0gJ1B1Ymxpc2ggKyBvcGVuIG5ldyBwdWxsIHJlcXVlc3QnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5haGVhZENvdW50ID4gMCkge1xuICAgICAgbWVzc2FnZSA9ICdQdXNoICsgb3BlbiBuZXcgcHVsbCByZXF1ZXN0JztcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdj5cbiAgICAgICAge2RpZmZlcmVudFJlbW90ZSAmJlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1tZXNzYWdlXCI+XG4gICAgICAgICAgICBZb3VyIGN1cnJlbnQgYnJhbmNoIGlzIDxzdHJvbmc+Y29uZmlndXJlZDwvc3Ryb25nPiB0byBwdXNoIHRvIHRoZVxuICAgICAgICAgICAgcmVtb3RlIDxjb2RlPnt0aGlzLnByb3BzLmJyYW5jaGVzLmdldEhlYWRCcmFuY2goKS5nZXRQdXNoKCkuZ2V0UmVtb3RlTmFtZSgpfTwvY29kZT4uXG4gICAgICAgICAgICA8aHIgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1kaXZpZGVyXCIgLz5cbiAgICAgICAgICAgIDxPY3RpY29uIGljb249XCJjbG91ZC11cGxvYWRcIiAvPlxuICAgICAgICAgICAgPHN0cm9uZz5QdWJsaXNoPC9zdHJvbmc+IGl0IHRvIDxjb2RlPnt0aGlzLnByb3BzLnJlbW90ZS5nZXROYW1lKCl9PC9jb2RlPiBpbnN0ZWFkP1xuICAgICAgICAgIDwvZGl2PlxuICAgICAgICB9XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2l0aHViLUNyZWF0ZVB1bGxSZXF1ZXN0VGlsZS1jb250cm9sc1wiPlxuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImdpdGh1Yi1DcmVhdGVQdWxsUmVxdWVzdFRpbGUtY3JlYXRlUHIgYnRuIGJ0bi1wcmltYXJ5XCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMucHJvcHMub25DcmVhdGVQcn1cbiAgICAgICAgICAgIGRpc2FibGVkPXtkaXNhYmxlfT5cbiAgICAgICAgICAgIHttZXNzYWdlfVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBpc1JlcG9zaXRvcnlOb3RGb3VuZCgpIHtcbiAgICByZXR1cm4gIXRoaXMucHJvcHMucmVwb3NpdG9yeTtcbiAgfVxuXG4gIGlzRGV0YWNoZWRIZWFkKCkge1xuICAgIHJldHVybiAhdGhpcy5wcm9wcy5icmFuY2hlcy5nZXRIZWFkQnJhbmNoKCkuaXNQcmVzZW50KCk7XG4gIH1cblxuICBoYXNOb0RlZmF1bHRSZWYoKSB7XG4gICAgcmV0dXJuICF0aGlzLnByb3BzLnJlcG9zaXRvcnkuZGVmYXVsdEJyYW5jaFJlZjtcbiAgfVxuXG4gIGlzT25EZWZhdWx0UmVmKCkge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmICghdGhpcy5wcm9wcy5yZXBvc2l0b3J5KSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGNvbnN0IGRlZmF1bHRSZWYgPSB0aGlzLnByb3BzLnJlcG9zaXRvcnkuZGVmYXVsdEJyYW5jaFJlZjtcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICBpZiAoIWRlZmF1bHRSZWYpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICBjb25zdCBjdXJyZW50QnJhbmNoID0gdGhpcy5wcm9wcy5icmFuY2hlcy5nZXRIZWFkQnJhbmNoKCk7XG4gICAgcmV0dXJuIGN1cnJlbnRCcmFuY2guZ2V0UHVzaCgpLmdldFJlbW90ZVJlZigpID09PSBgJHtkZWZhdWx0UmVmLnByZWZpeH0ke2RlZmF1bHRSZWYubmFtZX1gO1xuICB9XG5cbiAgaXNTYW1lQXNEZWZhdWx0UmVmKCkge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmICghdGhpcy5wcm9wcy5yZXBvc2l0b3J5KSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGNvbnN0IGRlZmF1bHRSZWYgPSB0aGlzLnByb3BzLnJlcG9zaXRvcnkuZGVmYXVsdEJyYW5jaFJlZjtcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICBpZiAoIWRlZmF1bHRSZWYpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICBjb25zdCBjdXJyZW50QnJhbmNoID0gdGhpcy5wcm9wcy5icmFuY2hlcy5nZXRIZWFkQnJhbmNoKCk7XG4gICAgY29uc3QgbWFpbkJyYW5jaGVzID0gdGhpcy5wcm9wcy5icmFuY2hlcy5nZXRQdXNoU291cmNlcyhcbiAgICAgIHRoaXMucHJvcHMucmVtb3RlLmdldE5hbWUoKSwgYCR7ZGVmYXVsdFJlZi5wcmVmaXh9JHtkZWZhdWx0UmVmLm5hbWV9YCk7XG4gICAgcmV0dXJuIG1haW5CcmFuY2hlcy5zb21lKGJyYW5jaCA9PiBicmFuY2guZ2V0U2hhKCkgPT09IGN1cnJlbnRCcmFuY2guZ2V0U2hhKCkpO1xuICB9XG5cbiAgcHVzaGVzVG9EaWZmZXJlbnRSZW1vdGUoKSB7XG4gICAgY29uc3QgcCA9IHRoaXMucHJvcHMuYnJhbmNoZXMuZ2V0SGVhZEJyYW5jaCgpLmdldFB1c2goKTtcbiAgICBpZiAoIXAuaXNSZW1vdGVUcmFja2luZygpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgY29uc3QgcHVzaFJlbW90ZU5hbWUgPSBwLmdldFJlbW90ZU5hbWUoKTtcbiAgICByZXR1cm4gcHVzaFJlbW90ZU5hbWUgIT09IHRoaXMucHJvcHMucmVtb3RlLmdldE5hbWUoKTtcbiAgfVxuXG4gIGhhc1Vwc3RyZWFtQnJhbmNoKCkge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmJyYW5jaGVzLmdldEhlYWRCcmFuY2goKS5nZXRVcHN0cmVhbSgpLmlzUHJlc2VudCgpO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFVBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLFFBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUVBLElBQUFHLFdBQUEsR0FBQUgsT0FBQTtBQUFnRSxTQUFBRCx1QkFBQUssR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLEtBQUFFLE9B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