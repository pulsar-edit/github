"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _reactRelay = require("react-relay");
/* istanbul ignore file */

const mutation = function () {
  const node = require("./__generated__/removeReactionMutation.graphql");
  if (node.hash && node.hash !== "f20b76a0ff63579992f4631894495523") {
    console.error("The definition of 'removeReactionMutation' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
  }
  return require("./__generated__/removeReactionMutation.graphql");
};
var _default = (environment, subjectId, content) => {
  const variables = {
    input: {
      content,
      subjectId
    }
  };
  function optimisticUpdater(store) {
    const subject = store.get(subjectId);
    const reactionGroups = subject.getLinkedRecords('reactionGroups') || [];
    const reactionGroup = reactionGroups.find(group => group.getValue('content') === content);
    if (!reactionGroup) {
      return;
    }
    reactionGroup.setValue(false, 'viewerHasReacted');
    const conn = reactionGroup.getLinkedRecord('users');
    conn.setValue(conn.getValue('totalCount') - 1, 'totalCount');
  }
  return new Promise((resolve, reject) => {
    (0, _reactRelay.commitMutation)(environment, {
      mutation,
      variables,
      optimisticUpdater,
      onCompleted: resolve,
      onError: reject
    });
  });
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3RSZWxheSIsInJlcXVpcmUiLCJtdXRhdGlvbiIsIm5vZGUiLCJoYXNoIiwiY29uc29sZSIsImVycm9yIiwiX2RlZmF1bHQiLCJlbnZpcm9ubWVudCIsInN1YmplY3RJZCIsImNvbnRlbnQiLCJ2YXJpYWJsZXMiLCJpbnB1dCIsIm9wdGltaXN0aWNVcGRhdGVyIiwic3RvcmUiLCJzdWJqZWN0IiwiZ2V0IiwicmVhY3Rpb25Hcm91cHMiLCJnZXRMaW5rZWRSZWNvcmRzIiwicmVhY3Rpb25Hcm91cCIsImZpbmQiLCJncm91cCIsImdldFZhbHVlIiwic2V0VmFsdWUiLCJjb25uIiwiZ2V0TGlua2VkUmVjb3JkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb21taXRNdXRhdGlvbiIsIm9uQ29tcGxldGVkIiwib25FcnJvciIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsicmVtb3ZlLXJlYWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGlzdGFuYnVsIGlnbm9yZSBmaWxlICovXG5cbmltcG9ydCB7Y29tbWl0TXV0YXRpb24sIGdyYXBocWx9IGZyb20gJ3JlYWN0LXJlbGF5JztcblxuY29uc3QgbXV0YXRpb24gPSBncmFwaHFsYFxuICBtdXRhdGlvbiByZW1vdmVSZWFjdGlvbk11dGF0aW9uKCRpbnB1dDogUmVtb3ZlUmVhY3Rpb25JbnB1dCEpIHtcbiAgICByZW1vdmVSZWFjdGlvbihpbnB1dDogJGlucHV0KSB7XG4gICAgICBzdWJqZWN0IHtcbiAgICAgICAgcmVhY3Rpb25Hcm91cHMge1xuICAgICAgICAgIGNvbnRlbnRcbiAgICAgICAgICB2aWV3ZXJIYXNSZWFjdGVkXG4gICAgICAgICAgdXNlcnMge1xuICAgICAgICAgICAgdG90YWxDb3VudFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuYDtcblxuZXhwb3J0IGRlZmF1bHQgKGVudmlyb25tZW50LCBzdWJqZWN0SWQsIGNvbnRlbnQpID0+IHtcbiAgY29uc3QgdmFyaWFibGVzID0ge1xuICAgIGlucHV0OiB7XG4gICAgICBjb250ZW50LFxuICAgICAgc3ViamVjdElkLFxuICAgIH0sXG4gIH07XG5cbiAgZnVuY3Rpb24gb3B0aW1pc3RpY1VwZGF0ZXIoc3RvcmUpIHtcbiAgICBjb25zdCBzdWJqZWN0ID0gc3RvcmUuZ2V0KHN1YmplY3RJZCk7XG4gICAgY29uc3QgcmVhY3Rpb25Hcm91cHMgPSBzdWJqZWN0LmdldExpbmtlZFJlY29yZHMoJ3JlYWN0aW9uR3JvdXBzJykgfHwgW107XG4gICAgY29uc3QgcmVhY3Rpb25Hcm91cCA9IHJlYWN0aW9uR3JvdXBzLmZpbmQoZ3JvdXAgPT4gZ3JvdXAuZ2V0VmFsdWUoJ2NvbnRlbnQnKSA9PT0gY29udGVudCk7XG4gICAgaWYgKCFyZWFjdGlvbkdyb3VwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmVhY3Rpb25Hcm91cC5zZXRWYWx1ZShmYWxzZSwgJ3ZpZXdlckhhc1JlYWN0ZWQnKTtcbiAgICBjb25zdCBjb25uID0gcmVhY3Rpb25Hcm91cC5nZXRMaW5rZWRSZWNvcmQoJ3VzZXJzJyk7XG4gICAgY29ubi5zZXRWYWx1ZShjb25uLmdldFZhbHVlKCd0b3RhbENvdW50JykgLSAxLCAndG90YWxDb3VudCcpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb21taXRNdXRhdGlvbihcbiAgICAgIGVudmlyb25tZW50LFxuICAgICAge1xuICAgICAgICBtdXRhdGlvbixcbiAgICAgICAgdmFyaWFibGVzLFxuICAgICAgICBvcHRpbWlzdGljVXBkYXRlcixcbiAgICAgICAgb25Db21wbGV0ZWQ6IHJlc29sdmUsXG4gICAgICAgIG9uRXJyb3I6IHJlamVjdCxcbiAgICAgIH0sXG4gICAgKTtcbiAgfSk7XG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxJQUFBQSxXQUFBLEdBQUFDLE9BQUE7QUFGQTs7QUFJQSxNQUFNQyxRQUFRLFlBQUFBLENBQUE7RUFBQSxNQUFBQyxJQUFBLEdBQUFGLE9BQUE7RUFBQSxJQUFBRSxJQUFBLENBQUFDLElBQUEsSUFBQUQsSUFBQSxDQUFBQyxJQUFBO0lBQUFDLE9BQUEsQ0FBQUMsS0FBQTtFQUFBO0VBQUEsT0FBQUwsT0FBQTtBQUFBLENBY2I7QUFBQyxJQUFBTSxRQUFBLEdBRWFBLENBQUNDLFdBQVcsRUFBRUMsU0FBUyxFQUFFQyxPQUFPLEtBQUs7RUFDbEQsTUFBTUMsU0FBUyxHQUFHO0lBQ2hCQyxLQUFLLEVBQUU7TUFDTEYsT0FBTztNQUNQRDtJQUNGO0VBQ0YsQ0FBQztFQUVELFNBQVNJLGlCQUFpQkEsQ0FBQ0MsS0FBSyxFQUFFO0lBQ2hDLE1BQU1DLE9BQU8sR0FBR0QsS0FBSyxDQUFDRSxHQUFHLENBQUNQLFNBQVMsQ0FBQztJQUNwQyxNQUFNUSxjQUFjLEdBQUdGLE9BQU8sQ0FBQ0csZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFO0lBQ3ZFLE1BQU1DLGFBQWEsR0FBR0YsY0FBYyxDQUFDRyxJQUFJLENBQUNDLEtBQUssSUFBSUEsS0FBSyxDQUFDQyxRQUFRLENBQUMsU0FBUyxDQUFDLEtBQUtaLE9BQU8sQ0FBQztJQUN6RixJQUFJLENBQUNTLGFBQWEsRUFBRTtNQUNsQjtJQUNGO0lBRUFBLGFBQWEsQ0FBQ0ksUUFBUSxDQUFDLEtBQUssRUFBRSxrQkFBa0IsQ0FBQztJQUNqRCxNQUFNQyxJQUFJLEdBQUdMLGFBQWEsQ0FBQ00sZUFBZSxDQUFDLE9BQU8sQ0FBQztJQUNuREQsSUFBSSxDQUFDRCxRQUFRLENBQUNDLElBQUksQ0FBQ0YsUUFBUSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFBRSxZQUFZLENBQUM7RUFDOUQ7RUFFQSxPQUFPLElBQUlJLE9BQU8sQ0FBQyxDQUFDQyxPQUFPLEVBQUVDLE1BQU0sS0FBSztJQUN0QyxJQUFBQywwQkFBYyxFQUNackIsV0FBVyxFQUNYO01BQ0VOLFFBQVE7TUFDUlMsU0FBUztNQUNURSxpQkFBaUI7TUFDakJpQixXQUFXLEVBQUVILE9BQU87TUFDcEJJLE9BQU8sRUFBRUg7SUFDWCxDQUFDLENBQ0Y7RUFDSCxDQUFDLENBQUM7QUFDSixDQUFDO0FBQUFJLE9BQUEsQ0FBQUMsT0FBQSxHQUFBMUIsUUFBQSJ9