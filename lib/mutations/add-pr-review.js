"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _reactRelay = require("react-relay");
var _relayRuntime = require("relay-runtime");
var _helpers = require("../helpers");
/* istanbul ignore file */

const mutation = function () {
  const node = require("./__generated__/addPrReviewMutation.graphql");
  if (node.hash && node.hash !== "d2960bba4729b6c3e91e249ea582fec1") {
    console.error("The definition of 'addPrReviewMutation' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
  }
  return require("./__generated__/addPrReviewMutation.graphql");
};
let placeholderID = 0;
var _default = (environment, {
  body,
  event,
  pullRequestID,
  viewerID
}) => {
  const variables = {
    input: {
      pullRequestId: pullRequestID
    }
  };
  if (body) {
    variables.input.body = body;
  }
  if (event) {
    variables.input.event = event;
  }
  const configs = [{
    type: 'RANGE_ADD',
    parentID: pullRequestID,
    connectionInfo: [{
      key: 'ReviewSummariesAccumulator_reviews',
      rangeBehavior: 'append'
    }],
    edgeName: 'reviewEdge'
  }];
  function optimisticUpdater(store) {
    const pullRequest = store.get(pullRequestID);
    if (!pullRequest) {
      return;
    }
    const id = `add-pr-review:review:${placeholderID++}`;
    const review = store.create(id, 'PullRequestReview');
    review.setValue(id, 'id');
    review.setValue('PENDING', 'state');
    review.setValue(body, 'body');
    review.setValue(body ? (0, _helpers.renderMarkdown)(body) : '...', 'bodyHTML');
    review.setLinkedRecords([], 'reactionGroups');
    review.setValue(false, 'viewerCanReact');
    review.setValue(false, 'viewerCanUpdate');
    let author;
    if (viewerID) {
      author = store.get(viewerID);
    } else {
      author = store.create(`add-pr-review-comment:author:${placeholderID++}`, 'User');
      author.setValue('...', 'login');
      author.setValue('atom://github/img/avatar.svg', 'avatarUrl');
    }
    review.setLinkedRecord(author, 'author');
    const reviews = _relayRuntime.ConnectionHandler.getConnection(pullRequest, 'ReviewSummariesAccumulator_reviews');
    const edge = _relayRuntime.ConnectionHandler.createEdge(store, reviews, review, 'PullRequestReviewEdge');
    _relayRuntime.ConnectionHandler.insertEdgeAfter(reviews, edge);
  }
  return new Promise((resolve, reject) => {
    (0, _reactRelay.commitMutation)(environment, {
      mutation,
      variables,
      configs,
      optimisticUpdater,
      onCompleted: resolve,
      onError: reject
    });
  });
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3RSZWxheSIsInJlcXVpcmUiLCJfcmVsYXlSdW50aW1lIiwiX2hlbHBlcnMiLCJtdXRhdGlvbiIsIm5vZGUiLCJoYXNoIiwiY29uc29sZSIsImVycm9yIiwicGxhY2Vob2xkZXJJRCIsIl9kZWZhdWx0IiwiZW52aXJvbm1lbnQiLCJib2R5IiwiZXZlbnQiLCJwdWxsUmVxdWVzdElEIiwidmlld2VySUQiLCJ2YXJpYWJsZXMiLCJpbnB1dCIsInB1bGxSZXF1ZXN0SWQiLCJjb25maWdzIiwidHlwZSIsInBhcmVudElEIiwiY29ubmVjdGlvbkluZm8iLCJrZXkiLCJyYW5nZUJlaGF2aW9yIiwiZWRnZU5hbWUiLCJvcHRpbWlzdGljVXBkYXRlciIsInN0b3JlIiwicHVsbFJlcXVlc3QiLCJnZXQiLCJpZCIsInJldmlldyIsImNyZWF0ZSIsInNldFZhbHVlIiwicmVuZGVyTWFya2Rvd24iLCJzZXRMaW5rZWRSZWNvcmRzIiwiYXV0aG9yIiwic2V0TGlua2VkUmVjb3JkIiwicmV2aWV3cyIsIkNvbm5lY3Rpb25IYW5kbGVyIiwiZ2V0Q29ubmVjdGlvbiIsImVkZ2UiLCJjcmVhdGVFZGdlIiwiaW5zZXJ0RWRnZUFmdGVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb21taXRNdXRhdGlvbiIsIm9uQ29tcGxldGVkIiwib25FcnJvciIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiYWRkLXByLXJldmlldy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBpc3RhbmJ1bCBpZ25vcmUgZmlsZSAqL1xuXG5pbXBvcnQge2NvbW1pdE11dGF0aW9uLCBncmFwaHFsfSBmcm9tICdyZWFjdC1yZWxheSc7XG5pbXBvcnQge0Nvbm5lY3Rpb25IYW5kbGVyfSBmcm9tICdyZWxheS1ydW50aW1lJztcblxuaW1wb3J0IHtyZW5kZXJNYXJrZG93bn0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmNvbnN0IG11dGF0aW9uID0gZ3JhcGhxbGBcbiAgbXV0YXRpb24gYWRkUHJSZXZpZXdNdXRhdGlvbigkaW5wdXQ6IEFkZFB1bGxSZXF1ZXN0UmV2aWV3SW5wdXQhKSB7XG4gICAgYWRkUHVsbFJlcXVlc3RSZXZpZXcoaW5wdXQ6ICRpbnB1dCkge1xuICAgICAgcmV2aWV3RWRnZSB7XG4gICAgICAgIG5vZGUge1xuICAgICAgICAgIGlkXG4gICAgICAgICAgYm9keVxuICAgICAgICAgIGJvZHlIVE1MXG4gICAgICAgICAgc3RhdGVcbiAgICAgICAgICBzdWJtaXR0ZWRBdFxuICAgICAgICAgIHZpZXdlckNhblJlYWN0XG4gICAgICAgICAgdmlld2VyQ2FuVXBkYXRlXG4gICAgICAgICAgYXV0aG9yIHtcbiAgICAgICAgICAgIGxvZ2luXG4gICAgICAgICAgICBhdmF0YXJVcmxcbiAgICAgICAgICB9XG4gICAgICAgICAgLi4uZW1vamlSZWFjdGlvbnNDb250cm9sbGVyX3JlYWN0YWJsZVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5gO1xuXG5sZXQgcGxhY2Vob2xkZXJJRCA9IDA7XG5cbmV4cG9ydCBkZWZhdWx0IChlbnZpcm9ubWVudCwge2JvZHksIGV2ZW50LCBwdWxsUmVxdWVzdElELCB2aWV3ZXJJRH0pID0+IHtcbiAgY29uc3QgdmFyaWFibGVzID0ge1xuICAgIGlucHV0OiB7cHVsbFJlcXVlc3RJZDogcHVsbFJlcXVlc3RJRH0sXG4gIH07XG5cbiAgaWYgKGJvZHkpIHtcbiAgICB2YXJpYWJsZXMuaW5wdXQuYm9keSA9IGJvZHk7XG4gIH1cbiAgaWYgKGV2ZW50KSB7XG4gICAgdmFyaWFibGVzLmlucHV0LmV2ZW50ID0gZXZlbnQ7XG4gIH1cblxuICBjb25zdCBjb25maWdzID0gW3tcbiAgICB0eXBlOiAnUkFOR0VfQUREJyxcbiAgICBwYXJlbnRJRDogcHVsbFJlcXVlc3RJRCxcbiAgICBjb25uZWN0aW9uSW5mbzogW3trZXk6ICdSZXZpZXdTdW1tYXJpZXNBY2N1bXVsYXRvcl9yZXZpZXdzJywgcmFuZ2VCZWhhdmlvcjogJ2FwcGVuZCd9XSxcbiAgICBlZGdlTmFtZTogJ3Jldmlld0VkZ2UnLFxuICB9XTtcblxuICBmdW5jdGlvbiBvcHRpbWlzdGljVXBkYXRlcihzdG9yZSkge1xuICAgIGNvbnN0IHB1bGxSZXF1ZXN0ID0gc3RvcmUuZ2V0KHB1bGxSZXF1ZXN0SUQpO1xuICAgIGlmICghcHVsbFJlcXVlc3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpZCA9IGBhZGQtcHItcmV2aWV3OnJldmlldzoke3BsYWNlaG9sZGVySUQrK31gO1xuICAgIGNvbnN0IHJldmlldyA9IHN0b3JlLmNyZWF0ZShpZCwgJ1B1bGxSZXF1ZXN0UmV2aWV3Jyk7XG4gICAgcmV2aWV3LnNldFZhbHVlKGlkLCAnaWQnKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoJ1BFTkRJTkcnLCAnc3RhdGUnKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoYm9keSwgJ2JvZHknKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoYm9keSA/IHJlbmRlck1hcmtkb3duKGJvZHkpIDogJy4uLicsICdib2R5SFRNTCcpO1xuICAgIHJldmlldy5zZXRMaW5rZWRSZWNvcmRzKFtdLCAncmVhY3Rpb25Hcm91cHMnKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoZmFsc2UsICd2aWV3ZXJDYW5SZWFjdCcpO1xuICAgIHJldmlldy5zZXRWYWx1ZShmYWxzZSwgJ3ZpZXdlckNhblVwZGF0ZScpO1xuXG4gICAgbGV0IGF1dGhvcjtcbiAgICBpZiAodmlld2VySUQpIHtcbiAgICAgIGF1dGhvciA9IHN0b3JlLmdldCh2aWV3ZXJJRCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF1dGhvciA9IHN0b3JlLmNyZWF0ZShgYWRkLXByLXJldmlldy1jb21tZW50OmF1dGhvcjoke3BsYWNlaG9sZGVySUQrK31gLCAnVXNlcicpO1xuICAgICAgYXV0aG9yLnNldFZhbHVlKCcuLi4nLCAnbG9naW4nKTtcbiAgICAgIGF1dGhvci5zZXRWYWx1ZSgnYXRvbTovL2dpdGh1Yi9pbWcvYXZhdGFyLnN2ZycsICdhdmF0YXJVcmwnKTtcbiAgICB9XG4gICAgcmV2aWV3LnNldExpbmtlZFJlY29yZChhdXRob3IsICdhdXRob3InKTtcblxuICAgIGNvbnN0IHJldmlld3MgPSBDb25uZWN0aW9uSGFuZGxlci5nZXRDb25uZWN0aW9uKHB1bGxSZXF1ZXN0LCAnUmV2aWV3U3VtbWFyaWVzQWNjdW11bGF0b3JfcmV2aWV3cycpO1xuICAgIGNvbnN0IGVkZ2UgPSBDb25uZWN0aW9uSGFuZGxlci5jcmVhdGVFZGdlKHN0b3JlLCByZXZpZXdzLCByZXZpZXcsICdQdWxsUmVxdWVzdFJldmlld0VkZ2UnKTtcbiAgICBDb25uZWN0aW9uSGFuZGxlci5pbnNlcnRFZGdlQWZ0ZXIocmV2aWV3cywgZWRnZSk7XG4gIH1cblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbW1pdE11dGF0aW9uKFxuICAgICAgZW52aXJvbm1lbnQsXG4gICAgICB7XG4gICAgICAgIG11dGF0aW9uLFxuICAgICAgICB2YXJpYWJsZXMsXG4gICAgICAgIGNvbmZpZ3MsXG4gICAgICAgIG9wdGltaXN0aWNVcGRhdGVyLFxuICAgICAgICBvbkNvbXBsZXRlZDogcmVzb2x2ZSxcbiAgICAgICAgb25FcnJvcjogcmVqZWN0LFxuICAgICAgfSxcbiAgICApO1xuICB9KTtcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLElBQUFBLFdBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLGFBQUEsR0FBQUQsT0FBQTtBQUVBLElBQUFFLFFBQUEsR0FBQUYsT0FBQTtBQUxBOztBQU9BLE1BQU1HLFFBQVEsWUFBQUEsQ0FBQTtFQUFBLE1BQUFDLElBQUEsR0FBQUosT0FBQTtFQUFBLElBQUFJLElBQUEsQ0FBQUMsSUFBQSxJQUFBRCxJQUFBLENBQUFDLElBQUE7SUFBQUMsT0FBQSxDQUFBQyxLQUFBO0VBQUE7RUFBQSxPQUFBUCxPQUFBO0FBQUEsQ0FxQmI7QUFFRCxJQUFJUSxhQUFhLEdBQUcsQ0FBQztBQUFDLElBQUFDLFFBQUEsR0FFUEEsQ0FBQ0MsV0FBVyxFQUFFO0VBQUNDLElBQUk7RUFBRUMsS0FBSztFQUFFQyxhQUFhO0VBQUVDO0FBQVEsQ0FBQyxLQUFLO0VBQ3RFLE1BQU1DLFNBQVMsR0FBRztJQUNoQkMsS0FBSyxFQUFFO01BQUNDLGFBQWEsRUFBRUo7SUFBYTtFQUN0QyxDQUFDO0VBRUQsSUFBSUYsSUFBSSxFQUFFO0lBQ1JJLFNBQVMsQ0FBQ0MsS0FBSyxDQUFDTCxJQUFJLEdBQUdBLElBQUk7RUFDN0I7RUFDQSxJQUFJQyxLQUFLLEVBQUU7SUFDVEcsU0FBUyxDQUFDQyxLQUFLLENBQUNKLEtBQUssR0FBR0EsS0FBSztFQUMvQjtFQUVBLE1BQU1NLE9BQU8sR0FBRyxDQUFDO0lBQ2ZDLElBQUksRUFBRSxXQUFXO0lBQ2pCQyxRQUFRLEVBQUVQLGFBQWE7SUFDdkJRLGNBQWMsRUFBRSxDQUFDO01BQUNDLEdBQUcsRUFBRSxvQ0FBb0M7TUFBRUMsYUFBYSxFQUFFO0lBQVEsQ0FBQyxDQUFDO0lBQ3RGQyxRQUFRLEVBQUU7RUFDWixDQUFDLENBQUM7RUFFRixTQUFTQyxpQkFBaUJBLENBQUNDLEtBQUssRUFBRTtJQUNoQyxNQUFNQyxXQUFXLEdBQUdELEtBQUssQ0FBQ0UsR0FBRyxDQUFDZixhQUFhLENBQUM7SUFDNUMsSUFBSSxDQUFDYyxXQUFXLEVBQUU7TUFDaEI7SUFDRjtJQUVBLE1BQU1FLEVBQUUsR0FBSSx3QkFBdUJyQixhQUFhLEVBQUcsRUFBQztJQUNwRCxNQUFNc0IsTUFBTSxHQUFHSixLQUFLLENBQUNLLE1BQU0sQ0FBQ0YsRUFBRSxFQUFFLG1CQUFtQixDQUFDO0lBQ3BEQyxNQUFNLENBQUNFLFFBQVEsQ0FBQ0gsRUFBRSxFQUFFLElBQUksQ0FBQztJQUN6QkMsTUFBTSxDQUFDRSxRQUFRLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQztJQUNuQ0YsTUFBTSxDQUFDRSxRQUFRLENBQUNyQixJQUFJLEVBQUUsTUFBTSxDQUFDO0lBQzdCbUIsTUFBTSxDQUFDRSxRQUFRLENBQUNyQixJQUFJLEdBQUcsSUFBQXNCLHVCQUFjLEVBQUN0QixJQUFJLENBQUMsR0FBRyxLQUFLLEVBQUUsVUFBVSxDQUFDO0lBQ2hFbUIsTUFBTSxDQUFDSSxnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsZ0JBQWdCLENBQUM7SUFDN0NKLE1BQU0sQ0FBQ0UsUUFBUSxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQztJQUN4Q0YsTUFBTSxDQUFDRSxRQUFRLENBQUMsS0FBSyxFQUFFLGlCQUFpQixDQUFDO0lBRXpDLElBQUlHLE1BQU07SUFDVixJQUFJckIsUUFBUSxFQUFFO01BQ1pxQixNQUFNLEdBQUdULEtBQUssQ0FBQ0UsR0FBRyxDQUFDZCxRQUFRLENBQUM7SUFDOUIsQ0FBQyxNQUFNO01BQ0xxQixNQUFNLEdBQUdULEtBQUssQ0FBQ0ssTUFBTSxDQUFFLGdDQUErQnZCLGFBQWEsRUFBRyxFQUFDLEVBQUUsTUFBTSxDQUFDO01BQ2hGMkIsTUFBTSxDQUFDSCxRQUFRLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQztNQUMvQkcsTUFBTSxDQUFDSCxRQUFRLENBQUMsOEJBQThCLEVBQUUsV0FBVyxDQUFDO0lBQzlEO0lBQ0FGLE1BQU0sQ0FBQ00sZUFBZSxDQUFDRCxNQUFNLEVBQUUsUUFBUSxDQUFDO0lBRXhDLE1BQU1FLE9BQU8sR0FBR0MsK0JBQWlCLENBQUNDLGFBQWEsQ0FBQ1osV0FBVyxFQUFFLG9DQUFvQyxDQUFDO0lBQ2xHLE1BQU1hLElBQUksR0FBR0YsK0JBQWlCLENBQUNHLFVBQVUsQ0FBQ2YsS0FBSyxFQUFFVyxPQUFPLEVBQUVQLE1BQU0sRUFBRSx1QkFBdUIsQ0FBQztJQUMxRlEsK0JBQWlCLENBQUNJLGVBQWUsQ0FBQ0wsT0FBTyxFQUFFRyxJQUFJLENBQUM7RUFDbEQ7RUFFQSxPQUFPLElBQUlHLE9BQU8sQ0FBQyxDQUFDQyxPQUFPLEVBQUVDLE1BQU0sS0FBSztJQUN0QyxJQUFBQywwQkFBYyxFQUNacEMsV0FBVyxFQUNYO01BQ0VQLFFBQVE7TUFDUlksU0FBUztNQUNURyxPQUFPO01BQ1BPLGlCQUFpQjtNQUNqQnNCLFdBQVcsRUFBRUgsT0FBTztNQUNwQkksT0FBTyxFQUFFSDtJQUNYLENBQ0YsQ0FBQztFQUNILENBQUMsQ0FBQztBQUNKLENBQUM7QUFBQUksT0FBQSxDQUFBQyxPQUFBLEdBQUF6QyxRQUFBIn0=