"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _reactRelay = require("react-relay");
var _relayRuntime = require("relay-runtime");
var _helpers = require("../helpers");
/* istanbul ignore file */

const mutation = function () {
  const node = require("./__generated__/addPrReviewMutation.graphql");
  if (node.hash && node.hash !== "d2960bba4729b6c3e91e249ea582fec1") {
    console.error("The definition of 'addPrReviewMutation' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
  }
  return require("./__generated__/addPrReviewMutation.graphql");
};
let placeholderID = 0;
var _default = (environment, {
  body,
  event,
  pullRequestID,
  viewerID
}) => {
  const variables = {
    input: {
      pullRequestId: pullRequestID
    }
  };
  if (body) {
    variables.input.body = body;
  }
  if (event) {
    variables.input.event = event;
  }
  const configs = [{
    type: 'RANGE_ADD',
    parentID: pullRequestID,
    connectionInfo: [{
      key: 'ReviewSummariesAccumulator_reviews',
      rangeBehavior: 'append'
    }],
    edgeName: 'reviewEdge'
  }];
  function optimisticUpdater(store) {
    const pullRequest = store.get(pullRequestID);
    if (!pullRequest) {
      return;
    }
    const id = `add-pr-review:review:${placeholderID++}`;
    const review = store.create(id, 'PullRequestReview');
    review.setValue(id, 'id');
    review.setValue('PENDING', 'state');
    review.setValue(body, 'body');
    review.setValue(body ? (0, _helpers.renderMarkdown)(body) : '...', 'bodyHTML');
    review.setLinkedRecords([], 'reactionGroups');
    review.setValue(false, 'viewerCanReact');
    review.setValue(false, 'viewerCanUpdate');
    let author;
    if (viewerID) {
      author = store.get(viewerID);
    } else {
      author = store.create(`add-pr-review-comment:author:${placeholderID++}`, 'User');
      author.setValue('...', 'login');
      author.setValue('atom://github/img/avatar.svg', 'avatarUrl');
    }
    review.setLinkedRecord(author, 'author');
    const reviews = _relayRuntime.ConnectionHandler.getConnection(pullRequest, 'ReviewSummariesAccumulator_reviews');
    const edge = _relayRuntime.ConnectionHandler.createEdge(store, reviews, review, 'PullRequestReviewEdge');
    _relayRuntime.ConnectionHandler.insertEdgeAfter(reviews, edge);
  }
  return new Promise((resolve, reject) => {
    (0, _reactRelay.commitMutation)(environment, {
      mutation,
      variables,
      configs,
      optimisticUpdater,
      onCompleted: resolve,
      onError: reject
    });
  });
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtdXRhdGlvbiIsInBsYWNlaG9sZGVySUQiLCJlbnZpcm9ubWVudCIsImJvZHkiLCJldmVudCIsInB1bGxSZXF1ZXN0SUQiLCJ2aWV3ZXJJRCIsInZhcmlhYmxlcyIsImlucHV0IiwicHVsbFJlcXVlc3RJZCIsImNvbmZpZ3MiLCJ0eXBlIiwicGFyZW50SUQiLCJjb25uZWN0aW9uSW5mbyIsImtleSIsInJhbmdlQmVoYXZpb3IiLCJlZGdlTmFtZSIsIm9wdGltaXN0aWNVcGRhdGVyIiwic3RvcmUiLCJwdWxsUmVxdWVzdCIsImdldCIsImlkIiwicmV2aWV3IiwiY3JlYXRlIiwic2V0VmFsdWUiLCJyZW5kZXJNYXJrZG93biIsInNldExpbmtlZFJlY29yZHMiLCJhdXRob3IiLCJzZXRMaW5rZWRSZWNvcmQiLCJyZXZpZXdzIiwiQ29ubmVjdGlvbkhhbmRsZXIiLCJnZXRDb25uZWN0aW9uIiwiZWRnZSIsImNyZWF0ZUVkZ2UiLCJpbnNlcnRFZGdlQWZ0ZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNvbW1pdE11dGF0aW9uIiwib25Db21wbGV0ZWQiLCJvbkVycm9yIl0sInNvdXJjZXMiOlsiYWRkLXByLXJldmlldy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBpc3RhbmJ1bCBpZ25vcmUgZmlsZSAqL1xuXG5pbXBvcnQge2NvbW1pdE11dGF0aW9uLCBncmFwaHFsfSBmcm9tICdyZWFjdC1yZWxheSc7XG5pbXBvcnQge0Nvbm5lY3Rpb25IYW5kbGVyfSBmcm9tICdyZWxheS1ydW50aW1lJztcblxuaW1wb3J0IHtyZW5kZXJNYXJrZG93bn0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmNvbnN0IG11dGF0aW9uID0gZ3JhcGhxbGBcbiAgbXV0YXRpb24gYWRkUHJSZXZpZXdNdXRhdGlvbigkaW5wdXQ6IEFkZFB1bGxSZXF1ZXN0UmV2aWV3SW5wdXQhKSB7XG4gICAgYWRkUHVsbFJlcXVlc3RSZXZpZXcoaW5wdXQ6ICRpbnB1dCkge1xuICAgICAgcmV2aWV3RWRnZSB7XG4gICAgICAgIG5vZGUge1xuICAgICAgICAgIGlkXG4gICAgICAgICAgYm9keVxuICAgICAgICAgIGJvZHlIVE1MXG4gICAgICAgICAgc3RhdGVcbiAgICAgICAgICBzdWJtaXR0ZWRBdFxuICAgICAgICAgIHZpZXdlckNhblJlYWN0XG4gICAgICAgICAgdmlld2VyQ2FuVXBkYXRlXG4gICAgICAgICAgYXV0aG9yIHtcbiAgICAgICAgICAgIGxvZ2luXG4gICAgICAgICAgICBhdmF0YXJVcmxcbiAgICAgICAgICB9XG4gICAgICAgICAgLi4uZW1vamlSZWFjdGlvbnNDb250cm9sbGVyX3JlYWN0YWJsZVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5gO1xuXG5sZXQgcGxhY2Vob2xkZXJJRCA9IDA7XG5cbmV4cG9ydCBkZWZhdWx0IChlbnZpcm9ubWVudCwge2JvZHksIGV2ZW50LCBwdWxsUmVxdWVzdElELCB2aWV3ZXJJRH0pID0+IHtcbiAgY29uc3QgdmFyaWFibGVzID0ge1xuICAgIGlucHV0OiB7cHVsbFJlcXVlc3RJZDogcHVsbFJlcXVlc3RJRH0sXG4gIH07XG5cbiAgaWYgKGJvZHkpIHtcbiAgICB2YXJpYWJsZXMuaW5wdXQuYm9keSA9IGJvZHk7XG4gIH1cbiAgaWYgKGV2ZW50KSB7XG4gICAgdmFyaWFibGVzLmlucHV0LmV2ZW50ID0gZXZlbnQ7XG4gIH1cblxuICBjb25zdCBjb25maWdzID0gW3tcbiAgICB0eXBlOiAnUkFOR0VfQUREJyxcbiAgICBwYXJlbnRJRDogcHVsbFJlcXVlc3RJRCxcbiAgICBjb25uZWN0aW9uSW5mbzogW3trZXk6ICdSZXZpZXdTdW1tYXJpZXNBY2N1bXVsYXRvcl9yZXZpZXdzJywgcmFuZ2VCZWhhdmlvcjogJ2FwcGVuZCd9XSxcbiAgICBlZGdlTmFtZTogJ3Jldmlld0VkZ2UnLFxuICB9XTtcblxuICBmdW5jdGlvbiBvcHRpbWlzdGljVXBkYXRlcihzdG9yZSkge1xuICAgIGNvbnN0IHB1bGxSZXF1ZXN0ID0gc3RvcmUuZ2V0KHB1bGxSZXF1ZXN0SUQpO1xuICAgIGlmICghcHVsbFJlcXVlc3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpZCA9IGBhZGQtcHItcmV2aWV3OnJldmlldzoke3BsYWNlaG9sZGVySUQrK31gO1xuICAgIGNvbnN0IHJldmlldyA9IHN0b3JlLmNyZWF0ZShpZCwgJ1B1bGxSZXF1ZXN0UmV2aWV3Jyk7XG4gICAgcmV2aWV3LnNldFZhbHVlKGlkLCAnaWQnKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoJ1BFTkRJTkcnLCAnc3RhdGUnKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoYm9keSwgJ2JvZHknKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoYm9keSA/IHJlbmRlck1hcmtkb3duKGJvZHkpIDogJy4uLicsICdib2R5SFRNTCcpO1xuICAgIHJldmlldy5zZXRMaW5rZWRSZWNvcmRzKFtdLCAncmVhY3Rpb25Hcm91cHMnKTtcbiAgICByZXZpZXcuc2V0VmFsdWUoZmFsc2UsICd2aWV3ZXJDYW5SZWFjdCcpO1xuICAgIHJldmlldy5zZXRWYWx1ZShmYWxzZSwgJ3ZpZXdlckNhblVwZGF0ZScpO1xuXG4gICAgbGV0IGF1dGhvcjtcbiAgICBpZiAodmlld2VySUQpIHtcbiAgICAgIGF1dGhvciA9IHN0b3JlLmdldCh2aWV3ZXJJRCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF1dGhvciA9IHN0b3JlLmNyZWF0ZShgYWRkLXByLXJldmlldy1jb21tZW50OmF1dGhvcjoke3BsYWNlaG9sZGVySUQrK31gLCAnVXNlcicpO1xuICAgICAgYXV0aG9yLnNldFZhbHVlKCcuLi4nLCAnbG9naW4nKTtcbiAgICAgIGF1dGhvci5zZXRWYWx1ZSgnYXRvbTovL2dpdGh1Yi9pbWcvYXZhdGFyLnN2ZycsICdhdmF0YXJVcmwnKTtcbiAgICB9XG4gICAgcmV2aWV3LnNldExpbmtlZFJlY29yZChhdXRob3IsICdhdXRob3InKTtcblxuICAgIGNvbnN0IHJldmlld3MgPSBDb25uZWN0aW9uSGFuZGxlci5nZXRDb25uZWN0aW9uKHB1bGxSZXF1ZXN0LCAnUmV2aWV3U3VtbWFyaWVzQWNjdW11bGF0b3JfcmV2aWV3cycpO1xuICAgIGNvbnN0IGVkZ2UgPSBDb25uZWN0aW9uSGFuZGxlci5jcmVhdGVFZGdlKHN0b3JlLCByZXZpZXdzLCByZXZpZXcsICdQdWxsUmVxdWVzdFJldmlld0VkZ2UnKTtcbiAgICBDb25uZWN0aW9uSGFuZGxlci5pbnNlcnRFZGdlQWZ0ZXIocmV2aWV3cywgZWRnZSk7XG4gIH1cblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbW1pdE11dGF0aW9uKFxuICAgICAgZW52aXJvbm1lbnQsXG4gICAgICB7XG4gICAgICAgIG11dGF0aW9uLFxuICAgICAgICB2YXJpYWJsZXMsXG4gICAgICAgIGNvbmZpZ3MsXG4gICAgICAgIG9wdGltaXN0aWNVcGRhdGVyLFxuICAgICAgICBvbkNvbXBsZXRlZDogcmVzb2x2ZSxcbiAgICAgICAgb25FcnJvcjogcmVqZWN0LFxuICAgICAgfSxcbiAgICApO1xuICB9KTtcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBO0FBQ0E7QUFFQTtBQUxBOztBQU9BLE1BQU1BLFFBQVE7RUFBQTtFQUFBO0lBQUE7RUFBQTtFQUFBO0FBQUEsQ0FxQmI7QUFFRCxJQUFJQyxhQUFhLEdBQUcsQ0FBQztBQUFDLGVBRVAsQ0FBQ0MsV0FBVyxFQUFFO0VBQUNDLElBQUk7RUFBRUMsS0FBSztFQUFFQyxhQUFhO0VBQUVDO0FBQVEsQ0FBQyxLQUFLO0VBQ3RFLE1BQU1DLFNBQVMsR0FBRztJQUNoQkMsS0FBSyxFQUFFO01BQUNDLGFBQWEsRUFBRUo7SUFBYTtFQUN0QyxDQUFDO0VBRUQsSUFBSUYsSUFBSSxFQUFFO0lBQ1JJLFNBQVMsQ0FBQ0MsS0FBSyxDQUFDTCxJQUFJLEdBQUdBLElBQUk7RUFDN0I7RUFDQSxJQUFJQyxLQUFLLEVBQUU7SUFDVEcsU0FBUyxDQUFDQyxLQUFLLENBQUNKLEtBQUssR0FBR0EsS0FBSztFQUMv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