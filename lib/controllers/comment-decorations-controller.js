"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BareCommentDecorationsController = void 0;
var _react = _interopRequireWildcard(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _reactRelay = require("react-relay");
var _path = _interopRequireDefault(require("path"));
var _editorCommentDecorationsController = _interopRequireDefault(require("./editor-comment-decorations-controller"));
var _reviewsItem = _interopRequireDefault(require("../items/reviews-item"));
var _gutter = _interopRequireDefault(require("../atom/gutter"));
var _commands = _interopRequireWildcard(require("../atom/commands"));
var _propTypes2 = require("../prop-types");
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class BareCommentDecorationsController extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "updateOpenEditors", () => {
      return new Promise(resolve => {
        this.setState({
          openEditors: this.props.workspace.getTextEditors()
        }, resolve);
      });
    });
    _defineProperty(this, "openReviewsTab", () => {
      const [pullRequest] = this.props.pullRequests;
      /* istanbul ignore if */
      if (!pullRequest) {
        return null;
      }
      const uri = _reviewsItem.default.buildURI({
        host: this.props.endpoint.getHost(),
        owner: this.props.owner,
        repo: this.props.repo,
        number: pullRequest.number,
        workdir: this.props.repoData.workingDirectoryPath
      });
      return this.props.workspace.open(uri, {
        searchAllPanes: true
      });
    });
    this.subscriptions = new _eventKit.CompositeDisposable();
    this.state = {
      openEditors: this.props.workspace.getTextEditors()
    };
  }
  componentDidMount() {
    this.subscriptions.add(this.props.workspace.observeTextEditors(this.updateOpenEditors), this.props.workspace.onDidDestroyPaneItem(this.updateOpenEditors));
  }
  componentWillUnmount() {
    this.subscriptions.dispose();
  }
  render() {
    if (this.props.pullRequests.length === 0) {
      return null;
    }
    const pullRequest = this.props.pullRequests[0];

    // only show comment decorations if we're on a checked out pull request
    // otherwise, we'd have no way of knowing which comments to show.
    if (!this.isCheckedOutPullRequest(this.props.repoData.branches, this.props.repoData.remotes, pullRequest)) {
      return null;
    }
    const threadDataByPath = new Map();
    const workdirPath = this.props.repoData.workingDirectoryPath;
    for (const {
      comments,
      thread
    } of this.props.commentThreads) {
      // Skip comment threads that are entirely minimized.
      if (comments.every(comment => comment.isMinimized)) {
        continue;
      }

      // There may be multiple comments in the thread, but we really only care about the root comment when rendering
      // decorations.
      const threadData = {
        rootCommentID: comments[0].id,
        threadID: thread.id,
        position: comments[0].position,
        nativeRelPath: (0, _helpers.toNativePathSep)(comments[0].path),
        fullPath: _path.default.join(workdirPath, (0, _helpers.toNativePathSep)(comments[0].path))
      };
      if (threadDataByPath.get(threadData.fullPath)) {
        threadDataByPath.get(threadData.fullPath).push(threadData);
      } else {
        threadDataByPath.set(threadData.fullPath, [threadData]);
      }
    }
    const openEditorsWithCommentThreads = this.getOpenEditorsWithCommentThreads(threadDataByPath);
    return _react.default.createElement(_react.Fragment, null, _react.default.createElement(_commands.default, {
      registry: this.props.commands,
      target: "atom-workspace"
    }, _react.default.createElement(_commands.Command, {
      command: "github:open-reviews-tab",
      callback: this.openReviewsTab
    })), openEditorsWithCommentThreads.map(editor => {
      const threadData = threadDataByPath.get(editor.getPath());
      const translations = this.props.commentTranslations.get(threadData[0].nativeRelPath);
      return _react.default.createElement(_react.Fragment, {
        key: `github-editor-decoration-${editor.id}`
      }, _react.default.createElement(_gutter.default, {
        name: "github-comment-icon",
        priority: 1,
        className: "comment",
        editor: editor,
        type: "decorated"
      }), _react.default.createElement(_editorCommentDecorationsController.default, {
        endpoint: this.props.endpoint,
        owner: this.props.owner,
        repo: this.props.repo,
        number: pullRequest.number,
        workdir: workdirPath,
        workspace: this.props.workspace,
        editor: editor,
        fileName: editor.getPath(),
        headSha: pullRequest.headRefOid,
        threadsForPath: threadData,
        commentTranslationsForPath: translations
      }));
    }));
  }
  getOpenEditorsWithCommentThreads(threadDataByPath) {
    const haveThreads = [];
    for (const editor of this.state.openEditors) {
      if (threadDataByPath.has(editor.getPath())) {
        haveThreads.push(editor);
      }
    }
    return haveThreads;
  }

  // Determine if we already have this PR checked out.
  // todo: if this is similar enough to pr-checkout-controller, extract a single
  // helper function to do this check.
  isCheckedOutPullRequest(branches, remotes, pullRequest) {
    // determine if pullRequest.headRepository is null
    // this can happen if a repository has been deleted.
    if (!pullRequest.headRepository) {
      return false;
    }
    const {
      repository
    } = pullRequest;
    const headPush = branches.getHeadBranch().getPush();
    const headRemote = remotes.withName(headPush.getRemoteName());

    // (detect checkout from pull/### refspec)
    const fromPullRefspec = headRemote.getOwner() === repository.owner.login && headRemote.getRepo() === repository.name && headPush.getShortRemoteRef() === `pull/${pullRequest.number}/head`;

    // (detect checkout from head repository)
    const fromHeadRepo = headRemote.getOwner() === pullRequest.headRepository.owner.login && headRemote.getRepo() === pullRequest.headRepository.name && headPush.getShortRemoteRef() === pullRequest.headRefName;
    if (fromPullRefspec || fromHeadRepo) {
      return true;
    }
    return false;
  }
}
exports.BareCommentDecorationsController = BareCommentDecorationsController;
_defineProperty(BareCommentDecorationsController, "propTypes", {
  // Relay response
  relay: _propTypes.default.object.isRequired,
  pullRequests: _propTypes.default.arrayOf(_propTypes.default.shape({
    number: _propTypes.default.number.isRequired,
    headRefName: _propTypes.default.string.isRequired,
    headRefOid: _propTypes.default.string.isRequired,
    headRepository: _propTypes.default.shape({
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }),
    repository: _propTypes.default.shape({
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }).isRequired
  })),
  // Connection information
  endpoint: _propTypes2.EndpointPropType.isRequired,
  owner: _propTypes.default.string.isRequired,
  repo: _propTypes.default.string.isRequired,
  // Atom environment
  workspace: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  // Models
  repoData: _propTypes.default.shape({
    branches: _propTypes2.BranchSetPropType.isRequired,
    remotes: _propTypes2.RemoteSetPropType.isRequired,
    currentRemote: _propTypes2.RemotePropType.isRequired,
    workingDirectoryPath: _propTypes.default.string.isRequired
  }).isRequired,
  commentThreads: _propTypes.default.arrayOf(_propTypes.default.shape({
    comments: _propTypes.default.arrayOf(_propTypes.default.object).isRequired,
    thread: _propTypes.default.shape({
      id: _propTypes.default.string.isRequired
    }).isRequired
  })).isRequired,
  commentTranslations: _propTypes.default.shape({
    get: _propTypes.default.func.isRequired
  }).isRequired
});
var _default = (0, _reactRelay.createFragmentContainer)(BareCommentDecorationsController, {
  pullRequests: function () {
    const node = require("./__generated__/commentDecorationsController_pullRequests.graphql");
    if (node.hash && node.hash !== "62f96ccd13dfc2649112a7b4afaf4ba2") {
      console.error("The definition of 'commentDecorationsController_pullRequests' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
    }
    return require("./__generated__/commentDecorationsController_pullRequests.graphql");
  }
});
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcHJvcFR5cGVzIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9ldmVudEtpdCIsIl9yZWFjdFJlbGF5IiwiX3BhdGgiLCJfZWRpdG9yQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciIsIl9yZXZpZXdzSXRlbSIsIl9ndXR0ZXIiLCJfY29tbWFuZHMiLCJfcHJvcFR5cGVzMiIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJub2RlSW50ZXJvcCIsIldlYWtNYXAiLCJjYWNoZUJhYmVsSW50ZXJvcCIsImNhY2hlTm9kZUludGVyb3AiLCJjYWNoZSIsImhhcyIsImdldCIsIm5ld09iaiIsImhhc1Byb3BlcnR5RGVzY3JpcHRvciIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsInNldCIsIl9kZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJhcmciLCJfdG9QcmltaXRpdmUiLCJTdHJpbmciLCJpbnB1dCIsImhpbnQiLCJwcmltIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJ1bmRlZmluZWQiLCJyZXMiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJCYXJlQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNvbnRleHQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFN0YXRlIiwib3BlbkVkaXRvcnMiLCJ3b3Jrc3BhY2UiLCJnZXRUZXh0RWRpdG9ycyIsInB1bGxSZXF1ZXN0IiwicHVsbFJlcXVlc3RzIiwidXJpIiwiUmV2aWV3c0l0ZW0iLCJidWlsZFVSSSIsImhvc3QiLCJlbmRwb2ludCIsImdldEhvc3QiLCJvd25lciIsInJlcG8iLCJudW1iZXIiLCJ3b3JrZGlyIiwicmVwb0RhdGEiLCJ3b3JraW5nRGlyZWN0b3J5UGF0aCIsIm9wZW4iLCJzZWFyY2hBbGxQYW5lcyIsInN1YnNjcmlwdGlvbnMiLCJDb21wb3NpdGVEaXNwb3NhYmxlIiwic3RhdGUiLCJjb21wb25lbnREaWRNb3VudCIsImFkZCIsIm9ic2VydmVUZXh0RWRpdG9ycyIsInVwZGF0ZU9wZW5FZGl0b3JzIiwib25EaWREZXN0cm95UGFuZUl0ZW0iLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJyZW5kZXIiLCJsZW5ndGgiLCJpc0NoZWNrZWRPdXRQdWxsUmVxdWVzdCIsImJyYW5jaGVzIiwicmVtb3RlcyIsInRocmVhZERhdGFCeVBhdGgiLCJNYXAiLCJ3b3JrZGlyUGF0aCIsImNvbW1lbnRzIiwidGhyZWFkIiwiY29tbWVudFRocmVhZHMiLCJldmVyeSIsImNvbW1lbnQiLCJpc01pbmltaXplZCIsInRocmVhZERhdGEiLCJyb290Q29tbWVudElEIiwiaWQiLCJ0aHJlYWRJRCIsInBvc2l0aW9uIiwibmF0aXZlUmVsUGF0aCIsInRvTmF0aXZlUGF0aFNlcCIsInBhdGgiLCJmdWxsUGF0aCIsImpvaW4iLCJwdXNoIiwib3BlbkVkaXRvcnNXaXRoQ29tbWVudFRocmVhZHMiLCJnZXRPcGVuRWRpdG9yc1dpdGhDb21tZW50VGhyZWFkcyIsImNyZWF0ZUVsZW1lbnQiLCJGcmFnbWVudCIsInJlZ2lzdHJ5IiwiY29tbWFuZHMiLCJ0YXJnZXQiLCJDb21tYW5kIiwiY29tbWFuZCIsImNhbGxiYWNrIiwib3BlblJldmlld3NUYWIiLCJtYXAiLCJlZGl0b3IiLCJnZXRQYXRoIiwidHJhbnNsYXRpb25zIiwiY29tbWVudFRyYW5zbGF0aW9ucyIsIm5hbWUiLCJwcmlvcml0eSIsImNsYXNzTmFtZSIsInR5cGUiLCJmaWxlTmFtZSIsImhlYWRTaGEiLCJoZWFkUmVmT2lkIiwidGhyZWFkc0ZvclBhdGgiLCJjb21tZW50VHJhbnNsYXRpb25zRm9yUGF0aCIsImhhdmVUaHJlYWRzIiwiaGVhZFJlcG9zaXRvcnkiLCJyZXBvc2l0b3J5IiwiaGVhZFB1c2giLCJnZXRIZWFkQnJhbmNoIiwiZ2V0UHVzaCIsImhlYWRSZW1vdGUiLCJ3aXRoTmFtZSIsImdldFJlbW90ZU5hbWUiLCJmcm9tUHVsbFJlZnNwZWMiLCJnZXRPd25lciIsImxvZ2luIiwiZ2V0UmVwbyIsImdldFNob3J0UmVtb3RlUmVmIiwiZnJvbUhlYWRSZXBvIiwiaGVhZFJlZk5hbWUiLCJleHBvcnRzIiwicmVsYXkiLCJQcm9wVHlwZXMiLCJvYmplY3QiLCJpc1JlcXVpcmVkIiwiYXJyYXlPZiIsInNoYXBlIiwic3RyaW5nIiwiRW5kcG9pbnRQcm9wVHlwZSIsIkJyYW5jaFNldFByb3BUeXBlIiwiUmVtb3RlU2V0UHJvcFR5cGUiLCJjdXJyZW50UmVtb3RlIiwiUmVtb3RlUHJvcFR5cGUiLCJmdW5jIiwiX2RlZmF1bHQiLCJjcmVhdGVGcmFnbWVudENvbnRhaW5lciIsIm5vZGUiLCJoYXNoIiwiY29uc29sZSIsImVycm9yIl0sInNvdXJjZXMiOlsiY29tbWVudC1kZWNvcmF0aW9ucy1jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge0ZyYWdtZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuaW1wb3J0IHtncmFwaHFsLCBjcmVhdGVGcmFnbWVudENvbnRhaW5lcn0gZnJvbSAncmVhY3QtcmVsYXknO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCBFZGl0b3JDb21tZW50RGVjb3JhdGlvbnNDb250cm9sbGVyIGZyb20gJy4vZWRpdG9yLWNvbW1lbnQtZGVjb3JhdGlvbnMtY29udHJvbGxlcic7XG5pbXBvcnQgUmV2aWV3c0l0ZW0gZnJvbSAnLi4vaXRlbXMvcmV2aWV3cy1pdGVtJztcbmltcG9ydCBHdXR0ZXIgZnJvbSAnLi4vYXRvbS9ndXR0ZXInO1xuaW1wb3J0IENvbW1hbmRzLCB7Q29tbWFuZH0gZnJvbSAnLi4vYXRvbS9jb21tYW5kcyc7XG5pbXBvcnQge0VuZHBvaW50UHJvcFR5cGUsIEJyYW5jaFNldFByb3BUeXBlLCBSZW1vdGVTZXRQcm9wVHlwZSwgUmVtb3RlUHJvcFR5cGV9IGZyb20gJy4uL3Byb3AtdHlwZXMnO1xuaW1wb3J0IHt0b05hdGl2ZVBhdGhTZXB9IGZyb20gJy4uL2hlbHBlcnMnO1xuXG5leHBvcnQgY2xhc3MgQmFyZUNvbW1lbnREZWNvcmF0aW9uc0NvbnRyb2xsZXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8vIFJlbGF5IHJlc3BvbnNlXG4gICAgcmVsYXk6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBwdWxsUmVxdWVzdHM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBudW1iZXI6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICAgIGhlYWRSZWZOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICBoZWFkUmVmT2lkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICBoZWFkUmVwb3NpdG9yeTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgbmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBvd25lcjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICBsb2dpbjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICB9KS5pc1JlcXVpcmVkLFxuICAgICAgfSksXG4gICAgICByZXBvc2l0b3J5OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIG93bmVyOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICAgIGxvZ2luOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgICB9KS5pc1JlcXVpcmVkLFxuICAgIH0pKSxcblxuICAgIC8vIENvbm5lY3Rpb24gaW5mb3JtYXRpb25cbiAgICBlbmRwb2ludDogRW5kcG9pbnRQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgIG93bmVyOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgcmVwbzogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuXG4gICAgLy8gQXRvbSBlbnZpcm9ubWVudFxuICAgIHdvcmtzcGFjZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGNvbW1hbmRzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG5cbiAgICAvLyBNb2RlbHNcbiAgICByZXBvRGF0YTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIGJyYW5jaGVzOiBCcmFuY2hTZXRQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgICAgcmVtb3RlczogUmVtb3RlU2V0UHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICAgIGN1cnJlbnRSZW1vdGU6IFJlbW90ZVByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgICB3b3JraW5nRGlyZWN0b3J5UGF0aDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgY29tbWVudFRocmVhZHM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBjb21tZW50czogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCkuaXNSZXF1aXJlZCxcbiAgICAgIHRocmVhZDogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgfSkpLmlzUmVxdWlyZWQsXG4gICAgY29tbWVudFRyYW5zbGF0aW9uczogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIGdldDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICB9KS5pc1JlcXVpcmVkLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICB0aGlzLnN0YXRlID0ge29wZW5FZGl0b3JzOiB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRUZXh0RWRpdG9ycygpfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICB0aGlzLnByb3BzLndvcmtzcGFjZS5vYnNlcnZlVGV4dEVkaXRvcnModGhpcy51cGRhdGVPcGVuRWRpdG9ycyksXG4gICAgICB0aGlzLnByb3BzLndvcmtzcGFjZS5vbkRpZERlc3Ryb3lQYW5lSXRlbSh0aGlzLnVwZGF0ZU9wZW5FZGl0b3JzKSxcbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5wdWxsUmVxdWVzdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgcHVsbFJlcXVlc3QgPSB0aGlzLnByb3BzLnB1bGxSZXF1ZXN0c1swXTtcblxuICAgIC8vIG9ubHkgc2hvdyBjb21tZW50IGRlY29yYXRpb25zIGlmIHdlJ3JlIG9uIGEgY2hlY2tlZCBvdXQgcHVsbCByZXF1ZXN0XG4gICAgLy8gb3RoZXJ3aXNlLCB3ZSdkIGhhdmUgbm8gd2F5IG9mIGtub3dpbmcgd2hpY2ggY29tbWVudHMgdG8gc2hvdy5cbiAgICBpZiAoXG4gICAgICAhdGhpcy5pc0NoZWNrZWRPdXRQdWxsUmVxdWVzdChcbiAgICAgICAgdGhpcy5wcm9wcy5yZXBvRGF0YS5icmFuY2hlcyxcbiAgICAgICAgdGhpcy5wcm9wcy5yZXBvRGF0YS5yZW1vdGVzLFxuICAgICAgICBwdWxsUmVxdWVzdCxcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHRocmVhZERhdGFCeVBhdGggPSBuZXcgTWFwKCk7XG4gICAgY29uc3Qgd29ya2RpclBhdGggPSB0aGlzLnByb3BzLnJlcG9EYXRhLndvcmtpbmdEaXJlY3RvcnlQYXRoO1xuXG4gICAgZm9yIChjb25zdCB7Y29tbWVudHMsIHRocmVhZH0gb2YgdGhpcy5wcm9wcy5jb21tZW50VGhyZWFkcykge1xuICAgICAgLy8gU2tpcCBjb21tZW50IHRocmVhZHMgdGhhdCBhcmUgZW50aXJlbHkgbWluaW1pemVkLlxuICAgICAgaWYgKGNvbW1lbnRzLmV2ZXJ5KGNvbW1lbnQgPT4gY29tbWVudC5pc01pbmltaXplZCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZXJlIG1heSBiZSBtdWx0aXBsZSBjb21tZW50cyBpbiB0aGUgdGhyZWFkLCBidXQgd2UgcmVhbGx5IG9ubHkgY2FyZSBhYm91dCB0aGUgcm9vdCBjb21tZW50IHdoZW4gcmVuZGVyaW5nXG4gICAgICAvLyBkZWNvcmF0aW9ucy5cbiAgICAgIGNvbnN0IHRocmVhZERhdGEgPSB7XG4gICAgICAgIHJvb3RDb21tZW50SUQ6IGNvbW1lbnRzWzBdLmlkLFxuICAgICAgICB0aHJlYWRJRDogdGhyZWFkLmlkLFxuICAgICAgICBwb3NpdGlvbjogY29tbWVudHNbMF0ucG9zaXRpb24sXG4gICAgICAgIG5hdGl2ZVJlbFBhdGg6IHRvTmF0aXZlUGF0aFNlcChjb21tZW50c1swXS5wYXRoKSxcbiAgICAgICAgZnVsbFBhdGg6IHBhdGguam9pbih3b3JrZGlyUGF0aCwgdG9OYXRpdmVQYXRoU2VwKGNvbW1lbnRzWzBdLnBhdGgpKSxcbiAgICAgIH07XG5cbiAgICAgIGlmICh0aHJlYWREYXRhQnlQYXRoLmdldCh0aHJlYWREYXRhLmZ1bGxQYXRoKSkge1xuICAgICAgICB0aHJlYWREYXRhQnlQYXRoLmdldCh0aHJlYWREYXRhLmZ1bGxQYXRoKS5wdXNoKHRocmVhZERhdGEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyZWFkRGF0YUJ5UGF0aC5zZXQodGhyZWFkRGF0YS5mdWxsUGF0aCwgW3RocmVhZERhdGFdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBvcGVuRWRpdG9yc1dpdGhDb21tZW50VGhyZWFkcyA9IHRoaXMuZ2V0T3BlbkVkaXRvcnNXaXRoQ29tbWVudFRocmVhZHModGhyZWFkRGF0YUJ5UGF0aCk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxGcmFnbWVudD5cbiAgICAgICAgPENvbW1hbmRzIHJlZ2lzdHJ5PXt0aGlzLnByb3BzLmNvbW1hbmRzfSB0YXJnZXQ9XCJhdG9tLXdvcmtzcGFjZVwiPlxuICAgICAgICAgIDxDb21tYW5kIGNvbW1hbmQ9XCJnaXRodWI6b3Blbi1yZXZpZXdzLXRhYlwiIGNhbGxiYWNrPXt0aGlzLm9wZW5SZXZpZXdzVGFifSAvPlxuICAgICAgICA8L0NvbW1hbmRzPlxuICAgICAgICB7b3BlbkVkaXRvcnNXaXRoQ29tbWVudFRocmVhZHMubWFwKGVkaXRvciA9PiB7XG4gICAgICAgICAgY29uc3QgdGhyZWFkRGF0YSA9IHRocmVhZERhdGFCeVBhdGguZ2V0KGVkaXRvci5nZXRQYXRoKCkpO1xuICAgICAgICAgIGNvbnN0IHRyYW5zbGF0aW9ucyA9IHRoaXMucHJvcHMuY29tbWVudFRyYW5zbGF0aW9ucy5nZXQodGhyZWFkRGF0YVswXS5uYXRpdmVSZWxQYXRoKTtcblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8RnJhZ21lbnQga2V5PXtgZ2l0aHViLWVkaXRvci1kZWNvcmF0aW9uLSR7ZWRpdG9yLmlkfWB9PlxuICAgICAgICAgICAgICA8R3V0dGVyXG4gICAgICAgICAgICAgICAgbmFtZT1cImdpdGh1Yi1jb21tZW50LWljb25cIlxuICAgICAgICAgICAgICAgIHByaW9yaXR5PXsxfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImNvbW1lbnRcIlxuICAgICAgICAgICAgICAgIGVkaXRvcj17ZWRpdG9yfVxuICAgICAgICAgICAgICAgIHR5cGU9XCJkZWNvcmF0ZWRcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8RWRpdG9yQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlclxuICAgICAgICAgICAgICAgIGVuZHBvaW50PXt0aGlzLnByb3BzLmVuZHBvaW50fVxuICAgICAgICAgICAgICAgIG93bmVyPXt0aGlzLnByb3BzLm93bmVyfVxuICAgICAgICAgICAgICAgIHJlcG89e3RoaXMucHJvcHMucmVwb31cbiAgICAgICAgICAgICAgICBudW1iZXI9e3B1bGxSZXF1ZXN0Lm51bWJlcn1cbiAgICAgICAgICAgICAgICB3b3JrZGlyPXt3b3JrZGlyUGF0aH1cbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2U9e3RoaXMucHJvcHMud29ya3NwYWNlfVxuICAgICAgICAgICAgICAgIGVkaXRvcj17ZWRpdG9yfVxuICAgICAgICAgICAgICAgIGZpbGVOYW1lPXtlZGl0b3IuZ2V0UGF0aCgpfVxuICAgICAgICAgICAgICAgIGhlYWRTaGE9e3B1bGxSZXF1ZXN0LmhlYWRSZWZPaWR9XG4gICAgICAgICAgICAgICAgdGhyZWFkc0ZvclBhdGg9e3RocmVhZERhdGF9XG4gICAgICAgICAgICAgICAgY29tbWVudFRyYW5zbGF0aW9uc0ZvclBhdGg9e3RyYW5zbGF0aW9uc31cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvRnJhZ21lbnQ+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSl9XG4gICAgICA8L0ZyYWdtZW50Pik7XG4gIH1cblxuICBnZXRPcGVuRWRpdG9yc1dpdGhDb21tZW50VGhyZWFkcyh0aHJlYWREYXRhQnlQYXRoKSB7XG4gICAgY29uc3QgaGF2ZVRocmVhZHMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiB0aGlzLnN0YXRlLm9wZW5FZGl0b3JzKSB7XG4gICAgICBpZiAodGhyZWFkRGF0YUJ5UGF0aC5oYXMoZWRpdG9yLmdldFBhdGgoKSkpIHtcbiAgICAgICAgaGF2ZVRocmVhZHMucHVzaChlZGl0b3IpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGF2ZVRocmVhZHM7XG4gIH1cblxuICAvLyBEZXRlcm1pbmUgaWYgd2UgYWxyZWFkeSBoYXZlIHRoaXMgUFIgY2hlY2tlZCBvdXQuXG4gIC8vIHRvZG86IGlmIHRoaXMgaXMgc2ltaWxhciBlbm91Z2ggdG8gcHItY2hlY2tvdXQtY29udHJvbGxlciwgZXh0cmFjdCBhIHNpbmdsZVxuICAvLyBoZWxwZXIgZnVuY3Rpb24gdG8gZG8gdGhpcyBjaGVjay5cbiAgaXNDaGVja2VkT3V0UHVsbFJlcXVlc3QoYnJhbmNoZXMsIHJlbW90ZXMsIHB1bGxSZXF1ZXN0KSB7XG4gICAgLy8gZGV0ZXJtaW5lIGlmIHB1bGxSZXF1ZXN0LmhlYWRSZXBvc2l0b3J5IGlzIG51bGxcbiAgICAvLyB0aGlzIGNhbiBoYXBwZW4gaWYgYSByZXBvc2l0b3J5IGhhcyBiZWVuIGRlbGV0ZWQuXG4gICAgaWYgKCFwdWxsUmVxdWVzdC5oZWFkUmVwb3NpdG9yeSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHtyZXBvc2l0b3J5fSA9IHB1bGxSZXF1ZXN0O1xuXG4gICAgY29uc3QgaGVhZFB1c2ggPSBicmFuY2hlcy5nZXRIZWFkQnJhbmNoKCkuZ2V0UHVzaCgpO1xuICAgIGNvbnN0IGhlYWRSZW1vdGUgPSByZW1vdGVzLndpdGhOYW1lKGhlYWRQdXNoLmdldFJlbW90ZU5hbWUoKSk7XG5cbiAgICAvLyAoZGV0ZWN0IGNoZWNrb3V0IGZyb20gcHVsbC8jIyMgcmVmc3BlYylcbiAgICBjb25zdCBmcm9tUHVsbFJlZnNwZWMgPVxuICAgICAgICBoZWFkUmVtb3RlLmdldE93bmVyKCkgPT09IHJlcG9zaXRvcnkub3duZXIubG9naW4gJiZcbiAgICAgICAgaGVhZFJlbW90ZS5nZXRSZXBvKCkgPT09IHJlcG9zaXRvcnkubmFtZSAmJlxuICAgICAgICBoZWFkUHVzaC5nZXRTaG9ydFJlbW90ZVJlZigpID09PSBgcHVsbC8ke3B1bGxSZXF1ZXN0Lm51bWJlcn0vaGVhZGA7XG5cbiAgICAvLyAoZGV0ZWN0IGNoZWNrb3V0IGZyb20gaGVhZCByZXBvc2l0b3J5KVxuICAgIGNvbnN0IGZyb21IZWFkUmVwbyA9XG4gICAgICAgIGhlYWRSZW1vdGUuZ2V0T3duZXIoKSA9PT0gcHVsbFJlcXVlc3QuaGVhZFJlcG9zaXRvcnkub3duZXIubG9naW4gJiZcbiAgICAgICAgaGVhZFJlbW90ZS5nZXRSZXBvKCkgPT09IHB1bGxSZXF1ZXN0LmhlYWRSZXBvc2l0b3J5Lm5hbWUgJiZcbiAgICAgICAgaGVhZFB1c2guZ2V0U2hvcnRSZW1vdGVSZWYoKSA9PT0gcHVsbFJlcXVlc3QuaGVhZFJlZk5hbWU7XG5cbiAgICBpZiAoZnJvbVB1bGxSZWZzcGVjIHx8IGZyb21IZWFkUmVwbykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHVwZGF0ZU9wZW5FZGl0b3JzID0gKCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe29wZW5FZGl0b3JzOiB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRUZXh0RWRpdG9ycygpfSwgcmVzb2x2ZSk7XG4gICAgfSk7XG4gIH1cblxuICBvcGVuUmV2aWV3c1RhYiA9ICgpID0+IHtcbiAgICBjb25zdCBbcHVsbFJlcXVlc3RdID0gdGhpcy5wcm9wcy5wdWxsUmVxdWVzdHM7XG4gICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gICAgaWYgKCFwdWxsUmVxdWVzdCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgdXJpID0gUmV2aWV3c0l0ZW0uYnVpbGRVUkkoe1xuICAgICAgaG9zdDogdGhpcy5wcm9wcy5lbmRwb2ludC5nZXRIb3N0KCksXG4gICAgICBvd25lcjogdGhpcy5wcm9wcy5vd25lcixcbiAgICAgIHJlcG86IHRoaXMucHJvcHMucmVwbyxcbiAgICAgIG51bWJlcjogcHVsbFJlcXVlc3QubnVtYmVyLFxuICAgICAgd29ya2RpcjogdGhpcy5wcm9wcy5yZXBvRGF0YS53b3JraW5nRGlyZWN0b3J5UGF0aCxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy53b3Jrc3BhY2Uub3Blbih1cmksIHtzZWFyY2hBbGxQYW5lczogdHJ1ZX0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUZyYWdtZW50Q29udGFpbmVyKEJhcmVDb21tZW50RGVjb3JhdGlvbnNDb250cm9sbGVyLCB7XG4gIHB1bGxSZXF1ZXN0czogZ3JhcGhxbGBcbiAgICBmcmFnbWVudCBjb21tZW50RGVjb3JhdGlvbnNDb250cm9sbGVyX3B1bGxSZXF1ZXN0cyBvbiBQdWxsUmVxdWVzdFxuICAgIEByZWxheShwbHVyYWw6IHRydWUpXG4gICAge1xuICAgICAgbnVtYmVyXG4gICAgICBoZWFkUmVmTmFtZVxuICAgICAgaGVhZFJlZk9pZFxuICAgICAgaGVhZFJlcG9zaXRvcnkge1xuICAgICAgICBuYW1lXG4gICAgICAgIG93bmVyIHtcbiAgICAgICAgICBsb2dpblxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXBvc2l0b3J5IHtcbiAgICAgICAgbmFtZVxuICAgICAgICBvd25lciB7XG4gICAgICAgICAgbG9naW5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgYCxcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxVQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxTQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxXQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxLQUFBLEdBQUFILHNCQUFBLENBQUFGLE9BQUE7QUFFQSxJQUFBTSxtQ0FBQSxHQUFBSixzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQU8sWUFBQSxHQUFBTCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQVEsT0FBQSxHQUFBTixzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQVMsU0FBQSxHQUFBVix1QkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQVUsV0FBQSxHQUFBVixPQUFBO0FBQ0EsSUFBQVcsUUFBQSxHQUFBWCxPQUFBO0FBQTJDLFNBQUFFLHVCQUFBVSxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcseUJBQUFDLFdBQUEsZUFBQUMsT0FBQSxrQ0FBQUMsaUJBQUEsT0FBQUQsT0FBQSxRQUFBRSxnQkFBQSxPQUFBRixPQUFBLFlBQUFGLHdCQUFBLFlBQUFBLENBQUFDLFdBQUEsV0FBQUEsV0FBQSxHQUFBRyxnQkFBQSxHQUFBRCxpQkFBQSxLQUFBRixXQUFBO0FBQUEsU0FBQWpCLHdCQUFBYSxHQUFBLEVBQUFJLFdBQUEsU0FBQUEsV0FBQSxJQUFBSixHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxXQUFBRCxHQUFBLFFBQUFBLEdBQUEsb0JBQUFBLEdBQUEsd0JBQUFBLEdBQUEsNEJBQUFFLE9BQUEsRUFBQUYsR0FBQSxVQUFBUSxLQUFBLEdBQUFMLHdCQUFBLENBQUFDLFdBQUEsT0FBQUksS0FBQSxJQUFBQSxLQUFBLENBQUFDLEdBQUEsQ0FBQVQsR0FBQSxZQUFBUSxLQUFBLENBQUFFLEdBQUEsQ0FBQVYsR0FBQSxTQUFBVyxNQUFBLFdBQUFDLHFCQUFBLEdBQUFDLE1BQUEsQ0FBQUMsY0FBQSxJQUFBRCxNQUFBLENBQUFFLHdCQUFBLFdBQUFDLEdBQUEsSUFBQWhCLEdBQUEsUUFBQWdCLEdBQUEsa0JBQUFILE1BQUEsQ0FBQUksU0FBQSxDQUFBQyxjQUFBLENBQUFDLElBQUEsQ0FBQW5CLEdBQUEsRUFBQWdCLEdBQUEsU0FBQUksSUFBQSxHQUFBUixxQkFBQSxHQUFBQyxNQUFBLENBQUFFLHdCQUFBLENBQUFmLEdBQUEsRUFBQWdCLEdBQUEsY0FBQUksSUFBQSxLQUFBQSxJQUFBLENBQUFWLEdBQUEsSUFBQVUsSUFBQSxDQUFBQyxHQUFBLEtBQUFSLE1BQUEsQ0FBQUMsY0FBQSxDQUFBSCxNQUFBLEVBQUFLLEdBQUEsRUFBQUksSUFBQSxZQUFBVCxNQUFBLENBQUFLLEdBQUEsSUFBQWhCLEdBQUEsQ0FBQWdCLEdBQUEsU0FBQUwsTUFBQSxDQUFBVCxPQUFBLEdBQUFGLEdBQUEsTUFBQVEsS0FBQSxJQUFBQSxLQUFBLENBQUFhLEdBQUEsQ0FBQXJCLEdBQUEsRUFBQVcsTUFBQSxZQUFBQSxNQUFBO0FBQUEsU0FBQVcsZ0JBQUF0QixHQUFBLEVBQUFnQixHQUFBLEVBQUFPLEtBQUEsSUFBQVAsR0FBQSxHQUFBUSxjQUFBLENBQUFSLEdBQUEsT0FBQUEsR0FBQSxJQUFBaEIsR0FBQSxJQUFBYSxNQUFBLENBQUFDLGNBQUEsQ0FBQWQsR0FBQSxFQUFBZ0IsR0FBQSxJQUFBTyxLQUFBLEVBQUFBLEtBQUEsRUFBQUUsVUFBQSxRQUFBQyxZQUFBLFFBQUFDLFFBQUEsb0JBQUEzQixHQUFBLENBQUFnQixHQUFBLElBQUFPLEtBQUEsV0FBQXZCLEdBQUE7QUFBQSxTQUFBd0IsZUFBQUksR0FBQSxRQUFBWixHQUFBLEdBQUFhLFlBQUEsQ0FBQUQsR0FBQSwyQkFBQVosR0FBQSxnQkFBQUEsR0FBQSxHQUFBYyxNQUFBLENBQUFkLEdBQUE7QUFBQSxTQUFBYSxhQUFBRSxLQUFBLEVBQUFDLElBQUEsZUFBQUQsS0FBQSxpQkFBQUEsS0FBQSxrQkFBQUEsS0FBQSxNQUFBRSxJQUFBLEdBQUFGLEtBQUEsQ0FBQUcsTUFBQSxDQUFBQyxXQUFBLE9BQUFGLElBQUEsS0FBQUcsU0FBQSxRQUFBQyxHQUFBLEdBQUFKLElBQUEsQ0FBQWQsSUFBQSxDQUFBWSxLQUFBLEVBQUFDLElBQUEsMkJBQUFLLEdBQUEsc0JBQUFBLEdBQUEsWUFBQUMsU0FBQSw0REFBQU4sSUFBQSxnQkFBQUYsTUFBQSxHQUFBUyxNQUFBLEVBQUFSLEtBQUE7QUFFcEMsTUFBTVMsZ0NBQWdDLFNBQVNDLGNBQUssQ0FBQ0MsU0FBUyxDQUFDO0VBaURwRUMsV0FBV0EsQ0FBQ0MsS0FBSyxFQUFFQyxPQUFPLEVBQUU7SUFDMUIsS0FBSyxDQUFDRCxLQUFLLEVBQUVDLE9BQU8sQ0FBQztJQUFDdkIsZUFBQSw0QkE4SUosTUFBTTtNQUN4QixPQUFPLElBQUl3QixPQUFPLENBQUNDLE9BQU8sSUFBSTtRQUM1QixJQUFJLENBQUNDLFFBQVEsQ0FBQztVQUFDQyxXQUFXLEVBQUUsSUFBSSxDQUFDTCxLQUFLLENBQUNNLFNBQVMsQ0FBQ0MsY0FBYyxDQUFDO1FBQUMsQ0FBQyxFQUFFSixPQUFPLENBQUM7TUFDOUUsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUFBekIsZUFBQSx5QkFFZ0IsTUFBTTtNQUNyQixNQUFNLENBQUM4QixXQUFXLENBQUMsR0FBRyxJQUFJLENBQUNSLEtBQUssQ0FBQ1MsWUFBWTtNQUM3QztNQUNBLElBQUksQ0FBQ0QsV0FBVyxFQUFFO1FBQ2hCLE9BQU8sSUFBSTtNQUNiO01BRUEsTUFBTUUsR0FBRyxHQUFHQyxvQkFBVyxDQUFDQyxRQUFRLENBQUM7UUFDL0JDLElBQUksRUFBRSxJQUFJLENBQUNiLEtBQUssQ0FBQ2MsUUFBUSxDQUFDQyxPQUFPLENBQUMsQ0FBQztRQUNuQ0MsS0FBSyxFQUFFLElBQUksQ0FBQ2hCLEtBQUssQ0FBQ2dCLEtBQUs7UUFDdkJDLElBQUksRUFBRSxJQUFJLENBQUNqQixLQUFLLENBQUNpQixJQUFJO1FBQ3JCQyxNQUFNLEVBQUVWLFdBQVcsQ0FBQ1UsTUFBTTtRQUMxQkMsT0FBTyxFQUFFLElBQUksQ0FBQ25CLEtBQUssQ0FBQ29CLFFBQVEsQ0FBQ0M7TUFDL0IsQ0FBQyxDQUFDO01BQ0YsT0FBTyxJQUFJLENBQUNyQixLQUFLLENBQUNNLFNBQVMsQ0FBQ2dCLElBQUksQ0FBQ1osR0FBRyxFQUFFO1FBQUNhLGNBQWMsRUFBRTtNQUFJLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBaktDLElBQUksQ0FBQ0MsYUFBYSxHQUFHLElBQUlDLDZCQUFtQixDQUFDLENBQUM7SUFDOUMsSUFBSSxDQUFDQyxLQUFLLEdBQUc7TUFBQ3JCLFdBQVcsRUFBRSxJQUFJLENBQUNMLEtBQUssQ0FBQ00sU0FBUyxDQUFDQyxjQUFjLENBQUM7SUFBQyxDQUFDO0VBQ25FO0VBRUFvQixpQkFBaUJBLENBQUEsRUFBRztJQUNsQixJQUFJLENBQUNILGFBQWEsQ0FBQ0ksR0FBRyxDQUNwQixJQUFJLENBQUM1QixLQUFLLENBQUNNLFNBQVMsQ0FBQ3VCLGtCQUFrQixDQUFDLElBQUksQ0FBQ0MsaUJBQWlCLENBQUMsRUFDL0QsSUFBSSxDQUFDOUIsS0FBSyxDQUFDTSxTQUFTLENBQUN5QixvQkFBb0IsQ0FBQyxJQUFJLENBQUNELGlCQUFpQixDQUNsRSxDQUFDO0VBQ0g7RUFFQUUsb0JBQW9CQSxDQUFBLEVBQUc7SUFDckIsSUFBSSxDQUFDUixhQUFhLENBQUNTLE9BQU8sQ0FBQyxDQUFDO0VBQzlCO0VBRUFDLE1BQU1BLENBQUEsRUFBRztJQUNQLElBQUksSUFBSSxDQUFDbEMsS0FBSyxDQUFDUyxZQUFZLENBQUMwQixNQUFNLEtBQUssQ0FBQyxFQUFFO01BQ3hDLE9BQU8sSUFBSTtJQUNiO0lBQ0EsTUFBTTNCLFdBQVcsR0FBRyxJQUFJLENBQUNSLEtBQUssQ0FBQ1MsWUFBWSxDQUFDLENBQUMsQ0FBQzs7SUFFOUM7SUFDQTtJQUNBLElBQ0UsQ0FBQyxJQUFJLENBQUMyQix1QkFBdUIsQ0FDM0IsSUFBSSxDQUFDcEMsS0FBSyxDQUFDb0IsUUFBUSxDQUFDaUIsUUFBUSxFQUM1QixJQUFJLENBQUNyQyxLQUFLLENBQUNvQixRQUFRLENBQUNrQixPQUFPLEVBQzNCOUIsV0FDRixDQUFDLEVBQ0Q7TUFDQSxPQUFPLElBQUk7SUFDYjtJQUVBLE1BQU0rQixnQkFBZ0IsR0FBRyxJQUFJQyxHQUFHLENBQUMsQ0FBQztJQUNsQyxNQUFNQyxXQUFXLEdBQUcsSUFBSSxDQUFDekMsS0FBSyxDQUFDb0IsUUFBUSxDQUFDQyxvQkFBb0I7SUFFNUQsS0FBSyxNQUFNO01BQUNxQixRQUFRO01BQUVDO0lBQU0sQ0FBQyxJQUFJLElBQUksQ0FBQzNDLEtBQUssQ0FBQzRDLGNBQWMsRUFBRTtNQUMxRDtNQUNBLElBQUlGLFFBQVEsQ0FBQ0csS0FBSyxDQUFDQyxPQUFPLElBQUlBLE9BQU8sQ0FBQ0MsV0FBVyxDQUFDLEVBQUU7UUFDbEQ7TUFDRjs7TUFFQTtNQUNBO01BQ0EsTUFBTUMsVUFBVSxHQUFHO1FBQ2pCQyxhQUFhLEVBQUVQLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQ1EsRUFBRTtRQUM3QkMsUUFBUSxFQUFFUixNQUFNLENBQUNPLEVBQUU7UUFDbkJFLFFBQVEsRUFBRVYsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDVSxRQUFRO1FBQzlCQyxhQUFhLEVBQUUsSUFBQUMsd0JBQWUsRUFBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDYSxJQUFJLENBQUM7UUFDaERDLFFBQVEsRUFBRUQsYUFBSSxDQUFDRSxJQUFJLENBQUNoQixXQUFXLEVBQUUsSUFBQWEsd0JBQWUsRUFBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDYSxJQUFJLENBQUM7TUFDcEUsQ0FBQztNQUVELElBQUloQixnQkFBZ0IsQ0FBQ3pFLEdBQUcsQ0FBQ2tGLFVBQVUsQ0FBQ1EsUUFBUSxDQUFDLEVBQUU7UUFDN0NqQixnQkFBZ0IsQ0FBQ3pFLEdBQUcsQ0FBQ2tGLFVBQVUsQ0FBQ1EsUUFBUSxDQUFDLENBQUNFLElBQUksQ0FBQ1YsVUFBVSxDQUFDO01BQzVELENBQUMsTUFBTTtRQUNMVCxnQkFBZ0IsQ0FBQzlELEdBQUcsQ0FBQ3VFLFVBQVUsQ0FBQ1EsUUFBUSxFQUFFLENBQUNSLFVBQVUsQ0FBQyxDQUFDO01BQ3pEO0lBQ0Y7SUFFQSxNQUFNVyw2QkFBNkIsR0FBRyxJQUFJLENBQUNDLGdDQUFnQyxDQUFDckIsZ0JBQWdCLENBQUM7SUFDN0YsT0FDRWpHLE1BQUEsQ0FBQWdCLE9BQUEsQ0FBQXVHLGFBQUEsQ0FBQ3ZILE1BQUEsQ0FBQXdILFFBQVEsUUFDUHhILE1BQUEsQ0FBQWdCLE9BQUEsQ0FBQXVHLGFBQUEsQ0FBQzVHLFNBQUEsQ0FBQUssT0FBUTtNQUFDeUcsUUFBUSxFQUFFLElBQUksQ0FBQy9ELEtBQUssQ0FBQ2dFLFFBQVM7TUFBQ0MsTUFBTSxFQUFDO0lBQWdCLEdBQzlEM0gsTUFBQSxDQUFBZ0IsT0FBQSxDQUFBdUcsYUFBQSxDQUFDNUcsU0FBQSxDQUFBaUgsT0FBTztNQUFDQyxPQUFPLEVBQUMseUJBQXlCO01BQUNDLFFBQVEsRUFBRSxJQUFJLENBQUNDO0lBQWUsQ0FBRSxDQUNuRSxDQUFDLEVBQ1ZWLDZCQUE2QixDQUFDVyxHQUFHLENBQUNDLE1BQU0sSUFBSTtNQUMzQyxNQUFNdkIsVUFBVSxHQUFHVCxnQkFBZ0IsQ0FBQ3pFLEdBQUcsQ0FBQ3lHLE1BQU0sQ0FBQ0MsT0FBTyxDQUFDLENBQUMsQ0FBQztNQUN6RCxNQUFNQyxZQUFZLEdBQUcsSUFBSSxDQUFDekUsS0FBSyxDQUFDMEUsbUJBQW1CLENBQUM1RyxHQUFHLENBQUNrRixVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUNLLGFBQWEsQ0FBQztNQUVwRixPQUNFL0csTUFBQSxDQUFBZ0IsT0FBQSxDQUFBdUcsYUFBQSxDQUFDdkgsTUFBQSxDQUFBd0gsUUFBUTtRQUFDMUYsR0FBRyxFQUFHLDRCQUEyQm1HLE1BQU0sQ0FBQ3JCLEVBQUc7TUFBRSxHQUNyRDVHLE1BQUEsQ0FBQWdCLE9BQUEsQ0FBQXVHLGFBQUEsQ0FBQzdHLE9BQUEsQ0FBQU0sT0FBTTtRQUNMcUgsSUFBSSxFQUFDLHFCQUFxQjtRQUMxQkMsUUFBUSxFQUFFLENBQUU7UUFDWkMsU0FBUyxFQUFDLFNBQVM7UUFDbkJOLE1BQU0sRUFBRUEsTUFBTztRQUNmTyxJQUFJLEVBQUM7TUFBVyxDQUNqQixDQUFDLEVBQ0Z4SSxNQUFBLENBQUFnQixPQUFBLENBQUF1RyxhQUFBLENBQUMvRyxtQ0FBQSxDQUFBUSxPQUFrQztRQUNqQ3dELFFBQVEsRUFBRSxJQUFJLENBQUNkLEtBQUssQ0FBQ2MsUUFBUztRQUM5QkUsS0FBSyxFQUFFLElBQUksQ0FBQ2hCLEtBQUssQ0FBQ2dCLEtBQU07UUFDeEJDLElBQUksRUFBRSxJQUFJLENBQUNqQixLQUFLLENBQUNpQixJQUFLO1FBQ3RCQyxNQUFNLEVBQUVWLFdBQVcsQ0FBQ1UsTUFBTztRQUMzQkMsT0FBTyxFQUFFc0IsV0FBWTtRQUNyQm5DLFNBQVMsRUFBRSxJQUFJLENBQUNOLEtBQUssQ0FBQ00sU0FBVTtRQUNoQ2lFLE1BQU0sRUFBRUEsTUFBTztRQUNmUSxRQUFRLEVBQUVSLE1BQU0sQ0FBQ0MsT0FBTyxDQUFDLENBQUU7UUFDM0JRLE9BQU8sRUFBRXhFLFdBQVcsQ0FBQ3lFLFVBQVc7UUFDaENDLGNBQWMsRUFBRWxDLFVBQVc7UUFDM0JtQywwQkFBMEIsRUFBRVY7TUFBYSxDQUMxQyxDQUNPLENBQUM7SUFFZixDQUFDLENBQ08sQ0FBQztFQUNmO0VBRUFiLGdDQUFnQ0EsQ0FBQ3JCLGdCQUFnQixFQUFFO0lBQ2pELE1BQU02QyxXQUFXLEdBQUcsRUFBRTtJQUN0QixLQUFLLE1BQU1iLE1BQU0sSUFBSSxJQUFJLENBQUM3QyxLQUFLLENBQUNyQixXQUFXLEVBQUU7TUFDM0MsSUFBSWtDLGdCQUFnQixDQUFDMUUsR0FBRyxDQUFDMEcsTUFBTSxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDMUNZLFdBQVcsQ0FBQzFCLElBQUksQ0FBQ2EsTUFBTSxDQUFDO01BQzFCO0lBQ0Y7SUFDQSxPQUFPYSxXQUFXO0VBQ3BCOztFQUVBO0VBQ0E7RUFDQTtFQUNBaEQsdUJBQXVCQSxDQUFDQyxRQUFRLEVBQUVDLE9BQU8sRUFBRTlCLFdBQVcsRUFBRTtJQUN0RDtJQUNBO0lBQ0EsSUFBSSxDQUFDQSxXQUFXLENBQUM2RSxjQUFjLEVBQUU7TUFDL0IsT0FBTyxLQUFLO0lBQ2Q7SUFFQSxNQUFNO01BQUNDO0lBQVUsQ0FBQyxHQUFHOUUsV0FBVztJQUVoQyxNQUFNK0UsUUFBUSxHQUFHbEQsUUFBUSxDQUFDbUQsYUFBYSxDQUFDLENBQUMsQ0FBQ0MsT0FBTyxDQUFDLENBQUM7SUFDbkQsTUFBTUMsVUFBVSxHQUFHcEQsT0FBTyxDQUFDcUQsUUFBUSxDQUFDSixRQUFRLENBQUNLLGFBQWEsQ0FBQyxDQUFDLENBQUM7O0lBRTdEO0lBQ0EsTUFBTUMsZUFBZSxHQUNqQkgsVUFBVSxDQUFDSSxRQUFRLENBQUMsQ0FBQyxLQUFLUixVQUFVLENBQUN0RSxLQUFLLENBQUMrRSxLQUFLLElBQ2hETCxVQUFVLENBQUNNLE9BQU8sQ0FBQyxDQUFDLEtBQUtWLFVBQVUsQ0FBQ1gsSUFBSSxJQUN4Q1ksUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUFDLEtBQU0sUUFBT3pGLFdBQVcsQ0FBQ1UsTUFBTyxPQUFNOztJQUV0RTtJQUNBLE1BQU1nRixZQUFZLEdBQ2RSLFVBQVUsQ0FBQ0ksUUFBUSxDQUFDLENBQUMsS0FBS3RGLFdBQVcsQ0FBQzZFLGNBQWMsQ0FBQ3JFLEtBQUssQ0FBQytFLEtBQUssSUFDaEVMLFVBQVUsQ0FBQ00sT0FBTyxDQUFDLENBQUMsS0FBS3hGLFdBQVcsQ0FBQzZFLGNBQWMsQ0FBQ1YsSUFBSSxJQUN4RFksUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUFDLEtBQUt6RixXQUFXLENBQUMyRixXQUFXO0lBRTVELElBQUlOLGVBQWUsSUFBSUssWUFBWSxFQUFFO01BQ25DLE9BQU8sSUFBSTtJQUNiO0lBQ0EsT0FBTyxLQUFLO0VBQ2Q7QUF3QkY7QUFBQ0UsT0FBQSxDQUFBeEcsZ0NBQUEsR0FBQUEsZ0NBQUE7QUFBQWxCLGVBQUEsQ0F0TllrQixnQ0FBZ0MsZUFDeEI7RUFDakI7RUFDQXlHLEtBQUssRUFBRUMsa0JBQVMsQ0FBQ0MsTUFBTSxDQUFDQyxVQUFVO0VBQ2xDL0YsWUFBWSxFQUFFNkYsa0JBQVMsQ0FBQ0csT0FBTyxDQUFDSCxrQkFBUyxDQUFDSSxLQUFLLENBQUM7SUFDOUN4RixNQUFNLEVBQUVvRixrQkFBUyxDQUFDcEYsTUFBTSxDQUFDc0YsVUFBVTtJQUNuQ0wsV0FBVyxFQUFFRyxrQkFBUyxDQUFDSyxNQUFNLENBQUNILFVBQVU7SUFDeEN2QixVQUFVLEVBQUVxQixrQkFBUyxDQUFDSyxNQUFNLENBQUNILFVBQVU7SUFDdkNuQixjQUFjLEVBQUVpQixrQkFBUyxDQUFDSSxLQUFLLENBQUM7TUFDOUIvQixJQUFJLEVBQUUyQixrQkFBUyxDQUFDSyxNQUFNLENBQUNILFVBQVU7TUFDakN4RixLQUFLLEVBQUVzRixrQkFBUyxDQUFDSSxLQUFLLENBQUM7UUFDckJYLEtBQUssRUFBRU8sa0JBQVMsQ0FBQ0ssTUFBTSxDQUFDSDtNQUMxQixDQUFDLENBQUMsQ0FBQ0E7SUFDTCxDQUFDLENBQUM7SUFDRmxCLFVBQVUsRUFBRWdCLGtCQUFTLENBQUNJLEtBQUssQ0FBQztNQUMxQi9CLElBQUksRUFBRTJCLGtCQUFTLENBQUNLLE1BQU0sQ0FBQ0gsVUFBVTtNQUNqQ3hGLEtBQUssRUFBRXNGLGtCQUFTLENBQUNJLEtBQUssQ0FBQztRQUNyQlgsS0FBSyxFQUFFTyxrQkFBUyxDQUFDSyxNQUFNLENBQUNIO01BQzFCLENBQUMsQ0FBQyxDQUFDQTtJQUNMLENBQUMsQ0FBQyxDQUFDQTtFQUNMLENBQUMsQ0FBQyxDQUFDO0VBRUg7RUFDQTFGLFFBQVEsRUFBRThGLDRCQUFnQixDQUFDSixVQUFVO0VBQ3JDeEYsS0FBSyxFQUFFc0Ysa0JBQVMsQ0FBQ0ssTUFBTSxDQUFDSCxVQUFVO0VBQ2xDdkYsSUFBSSxFQUFFcUYsa0JBQVMsQ0FBQ0ssTUFBTSxDQUFDSCxVQUFVO0VBRWpDO0VBQ0FsRyxTQUFTLEVBQUVnRyxrQkFBUyxDQUFDQyxNQUFNLENBQUNDLFVBQVU7RUFDdEN4QyxRQUFRLEVBQUVzQyxrQkFBUyxDQUFDQyxNQUFNLENBQUNDLFVBQVU7RUFFckM7RUFDQXBGLFFBQVEsRUFBRWtGLGtCQUFTLENBQUNJLEtBQUssQ0FBQztJQUN4QnJFLFFBQVEsRUFBRXdFLDZCQUFpQixDQUFDTCxVQUFVO0lBQ3RDbEUsT0FBTyxFQUFFd0UsNkJBQWlCLENBQUNOLFVBQVU7SUFDckNPLGFBQWEsRUFBRUMsMEJBQWMsQ0FBQ1IsVUFBVTtJQUN4Q25GLG9CQUFvQixFQUFFaUYsa0JBQVMsQ0FBQ0ssTUFBTSxDQUFDSDtFQUN6QyxDQUFDLENBQUMsQ0FBQ0EsVUFBVTtFQUNiNUQsY0FBYyxFQUFFMEQsa0JBQVMsQ0FBQ0csT0FBTyxDQUFDSCxrQkFBUyxDQUFDSSxLQUFLLENBQUM7SUFDaERoRSxRQUFRLEVBQUU0RCxrQkFBUyxDQUFDRyxPQUFPLENBQUNILGtCQUFTLENBQUNDLE1BQU0sQ0FBQyxDQUFDQyxVQUFVO0lBQ3hEN0QsTUFBTSxFQUFFMkQsa0JBQVMsQ0FBQ0ksS0FBSyxDQUFDO01BQ3RCeEQsRUFBRSxFQUFFb0Qsa0JBQVMsQ0FBQ0ssTUFBTSxDQUFDSDtJQUN2QixDQUFDLENBQUMsQ0FBQ0E7RUFDTCxDQUFDLENBQUMsQ0FBQyxDQUFDQSxVQUFVO0VBQ2Q5QixtQkFBbUIsRUFBRTRCLGtCQUFTLENBQUNJLEtBQUssQ0FBQztJQUNuQzVJLEdBQUcsRUFBRXdJLGtCQUFTLENBQUNXLElBQUksQ0FBQ1Q7RUFDdEIsQ0FBQyxDQUFDLENBQUNBO0FBQ0wsQ0FBQztBQUFBLElBQUFVLFFBQUEsR0F5S1ksSUFBQUMsbUNBQXVCLEVBQUN2SCxnQ0FBZ0MsRUFBRTtFQUN2RWEsWUFBWSxXQUFBQSxDQUFBO0lBQUEsTUFBQTJHLElBQUEsR0FBQTVLLE9BQUE7SUFBQSxJQUFBNEssSUFBQSxDQUFBQyxJQUFBLElBQUFELElBQUEsQ0FBQUMsSUFBQTtNQUFBQyxPQUFBLENBQUFDLEtBQUE7SUFBQTtJQUFBLE9BQUEvSyxPQUFBO0VBQUE7QUFxQmQsQ0FBQyxDQUFDO0FBQUE0SixPQUFBLENBQUE5SSxPQUFBLEdBQUE0SixRQUFBIn0=