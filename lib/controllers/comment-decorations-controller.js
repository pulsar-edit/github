"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BareCommentDecorationsController = void 0;
var _react = _interopRequireWildcard(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _reactRelay = require("react-relay");
var _path = _interopRequireDefault(require("path"));
var _editorCommentDecorationsController = _interopRequireDefault(require("./editor-comment-decorations-controller"));
var _reviewsItem = _interopRequireDefault(require("../items/reviews-item"));
var _gutter = _interopRequireDefault(require("../atom/gutter"));
var _commands = _interopRequireWildcard(require("../atom/commands"));
var _propTypes2 = require("../prop-types");
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
class BareCommentDecorationsController extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "updateOpenEditors", () => {
      return new Promise(resolve => {
        this.setState({
          openEditors: this.props.workspace.getTextEditors()
        }, resolve);
      });
    });
    _defineProperty(this, "openReviewsTab", () => {
      const [pullRequest] = this.props.pullRequests;
      /* istanbul ignore if */
      if (!pullRequest) {
        return null;
      }
      const uri = _reviewsItem.default.buildURI({
        host: this.props.endpoint.getHost(),
        owner: this.props.owner,
        repo: this.props.repo,
        number: pullRequest.number,
        workdir: this.props.repoData.workingDirectoryPath
      });
      return this.props.workspace.open(uri, {
        searchAllPanes: true
      });
    });
    this.subscriptions = new _eventKit.CompositeDisposable();
    this.state = {
      openEditors: this.props.workspace.getTextEditors()
    };
  }
  componentDidMount() {
    this.subscriptions.add(this.props.workspace.observeTextEditors(this.updateOpenEditors), this.props.workspace.onDidDestroyPaneItem(this.updateOpenEditors));
  }
  componentWillUnmount() {
    this.subscriptions.dispose();
  }
  render() {
    if (this.props.pullRequests.length === 0) {
      return null;
    }
    const pullRequest = this.props.pullRequests[0];

    // only show comment decorations if we're on a checked out pull request
    // otherwise, we'd have no way of knowing which comments to show.
    if (!this.isCheckedOutPullRequest(this.props.repoData.branches, this.props.repoData.remotes, pullRequest)) {
      return null;
    }
    const threadDataByPath = new Map();
    const workdirPath = this.props.repoData.workingDirectoryPath;
    for (const {
      comments,
      thread
    } of this.props.commentThreads) {
      // Skip comment threads that are entirely minimized.
      if (comments.every(comment => comment.isMinimized)) {
        continue;
      }

      // There may be multiple comments in the thread, but we really only care about the root comment when rendering
      // decorations.
      const threadData = {
        rootCommentID: comments[0].id,
        threadID: thread.id,
        position: comments[0].position,
        nativeRelPath: (0, _helpers.toNativePathSep)(comments[0].path),
        fullPath: _path.default.join(workdirPath, (0, _helpers.toNativePathSep)(comments[0].path))
      };
      if (threadDataByPath.get(threadData.fullPath)) {
        threadDataByPath.get(threadData.fullPath).push(threadData);
      } else {
        threadDataByPath.set(threadData.fullPath, [threadData]);
      }
    }
    const openEditorsWithCommentThreads = this.getOpenEditorsWithCommentThreads(threadDataByPath);
    return _react.default.createElement(_react.Fragment, null, _react.default.createElement(_commands.default, {
      registry: this.props.commands,
      target: "atom-workspace"
    }, _react.default.createElement(_commands.Command, {
      command: "github:open-reviews-tab",
      callback: this.openReviewsTab
    })), openEditorsWithCommentThreads.map(editor => {
      const threadData = threadDataByPath.get(editor.getPath());
      const translations = this.props.commentTranslations.get(threadData[0].nativeRelPath);
      return _react.default.createElement(_react.Fragment, {
        key: `github-editor-decoration-${editor.id}`
      }, _react.default.createElement(_gutter.default, {
        name: "github-comment-icon",
        priority: 1,
        className: "comment",
        editor: editor,
        type: "decorated"
      }), _react.default.createElement(_editorCommentDecorationsController.default, {
        endpoint: this.props.endpoint,
        owner: this.props.owner,
        repo: this.props.repo,
        number: pullRequest.number,
        workdir: workdirPath,
        workspace: this.props.workspace,
        editor: editor,
        fileName: editor.getPath(),
        headSha: pullRequest.headRefOid,
        threadsForPath: threadData,
        commentTranslationsForPath: translations
      }));
    }));
  }
  getOpenEditorsWithCommentThreads(threadDataByPath) {
    const haveThreads = [];
    for (const editor of this.state.openEditors) {
      if (threadDataByPath.has(editor.getPath())) {
        haveThreads.push(editor);
      }
    }
    return haveThreads;
  }

  // Determine if we already have this PR checked out.
  // todo: if this is similar enough to pr-checkout-controller, extract a single
  // helper function to do this check.
  isCheckedOutPullRequest(branches, remotes, pullRequest) {
    // determine if pullRequest.headRepository is null
    // this can happen if a repository has been deleted.
    if (!pullRequest.headRepository) {
      return false;
    }
    const {
      repository
    } = pullRequest;
    const headPush = branches.getHeadBranch().getPush();
    const headRemote = remotes.withName(headPush.getRemoteName());

    // (detect checkout from pull/### refspec)
    const fromPullRefspec = headRemote.getOwner() === repository.owner.login && headRemote.getRepo() === repository.name && headPush.getShortRemoteRef() === `pull/${pullRequest.number}/head`;

    // (detect checkout from head repository)
    const fromHeadRepo = headRemote.getOwner() === pullRequest.headRepository.owner.login && headRemote.getRepo() === pullRequest.headRepository.name && headPush.getShortRemoteRef() === pullRequest.headRefName;
    if (fromPullRefspec || fromHeadRepo) {
      return true;
    }
    return false;
  }
}
exports.BareCommentDecorationsController = BareCommentDecorationsController;
_defineProperty(BareCommentDecorationsController, "propTypes", {
  // Relay response
  relay: _propTypes.default.object.isRequired,
  pullRequests: _propTypes.default.arrayOf(_propTypes.default.shape({
    number: _propTypes.default.number.isRequired,
    headRefName: _propTypes.default.string.isRequired,
    headRefOid: _propTypes.default.string.isRequired,
    headRepository: _propTypes.default.shape({
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }),
    repository: _propTypes.default.shape({
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }).isRequired
  })),
  // Connection information
  endpoint: _propTypes2.EndpointPropType.isRequired,
  owner: _propTypes.default.string.isRequired,
  repo: _propTypes.default.string.isRequired,
  // Atom environment
  workspace: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  // Models
  repoData: _propTypes.default.shape({
    branches: _propTypes2.BranchSetPropType.isRequired,
    remotes: _propTypes2.RemoteSetPropType.isRequired,
    currentRemote: _propTypes2.RemotePropType.isRequired,
    workingDirectoryPath: _propTypes.default.string.isRequired
  }).isRequired,
  commentThreads: _propTypes.default.arrayOf(_propTypes.default.shape({
    comments: _propTypes.default.arrayOf(_propTypes.default.object).isRequired,
    thread: _propTypes.default.shape({
      id: _propTypes.default.string.isRequired
    }).isRequired
  })).isRequired,
  commentTranslations: _propTypes.default.shape({
    get: _propTypes.default.func.isRequired
  }).isRequired
});
var _default = (0, _reactRelay.createFragmentContainer)(BareCommentDecorationsController, {
  pullRequests: function () {
    const node = require("./__generated__/commentDecorationsController_pullRequests.graphql");
    if (node.hash && node.hash !== "62f96ccd13dfc2649112a7b4afaf4ba2") {
      console.error("The definition of 'commentDecorationsController_pullRequests' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
    }
    return require("./__generated__/commentDecorationsController_pullRequests.graphql");
  }
});
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcHJvcFR5cGVzIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9ldmVudEtpdCIsIl9yZWFjdFJlbGF5IiwiX3BhdGgiLCJfZWRpdG9yQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciIsIl9yZXZpZXdzSXRlbSIsIl9ndXR0ZXIiLCJfY29tbWFuZHMiLCJfcHJvcFR5cGVzMiIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJlIiwiV2Vha01hcCIsInIiLCJ0IiwiaGFzIiwiZ2V0IiwibiIsIl9fcHJvdG9fXyIsImEiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0IiwiX2RlZmluZVByb3BlcnR5Iiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiQmFyZUNvbW1lbnREZWNvcmF0aW9uc0NvbnRyb2xsZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjb250ZXh0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRTdGF0ZSIsIm9wZW5FZGl0b3JzIiwid29ya3NwYWNlIiwiZ2V0VGV4dEVkaXRvcnMiLCJwdWxsUmVxdWVzdCIsInB1bGxSZXF1ZXN0cyIsInVyaSIsIlJldmlld3NJdGVtIiwiYnVpbGRVUkkiLCJob3N0IiwiZW5kcG9pbnQiLCJnZXRIb3N0Iiwib3duZXIiLCJyZXBvIiwibnVtYmVyIiwid29ya2RpciIsInJlcG9EYXRhIiwid29ya2luZ0RpcmVjdG9yeVBhdGgiLCJvcGVuIiwic2VhcmNoQWxsUGFuZXMiLCJzdWJzY3JpcHRpb25zIiwiQ29tcG9zaXRlRGlzcG9zYWJsZSIsInN0YXRlIiwiY29tcG9uZW50RGlkTW91bnQiLCJhZGQiLCJvYnNlcnZlVGV4dEVkaXRvcnMiLCJ1cGRhdGVPcGVuRWRpdG9ycyIsIm9uRGlkRGVzdHJveVBhbmVJdGVtIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwicmVuZGVyIiwibGVuZ3RoIiwiaXNDaGVja2VkT3V0UHVsbFJlcXVlc3QiLCJicmFuY2hlcyIsInJlbW90ZXMiLCJ0aHJlYWREYXRhQnlQYXRoIiwiTWFwIiwid29ya2RpclBhdGgiLCJjb21tZW50cyIsInRocmVhZCIsImNvbW1lbnRUaHJlYWRzIiwiZXZlcnkiLCJjb21tZW50IiwiaXNNaW5pbWl6ZWQiLCJ0aHJlYWREYXRhIiwicm9vdENvbW1lbnRJRCIsImlkIiwidGhyZWFkSUQiLCJwb3NpdGlvbiIsIm5hdGl2ZVJlbFBhdGgiLCJ0b05hdGl2ZVBhdGhTZXAiLCJwYXRoIiwiZnVsbFBhdGgiLCJqb2luIiwicHVzaCIsIm9wZW5FZGl0b3JzV2l0aENvbW1lbnRUaHJlYWRzIiwiZ2V0T3BlbkVkaXRvcnNXaXRoQ29tbWVudFRocmVhZHMiLCJjcmVhdGVFbGVtZW50IiwiRnJhZ21lbnQiLCJyZWdpc3RyeSIsImNvbW1hbmRzIiwidGFyZ2V0IiwiQ29tbWFuZCIsImNvbW1hbmQiLCJjYWxsYmFjayIsIm9wZW5SZXZpZXdzVGFiIiwibWFwIiwiZWRpdG9yIiwiZ2V0UGF0aCIsInRyYW5zbGF0aW9ucyIsImNvbW1lbnRUcmFuc2xhdGlvbnMiLCJuYW1lIiwicHJpb3JpdHkiLCJjbGFzc05hbWUiLCJ0eXBlIiwiZmlsZU5hbWUiLCJoZWFkU2hhIiwiaGVhZFJlZk9pZCIsInRocmVhZHNGb3JQYXRoIiwiY29tbWVudFRyYW5zbGF0aW9uc0ZvclBhdGgiLCJoYXZlVGhyZWFkcyIsImhlYWRSZXBvc2l0b3J5IiwicmVwb3NpdG9yeSIsImhlYWRQdXNoIiwiZ2V0SGVhZEJyYW5jaCIsImdldFB1c2giLCJoZWFkUmVtb3RlIiwid2l0aE5hbWUiLCJnZXRSZW1vdGVOYW1lIiwiZnJvbVB1bGxSZWZzcGVjIiwiZ2V0T3duZXIiLCJsb2dpbiIsImdldFJlcG8iLCJnZXRTaG9ydFJlbW90ZVJlZiIsImZyb21IZWFkUmVwbyIsImhlYWRSZWZOYW1lIiwiZXhwb3J0cyIsInJlbGF5IiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsImFycmF5T2YiLCJzaGFwZSIsInN0cmluZyIsIkVuZHBvaW50UHJvcFR5cGUiLCJCcmFuY2hTZXRQcm9wVHlwZSIsIlJlbW90ZVNldFByb3BUeXBlIiwiY3VycmVudFJlbW90ZSIsIlJlbW90ZVByb3BUeXBlIiwiZnVuYyIsIl9kZWZhdWx0IiwiY3JlYXRlRnJhZ21lbnRDb250YWluZXIiLCJub2RlIiwiaGFzaCIsImNvbnNvbGUiLCJlcnJvciJdLCJzb3VyY2VzIjpbImNvbW1lbnQtZGVjb3JhdGlvbnMtY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtGcmFnbWVudH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcbmltcG9ydCB7Z3JhcGhxbCwgY3JlYXRlRnJhZ21lbnRDb250YWluZXJ9IGZyb20gJ3JlYWN0LXJlbGF5JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgRWRpdG9yQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciBmcm9tICcuL2VkaXRvci1jb21tZW50LWRlY29yYXRpb25zLWNvbnRyb2xsZXInO1xuaW1wb3J0IFJldmlld3NJdGVtIGZyb20gJy4uL2l0ZW1zL3Jldmlld3MtaXRlbSc7XG5pbXBvcnQgR3V0dGVyIGZyb20gJy4uL2F0b20vZ3V0dGVyJztcbmltcG9ydCBDb21tYW5kcywge0NvbW1hbmR9IGZyb20gJy4uL2F0b20vY29tbWFuZHMnO1xuaW1wb3J0IHtFbmRwb2ludFByb3BUeXBlLCBCcmFuY2hTZXRQcm9wVHlwZSwgUmVtb3RlU2V0UHJvcFR5cGUsIFJlbW90ZVByb3BUeXBlfSBmcm9tICcuLi9wcm9wLXR5cGVzJztcbmltcG9ydCB7dG9OYXRpdmVQYXRoU2VwfSBmcm9tICcuLi9oZWxwZXJzJztcblxuZXhwb3J0IGNsYXNzIEJhcmVDb21tZW50RGVjb3JhdGlvbnNDb250cm9sbGVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyBSZWxheSByZXNwb25zZVxuICAgIHJlbGF5OiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgcHVsbFJlcXVlc3RzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgbnVtYmVyOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gICAgICBoZWFkUmVmTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgaGVhZFJlZk9pZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgaGVhZFJlcG9zaXRvcnk6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgb3duZXI6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgbG9naW46IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICAgIH0pLFxuICAgICAgcmVwb3NpdG9yeTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgbmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBvd25lcjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICBsb2dpbjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICB9KS5pc1JlcXVpcmVkLFxuICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICB9KSksXG5cbiAgICAvLyBDb25uZWN0aW9uIGluZm9ybWF0aW9uXG4gICAgZW5kcG9pbnQ6IEVuZHBvaW50UHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICBvd25lcjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHJlcG86IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcblxuICAgIC8vIEF0b20gZW52aXJvbm1lbnRcbiAgICB3b3Jrc3BhY2U6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBjb21tYW5kczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuXG4gICAgLy8gTW9kZWxzXG4gICAgcmVwb0RhdGE6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBicmFuY2hlczogQnJhbmNoU2V0UHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICAgIHJlbW90ZXM6IFJlbW90ZVNldFByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgICBjdXJyZW50UmVtb3RlOiBSZW1vdGVQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgICAgd29ya2luZ0RpcmVjdG9yeVBhdGg6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICB9KS5pc1JlcXVpcmVkLFxuICAgIGNvbW1lbnRUaHJlYWRzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgY29tbWVudHM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5vYmplY3QpLmlzUmVxdWlyZWQsXG4gICAgICB0aHJlYWQ6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIGlkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICB9KS5pc1JlcXVpcmVkLFxuICAgIH0pKS5pc1JlcXVpcmVkLFxuICAgIGNvbW1lbnRUcmFuc2xhdGlvbnM6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBnZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgfSkuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcywgY29udGV4dCkge1xuICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5zdGF0ZSA9IHtvcGVuRWRpdG9yczogdGhpcy5wcm9wcy53b3Jrc3BhY2UuZ2V0VGV4dEVkaXRvcnMoKX07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKFxuICAgICAgdGhpcy5wcm9wcy53b3Jrc3BhY2Uub2JzZXJ2ZVRleHRFZGl0b3JzKHRoaXMudXBkYXRlT3BlbkVkaXRvcnMpLFxuICAgICAgdGhpcy5wcm9wcy53b3Jrc3BhY2Uub25EaWREZXN0cm95UGFuZUl0ZW0odGhpcy51cGRhdGVPcGVuRWRpdG9ycyksXG4gICAgKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5kaXNwb3NlKCk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMucHVsbFJlcXVlc3RzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHB1bGxSZXF1ZXN0ID0gdGhpcy5wcm9wcy5wdWxsUmVxdWVzdHNbMF07XG5cbiAgICAvLyBvbmx5IHNob3cgY29tbWVudCBkZWNvcmF0aW9ucyBpZiB3ZSdyZSBvbiBhIGNoZWNrZWQgb3V0IHB1bGwgcmVxdWVzdFxuICAgIC8vIG90aGVyd2lzZSwgd2UnZCBoYXZlIG5vIHdheSBvZiBrbm93aW5nIHdoaWNoIGNvbW1lbnRzIHRvIHNob3cuXG4gICAgaWYgKFxuICAgICAgIXRoaXMuaXNDaGVja2VkT3V0UHVsbFJlcXVlc3QoXG4gICAgICAgIHRoaXMucHJvcHMucmVwb0RhdGEuYnJhbmNoZXMsXG4gICAgICAgIHRoaXMucHJvcHMucmVwb0RhdGEucmVtb3RlcyxcbiAgICAgICAgcHVsbFJlcXVlc3QsXG4gICAgICApXG4gICAgKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCB0aHJlYWREYXRhQnlQYXRoID0gbmV3IE1hcCgpO1xuICAgIGNvbnN0IHdvcmtkaXJQYXRoID0gdGhpcy5wcm9wcy5yZXBvRGF0YS53b3JraW5nRGlyZWN0b3J5UGF0aDtcblxuICAgIGZvciAoY29uc3Qge2NvbW1lbnRzLCB0aHJlYWR9IG9mIHRoaXMucHJvcHMuY29tbWVudFRocmVhZHMpIHtcbiAgICAgIC8vIFNraXAgY29tbWVudCB0aHJlYWRzIHRoYXQgYXJlIGVudGlyZWx5IG1pbmltaXplZC5cbiAgICAgIGlmIChjb21tZW50cy5ldmVyeShjb21tZW50ID0+IGNvbW1lbnQuaXNNaW5pbWl6ZWQpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBUaGVyZSBtYXkgYmUgbXVsdGlwbGUgY29tbWVudHMgaW4gdGhlIHRocmVhZCwgYnV0IHdlIHJlYWxseSBvbmx5IGNhcmUgYWJvdXQgdGhlIHJvb3QgY29tbWVudCB3aGVuIHJlbmRlcmluZ1xuICAgICAgLy8gZGVjb3JhdGlvbnMuXG4gICAgICBjb25zdCB0aHJlYWREYXRhID0ge1xuICAgICAgICByb290Q29tbWVudElEOiBjb21tZW50c1swXS5pZCxcbiAgICAgICAgdGhyZWFkSUQ6IHRocmVhZC5pZCxcbiAgICAgICAgcG9zaXRpb246IGNvbW1lbnRzWzBdLnBvc2l0aW9uLFxuICAgICAgICBuYXRpdmVSZWxQYXRoOiB0b05hdGl2ZVBhdGhTZXAoY29tbWVudHNbMF0ucGF0aCksXG4gICAgICAgIGZ1bGxQYXRoOiBwYXRoLmpvaW4od29ya2RpclBhdGgsIHRvTmF0aXZlUGF0aFNlcChjb21tZW50c1swXS5wYXRoKSksXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhyZWFkRGF0YUJ5UGF0aC5nZXQodGhyZWFkRGF0YS5mdWxsUGF0aCkpIHtcbiAgICAgICAgdGhyZWFkRGF0YUJ5UGF0aC5nZXQodGhyZWFkRGF0YS5mdWxsUGF0aCkucHVzaCh0aHJlYWREYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocmVhZERhdGFCeVBhdGguc2V0KHRocmVhZERhdGEuZnVsbFBhdGgsIFt0aHJlYWREYXRhXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgb3BlbkVkaXRvcnNXaXRoQ29tbWVudFRocmVhZHMgPSB0aGlzLmdldE9wZW5FZGl0b3JzV2l0aENvbW1lbnRUaHJlYWRzKHRocmVhZERhdGFCeVBhdGgpO1xuICAgIHJldHVybiAoXG4gICAgICA8RnJhZ21lbnQ+XG4gICAgICAgIDxDb21tYW5kcyByZWdpc3RyeT17dGhpcy5wcm9wcy5jb21tYW5kc30gdGFyZ2V0PVwiYXRvbS13b3Jrc3BhY2VcIj5cbiAgICAgICAgICA8Q29tbWFuZCBjb21tYW5kPVwiZ2l0aHViOm9wZW4tcmV2aWV3cy10YWJcIiBjYWxsYmFjaz17dGhpcy5vcGVuUmV2aWV3c1RhYn0gLz5cbiAgICAgICAgPC9Db21tYW5kcz5cbiAgICAgICAge29wZW5FZGl0b3JzV2l0aENvbW1lbnRUaHJlYWRzLm1hcChlZGl0b3IgPT4ge1xuICAgICAgICAgIGNvbnN0IHRocmVhZERhdGEgPSB0aHJlYWREYXRhQnlQYXRoLmdldChlZGl0b3IuZ2V0UGF0aCgpKTtcbiAgICAgICAgICBjb25zdCB0cmFuc2xhdGlvbnMgPSB0aGlzLnByb3BzLmNvbW1lbnRUcmFuc2xhdGlvbnMuZ2V0KHRocmVhZERhdGFbMF0ubmF0aXZlUmVsUGF0aCk7XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEZyYWdtZW50IGtleT17YGdpdGh1Yi1lZGl0b3ItZGVjb3JhdGlvbi0ke2VkaXRvci5pZH1gfT5cbiAgICAgICAgICAgICAgPEd1dHRlclxuICAgICAgICAgICAgICAgIG5hbWU9XCJnaXRodWItY29tbWVudC1pY29uXCJcbiAgICAgICAgICAgICAgICBwcmlvcml0eT17MX1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJjb21tZW50XCJcbiAgICAgICAgICAgICAgICBlZGl0b3I9e2VkaXRvcn1cbiAgICAgICAgICAgICAgICB0eXBlPVwiZGVjb3JhdGVkXCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPEVkaXRvckNvbW1lbnREZWNvcmF0aW9uc0NvbnRyb2xsZXJcbiAgICAgICAgICAgICAgICBlbmRwb2ludD17dGhpcy5wcm9wcy5lbmRwb2ludH1cbiAgICAgICAgICAgICAgICBvd25lcj17dGhpcy5wcm9wcy5vd25lcn1cbiAgICAgICAgICAgICAgICByZXBvPXt0aGlzLnByb3BzLnJlcG99XG4gICAgICAgICAgICAgICAgbnVtYmVyPXtwdWxsUmVxdWVzdC5udW1iZXJ9XG4gICAgICAgICAgICAgICAgd29ya2Rpcj17d29ya2RpclBhdGh9XG4gICAgICAgICAgICAgICAgd29ya3NwYWNlPXt0aGlzLnByb3BzLndvcmtzcGFjZX1cbiAgICAgICAgICAgICAgICBlZGl0b3I9e2VkaXRvcn1cbiAgICAgICAgICAgICAgICBmaWxlTmFtZT17ZWRpdG9yLmdldFBhdGgoKX1cbiAgICAgICAgICAgICAgICBoZWFkU2hhPXtwdWxsUmVxdWVzdC5oZWFkUmVmT2lkfVxuICAgICAgICAgICAgICAgIHRocmVhZHNGb3JQYXRoPXt0aHJlYWREYXRhfVxuICAgICAgICAgICAgICAgIGNvbW1lbnRUcmFuc2xhdGlvbnNGb3JQYXRoPXt0cmFuc2xhdGlvbnN9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0ZyYWdtZW50PlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC9GcmFnbWVudD4pO1xuICB9XG5cbiAgZ2V0T3BlbkVkaXRvcnNXaXRoQ29tbWVudFRocmVhZHModGhyZWFkRGF0YUJ5UGF0aCkge1xuICAgIGNvbnN0IGhhdmVUaHJlYWRzID0gW107XG4gICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy5zdGF0ZS5vcGVuRWRpdG9ycykge1xuICAgICAgaWYgKHRocmVhZERhdGFCeVBhdGguaGFzKGVkaXRvci5nZXRQYXRoKCkpKSB7XG4gICAgICAgIGhhdmVUaHJlYWRzLnB1c2goZWRpdG9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhdmVUaHJlYWRzO1xuICB9XG5cbiAgLy8gRGV0ZXJtaW5lIGlmIHdlIGFscmVhZHkgaGF2ZSB0aGlzIFBSIGNoZWNrZWQgb3V0LlxuICAvLyB0b2RvOiBpZiB0aGlzIGlzIHNpbWlsYXIgZW5vdWdoIHRvIHByLWNoZWNrb3V0LWNvbnRyb2xsZXIsIGV4dHJhY3QgYSBzaW5nbGVcbiAgLy8gaGVscGVyIGZ1bmN0aW9uIHRvIGRvIHRoaXMgY2hlY2suXG4gIGlzQ2hlY2tlZE91dFB1bGxSZXF1ZXN0KGJyYW5jaGVzLCByZW1vdGVzLCBwdWxsUmVxdWVzdCkge1xuICAgIC8vIGRldGVybWluZSBpZiBwdWxsUmVxdWVzdC5oZWFkUmVwb3NpdG9yeSBpcyBudWxsXG4gICAgLy8gdGhpcyBjYW4gaGFwcGVuIGlmIGEgcmVwb3NpdG9yeSBoYXMgYmVlbiBkZWxldGVkLlxuICAgIGlmICghcHVsbFJlcXVlc3QuaGVhZFJlcG9zaXRvcnkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCB7cmVwb3NpdG9yeX0gPSBwdWxsUmVxdWVzdDtcblxuICAgIGNvbnN0IGhlYWRQdXNoID0gYnJhbmNoZXMuZ2V0SGVhZEJyYW5jaCgpLmdldFB1c2goKTtcbiAgICBjb25zdCBoZWFkUmVtb3RlID0gcmVtb3Rlcy53aXRoTmFtZShoZWFkUHVzaC5nZXRSZW1vdGVOYW1lKCkpO1xuXG4gICAgLy8gKGRldGVjdCBjaGVja291dCBmcm9tIHB1bGwvIyMjIHJlZnNwZWMpXG4gICAgY29uc3QgZnJvbVB1bGxSZWZzcGVjID1cbiAgICAgICAgaGVhZFJlbW90ZS5nZXRPd25lcigpID09PSByZXBvc2l0b3J5Lm93bmVyLmxvZ2luICYmXG4gICAgICAgIGhlYWRSZW1vdGUuZ2V0UmVwbygpID09PSByZXBvc2l0b3J5Lm5hbWUgJiZcbiAgICAgICAgaGVhZFB1c2guZ2V0U2hvcnRSZW1vdGVSZWYoKSA9PT0gYHB1bGwvJHtwdWxsUmVxdWVzdC5udW1iZXJ9L2hlYWRgO1xuXG4gICAgLy8gKGRldGVjdCBjaGVja291dCBmcm9tIGhlYWQgcmVwb3NpdG9yeSlcbiAgICBjb25zdCBmcm9tSGVhZFJlcG8gPVxuICAgICAgICBoZWFkUmVtb3RlLmdldE93bmVyKCkgPT09IHB1bGxSZXF1ZXN0LmhlYWRSZXBvc2l0b3J5Lm93bmVyLmxvZ2luICYmXG4gICAgICAgIGhlYWRSZW1vdGUuZ2V0UmVwbygpID09PSBwdWxsUmVxdWVzdC5oZWFkUmVwb3NpdG9yeS5uYW1lICYmXG4gICAgICAgIGhlYWRQdXNoLmdldFNob3J0UmVtb3RlUmVmKCkgPT09IHB1bGxSZXF1ZXN0LmhlYWRSZWZOYW1lO1xuXG4gICAgaWYgKGZyb21QdWxsUmVmc3BlYyB8fCBmcm9tSGVhZFJlcG8pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB1cGRhdGVPcGVuRWRpdG9ycyA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtvcGVuRWRpdG9yczogdGhpcy5wcm9wcy53b3Jrc3BhY2UuZ2V0VGV4dEVkaXRvcnMoKX0sIHJlc29sdmUpO1xuICAgIH0pO1xuICB9XG5cbiAgb3BlblJldmlld3NUYWIgPSAoKSA9PiB7XG4gICAgY29uc3QgW3B1bGxSZXF1ZXN0XSA9IHRoaXMucHJvcHMucHVsbFJlcXVlc3RzO1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmICghcHVsbFJlcXVlc3QpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHVyaSA9IFJldmlld3NJdGVtLmJ1aWxkVVJJKHtcbiAgICAgIGhvc3Q6IHRoaXMucHJvcHMuZW5kcG9pbnQuZ2V0SG9zdCgpLFxuICAgICAgb3duZXI6IHRoaXMucHJvcHMub3duZXIsXG4gICAgICByZXBvOiB0aGlzLnByb3BzLnJlcG8sXG4gICAgICBudW1iZXI6IHB1bGxSZXF1ZXN0Lm51bWJlcixcbiAgICAgIHdvcmtkaXI6IHRoaXMucHJvcHMucmVwb0RhdGEud29ya2luZ0RpcmVjdG9yeVBhdGgsXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMud29ya3NwYWNlLm9wZW4odXJpLCB7c2VhcmNoQWxsUGFuZXM6IHRydWV9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVGcmFnbWVudENvbnRhaW5lcihCYXJlQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciwge1xuICBwdWxsUmVxdWVzdHM6IGdyYXBocWxgXG4gICAgZnJhZ21lbnQgY29tbWVudERlY29yYXRpb25zQ29udHJvbGxlcl9wdWxsUmVxdWVzdHMgb24gUHVsbFJlcXVlc3RcbiAgICBAcmVsYXkocGx1cmFsOiB0cnVlKVxuICAgIHtcbiAgICAgIG51bWJlclxuICAgICAgaGVhZFJlZk5hbWVcbiAgICAgIGhlYWRSZWZPaWRcbiAgICAgIGhlYWRSZXBvc2l0b3J5IHtcbiAgICAgICAgbmFtZVxuICAgICAgICBvd25lciB7XG4gICAgICAgICAgbG9naW5cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVwb3NpdG9yeSB7XG4gICAgICAgIG5hbWVcbiAgICAgICAgb3duZXIge1xuICAgICAgICAgIGxvZ2luXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIGAsXG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyx1QkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsVUFBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksV0FBQSxHQUFB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