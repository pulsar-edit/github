"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BareCommentDecorationsController = void 0;
var _react = _interopRequireWildcard(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _reactRelay = require("react-relay");
var _path = _interopRequireDefault(require("path"));
var _editorCommentDecorationsController = _interopRequireDefault(require("./editor-comment-decorations-controller"));
var _reviewsItem = _interopRequireDefault(require("../items/reviews-item"));
var _gutter = _interopRequireDefault(require("../atom/gutter"));
var _commands = _interopRequireWildcard(require("../atom/commands"));
var _propTypes2 = require("../prop-types");
var _helpers = require("../helpers");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class BareCommentDecorationsController extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "updateOpenEditors", () => {
      return new Promise(resolve => {
        this.setState({
          openEditors: this.props.workspace.getTextEditors()
        }, resolve);
      });
    });
    _defineProperty(this, "openReviewsTab", () => {
      const [pullRequest] = this.props.pullRequests;
      /* istanbul ignore if */
      if (!pullRequest) {
        return null;
      }
      const uri = _reviewsItem.default.buildURI({
        host: this.props.endpoint.getHost(),
        owner: this.props.owner,
        repo: this.props.repo,
        number: pullRequest.number,
        workdir: this.props.repoData.workingDirectoryPath
      });
      return this.props.workspace.open(uri, {
        searchAllPanes: true
      });
    });
    this.subscriptions = new _eventKit.CompositeDisposable();
    this.state = {
      openEditors: this.props.workspace.getTextEditors()
    };
  }
  componentDidMount() {
    this.subscriptions.add(this.props.workspace.observeTextEditors(this.updateOpenEditors), this.props.workspace.onDidDestroyPaneItem(this.updateOpenEditors));
  }
  componentWillUnmount() {
    this.subscriptions.dispose();
  }
  render() {
    if (this.props.pullRequests.length === 0) {
      return null;
    }
    const pullRequest = this.props.pullRequests[0];

    // only show comment decorations if we're on a checked out pull request
    // otherwise, we'd have no way of knowing which comments to show.
    if (!this.isCheckedOutPullRequest(this.props.repoData.branches, this.props.repoData.remotes, pullRequest)) {
      return null;
    }
    const threadDataByPath = new Map();
    const workdirPath = this.props.repoData.workingDirectoryPath;
    for (const {
      comments,
      thread
    } of this.props.commentThreads) {
      // Skip comment threads that are entirely minimized.
      if (comments.every(comment => comment.isMinimized)) {
        continue;
      }

      // There may be multiple comments in the thread, but we really only care about the root comment when rendering
      // decorations.
      const threadData = {
        rootCommentID: comments[0].id,
        threadID: thread.id,
        position: comments[0].position,
        nativeRelPath: (0, _helpers.toNativePathSep)(comments[0].path),
        fullPath: _path.default.join(workdirPath, (0, _helpers.toNativePathSep)(comments[0].path))
      };
      if (threadDataByPath.get(threadData.fullPath)) {
        threadDataByPath.get(threadData.fullPath).push(threadData);
      } else {
        threadDataByPath.set(threadData.fullPath, [threadData]);
      }
    }
    const openEditorsWithCommentThreads = this.getOpenEditorsWithCommentThreads(threadDataByPath);
    return _react.default.createElement(_react.Fragment, null, _react.default.createElement(_commands.default, {
      registry: this.props.commands,
      target: "atom-workspace"
    }, _react.default.createElement(_commands.Command, {
      command: "github:open-reviews-tab",
      callback: this.openReviewsTab
    })), openEditorsWithCommentThreads.map(editor => {
      const threadData = threadDataByPath.get(editor.getPath());
      const translations = this.props.commentTranslations.get(threadData[0].nativeRelPath);
      return _react.default.createElement(_react.Fragment, {
        key: `github-editor-decoration-${editor.id}`
      }, _react.default.createElement(_gutter.default, {
        name: "github-comment-icon",
        priority: 1,
        className: "comment",
        editor: editor,
        type: "decorated"
      }), _react.default.createElement(_editorCommentDecorationsController.default, {
        endpoint: this.props.endpoint,
        owner: this.props.owner,
        repo: this.props.repo,
        number: pullRequest.number,
        workdir: workdirPath,
        workspace: this.props.workspace,
        editor: editor,
        fileName: editor.getPath(),
        headSha: pullRequest.headRefOid,
        threadsForPath: threadData,
        commentTranslationsForPath: translations
      }));
    }));
  }
  getOpenEditorsWithCommentThreads(threadDataByPath) {
    const haveThreads = [];
    for (const editor of this.state.openEditors) {
      if (threadDataByPath.has(editor.getPath())) {
        haveThreads.push(editor);
      }
    }
    return haveThreads;
  }

  // Determine if we already have this PR checked out.
  // todo: if this is similar enough to pr-checkout-controller, extract a single
  // helper function to do this check.
  isCheckedOutPullRequest(branches, remotes, pullRequest) {
    // determine if pullRequest.headRepository is null
    // this can happen if a repository has been deleted.
    if (!pullRequest.headRepository) {
      return false;
    }
    const {
      repository
    } = pullRequest;
    const headPush = branches.getHeadBranch().getPush();
    const headRemote = remotes.withName(headPush.getRemoteName());

    // (detect checkout from pull/### refspec)
    const fromPullRefspec = headRemote.getOwner() === repository.owner.login && headRemote.getRepo() === repository.name && headPush.getShortRemoteRef() === `pull/${pullRequest.number}/head`;

    // (detect checkout from head repository)
    const fromHeadRepo = headRemote.getOwner() === pullRequest.headRepository.owner.login && headRemote.getRepo() === pullRequest.headRepository.name && headPush.getShortRemoteRef() === pullRequest.headRefName;
    if (fromPullRefspec || fromHeadRepo) {
      return true;
    }
    return false;
  }
}
exports.BareCommentDecorationsController = BareCommentDecorationsController;
_defineProperty(BareCommentDecorationsController, "propTypes", {
  // Relay response
  relay: _propTypes.default.object.isRequired,
  pullRequests: _propTypes.default.arrayOf(_propTypes.default.shape({
    number: _propTypes.default.number.isRequired,
    headRefName: _propTypes.default.string.isRequired,
    headRefOid: _propTypes.default.string.isRequired,
    headRepository: _propTypes.default.shape({
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }),
    repository: _propTypes.default.shape({
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }).isRequired
  })),
  // Connection information
  endpoint: _propTypes2.EndpointPropType.isRequired,
  owner: _propTypes.default.string.isRequired,
  repo: _propTypes.default.string.isRequired,
  // Atom environment
  workspace: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  // Models
  repoData: _propTypes.default.shape({
    branches: _propTypes2.BranchSetPropType.isRequired,
    remotes: _propTypes2.RemoteSetPropType.isRequired,
    currentRemote: _propTypes2.RemotePropType.isRequired,
    workingDirectoryPath: _propTypes.default.string.isRequired
  }).isRequired,
  commentThreads: _propTypes.default.arrayOf(_propTypes.default.shape({
    comments: _propTypes.default.arrayOf(_propTypes.default.object).isRequired,
    thread: _propTypes.default.shape({
      id: _propTypes.default.string.isRequired
    }).isRequired
  })).isRequired,
  commentTranslations: _propTypes.default.shape({
    get: _propTypes.default.func.isRequired
  }).isRequired
});
var _default = (0, _reactRelay.createFragmentContainer)(BareCommentDecorationsController, {
  pullRequests: function () {
    const node = require("./__generated__/commentDecorationsController_pullRequests.graphql");
    if (node.hash && node.hash !== "62f96ccd13dfc2649112a7b4afaf4ba2") {
      console.error("The definition of 'commentDecorationsController_pullRequests' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
    }
    return require("./__generated__/commentDecorationsController_pullRequests.graphql");
  }
});
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcHJvcFR5cGVzIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9ldmVudEtpdCIsIl9yZWFjdFJlbGF5IiwiX3BhdGgiLCJfZWRpdG9yQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciIsIl9yZXZpZXdzSXRlbSIsIl9ndXR0ZXIiLCJfY29tbWFuZHMiLCJfcHJvcFR5cGVzMiIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJlIiwiV2Vha01hcCIsInIiLCJ0IiwiaGFzIiwiZ2V0IiwibiIsIl9fcHJvdG9fXyIsImEiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0IiwiX2RlZmluZVByb3BlcnR5Iiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImFyZyIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsImlucHV0IiwiaGludCIsInByaW0iLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsInVuZGVmaW5lZCIsInJlcyIsIlR5cGVFcnJvciIsIk51bWJlciIsIkJhcmVDb21tZW50RGVjb3JhdGlvbnNDb250cm9sbGVyIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0U3RhdGUiLCJvcGVuRWRpdG9ycyIsIndvcmtzcGFjZSIsImdldFRleHRFZGl0b3JzIiwicHVsbFJlcXVlc3QiLCJwdWxsUmVxdWVzdHMiLCJ1cmkiLCJSZXZpZXdzSXRlbSIsImJ1aWxkVVJJIiwiaG9zdCIsImVuZHBvaW50IiwiZ2V0SG9zdCIsIm93bmVyIiwicmVwbyIsIm51bWJlciIsIndvcmtkaXIiLCJyZXBvRGF0YSIsIndvcmtpbmdEaXJlY3RvcnlQYXRoIiwib3BlbiIsInNlYXJjaEFsbFBhbmVzIiwic3Vic2NyaXB0aW9ucyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJzdGF0ZSIsImNvbXBvbmVudERpZE1vdW50IiwiYWRkIiwib2JzZXJ2ZVRleHRFZGl0b3JzIiwidXBkYXRlT3BlbkVkaXRvcnMiLCJvbkRpZERlc3Ryb3lQYW5lSXRlbSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsInJlbmRlciIsImxlbmd0aCIsImlzQ2hlY2tlZE91dFB1bGxSZXF1ZXN0IiwiYnJhbmNoZXMiLCJyZW1vdGVzIiwidGhyZWFkRGF0YUJ5UGF0aCIsIk1hcCIsIndvcmtkaXJQYXRoIiwiY29tbWVudHMiLCJ0aHJlYWQiLCJjb21tZW50VGhyZWFkcyIsImV2ZXJ5IiwiY29tbWVudCIsImlzTWluaW1pemVkIiwidGhyZWFkRGF0YSIsInJvb3RDb21tZW50SUQiLCJpZCIsInRocmVhZElEIiwicG9zaXRpb24iLCJuYXRpdmVSZWxQYXRoIiwidG9OYXRpdmVQYXRoU2VwIiwicGF0aCIsImZ1bGxQYXRoIiwiam9pbiIsInB1c2giLCJvcGVuRWRpdG9yc1dpdGhDb21tZW50VGhyZWFkcyIsImdldE9wZW5FZGl0b3JzV2l0aENvbW1lbnRUaHJlYWRzIiwiY3JlYXRlRWxlbWVudCIsIkZyYWdtZW50IiwicmVnaXN0cnkiLCJjb21tYW5kcyIsInRhcmdldCIsIkNvbW1hbmQiLCJjb21tYW5kIiwiY2FsbGJhY2siLCJvcGVuUmV2aWV3c1RhYiIsIm1hcCIsImVkaXRvciIsImdldFBhdGgiLCJ0cmFuc2xhdGlvbnMiLCJjb21tZW50VHJhbnNsYXRpb25zIiwibmFtZSIsInByaW9yaXR5IiwiY2xhc3NOYW1lIiwidHlwZSIsImZpbGVOYW1lIiwiaGVhZFNoYSIsImhlYWRSZWZPaWQiLCJ0aHJlYWRzRm9yUGF0aCIsImNvbW1lbnRUcmFuc2xhdGlvbnNGb3JQYXRoIiwiaGF2ZVRocmVhZHMiLCJoZWFkUmVwb3NpdG9yeSIsInJlcG9zaXRvcnkiLCJoZWFkUHVzaCIsImdldEhlYWRCcmFuY2giLCJnZXRQdXNoIiwiaGVhZFJlbW90ZSIsIndpdGhOYW1lIiwiZ2V0UmVtb3RlTmFtZSIsImZyb21QdWxsUmVmc3BlYyIsImdldE93bmVyIiwibG9naW4iLCJnZXRSZXBvIiwiZ2V0U2hvcnRSZW1vdGVSZWYiLCJmcm9tSGVhZFJlcG8iLCJoZWFkUmVmTmFtZSIsImV4cG9ydHMiLCJyZWxheSIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJhcnJheU9mIiwic2hhcGUiLCJzdHJpbmciLCJFbmRwb2ludFByb3BUeXBlIiwiQnJhbmNoU2V0UHJvcFR5cGUiLCJSZW1vdGVTZXRQcm9wVHlwZSIsImN1cnJlbnRSZW1vdGUiLCJSZW1vdGVQcm9wVHlwZSIsImZ1bmMiLCJfZGVmYXVsdCIsImNyZWF0ZUZyYWdtZW50Q29udGFpbmVyIiwibm9kZSIsImhhc2giLCJjb25zb2xlIiwiZXJyb3IiXSwic291cmNlcyI6WyJjb21tZW50LWRlY29yYXRpb25zLWNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7RnJhZ21lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2V2ZW50LWtpdCc7XG5pbXBvcnQge2dyYXBocWwsIGNyZWF0ZUZyYWdtZW50Q29udGFpbmVyfSBmcm9tICdyZWFjdC1yZWxheSc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IEVkaXRvckNvbW1lbnREZWNvcmF0aW9uc0NvbnRyb2xsZXIgZnJvbSAnLi9lZGl0b3ItY29tbWVudC1kZWNvcmF0aW9ucy1jb250cm9sbGVyJztcbmltcG9ydCBSZXZpZXdzSXRlbSBmcm9tICcuLi9pdGVtcy9yZXZpZXdzLWl0ZW0nO1xuaW1wb3J0IEd1dHRlciBmcm9tICcuLi9hdG9tL2d1dHRlcic7XG5pbXBvcnQgQ29tbWFuZHMsIHtDb21tYW5kfSBmcm9tICcuLi9hdG9tL2NvbW1hbmRzJztcbmltcG9ydCB7RW5kcG9pbnRQcm9wVHlwZSwgQnJhbmNoU2V0UHJvcFR5cGUsIFJlbW90ZVNldFByb3BUeXBlLCBSZW1vdGVQcm9wVHlwZX0gZnJvbSAnLi4vcHJvcC10eXBlcyc7XG5pbXBvcnQge3RvTmF0aXZlUGF0aFNlcH0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmV4cG9ydCBjbGFzcyBCYXJlQ29tbWVudERlY29yYXRpb25zQ29udHJvbGxlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLy8gUmVsYXkgcmVzcG9uc2VcbiAgICByZWxheTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHB1bGxSZXF1ZXN0czogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIG51bWJlcjogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgICAgaGVhZFJlZk5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgIGhlYWRSZWZPaWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgIGhlYWRSZXBvc2l0b3J5OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIG93bmVyOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICAgIGxvZ2luOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgICB9KSxcbiAgICAgIHJlcG9zaXRvcnk6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgb3duZXI6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgbG9naW46IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgfSkpLFxuXG4gICAgLy8gQ29ubmVjdGlvbiBpbmZvcm1hdGlvblxuICAgIGVuZHBvaW50OiBFbmRwb2ludFByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgb3duZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICByZXBvOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cbiAgICAvLyBBdG9tIGVudmlyb25tZW50XG4gICAgd29ya3NwYWNlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY29tbWFuZHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcblxuICAgIC8vIE1vZGVsc1xuICAgIHJlcG9EYXRhOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgYnJhbmNoZXM6IEJyYW5jaFNldFByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgICByZW1vdGVzOiBSZW1vdGVTZXRQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgICAgY3VycmVudFJlbW90ZTogUmVtb3RlUHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICAgIHdvcmtpbmdEaXJlY3RvcnlQYXRoOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgfSkuaXNSZXF1aXJlZCxcbiAgICBjb21tZW50VGhyZWFkczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIGNvbW1lbnRzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMub2JqZWN0KS5pc1JlcXVpcmVkLFxuICAgICAgdGhyZWFkOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBpZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICB9KSkuaXNSZXF1aXJlZCxcbiAgICBjb21tZW50VHJhbnNsYXRpb25zOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgZ2V0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIH0pLmlzUmVxdWlyZWQsXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuc3RhdGUgPSB7b3BlbkVkaXRvcnM6IHRoaXMucHJvcHMud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKCl9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChcbiAgICAgIHRoaXMucHJvcHMud29ya3NwYWNlLm9ic2VydmVUZXh0RWRpdG9ycyh0aGlzLnVwZGF0ZU9wZW5FZGl0b3JzKSxcbiAgICAgIHRoaXMucHJvcHMud29ya3NwYWNlLm9uRGlkRGVzdHJveVBhbmVJdGVtKHRoaXMudXBkYXRlT3BlbkVkaXRvcnMpLFxuICAgICk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLnByb3BzLnB1bGxSZXF1ZXN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBwdWxsUmVxdWVzdCA9IHRoaXMucHJvcHMucHVsbFJlcXVlc3RzWzBdO1xuXG4gICAgLy8gb25seSBzaG93IGNvbW1lbnQgZGVjb3JhdGlvbnMgaWYgd2UncmUgb24gYSBjaGVja2VkIG91dCBwdWxsIHJlcXVlc3RcbiAgICAvLyBvdGhlcndpc2UsIHdlJ2QgaGF2ZSBubyB3YXkgb2Yga25vd2luZyB3aGljaCBjb21tZW50cyB0byBzaG93LlxuICAgIGlmIChcbiAgICAgICF0aGlzLmlzQ2hlY2tlZE91dFB1bGxSZXF1ZXN0KFxuICAgICAgICB0aGlzLnByb3BzLnJlcG9EYXRhLmJyYW5jaGVzLFxuICAgICAgICB0aGlzLnByb3BzLnJlcG9EYXRhLnJlbW90ZXMsXG4gICAgICAgIHB1bGxSZXF1ZXN0LFxuICAgICAgKVxuICAgICkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgdGhyZWFkRGF0YUJ5UGF0aCA9IG5ldyBNYXAoKTtcbiAgICBjb25zdCB3b3JrZGlyUGF0aCA9IHRoaXMucHJvcHMucmVwb0RhdGEud29ya2luZ0RpcmVjdG9yeVBhdGg7XG5cbiAgICBmb3IgKGNvbnN0IHtjb21tZW50cywgdGhyZWFkfSBvZiB0aGlzLnByb3BzLmNvbW1lbnRUaHJlYWRzKSB7XG4gICAgICAvLyBTa2lwIGNvbW1lbnQgdGhyZWFkcyB0aGF0IGFyZSBlbnRpcmVseSBtaW5pbWl6ZWQuXG4gICAgICBpZiAoY29tbWVudHMuZXZlcnkoY29tbWVudCA9PiBjb21tZW50LmlzTWluaW1pemVkKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gVGhlcmUgbWF5IGJlIG11bHRpcGxlIGNvbW1lbnRzIGluIHRoZSB0aHJlYWQsIGJ1dCB3ZSByZWFsbHkgb25seSBjYXJlIGFib3V0IHRoZSByb290IGNvbW1lbnQgd2hlbiByZW5kZXJpbmdcbiAgICAgIC8vIGRlY29yYXRpb25zLlxuICAgICAgY29uc3QgdGhyZWFkRGF0YSA9IHtcbiAgICAgICAgcm9vdENvbW1lbnRJRDogY29tbWVudHNbMF0uaWQsXG4gICAgICAgIHRocmVhZElEOiB0aHJlYWQuaWQsXG4gICAgICAgIHBvc2l0aW9uOiBjb21tZW50c1swXS5wb3NpdGlvbixcbiAgICAgICAgbmF0aXZlUmVsUGF0aDogdG9OYXRpdmVQYXRoU2VwKGNvbW1lbnRzWzBdLnBhdGgpLFxuICAgICAgICBmdWxsUGF0aDogcGF0aC5qb2luKHdvcmtkaXJQYXRoLCB0b05hdGl2ZVBhdGhTZXAoY29tbWVudHNbMF0ucGF0aCkpLFxuICAgICAgfTtcblxuICAgICAgaWYgKHRocmVhZERhdGFCeVBhdGguZ2V0KHRocmVhZERhdGEuZnVsbFBhdGgpKSB7XG4gICAgICAgIHRocmVhZERhdGFCeVBhdGguZ2V0KHRocmVhZERhdGEuZnVsbFBhdGgpLnB1c2godGhyZWFkRGF0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJlYWREYXRhQnlQYXRoLnNldCh0aHJlYWREYXRhLmZ1bGxQYXRoLCBbdGhyZWFkRGF0YV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG9wZW5FZGl0b3JzV2l0aENvbW1lbnRUaHJlYWRzID0gdGhpcy5nZXRPcGVuRWRpdG9yc1dpdGhDb21tZW50VGhyZWFkcyh0aHJlYWREYXRhQnlQYXRoKTtcbiAgICByZXR1cm4gKFxuICAgICAgPEZyYWdtZW50PlxuICAgICAgICA8Q29tbWFuZHMgcmVnaXN0cnk9e3RoaXMucHJvcHMuY29tbWFuZHN9IHRhcmdldD1cImF0b20td29ya3NwYWNlXCI+XG4gICAgICAgICAgPENvbW1hbmQgY29tbWFuZD1cImdpdGh1YjpvcGVuLXJldmlld3MtdGFiXCIgY2FsbGJhY2s9e3RoaXMub3BlblJldmlld3NUYWJ9IC8+XG4gICAgICAgIDwvQ29tbWFuZHM+XG4gICAgICAgIHtvcGVuRWRpdG9yc1dpdGhDb21tZW50VGhyZWFkcy5tYXAoZWRpdG9yID0+IHtcbiAgICAgICAgICBjb25zdCB0aHJlYWREYXRhID0gdGhyZWFkRGF0YUJ5UGF0aC5nZXQoZWRpdG9yLmdldFBhdGgoKSk7XG4gICAgICAgICAgY29uc3QgdHJhbnNsYXRpb25zID0gdGhpcy5wcm9wcy5jb21tZW50VHJhbnNsYXRpb25zLmdldCh0aHJlYWREYXRhWzBdLm5hdGl2ZVJlbFBhdGgpO1xuXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxGcmFnbWVudCBrZXk9e2BnaXRodWItZWRpdG9yLWRlY29yYXRpb24tJHtlZGl0b3IuaWR9YH0+XG4gICAgICAgICAgICAgIDxHdXR0ZXJcbiAgICAgICAgICAgICAgICBuYW1lPVwiZ2l0aHViLWNvbW1lbnQtaWNvblwiXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk9ezF9XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiY29tbWVudFwiXG4gICAgICAgICAgICAgICAgZWRpdG9yPXtlZGl0b3J9XG4gICAgICAgICAgICAgICAgdHlwZT1cImRlY29yYXRlZFwiXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxFZGl0b3JDb21tZW50RGVjb3JhdGlvbnNDb250cm9sbGVyXG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ9e3RoaXMucHJvcHMuZW5kcG9pbnR9XG4gICAgICAgICAgICAgICAgb3duZXI9e3RoaXMucHJvcHMub3duZXJ9XG4gICAgICAgICAgICAgICAgcmVwbz17dGhpcy5wcm9wcy5yZXBvfVxuICAgICAgICAgICAgICAgIG51bWJlcj17cHVsbFJlcXVlc3QubnVtYmVyfVxuICAgICAgICAgICAgICAgIHdvcmtkaXI9e3dvcmtkaXJQYXRofVxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZT17dGhpcy5wcm9wcy53b3Jrc3BhY2V9XG4gICAgICAgICAgICAgICAgZWRpdG9yPXtlZGl0b3J9XG4gICAgICAgICAgICAgICAgZmlsZU5hbWU9e2VkaXRvci5nZXRQYXRoKCl9XG4gICAgICAgICAgICAgICAgaGVhZFNoYT17cHVsbFJlcXVlc3QuaGVhZFJlZk9pZH1cbiAgICAgICAgICAgICAgICB0aHJlYWRzRm9yUGF0aD17dGhyZWFkRGF0YX1cbiAgICAgICAgICAgICAgICBjb21tZW50VHJhbnNsYXRpb25zRm9yUGF0aD17dHJhbnNsYXRpb25zfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9GcmFnbWVudD5cbiAgICAgICAgICApO1xuICAgICAgICB9KX1cbiAgICAgIDwvRnJhZ21lbnQ+KTtcbiAgfVxuXG4gIGdldE9wZW5FZGl0b3JzV2l0aENvbW1lbnRUaHJlYWRzKHRocmVhZERhdGFCeVBhdGgpIHtcbiAgICBjb25zdCBoYXZlVGhyZWFkcyA9IFtdO1xuICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuc3RhdGUub3BlbkVkaXRvcnMpIHtcbiAgICAgIGlmICh0aHJlYWREYXRhQnlQYXRoLmhhcyhlZGl0b3IuZ2V0UGF0aCgpKSkge1xuICAgICAgICBoYXZlVGhyZWFkcy5wdXNoKGVkaXRvcik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYXZlVGhyZWFkcztcbiAgfVxuXG4gIC8vIERldGVybWluZSBpZiB3ZSBhbHJlYWR5IGhhdmUgdGhpcyBQUiBjaGVja2VkIG91dC5cbiAgLy8gdG9kbzogaWYgdGhpcyBpcyBzaW1pbGFyIGVub3VnaCB0byBwci1jaGVja291dC1jb250cm9sbGVyLCBleHRyYWN0IGEgc2luZ2xlXG4gIC8vIGhlbHBlciBmdW5jdGlvbiB0byBkbyB0aGlzIGNoZWNrLlxuICBpc0NoZWNrZWRPdXRQdWxsUmVxdWVzdChicmFuY2hlcywgcmVtb3RlcywgcHVsbFJlcXVlc3QpIHtcbiAgICAvLyBkZXRlcm1pbmUgaWYgcHVsbFJlcXVlc3QuaGVhZFJlcG9zaXRvcnkgaXMgbnVsbFxuICAgIC8vIHRoaXMgY2FuIGhhcHBlbiBpZiBhIHJlcG9zaXRvcnkgaGFzIGJlZW4gZGVsZXRlZC5cbiAgICBpZiAoIXB1bGxSZXF1ZXN0LmhlYWRSZXBvc2l0b3J5KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3Qge3JlcG9zaXRvcnl9ID0gcHVsbFJlcXVlc3Q7XG5cbiAgICBjb25zdCBoZWFkUHVzaCA9IGJyYW5jaGVzLmdldEhlYWRCcmFuY2goKS5nZXRQdXNoKCk7XG4gICAgY29uc3QgaGVhZFJlbW90ZSA9IHJlbW90ZXMud2l0aE5hbWUoaGVhZFB1c2guZ2V0UmVtb3RlTmFtZSgpKTtcblxuICAgIC8vIChkZXRlY3QgY2hlY2tvdXQgZnJvbSBwdWxsLyMjIyByZWZzcGVjKVxuICAgIGNvbnN0IGZyb21QdWxsUmVmc3BlYyA9XG4gICAgICAgIGhlYWRSZW1vdGUuZ2V0T3duZXIoKSA9PT0gcmVwb3NpdG9yeS5vd25lci5sb2dpbiAmJlxuICAgICAgICBoZWFkUmVtb3RlLmdldFJlcG8oKSA9PT0gcmVwb3NpdG9yeS5uYW1lICYmXG4gICAgICAgIGhlYWRQdXNoLmdldFNob3J0UmVtb3RlUmVmKCkgPT09IGBwdWxsLyR7cHVsbFJlcXVlc3QubnVtYmVyfS9oZWFkYDtcblxuICAgIC8vIChkZXRlY3QgY2hlY2tvdXQgZnJvbSBoZWFkIHJlcG9zaXRvcnkpXG4gICAgY29uc3QgZnJvbUhlYWRSZXBvID1cbiAgICAgICAgaGVhZFJlbW90ZS5nZXRPd25lcigpID09PSBwdWxsUmVxdWVzdC5oZWFkUmVwb3NpdG9yeS5vd25lci5sb2dpbiAmJlxuICAgICAgICBoZWFkUmVtb3RlLmdldFJlcG8oKSA9PT0gcHVsbFJlcXVlc3QuaGVhZFJlcG9zaXRvcnkubmFtZSAmJlxuICAgICAgICBoZWFkUHVzaC5nZXRTaG9ydFJlbW90ZVJlZigpID09PSBwdWxsUmVxdWVzdC5oZWFkUmVmTmFtZTtcblxuICAgIGlmIChmcm9tUHVsbFJlZnNwZWMgfHwgZnJvbUhlYWRSZXBvKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdXBkYXRlT3BlbkVkaXRvcnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7b3BlbkVkaXRvcnM6IHRoaXMucHJvcHMud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKCl9LCByZXNvbHZlKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9wZW5SZXZpZXdzVGFiID0gKCkgPT4ge1xuICAgIGNvbnN0IFtwdWxsUmVxdWVzdF0gPSB0aGlzLnByb3BzLnB1bGxSZXF1ZXN0cztcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICBpZiAoIXB1bGxSZXF1ZXN0KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCB1cmkgPSBSZXZpZXdzSXRlbS5idWlsZFVSSSh7XG4gICAgICBob3N0OiB0aGlzLnByb3BzLmVuZHBvaW50LmdldEhvc3QoKSxcbiAgICAgIG93bmVyOiB0aGlzLnByb3BzLm93bmVyLFxuICAgICAgcmVwbzogdGhpcy5wcm9wcy5yZXBvLFxuICAgICAgbnVtYmVyOiBwdWxsUmVxdWVzdC5udW1iZXIsXG4gICAgICB3b3JrZGlyOiB0aGlzLnByb3BzLnJlcG9EYXRhLndvcmtpbmdEaXJlY3RvcnlQYXRoLFxuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLnByb3BzLndvcmtzcGFjZS5vcGVuKHVyaSwge3NlYXJjaEFsbFBhbmVzOiB0cnVlfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlRnJhZ21lbnRDb250YWluZXIoQmFyZUNvbW1lbnREZWNvcmF0aW9uc0NvbnRyb2xsZXIsIHtcbiAgcHVsbFJlcXVlc3RzOiBncmFwaHFsYFxuICAgIGZyYWdtZW50IGNvbW1lbnREZWNvcmF0aW9uc0NvbnRyb2xsZXJfcHVsbFJlcXVlc3RzIG9uIFB1bGxSZXF1ZXN0XG4gICAgQHJlbGF5KHBsdXJhbDogdHJ1ZSlcbiAgICB7XG4gICAgICBudW1iZXJcbiAgICAgIGhlYWRSZWZOYW1lXG4gICAgICBoZWFkUmVmT2lkXG4gICAgICBoZWFkUmVwb3NpdG9yeSB7XG4gICAgICAgIG5hbWVcbiAgICAgICAgb3duZXIge1xuICAgICAgICAgIGxvZ2luXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlcG9zaXRvcnkge1xuICAgICAgICBuYW1lXG4gICAgICAgIG93bmVyIHtcbiAgICAgICAgICBsb2dpblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICBgLFxufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFVBQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtB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