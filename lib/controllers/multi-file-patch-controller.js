"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _path = _interopRequireDefault(require("path"));
var _helpers = require("../helpers");
var _reporterProxy = require("../reporter-proxy");
var _propTypes2 = require("../prop-types");
var _changedFileItem = _interopRequireDefault(require("../items/changed-file-item"));
var _multiFilePatchView = _interopRequireDefault(require("../views/multi-file-patch-view"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class MultiFilePatchController extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _helpers.autobind)(this, 'selectedRowsChanged', 'undoLastDiscard', 'diveIntoMirrorPatch', 'openFile', 'toggleFile', 'toggleRows', 'toggleModeChange', 'toggleSymlinkChange', 'discardRows');
    this.state = {
      selectionMode: 'hunk',
      selectedRows: new Set(),
      hasMultipleFileSelections: false
    };
    this.mouseSelectionInProgress = false;
    this.stagingOperationInProgress = false;
    this.lastPatchString = null;
    this.patchChangePromise = new Promise(resolve => {
      this.resolvePatchChangePromise = resolve;
    });
  }
  componentDidUpdate(prevProps) {
    if (this.lastPatchString !== null && this.lastPatchString !== this.props.multiFilePatch.toString()) {
      this.resolvePatchChangePromise();
      this.patchChangePromise = new Promise(resolve => {
        this.resolvePatchChangePromise = resolve;
      });
    }
  }
  render() {
    return _react.default.createElement(_multiFilePatchView.default, _extends({}, this.props, {
      selectedRows: this.state.selectedRows,
      selectionMode: this.state.selectionMode,
      hasMultipleFileSelections: this.state.hasMultipleFileSelections,
      selectedRowsChanged: this.selectedRowsChanged,
      diveIntoMirrorPatch: this.diveIntoMirrorPatch,
      openFile: this.openFile,
      toggleFile: this.toggleFile,
      toggleRows: this.toggleRows,
      toggleModeChange: this.toggleModeChange,
      toggleSymlinkChange: this.toggleSymlinkChange,
      undoLastDiscard: this.undoLastDiscard,
      discardRows: this.discardRows,
      selectNextHunk: this.selectNextHunk,
      selectPreviousHunk: this.selectPreviousHunk,
      switchToIssueish: this.props.switchToIssueish
    }));
  }
  undoLastDiscard(filePatch, {
    eventSource
  } = {}) {
    (0, _reporterProxy.addEvent)('undo-last-discard', {
      package: 'github',
      component: this.constructor.name,
      eventSource
    });
    return this.props.undoLastDiscard(filePatch.getPath(), this.props.repository);
  }
  diveIntoMirrorPatch(filePatch) {
    const mirrorStatus = this.withStagingStatus({
      staged: 'unstaged',
      unstaged: 'staged'
    });
    const workingDirectory = this.props.repository.getWorkingDirectoryPath();
    const uri = _changedFileItem.default.buildURI(filePatch.getPath(), workingDirectory, mirrorStatus);
    this.props.destroy();
    return this.props.workspace.open(uri);
  }
  async openFile(filePatch, positions, pending) {
    const absolutePath = _path.default.join(this.props.repository.getWorkingDirectoryPath(), filePatch.getPath());
    const editor = await this.props.workspace.open(absolutePath, {
      pending
    });
    if (positions.length > 0) {
      editor.setCursorBufferPosition(positions[0], {
        autoscroll: false
      });
      for (const position of positions.slice(1)) {
        editor.addCursorAtBufferPosition(position);
      }
      editor.scrollToBufferPosition(positions[positions.length - 1], {
        center: true
      });
    }
    return editor;
  }
  toggleFile(filePatch) {
    return this.stagingOperation(() => {
      const methodName = this.withStagingStatus({
        staged: 'unstageFiles',
        unstaged: 'stageFiles'
      });
      return this.props.repository[methodName]([filePatch.getPath()]);
    });
  }
  async toggleRows(rowSet, nextSelectionMode) {
    let chosenRows = rowSet;
    if (chosenRows) {
      const nextMultipleFileSelections = this.props.multiFilePatch.spansMultipleFiles(chosenRows);
      await this.selectedRowsChanged(chosenRows, nextSelectionMode, nextMultipleFileSelections);
    } else {
      chosenRows = this.state.selectedRows;
    }
    if (chosenRows.size === 0) {
      return Promise.resolve();
    }
    return this.stagingOperation(() => {
      const patch = this.withStagingStatus({
        staged: () => this.props.multiFilePatch.getUnstagePatchForLines(chosenRows),
        unstaged: () => this.props.multiFilePatch.getStagePatchForLines(chosenRows)
      });
      return this.props.repository.applyPatchToIndex(patch);
    });
  }
  toggleModeChange(filePatch) {
    return this.stagingOperation(() => {
      const targetMode = this.withStagingStatus({
        unstaged: filePatch.getNewMode(),
        staged: filePatch.getOldMode()
      });
      return this.props.repository.stageFileModeChange(filePatch.getPath(), targetMode);
    });
  }
  toggleSymlinkChange(filePatch) {
    return this.stagingOperation(() => {
      const relPath = filePatch.getPath();
      const repository = this.props.repository;
      return this.withStagingStatus({
        unstaged: () => {
          if (filePatch.hasTypechange() && filePatch.getStatus() === 'added') {
            return repository.stageFileSymlinkChange(relPath);
          }
          return repository.stageFiles([relPath]);
        },
        staged: () => {
          if (filePatch.hasTypechange() && filePatch.getStatus() === 'deleted') {
            return repository.stageFileSymlinkChange(relPath);
          }
          return repository.unstageFiles([relPath]);
        }
      });
    });
  }
  async discardRows(rowSet, nextSelectionMode, {
    eventSource
  } = {}) {
    // (kuychaco) For now we only support discarding rows for MultiFilePatches that contain a single file patch
    // The only way to access this method from the UI is to be in a ChangedFileItem, which only has a single file patch
    // This check is duplicated in RootController#discardLines. We also want it here to prevent us from sending metrics
    // unnecessarily
    if (this.props.multiFilePatch.getFilePatches().length !== 1) {
      return Promise.resolve(null);
    }
    let chosenRows = rowSet;
    if (chosenRows) {
      const nextMultipleFileSelections = this.props.multiFilePatch.spansMultipleFiles(chosenRows);
      await this.selectedRowsChanged(chosenRows, nextSelectionMode, nextMultipleFileSelections);
    } else {
      chosenRows = this.state.selectedRows;
    }
    (0, _reporterProxy.addEvent)('discard-unstaged-changes', {
      package: 'github',
      component: this.constructor.name,
      lineCount: chosenRows.size,
      eventSource
    });
    return this.props.discardLines(this.props.multiFilePatch, chosenRows, this.props.repository);
  }
  selectedRowsChanged(rows, nextSelectionMode, nextMultipleFileSelections) {
    if ((0, _helpers.equalSets)(this.state.selectedRows, rows) && this.state.selectionMode === nextSelectionMode && this.state.hasMultipleFileSelections === nextMultipleFileSelections) {
      return Promise.resolve();
    }
    return new Promise(resolve => {
      this.setState({
        selectedRows: rows,
        selectionMode: nextSelectionMode,
        hasMultipleFileSelections: nextMultipleFileSelections
      }, resolve);
    });
  }
  withStagingStatus(callbacks) {
    const callback = callbacks[this.props.stagingStatus];
    /* istanbul ignore if */
    if (!callback) {
      throw new Error(`Unknown staging status: ${this.props.stagingStatus}`);
    }
    return callback instanceof Function ? callback() : callback;
  }
  stagingOperation(fn) {
    if (this.stagingOperationInProgress) {
      return null;
    }
    this.stagingOperationInProgress = true;
    this.lastPatchString = this.props.multiFilePatch.toString();
    const operationPromise = fn();
    operationPromise.then(() => this.patchChangePromise).then(() => {
      this.stagingOperationInProgress = false;
      this.lastPatchString = null;
    });
    return operationPromise;
  }
}
exports.default = MultiFilePatchController;
_defineProperty(MultiFilePatchController, "propTypes", {
  repository: _propTypes.default.object.isRequired,
  stagingStatus: _propTypes.default.oneOf(['staged', 'unstaged']),
  multiFilePatch: _propTypes2.MultiFilePatchPropType.isRequired,
  hasUndoHistory: _propTypes.default.bool,
  reviewCommentsLoading: _propTypes.default.bool,
  reviewCommentThreads: _propTypes.default.arrayOf(_propTypes.default.shape({
    thread: _propTypes.default.object.isRequired,
    comments: _propTypes.default.arrayOf(_propTypes.default.object).isRequired
  })),
  workspace: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  keymaps: _propTypes.default.object.isRequired,
  tooltips: _propTypes.default.object.isRequired,
  config: _propTypes.default.object.isRequired,
  destroy: _propTypes.default.func.isRequired,
  discardLines: _propTypes.default.func,
  undoLastDiscard: _propTypes.default.func,
  surface: _propTypes.default.func,
  switchToIssueish: _propTypes.default.func
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aUZpbGVQYXRjaENvbnRyb2xsZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJhdXRvYmluZCIsInN0YXRlIiwic2VsZWN0aW9uTW9kZSIsInNlbGVjdGVkUm93cyIsIlNldCIsImhhc011bHRpcGxlRmlsZVNlbGVjdGlvbnMiLCJtb3VzZVNlbGVjdGlvbkluUHJvZ3Jlc3MiLCJzdGFnaW5nT3BlcmF0aW9uSW5Qcm9ncmVzcyIsImxhc3RQYXRjaFN0cmluZyIsInBhdGNoQ2hhbmdlUHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVzb2x2ZVBhdGNoQ2hhbmdlUHJvbWlzZSIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsIm11bHRpRmlsZVBhdGNoIiwidG9TdHJpbmciLCJyZW5kZXIiLCJzZWxlY3RlZFJvd3NDaGFuZ2VkIiwiZGl2ZUludG9NaXJyb3JQYXRjaCIsIm9wZW5GaWxlIiwidG9nZ2xlRmlsZSIsInRvZ2dsZVJvd3MiLCJ0b2dnbGVNb2RlQ2hhbmdlIiwidG9nZ2xlU3ltbGlua0NoYW5nZSIsInVuZG9MYXN0RGlzY2FyZCIsImRpc2NhcmRSb3dzIiwic2VsZWN0TmV4dEh1bmsiLCJzZWxlY3RQcmV2aW91c0h1bmsiLCJzd2l0Y2hUb0lzc3VlaXNoIiwiZmlsZVBhdGNoIiwiZXZlbnRTb3VyY2UiLCJhZGRFdmVudCIsInBhY2thZ2UiLCJjb21wb25lbnQiLCJuYW1lIiwiZ2V0UGF0aCIsInJlcG9zaXRvcnkiLCJtaXJyb3JTdGF0dXMiLCJ3aXRoU3RhZ2luZ1N0YXR1cyIsInN0YWdlZCIsInVuc3RhZ2VkIiwid29ya2luZ0RpcmVjdG9yeSIsImdldFdvcmtpbmdEaXJlY3RvcnlQYXRoIiwidXJpIiwiQ2hhbmdlZEZpbGVJdGVtIiwiYnVpbGRVUkkiLCJkZXN0cm95Iiwid29ya3NwYWNlIiwib3BlbiIsInBvc2l0aW9ucyIsInBlbmRpbmciLCJhYnNvbHV0ZVBhdGgiLCJwYXRoIiwiam9pbiIsImVkaXRvciIsImxlbmd0aCIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiYXV0b3Njcm9sbCIsInBvc2l0aW9uIiwic2xpY2UiLCJhZGRDdXJzb3JBdEJ1ZmZlclBvc2l0aW9uIiwic2Nyb2xsVG9CdWZmZXJQb3NpdGlvbiIsImNlbnRlciIsInN0YWdpbmdPcGVyYXRpb24iLCJtZXRob2ROYW1lIiwicm93U2V0IiwibmV4dFNlbGVjdGlvbk1vZGUiLCJjaG9zZW5Sb3dzIiwibmV4dE11bHRpcGxlRmlsZVNlbGVjdGlvbnMiLCJzcGFuc011bHRpcGxlRmlsZXMiLCJzaXplIiwicGF0Y2giLCJnZXRVbnN0YWdlUGF0Y2hGb3JMaW5lcyIsImdldFN0YWdlUGF0Y2hGb3JMaW5lcyIsImFwcGx5UGF0Y2hUb0luZGV4IiwidGFyZ2V0TW9kZSIsImdldE5ld01vZGUiLCJnZXRPbGRNb2RlIiwic3RhZ2VGaWxlTW9kZUNoYW5nZSIsInJlbFBhdGgiLCJoYXNUeXBlY2hhbmdlIiwiZ2V0U3RhdHVzIiwic3RhZ2VGaWxlU3ltbGlua0NoYW5nZSIsInN0YWdlRmlsZXMiLCJ1bnN0YWdlRmlsZXMiLCJnZXRGaWxlUGF0Y2hlcyIsImxpbmVDb3VudCIsImRpc2NhcmRMaW5lcyIsInJvd3MiLCJlcXVhbFNldHMiLCJzZXRTdGF0ZSIsImNhbGxiYWNrcyIsImNhbGxiYWNrIiwic3RhZ2luZ1N0YXR1cyIsIkVycm9yIiwiRnVuY3Rpb24iLCJmbiIsIm9wZXJhdGlvblByb21pc2UiLCJ0aGVuIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsIm9uZU9mIiwiTXVsdGlGaWxlUGF0Y2hQcm9wVHlwZSIsImhhc1VuZG9IaXN0b3J5IiwiYm9vbCIsInJldmlld0NvbW1lbnRzTG9hZGluZyIsInJldmlld0NvbW1lbnRUaHJlYWRzIiwiYXJyYXlPZiIsInNoYXBlIiwidGhyZWFkIiwiY29tbWVudHMiLCJjb21tYW5kcyIsImtleW1hcHMiLCJ0b29sdGlwcyIsImNvbmZpZyIsImZ1bmMiLCJzdXJmYWNlIl0sInNvdXJjZXMiOlsibXVsdGktZmlsZS1wYXRjaC1jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCB7YXV0b2JpbmQsIGVxdWFsU2V0c30gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQge2FkZEV2ZW50fSBmcm9tICcuLi9yZXBvcnRlci1wcm94eSc7XG5pbXBvcnQge011bHRpRmlsZVBhdGNoUHJvcFR5cGV9IGZyb20gJy4uL3Byb3AtdHlwZXMnO1xuaW1wb3J0IENoYW5nZWRGaWxlSXRlbSBmcm9tICcuLi9pdGVtcy9jaGFuZ2VkLWZpbGUtaXRlbSc7XG5pbXBvcnQgTXVsdGlGaWxlUGF0Y2hWaWV3IGZyb20gJy4uL3ZpZXdzL211bHRpLWZpbGUtcGF0Y2gtdmlldyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE11bHRpRmlsZVBhdGNoQ29udHJvbGxlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgcmVwb3NpdG9yeTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHN0YWdpbmdTdGF0dXM6IFByb3BUeXBlcy5vbmVPZihbJ3N0YWdlZCcsICd1bnN0YWdlZCddKSxcbiAgICBtdWx0aUZpbGVQYXRjaDogTXVsdGlGaWxlUGF0Y2hQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgIGhhc1VuZG9IaXN0b3J5OiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIHJldmlld0NvbW1lbnRzTG9hZGluZzogUHJvcFR5cGVzLmJvb2wsXG4gICAgcmV2aWV3Q29tbWVudFRocmVhZHM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICB0aHJlYWQ6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICAgIGNvbW1lbnRzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMub2JqZWN0KS5pc1JlcXVpcmVkLFxuICAgIH0pKSxcblxuICAgIHdvcmtzcGFjZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGNvbW1hbmRzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAga2V5bWFwczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHRvb2x0aXBzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY29uZmlnOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG5cbiAgICBkZXN0cm95OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGRpc2NhcmRMaW5lczogUHJvcFR5cGVzLmZ1bmMsXG4gICAgdW5kb0xhc3REaXNjYXJkOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzdXJmYWNlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzd2l0Y2hUb0lzc3VlaXNoOiBQcm9wVHlwZXMuZnVuYyxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGF1dG9iaW5kKFxuICAgICAgdGhpcyxcbiAgICAgICdzZWxlY3RlZFJvd3NDaGFuZ2VkJyxcbiAgICAgICd1bmRvTGFzdERpc2NhcmQnLCAnZGl2ZUludG9NaXJyb3JQYXRjaCcsICdvcGVuRmlsZScsXG4gICAgICAndG9nZ2xlRmlsZScsICd0b2dnbGVSb3dzJywgJ3RvZ2dsZU1vZGVDaGFuZ2UnLCAndG9nZ2xlU3ltbGlua0NoYW5nZScsICdkaXNjYXJkUm93cycsXG4gICAgKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBzZWxlY3Rpb25Nb2RlOiAnaHVuaycsXG4gICAgICBzZWxlY3RlZFJvd3M6IG5ldyBTZXQoKSxcbiAgICAgIGhhc011bHRpcGxlRmlsZVNlbGVjdGlvbnM6IGZhbHNlLFxuICAgIH07XG5cbiAgICB0aGlzLm1vdXNlU2VsZWN0aW9uSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgIHRoaXMuc3RhZ2luZ09wZXJhdGlvbkluUHJvZ3Jlc3MgPSBmYWxzZTtcblxuICAgIHRoaXMubGFzdFBhdGNoU3RyaW5nID0gbnVsbDtcbiAgICB0aGlzLnBhdGNoQ2hhbmdlUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlUGF0Y2hDaGFuZ2VQcm9taXNlID0gcmVzb2x2ZTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLmxhc3RQYXRjaFN0cmluZyAhPT0gbnVsbCAmJlxuICAgICAgdGhpcy5sYXN0UGF0Y2hTdHJpbmcgIT09IHRoaXMucHJvcHMubXVsdGlGaWxlUGF0Y2gudG9TdHJpbmcoKVxuICAgICkge1xuICAgICAgdGhpcy5yZXNvbHZlUGF0Y2hDaGFuZ2VQcm9taXNlKCk7XG4gICAgICB0aGlzLnBhdGNoQ2hhbmdlUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICB0aGlzLnJlc29sdmVQYXRjaENoYW5nZVByb21pc2UgPSByZXNvbHZlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8TXVsdGlGaWxlUGF0Y2hWaWV3XG4gICAgICAgIHsuLi50aGlzLnByb3BzfVxuXG4gICAgICAgIHNlbGVjdGVkUm93cz17dGhpcy5zdGF0ZS5zZWxlY3RlZFJvd3N9XG4gICAgICAgIHNlbGVjdGlvbk1vZGU9e3RoaXMuc3RhdGUuc2VsZWN0aW9uTW9kZX1cbiAgICAgICAgaGFzTXVsdGlwbGVGaWxlU2VsZWN0aW9ucz17dGhpcy5zdGF0ZS5oYXNNdWx0aXBsZUZpbGVTZWxlY3Rpb25zfVxuICAgICAgICBzZWxlY3RlZFJvd3NDaGFuZ2VkPXt0aGlzLnNlbGVjdGVkUm93c0NoYW5nZWR9XG5cbiAgICAgICAgZGl2ZUludG9NaXJyb3JQYXRjaD17dGhpcy5kaXZlSW50b01pcnJvclBhdGNofVxuICAgICAgICBvcGVuRmlsZT17dGhpcy5vcGVuRmlsZX1cbiAgICAgICAgdG9nZ2xlRmlsZT17dGhpcy50b2dnbGVGaWxlfVxuICAgICAgICB0b2dnbGVSb3dzPXt0aGlzLnRvZ2dsZVJvd3N9XG4gICAgICAgIHRvZ2dsZU1vZGVDaGFuZ2U9e3RoaXMudG9nZ2xlTW9kZUNoYW5nZX1cbiAgICAgICAgdG9nZ2xlU3ltbGlua0NoYW5nZT17dGhpcy50b2dnbGVTeW1saW5rQ2hhbmdlfVxuICAgICAgICB1bmRvTGFzdERpc2NhcmQ9e3RoaXMudW5kb0xhc3REaXNjYXJkfVxuICAgICAgICBkaXNjYXJkUm93cz17dGhpcy5kaXNjYXJkUm93c31cbiAgICAgICAgc2VsZWN0TmV4dEh1bms9e3RoaXMuc2VsZWN0TmV4dEh1bmt9XG4gICAgICAgIHNlbGVjdFByZXZpb3VzSHVuaz17dGhpcy5zZWxlY3RQcmV2aW91c0h1bmt9XG4gICAgICAgIHN3aXRjaFRvSXNzdWVpc2g9e3RoaXMucHJvcHMuc3dpdGNoVG9Jc3N1ZWlzaH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHVuZG9MYXN0RGlzY2FyZChmaWxlUGF0Y2gsIHtldmVudFNvdXJjZX0gPSB7fSkge1xuICAgIGFkZEV2ZW50KCd1bmRvLWxhc3QtZGlzY2FyZCcsIHtcbiAgICAgIHBhY2thZ2U6ICdnaXRodWInLFxuICAgICAgY29tcG9uZW50OiB0aGlzLmNvbnN0cnVjdG9yLm5hbWUsXG4gICAgICBldmVudFNvdXJjZSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnByb3BzLnVuZG9MYXN0RGlzY2FyZChmaWxlUGF0Y2guZ2V0UGF0aCgpLCB0aGlzLnByb3BzLnJlcG9zaXRvcnkpO1xuICB9XG5cbiAgZGl2ZUludG9NaXJyb3JQYXRjaChmaWxlUGF0Y2gpIHtcbiAgICBjb25zdCBtaXJyb3JTdGF0dXMgPSB0aGlzLndpdGhTdGFnaW5nU3RhdHVzKHtzdGFnZWQ6ICd1bnN0YWdlZCcsIHVuc3RhZ2VkOiAnc3RhZ2VkJ30pO1xuICAgIGNvbnN0IHdvcmtpbmdEaXJlY3RvcnkgPSB0aGlzLnByb3BzLnJlcG9zaXRvcnkuZ2V0V29ya2luZ0RpcmVjdG9yeVBhdGgoKTtcbiAgICBjb25zdCB1cmkgPSBDaGFuZ2VkRmlsZUl0ZW0uYnVpbGRVUkkoZmlsZVBhdGNoLmdldFBhdGgoKSwgd29ya2luZ0RpcmVjdG9yeSwgbWlycm9yU3RhdHVzKTtcblxuICAgIHRoaXMucHJvcHMuZGVzdHJveSgpO1xuICAgIHJldHVybiB0aGlzLnByb3BzLndvcmtzcGFjZS5vcGVuKHVyaSk7XG4gIH1cblxuICBhc3luYyBvcGVuRmlsZShmaWxlUGF0Y2gsIHBvc2l0aW9ucywgcGVuZGluZykge1xuICAgIGNvbnN0IGFic29sdXRlUGF0aCA9IHBhdGguam9pbih0aGlzLnByb3BzLnJlcG9zaXRvcnkuZ2V0V29ya2luZ0RpcmVjdG9yeVBhdGgoKSwgZmlsZVBhdGNoLmdldFBhdGgoKSk7XG4gICAgY29uc3QgZWRpdG9yID0gYXdhaXQgdGhpcy5wcm9wcy53b3Jrc3BhY2Uub3BlbihhYnNvbHV0ZVBhdGgsIHtwZW5kaW5nfSk7XG4gICAgaWYgKHBvc2l0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24ocG9zaXRpb25zWzBdLCB7YXV0b3Njcm9sbDogZmFsc2V9KTtcbiAgICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgcG9zaXRpb25zLnNsaWNlKDEpKSB7XG4gICAgICAgIGVkaXRvci5hZGRDdXJzb3JBdEJ1ZmZlclBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgIH1cbiAgICAgIGVkaXRvci5zY3JvbGxUb0J1ZmZlclBvc2l0aW9uKHBvc2l0aW9uc1twb3NpdGlvbnMubGVuZ3RoIC0gMV0sIHtjZW50ZXI6IHRydWV9KTtcbiAgICB9XG4gICAgcmV0dXJuIGVkaXRvcjtcbiAgfVxuXG4gIHRvZ2dsZUZpbGUoZmlsZVBhdGNoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhZ2luZ09wZXJhdGlvbigoKSA9PiB7XG4gICAgICBjb25zdCBtZXRob2ROYW1lID0gdGhpcy53aXRoU3RhZ2luZ1N0YXR1cyh7c3RhZ2VkOiAndW5zdGFnZUZpbGVzJywgdW5zdGFnZWQ6ICdzdGFnZUZpbGVzJ30pO1xuICAgICAgcmV0dXJuIHRoaXMucHJvcHMucmVwb3NpdG9yeVttZXRob2ROYW1lXShbZmlsZVBhdGNoLmdldFBhdGgoKV0pO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgdG9nZ2xlUm93cyhyb3dTZXQsIG5leHRTZWxlY3Rpb25Nb2RlKSB7XG4gICAgbGV0IGNob3NlblJvd3MgPSByb3dTZXQ7XG4gICAgaWYgKGNob3NlblJvd3MpIHtcbiAgICAgIGNvbnN0IG5leHRNdWx0aXBsZUZpbGVTZWxlY3Rpb25zID0gdGhpcy5wcm9wcy5tdWx0aUZpbGVQYXRjaC5zcGFuc011bHRpcGxlRmlsZXMoY2hvc2VuUm93cyk7XG4gICAgICBhd2FpdCB0aGlzLnNlbGVjdGVkUm93c0NoYW5nZWQoY2hvc2VuUm93cywgbmV4dFNlbGVjdGlvbk1vZGUsIG5leHRNdWx0aXBsZUZpbGVTZWxlY3Rpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hvc2VuUm93cyA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRSb3dzO1xuICAgIH1cblxuICAgIGlmIChjaG9zZW5Sb3dzLnNpemUgPT09IDApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zdGFnaW5nT3BlcmF0aW9uKCgpID0+IHtcbiAgICAgIGNvbnN0IHBhdGNoID0gdGhpcy53aXRoU3RhZ2luZ1N0YXR1cyh7XG4gICAgICAgIHN0YWdlZDogKCkgPT4gdGhpcy5wcm9wcy5tdWx0aUZpbGVQYXRjaC5nZXRVbnN0YWdlUGF0Y2hGb3JMaW5lcyhjaG9zZW5Sb3dzKSxcbiAgICAgICAgdW5zdGFnZWQ6ICgpID0+IHRoaXMucHJvcHMubXVsdGlGaWxlUGF0Y2guZ2V0U3RhZ2VQYXRjaEZvckxpbmVzKGNob3NlblJvd3MpLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmFwcGx5UGF0Y2hUb0luZGV4KHBhdGNoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZU1vZGVDaGFuZ2UoZmlsZVBhdGNoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhZ2luZ09wZXJhdGlvbigoKSA9PiB7XG4gICAgICBjb25zdCB0YXJnZXRNb2RlID0gdGhpcy53aXRoU3RhZ2luZ1N0YXR1cyh7XG4gICAgICAgIHVuc3RhZ2VkOiBmaWxlUGF0Y2guZ2V0TmV3TW9kZSgpLFxuICAgICAgICBzdGFnZWQ6IGZpbGVQYXRjaC5nZXRPbGRNb2RlKCksXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLnJlcG9zaXRvcnkuc3RhZ2VGaWxlTW9kZUNoYW5nZShmaWxlUGF0Y2guZ2V0UGF0aCgpLCB0YXJnZXRNb2RlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZVN5bWxpbmtDaGFuZ2UoZmlsZVBhdGNoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhZ2luZ09wZXJhdGlvbigoKSA9PiB7XG4gICAgICBjb25zdCByZWxQYXRoID0gZmlsZVBhdGNoLmdldFBhdGgoKTtcbiAgICAgIGNvbnN0IHJlcG9zaXRvcnkgPSB0aGlzLnByb3BzLnJlcG9zaXRvcnk7XG4gICAgICByZXR1cm4gdGhpcy53aXRoU3RhZ2luZ1N0YXR1cyh7XG4gICAgICAgIHVuc3RhZ2VkOiAoKSA9PiB7XG4gICAgICAgICAgaWYgKGZpbGVQYXRjaC5oYXNUeXBlY2hhbmdlKCkgJiYgZmlsZVBhdGNoLmdldFN0YXR1cygpID09PSAnYWRkZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVwb3NpdG9yeS5zdGFnZUZpbGVTeW1saW5rQ2hhbmdlKHJlbFBhdGgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiByZXBvc2l0b3J5LnN0YWdlRmlsZXMoW3JlbFBhdGhdKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3RhZ2VkOiAoKSA9PiB7XG4gICAgICAgICAgaWYgKGZpbGVQYXRjaC5oYXNUeXBlY2hhbmdlKCkgJiYgZmlsZVBhdGNoLmdldFN0YXR1cygpID09PSAnZGVsZXRlZCcpIHtcbiAgICAgICAgICAgIHJldHVybiByZXBvc2l0b3J5LnN0YWdlRmlsZVN5bWxpbmtDaGFuZ2UocmVsUGF0aCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHJlcG9zaXRvcnkudW5zdGFnZUZpbGVzKFtyZWxQYXRoXSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRpc2NhcmRSb3dzKHJvd1NldCwgbmV4dFNlbGVjdGlvbk1vZGUsIHtldmVudFNvdXJjZX0gPSB7fSkge1xuICAgIC8vIChrdXljaGFjbykgRm9yIG5vdyB3ZSBvbmx5IHN1cHBvcnQgZGlzY2FyZGluZyByb3dzIGZvciBNdWx0aUZpbGVQYXRjaGVzIHRoYXQgY29udGFpbiBhIHNpbmdsZSBmaWxlIHBhdGNoXG4gICAgLy8gVGhlIG9ubHkgd2F5IHRvIGFjY2VzcyB0aGlzIG1ldGhvZCBmcm9tIHRoZSBVSSBpcyB0byBiZSBpbiBhIENoYW5nZWRGaWxlSXRlbSwgd2hpY2ggb25seSBoYXMgYSBzaW5nbGUgZmlsZSBwYXRjaFxuICAgIC8vIFRoaXMgY2hlY2sgaXMgZHVwbGljYXRlZCBpbiBSb290Q29udHJvbGxlciNkaXNjYXJkTGluZXMuIFdlIGFsc28gd2FudCBpdCBoZXJlIHRvIHByZXZlbnQgdXMgZnJvbSBzZW5kaW5nIG1ldHJpY3NcbiAgICAvLyB1bm5lY2Vzc2FyaWx5XG4gICAgaWYgKHRoaXMucHJvcHMubXVsdGlGaWxlUGF0Y2guZ2V0RmlsZVBhdGNoZXMoKS5sZW5ndGggIT09IDEpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuXG4gICAgbGV0IGNob3NlblJvd3MgPSByb3dTZXQ7XG4gICAgaWYgKGNob3NlblJvd3MpIHtcbiAgICAgIGNvbnN0IG5leHRNdWx0aXBsZUZpbGVTZWxlY3Rpb25zID0gdGhpcy5wcm9wcy5tdWx0aUZpbGVQYXRjaC5zcGFuc011bHRpcGxlRmlsZXMoY2hvc2VuUm93cyk7XG4gICAgICBhd2FpdCB0aGlzLnNlbGVjdGVkUm93c0NoYW5nZWQoY2hvc2VuUm93cywgbmV4dFNlbGVjdGlvbk1vZGUsIG5leHRNdWx0aXBsZUZpbGVTZWxlY3Rpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hvc2VuUm93cyA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRSb3dzO1xuICAgIH1cblxuICAgIGFkZEV2ZW50KCdkaXNjYXJkLXVuc3RhZ2VkLWNoYW5nZXMnLCB7XG4gICAgICBwYWNrYWdlOiAnZ2l0aHViJyxcbiAgICAgIGNvbXBvbmVudDogdGhpcy5jb25zdHJ1Y3Rvci5uYW1lLFxuICAgICAgbGluZUNvdW50OiBjaG9zZW5Sb3dzLnNpemUsXG4gICAgICBldmVudFNvdXJjZSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnByb3BzLmRpc2NhcmRMaW5lcyh0aGlzLnByb3BzLm11bHRpRmlsZVBhdGNoLCBjaG9zZW5Sb3dzLCB0aGlzLnByb3BzLnJlcG9zaXRvcnkpO1xuICB9XG5cbiAgc2VsZWN0ZWRSb3dzQ2hhbmdlZChyb3dzLCBuZXh0U2VsZWN0aW9uTW9kZSwgbmV4dE11bHRpcGxlRmlsZVNlbGVjdGlvbnMpIHtcbiAgICBpZiAoXG4gICAgICBlcXVhbFNldHModGhpcy5zdGF0ZS5zZWxlY3RlZFJvd3MsIHJvd3MpICYmXG4gICAgICB0aGlzLnN0YXRlLnNlbGVjdGlvbk1vZGUgPT09IG5leHRTZWxlY3Rpb25Nb2RlICYmXG4gICAgICB0aGlzLnN0YXRlLmhhc011bHRpcGxlRmlsZVNlbGVjdGlvbnMgPT09IG5leHRNdWx0aXBsZUZpbGVTZWxlY3Rpb25zXG4gICAgKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHNlbGVjdGVkUm93czogcm93cyxcbiAgICAgICAgc2VsZWN0aW9uTW9kZTogbmV4dFNlbGVjdGlvbk1vZGUsXG4gICAgICAgIGhhc011bHRpcGxlRmlsZVNlbGVjdGlvbnM6IG5leHRNdWx0aXBsZUZpbGVTZWxlY3Rpb25zLFxuICAgICAgfSwgcmVzb2x2ZSk7XG4gICAgfSk7XG4gIH1cblxuICB3aXRoU3RhZ2luZ1N0YXR1cyhjYWxsYmFja3MpIHtcbiAgICBjb25zdCBjYWxsYmFjayA9IGNhbGxiYWNrc1t0aGlzLnByb3BzLnN0YWdpbmdTdGF0dXNdO1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmICghY2FsbGJhY2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBzdGFnaW5nIHN0YXR1czogJHt0aGlzLnByb3BzLnN0YWdpbmdTdGF0dXN9YCk7XG4gICAgfVxuICAgIHJldHVybiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gY2FsbGJhY2soKSA6IGNhbGxiYWNrO1xuICB9XG5cbiAgc3RhZ2luZ09wZXJhdGlvbihmbikge1xuICAgIGlmICh0aGlzLnN0YWdpbmdPcGVyYXRpb25JblByb2dyZXNzKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLnN0YWdpbmdPcGVyYXRpb25JblByb2dyZXNzID0gdHJ1ZTtcbiAgICB0aGlzLmxhc3RQYXRjaFN0cmluZyA9IHRoaXMucHJvcHMubXVsdGlGaWxlUGF0Y2gudG9TdHJpbmcoKTtcbiAgICBjb25zdCBvcGVyYXRpb25Qcm9taXNlID0gZm4oKTtcblxuICAgIG9wZXJhdGlvblByb21pc2VcbiAgICAgIC50aGVuKCgpID0+IHRoaXMucGF0Y2hDaGFuZ2VQcm9taXNlKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLnN0YWdpbmdPcGVyYXRpb25JblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGFzdFBhdGNoU3RyaW5nID0g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