"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.COMMIT_GRAMMAR_SCOPE = void 0;
var _path = _interopRequireDefault(require("path"));
var _atom = require("atom");
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _fsExtra = _interopRequireDefault(require("fs-extra"));
var _commitView = _interopRequireDefault(require("../views/commit-view"));
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
var _commitPreviewItem = _interopRequireDefault(require("../items/commit-preview-item"));
var _propTypes2 = require("../prop-types");
var _watchWorkspaceItem = require("../watch-workspace-item");
var _helpers = require("../helpers");
var _reporterProxy = require("../reporter-proxy");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const COMMIT_GRAMMAR_SCOPE = 'text.git-commit';
exports.COMMIT_GRAMMAR_SCOPE = COMMIT_GRAMMAR_SCOPE;
class CommitController extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "activateCommitPreview", () => {
      const uri = _commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath());
      return this.props.workspace.open(uri, {
        searchAllPanes: true,
        pending: true,
        activate: true
      });
    });
    (0, _helpers.autobind)(this, 'commit', 'handleMessageChange', 'toggleExpandedCommitMessageEditor', 'grammarAdded', 'toggleCommitPreview');
    this.subscriptions = new _eventKit.CompositeDisposable();
    this.refCommitView = new _refHolder.default();
    this.commitMessageBuffer = new _atom.TextBuffer({
      text: this.props.repository.getCommitMessage()
    });
    this.subscriptions.add(this.commitMessageBuffer.onDidChange(this.handleMessageChange));
    this.previewWatcher = (0, _watchWorkspaceItem.watchWorkspaceItem)(this.props.workspace, _commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath()), this, 'commitPreviewActive');
    this.subscriptions.add(this.previewWatcher);
  }
  componentDidMount() {
    this.subscriptions.add(this.props.workspace.onDidAddTextEditor(({
      textEditor
    }) => {
      if (this.props.repository.isPresent() && textEditor.getPath() === this.getCommitMessagePath()) {
        const grammar = this.props.grammars.grammarForScopeName(COMMIT_GRAMMAR_SCOPE);
        if (grammar) {
          textEditor.setGrammar(grammar);
        }
      }
    }), this.props.workspace.onDidDestroyPaneItem(async ({
      item
    }) => {
      if (this.props.repository.isPresent() && item.getPath && item.getPath() === this.getCommitMessagePath() && this.getCommitMessageEditors().length === 0) {
        // we closed the last editor pointing to the commit message file
        try {
          this.commitMessageBuffer.setText(await _fsExtra.default.readFile(this.getCommitMessagePath(), {
            encoding: 'utf8'
          }));
        } catch (e) {
          if (e.code !== 'ENOENT') {
            throw e;
          }
        }
      }
    }));
  }
  render() {
    const operationStates = this.props.repository.getOperationStates();
    return _react.default.createElement(_commitView.default, {
      ref: this.refCommitView.setter,
      workspace: this.props.workspace,
      tooltips: this.props.tooltips,
      config: this.props.config,
      stagedChangesExist: this.props.stagedChangesExist,
      mergeConflictsExist: this.props.mergeConflictsExist,
      prepareToCommit: this.props.prepareToCommit,
      commit: this.commit,
      abortMerge: this.props.abortMerge,
      commands: this.props.commands,
      maximumCharacterLimit: 72,
      messageBuffer: this.commitMessageBuffer,
      isMerging: this.props.isMerging,
      isCommitting: operationStates.isCommitInProgress(),
      lastCommit: this.props.lastCommit,
      currentBranch: this.props.currentBranch,
      toggleExpandedCommitMessageEditor: this.toggleExpandedCommitMessageEditor,
      deactivateCommitBox: this.isCommitMessageEditorExpanded(),
      userStore: this.props.userStore,
      selectedCoAuthors: this.props.selectedCoAuthors,
      updateSelectedCoAuthors: this.props.updateSelectedCoAuthors,
      toggleCommitPreview: this.toggleCommitPreview,
      activateCommitPreview: this.activateCommitPreview,
      commitPreviewActive: this.state.commitPreviewActive
    });
  }
  componentDidUpdate(prevProps) {
    this.commitMessageBuffer.setTextViaDiff(this.getCommitMessage());
    if (prevProps.repository !== this.props.repository) {
      this.previewWatcher.setPattern(_commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath()));
    }
  }
  componentWillUnmount() {
    this.subscriptions.dispose();
  }
  commit(message, coAuthors = [], amend = false) {
    let msg, verbatim;
    if (this.isCommitMessageEditorExpanded()) {
      msg = this.getCommitMessageEditors()[0].getText();
      verbatim = false;
    } else {
      const wrapMessage = this.props.config.get('github.automaticCommitMessageWrapping');
      msg = wrapMessage ? wrapCommitMessage(message) : message;
      verbatim = true;
    }
    return this.props.commit(msg.trim(), {
      amend,
      coAuthors,
      verbatim
    });
  }
  setCommitMessage(message, options) {
    if (!this.props.repository.isPresent()) {
      return;
    }
    this.props.repository.setCommitMessage(message, options);
  }
  getCommitMessage() {
    return this.props.repository.getCommitMessage();
  }
  getCommitMessagePath() {
    return _path.default.join(this.props.repository.getGitDirectoryPath(), 'ATOM_COMMIT_EDITMSG');
  }
  handleMessageChange() {
    if (!this.props.repository.isPresent()) {
      return;
    }
    this.setCommitMessage(this.commitMessageBuffer.getText(), {
      suppressUpdate: true
    });
  }
  getCommitMessageEditors() {
    if (!this.props.repository.isPresent()) {
      return [];
    }
    return this.props.workspace.getTextEditors().filter(editor => editor.getPath() === this.getCommitMessagePath());
  }
  async toggleExpandedCommitMessageEditor(messageFromBox) {
    if (this.isCommitMessageEditorExpanded()) {
      if (this.commitMessageEditorIsInForeground()) {
        await this.closeAllOpenCommitMessageEditors();
        this.forceUpdate();
      } else {
        this.activateCommitMessageEditor();
      }
    } else {
      await this.openCommitMessageEditor(messageFromBox);
      this.forceUpdate();
    }
  }
  isCommitMessageEditorExpanded() {
    return this.getCommitMessageEditors().length > 0;
  }
  commitMessageEditorIsInForeground() {
    const commitMessageEditorsInForeground = this.props.workspace.getPanes().map(pane => pane.getActiveItem()).filter(item => item && item.getPath && item.getPath() === this.getCommitMessagePath());
    return commitMessageEditorsInForeground.length > 0;
  }
  activateCommitMessageEditor() {
    const panes = this.props.workspace.getPanes();
    let editor;
    const paneWithEditor = panes.find(pane => {
      editor = pane.getItems().find(item => item.getPath && item.getPath() === this.getCommitMessagePath());
      return !!editor;
    });
    paneWithEditor.activate();
    paneWithEditor.activateItem(editor);
  }
  closeAllOpenCommitMessageEditors() {
    return Promise.all(this.props.workspace.getPanes().map(pane => {
      return Promise.all(pane.getItems().map(async item => {
        if (item && item.getPath && item.getPath() === this.getCommitMessagePath()) {
          const destroyed = await pane.destroyItem(item);
          if (!destroyed) {
            pane.activateItem(item);
          }
        }
      }));
    }));
  }
  async openCommitMessageEditor(messageFromBox) {
    await _fsExtra.default.writeFile(this.getCommitMessagePath(), messageFromBox, 'utf8');
    const commitEditor = await this.props.workspace.open(this.getCommitMessagePath());
    (0, _reporterProxy.addEvent)('open-commit-message-editor', {
      package: 'github'
    });
    const grammar = this.props.grammars.grammarForScopeName(COMMIT_GRAMMAR_SCOPE);
    if (grammar) {
      commitEditor.setGrammar(grammar);
    } else {
      this.grammarSubscription = this.props.grammars.onDidAddGrammar(this.grammarAdded);
      this.subscriptions.add(this.grammarSubscription);
    }
  }
  grammarAdded(grammar) {
    if (grammar.scopeName !== COMMIT_GRAMMAR_SCOPE) {
      return;
    }
    this.getCommitMessageEditors().forEach(editor => editor.setGrammar(grammar));
    this.grammarSubscription.dispose();
  }
  getFocus(element) {
    return this.refCommitView.map(view => view.getFocus(element)).getOr(null);
  }
  setFocus(focus) {
    return this.refCommitView.map(view => view.setFocus(focus)).getOr(false);
  }
  advanceFocusFrom(...args) {
    return this.refCommitView.map(view => view.advanceFocusFrom(...args)).getOr(false);
  }
  retreatFocusFrom(...args) {
    return this.refCommitView.map(view => view.retreatFocusFrom(...args)).getOr(false);
  }
  toggleCommitPreview() {
    (0, _reporterProxy.addEvent)('toggle-commit-preview', {
      package: 'github'
    });
    const uri = _commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath());
    if (this.props.workspace.hide(uri)) {
      return Promise.resolve();
    } else {
      return this.props.workspace.open(uri, {
        searchAllPanes: true,
        pending: true
      });
    }
  }
}
exports.default = CommitController;
_defineProperty(CommitController, "focus", _objectSpread({}, _commitView.default.focus));
_defineProperty(CommitController, "propTypes", {
  workspace: _propTypes.default.object.isRequired,
  grammars: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  config: _propTypes.default.object.isRequired,
  tooltips: _propTypes.default.object.isRequired,
  repository: _propTypes.default.object.isRequired,
  isMerging: _propTypes.default.bool.isRequired,
  mergeConflictsExist: _propTypes.default.bool.isRequired,
  stagedChangesExist: _propTypes.default.bool.isRequired,
  lastCommit: _propTypes.default.object.isRequired,
  currentBranch: _propTypes.default.object.isRequired,
  userStore: _propTypes2.UserStorePropType.isRequired,
  selectedCoAuthors: _propTypes.default.arrayOf(_propTypes2.AuthorPropType),
  updateSelectedCoAuthors: _propTypes.default.func,
  prepareToCommit: _propTypes.default.func.isRequired,
  commit: _propTypes.default.func.isRequired,
  abortMerge: _propTypes.default.func.isRequired
});
function wrapCommitMessage(message) {
  // hard wrap message (except for first line) at 72 characters
  let results = [];
  message.split('\n').forEach((line, index) => {
    if (line.length <= 72 || index === 0) {
      results.push(line);
    } else {
      const matches = line.match(/.{1,72}(\s|$)|\S+?(\s|$)/g).map(match => {
        return match.endsWith('\n') ? match.substr(0, match.length - 1) : match;
      });
      results = results.concat(matches);
    }
  });
  return results.join('\n');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcGF0aCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2F0b20iLCJfcmVhY3QiLCJfcHJvcFR5cGVzIiwiX2V2ZW50S2l0IiwiX2ZzRXh0cmEiLCJfY29tbWl0VmlldyIsIl9yZWZIb2xkZXIiLCJfY29tbWl0UHJldmlld0l0ZW0iLCJfcHJvcFR5cGVzMiIsIl93YXRjaFdvcmtzcGFjZUl0ZW0iLCJfaGVscGVycyIsIl9yZXBvcnRlclByb3h5Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJvd25LZXlzIiwiZSIsInIiLCJ0IiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsIm8iLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiY2FsbCIsIlR5cGVFcnJvciIsIk51bWJlciIsIkNPTU1JVF9HUkFNTUFSX1NDT1BFIiwiZXhwb3J0cyIsIkNvbW1pdENvbnRyb2xsZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjb250ZXh0IiwidXJpIiwiQ29tbWl0UHJldmlld0l0ZW0iLCJidWlsZFVSSSIsInJlcG9zaXRvcnkiLCJnZXRXb3JraW5nRGlyZWN0b3J5UGF0aCIsIndvcmtzcGFjZSIsIm9wZW4iLCJzZWFyY2hBbGxQYW5lcyIsInBlbmRpbmciLCJhY3RpdmF0ZSIsImF1dG9iaW5kIiwic3Vic2NyaXB0aW9ucyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJyZWZDb21taXRWaWV3IiwiUmVmSG9sZGVyIiwiY29tbWl0TWVzc2FnZUJ1ZmZlciIsIlRleHRCdWZmZXIiLCJ0ZXh0IiwiZ2V0Q29tbWl0TWVzc2FnZSIsImFkZCIsIm9uRGlkQ2hhbmdlIiwiaGFuZGxlTWVzc2FnZUNoYW5nZSIsInByZXZpZXdXYXRjaGVyIiwid2F0Y2hXb3Jrc3BhY2VJdGVtIiwiY29tcG9uZW50RGlkTW91bnQiLCJvbkRpZEFkZFRleHRFZGl0b3IiLCJ0ZXh0RWRpdG9yIiwiaXNQcmVzZW50IiwiZ2V0UGF0aCIsImdldENvbW1pdE1lc3NhZ2VQYXRoIiwiZ3JhbW1hciIsImdyYW1tYXJzIiwiZ3JhbW1hckZvclNjb3BlTmFtZSIsInNldEdyYW1tYXIiLCJvbkRpZERlc3Ryb3lQYW5lSXRlbSIsIml0ZW0iLCJnZXRDb21taXRNZXNzYWdlRWRpdG9ycyIsInNldFRleHQiLCJmcyIsInJlYWRGaWxlIiwiZW5jb2RpbmciLCJjb2RlIiwicmVuZGVyIiwib3BlcmF0aW9uU3RhdGVzIiwiZ2V0T3BlcmF0aW9uU3RhdGVzIiwiY3JlYXRlRWxlbWVudCIsInJlZiIsInNldHRlciIsInRvb2x0aXBzIiwiY29uZmlnIiwic3RhZ2VkQ2hhbmdlc0V4aXN0IiwibWVyZ2VDb25mbGljdHNFeGlzdCIsInByZXBhcmVUb0NvbW1pdCIsImNvbW1pdCIsImFib3J0TWVyZ2UiLCJjb21tYW5kcyIsIm1heGltdW1DaGFyYWN0ZXJMaW1pdCIsIm1lc3NhZ2VCdWZmZXIiLCJpc01lcmdpbmciLCJpc0NvbW1pdHRpbmciLCJpc0NvbW1pdEluUHJvZ3Jlc3MiLCJsYXN0Q29tbWl0IiwiY3VycmVudEJyYW5jaCIsInRvZ2dsZUV4cGFuZGVkQ29tbWl0TWVzc2FnZUVkaXRvciIsImRlYWN0aXZhdGVDb21taXRCb3giLCJpc0NvbW1pdE1lc3NhZ2VFZGl0b3JFeHBhbmRlZCIsInVzZXJTdG9yZSIsInNlbGVjdGVkQ29BdXRob3JzIiwidXBkYXRlU2VsZWN0ZWRDb0F1dGhvcnMiLCJ0b2dnbGVDb21taXRQcmV2aWV3IiwiYWN0aXZhdGVDb21taXRQcmV2aWV3IiwiY29tbWl0UHJldmlld0FjdGl2ZSIsInN0YXRlIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwic2V0VGV4dFZpYURpZmYiLCJzZXRQYXR0ZXJuIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwibWVzc2FnZSIsImNvQXV0aG9ycyIsImFtZW5kIiwibXNnIiwidmVyYmF0aW0iLCJnZXRUZXh0Iiwid3JhcE1lc3NhZ2UiLCJnZXQiLCJ3cmFwQ29tbWl0TWVzc2FnZSIsInRyaW0iLCJzZXRDb21taXRNZXNzYWdlIiwib3B0aW9ucyIsInBhdGgiLCJqb2luIiwiZ2V0R2l0RGlyZWN0b3J5UGF0aCIsInN1cHByZXNzVXBkYXRlIiwiZ2V0VGV4dEVkaXRvcnMiLCJlZGl0b3IiLCJtZXNzYWdlRnJvbUJveCIsImNvbW1pdE1lc3NhZ2VFZGl0b3JJc0luRm9yZWdyb3VuZCIsImNsb3NlQWxsT3BlbkNvbW1pdE1lc3NhZ2VFZGl0b3JzIiwiZm9yY2VVcGRhdGUiLCJhY3RpdmF0ZUNvbW1pdE1lc3NhZ2VFZGl0b3IiLCJvcGVuQ29tbWl0TWVzc2FnZUVkaXRvciIsImNvbW1pdE1lc3NhZ2VFZGl0b3JzSW5Gb3JlZ3JvdW5kIiwiZ2V0UGFuZXMiLCJtYXAiLCJwYW5lIiwiZ2V0QWN0aXZlSXRlbSIsInBhbmVzIiwicGFuZVdpdGhFZGl0b3IiLCJmaW5kIiwiZ2V0SXRlbXMiLCJhY3RpdmF0ZUl0ZW0iLCJQcm9taXNlIiwiYWxsIiwiZGVzdHJveWVkIiwiZGVzdHJveUl0ZW0iLCJ3cml0ZUZpbGUiLCJjb21taXRFZGl0b3IiLCJhZGRFdmVudCIsInBhY2thZ2UiLCJncmFtbWFyU3Vic2NyaXB0aW9uIiwib25EaWRBZGRHcmFtbWFyIiwiZ3JhbW1hckFkZGVkIiwic2NvcGVOYW1lIiwiZ2V0Rm9jdXMiLCJlbGVtZW50IiwidmlldyIsImdldE9yIiwic2V0Rm9jdXMiLCJmb2N1cyIsImFkdmFuY2VGb2N1c0Zyb20iLCJhcmdzIiwicmV0cmVhdEZvY3VzRnJvbSIsImhpZGUiLCJyZXNvbHZlIiwiQ29tbWl0VmlldyIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJib29sIiwiVXNlclN0b3JlUHJvcFR5cGUiLCJhcnJheU9mIiwiQXV0aG9yUHJvcFR5cGUiLCJmdW5jIiwicmVzdWx0cyIsInNwbGl0IiwibGluZSIsImluZGV4IiwibWF0Y2hlcyIsIm1hdGNoIiwiZW5kc1dpdGgiLCJzdWJzdHIiLCJjb25jYXQiXSwic291cmNlcyI6WyJjb21taXQtY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7VGV4dEJ1ZmZlcn0gZnJvbSAnYXRvbSc7XG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcblxuaW1wb3J0IENvbW1pdFZpZXcgZnJvbSAnLi4vdmlld3MvY29tbWl0LXZpZXcnO1xuaW1wb3J0IFJlZkhvbGRlciBmcm9tICcuLi9tb2RlbHMvcmVmLWhvbGRlcic7XG5pbXBvcnQgQ29tbWl0UHJldmlld0l0ZW0gZnJvbSAnLi4vaXRlbXMvY29tbWl0LXByZXZpZXctaXRlbSc7XG5pbXBvcnQge0F1dGhvclByb3BUeXBlLCBVc2VyU3RvcmVQcm9wVHlwZX0gZnJvbSAnLi4vcHJvcC10eXBlcyc7XG5pbXBvcnQge3dhdGNoV29ya3NwYWNlSXRlbX0gZnJvbSAnLi4vd2F0Y2gtd29ya3NwYWNlLWl0ZW0nO1xuaW1wb3J0IHthdXRvYmluZH0gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQge2FkZEV2ZW50fSBmcm9tICcuLi9yZXBvcnRlci1wcm94eSc7XG5cbmV4cG9ydCBjb25zdCBDT01NSVRfR1JBTU1BUl9TQ09QRSA9ICd0ZXh0LmdpdC1jb21taXQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21taXRDb250cm9sbGVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIGZvY3VzID0ge1xuICAgIC4uLkNvbW1pdFZpZXcuZm9jdXMsXG4gIH1cblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHdvcmtzcGFjZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGdyYW1tYXJzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY29tbWFuZHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBjb25maWc6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB0b29sdGlwczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuXG4gICAgcmVwb3NpdG9yeTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGlzTWVyZ2luZzogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBtZXJnZUNvbmZsaWN0c0V4aXN0OiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIHN0YWdlZENoYW5nZXNFeGlzdDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBsYXN0Q29tbWl0OiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY3VycmVudEJyYW5jaDogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHVzZXJTdG9yZTogVXNlclN0b3JlUHJvcFR5cGUuaXNSZXF1aXJlZCxcbiAgICBzZWxlY3RlZENvQXV0aG9yczogUHJvcFR5cGVzLmFycmF5T2YoQXV0aG9yUHJvcFR5cGUpLFxuICAgIHVwZGF0ZVNlbGVjdGVkQ29BdXRob3JzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBwcmVwYXJlVG9Db21taXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY29tbWl0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGFib3J0TWVyZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcywgY29udGV4dCkge1xuICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcbiAgICBhdXRvYmluZCh0aGlzLCAnY29tbWl0JywgJ2hhbmRsZU1lc3NhZ2VDaGFuZ2UnLCAndG9nZ2xlRXhwYW5kZWRDb21taXRNZXNzYWdlRWRpdG9yJywgJ2dyYW1tYXJBZGRlZCcsXG4gICAgICAndG9nZ2xlQ29tbWl0UHJldmlldycpO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICB0aGlzLnJlZkNvbW1pdFZpZXcgPSBuZXcgUmVmSG9sZGVyKCk7XG5cbiAgICB0aGlzLmNvbW1pdE1lc3NhZ2VCdWZmZXIgPSBuZXcgVGV4dEJ1ZmZlcih7dGV4dDogdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmdldENvbW1pdE1lc3NhZ2UoKX0pO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQoXG4gICAgICB0aGlzLmNvbW1pdE1lc3NhZ2VCdWZmZXIub25EaWRDaGFuZ2UodGhpcy5oYW5kbGVNZXNzYWdlQ2hhbmdlKSxcbiAgICApO1xuXG4gICAgdGhpcy5wcmV2aWV3V2F0Y2hlciA9IHdhdGNoV29ya3NwYWNlSXRlbShcbiAgICAgIHRoaXMucHJvcHMud29ya3NwYWNlLFxuICAgICAgQ29tbWl0UHJldmlld0l0ZW0uYnVpbGRVUkkodGhpcy5wcm9wcy5yZXBvc2l0b3J5LmdldFdvcmtpbmdEaXJlY3RvcnlQYXRoKCkpLFxuICAgICAgdGhpcyxcbiAgICAgICdjb21taXRQcmV2aWV3QWN0aXZlJyxcbiAgICApO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5wcmV2aWV3V2F0Y2hlcik7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKFxuICAgICAgdGhpcy5wcm9wcy53b3Jrc3BhY2Uub25EaWRBZGRUZXh0RWRpdG9yKCh7dGV4dEVkaXRvcn0pID0+IHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMucmVwb3NpdG9yeS5pc1ByZXNlbnQoKSAmJiB0ZXh0RWRpdG9yLmdldFBhdGgoKSA9PT0gdGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpKSB7XG4gICAgICAgICAgY29uc3QgZ3JhbW1hciA9IHRoaXMucHJvcHMuZ3JhbW1hcnMuZ3JhbW1hckZvclNjb3BlTmFtZShDT01NSVRfR1JBTU1BUl9TQ09QRSk7XG4gICAgICAgICAgaWYgKGdyYW1tYXIpIHtcbiAgICAgICAgICAgIHRleHRFZGl0b3Iuc2V0R3JhbW1hcihncmFtbWFyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgdGhpcy5wcm9wcy53b3Jrc3BhY2Uub25EaWREZXN0cm95UGFuZUl0ZW0oYXN5bmMgKHtpdGVtfSkgPT4ge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5yZXBvc2l0b3J5LmlzUHJlc2VudCgpICYmIGl0ZW0uZ2V0UGF0aCAmJiBpdGVtLmdldFBhdGgoKSA9PT0gdGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpICYmXG4gICAgICAgICAgdGhpcy5nZXRDb21taXRNZXNzYWdlRWRpdG9ycygpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIC8vIHdlIGNsb3NlZCB0aGUgbGFzdCBlZGl0b3IgcG9pbnRpbmcgdG8gdGhlIGNvbW1pdCBtZXNzYWdlIGZpbGVcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5jb21taXRNZXNzYWdlQnVmZmVyLnNldFRleHQoYXdhaXQgZnMucmVhZEZpbGUodGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpLCB7ZW5jb2Rpbmc6ICd1dGY4J30pKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5jb2RlICE9PSAnRU5PRU5UJykge1xuICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBvcGVyYXRpb25TdGF0ZXMgPSB0aGlzLnByb3BzLnJlcG9zaXRvcnkuZ2V0T3BlcmF0aW9uU3RhdGVzKCk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbW1pdFZpZXdcbiAgICAgICAgcmVmPXt0aGlzLnJlZkNvbW1pdFZpZXcuc2V0dGVyfVxuICAgICAgICB3b3Jrc3BhY2U9e3RoaXMucHJvcHMud29ya3NwYWNlfVxuICAgICAgICB0b29sdGlwcz17dGhpcy5wcm9wcy50b29sdGlwc31cbiAgICAgICAgY29uZmlnPXt0aGlzLnByb3BzLmNvbmZpZ31cbiAgICAgICAgc3RhZ2VkQ2hhbmdlc0V4aXN0PXt0aGlzLnByb3BzLnN0YWdlZENoYW5nZXNFeGlzdH1cbiAgICAgICAgbWVyZ2VDb25mbGljdHNFeGlzdD17dGhpcy5wcm9wcy5tZXJnZUNvbmZsaWN0c0V4aXN0fVxuICAgICAgICBwcmVwYXJlVG9Db21taXQ9e3RoaXMucHJvcHMucHJlcGFyZVRvQ29tbWl0fVxuICAgICAgICBjb21taXQ9e3RoaXMuY29tbWl0fVxuICAgICAgICBhYm9ydE1lcmdlPXt0aGlzLnByb3BzLmFib3J0TWVyZ2V9XG4gICAgICAgIGNvbW1hbmRzPXt0aGlzLnByb3BzLmNvbW1hbmRzfVxuICAgICAgICBtYXhpbXVtQ2hhcmFjdGVyTGltaXQ9ezcyfVxuICAgICAgICBtZXNzYWdlQnVmZmVyPXt0aGlzLmNvbW1pdE1lc3NhZ2VCdWZmZXJ9XG4gICAgICAgIGlzTWVyZ2luZz17dGhpcy5wcm9wcy5pc01lcmdpbmd9XG4gICAgICAgIGlzQ29tbWl0dGluZz17b3BlcmF0aW9uU3RhdGVzLmlzQ29tbWl0SW5Qcm9ncmVzcygpfVxuICAgICAgICBsYXN0Q29tbWl0PXt0aGlzLnByb3BzLmxhc3RDb21taXR9XG4gICAgICAgIGN1cnJlbnRCcmFuY2g9e3RoaXMucHJvcHMuY3VycmVudEJyYW5jaH1cbiAgICAgICAgdG9nZ2xlRXhwYW5kZWRDb21taXRNZXNzYWdlRWRpdG9yPXt0aGlzLnRvZ2dsZUV4cGFuZGVkQ29tbWl0TWVzc2FnZUVkaXRvcn1cbiAgICAgICAgZGVhY3RpdmF0ZUNvbW1pdEJveD17dGhpcy5pc0NvbW1pdE1lc3NhZ2VFZGl0b3JFeHBhbmRlZCgpfVxuICAgICAgICB1c2VyU3RvcmU9e3RoaXMucHJvcHMudXNlclN0b3JlfVxuICAgICAgICBzZWxlY3RlZENvQXV0aG9ycz17dGhpcy5wcm9wcy5zZWxlY3RlZENvQXV0aG9yc31cbiAgICAgICAgdXBkYXRlU2VsZWN0ZWRDb0F1dGhvcnM9e3RoaXMucHJvcHMudXBkYXRlU2VsZWN0ZWRDb0F1dGhvcnN9XG4gICAgICAgIHRvZ2dsZUNvbW1pdFByZXZpZXc9e3RoaXMudG9nZ2xlQ29tbWl0UHJldmlld31cbiAgICAgICAgYWN0aXZhdGVDb21taXRQcmV2aWV3PXt0aGlzLmFjdGl2YXRlQ29tbWl0UHJldmlld31cbiAgICAgICAgY29tbWl0UHJldmlld0FjdGl2ZT17dGhpcy5zdGF0ZS5jb21taXRQcmV2aWV3QWN0aXZlfVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIHRoaXMuY29tbWl0TWVzc2FnZUJ1ZmZlci5zZXRUZXh0VmlhRGlmZih0aGlzLmdldENvbW1pdE1lc3NhZ2UoKSk7XG5cbiAgICBpZiAocHJldlByb3BzLnJlcG9zaXRvcnkgIT09IHRoaXMucHJvcHMucmVwb3NpdG9yeSkge1xuICAgICAgdGhpcy5wcmV2aWV3V2F0Y2hlci5zZXRQYXR0ZXJuKFxuICAgICAgICBDb21taXRQcmV2aWV3SXRlbS5idWlsZFVSSSh0aGlzLnByb3BzLnJlcG9zaXRvcnkuZ2V0V29ya2luZ0RpcmVjdG9yeVBhdGgoKSksXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5kaXNwb3NlKCk7XG4gIH1cblxuICBjb21taXQobWVzc2FnZSwgY29BdXRob3JzID0gW10sIGFtZW5kID0gZmFsc2UpIHtcbiAgICBsZXQgbXNnLCB2ZXJiYXRpbTtcbiAgICBpZiAodGhpcy5pc0NvbW1pdE1lc3NhZ2VFZGl0b3JFeHBhbmRlZCgpKSB7XG4gICAgICBtc2cgPSB0aGlzLmdldENvbW1pdE1lc3NhZ2VFZGl0b3JzKClbMF0uZ2V0VGV4dCgpO1xuICAgICAgdmVyYmF0aW0gPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgd3JhcE1lc3NhZ2UgPSB0aGlzLnByb3BzLmNvbmZpZy5nZXQoJ2dpdGh1Yi5hdXRvbWF0aWNDb21taXRNZXNzYWdlV3JhcHBpbmcnKTtcbiAgICAgIG1zZyA9IHdyYXBNZXNzYWdlID8gd3JhcENvbW1pdE1lc3NhZ2UobWVzc2FnZSkgOiBtZXNzYWdlO1xuICAgICAgdmVyYmF0aW0gPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnByb3BzLmNvbW1pdChtc2cudHJpbSgpLCB7YW1lbmQsIGNvQXV0aG9ycywgdmVyYmF0aW19KTtcbiAgfVxuXG4gIHNldENvbW1pdE1lc3NhZ2UobWVzc2FnZSwgb3B0aW9ucykge1xuICAgIGlmICghdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmlzUHJlc2VudCgpKSB7IHJldHVybjsgfVxuICAgIHRoaXMucHJvcHMucmVwb3NpdG9yeS5zZXRDb21taXRNZXNzYWdlKG1lc3NhZ2UsIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0Q29tbWl0TWVzc2FnZSgpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmdldENvbW1pdE1lc3NhZ2UoKTtcbiAgfVxuXG4gIGdldENvbW1pdE1lc3NhZ2VQYXRoKCkge1xuICAgIHJldHVybiBwYXRoLmpvaW4odGhpcy5wcm9wcy5yZXBvc2l0b3J5LmdldEdpdERpcmVjdG9yeVBhdGgoKSwgJ0FUT01fQ09NTUlUX0VESVRNU0cnKTtcbiAgfVxuXG4gIGhhbmRsZU1lc3NhZ2VDaGFuZ2UoKSB7XG4gICAgaWYgKCF0aGlzLnByb3BzLnJlcG9zaXRvcnkuaXNQcmVzZW50KCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXRDb21taXRNZXNzYWdlKHRoaXMuY29tbWl0TWVzc2FnZUJ1ZmZlci5nZXRUZXh0KCksIHtzdXBwcmVzc1VwZGF0ZTogdHJ1ZX0pO1xuICB9XG5cbiAgZ2V0Q29tbWl0TWVzc2FnZUVkaXRvcnMoKSB7XG4gICAgaWYgKCF0aGlzLnByb3BzLnJlcG9zaXRvcnkuaXNQcmVzZW50KCkpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucHJvcHMud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKCkuZmlsdGVyKGVkaXRvciA9PiBlZGl0b3IuZ2V0UGF0aCgpID09PSB0aGlzLmdldENvbW1pdE1lc3NhZ2VQYXRoKCkpO1xuICB9XG5cbiAgYXN5bmMgdG9nZ2xlRXhwYW5kZWRDb21taXRNZXNzYWdlRWRpdG9yKG1lc3NhZ2VGcm9tQm94KSB7XG4gICAgaWYgKHRoaXMuaXNDb21taXRNZXNzYWdlRWRpdG9yRXhwYW5kZWQoKSkge1xuICAgICAgaWYgKHRoaXMuY29tbWl0TWVzc2FnZUVkaXRvcklzSW5Gb3JlZ3JvdW5kKCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbG9zZUFsbE9wZW5Db21taXRNZXNzYWdlRWRpdG9ycygpO1xuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmFjdGl2YXRlQ29tbWl0TWVzc2FnZUVkaXRvcigpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLm9wZW5Db21taXRNZXNzYWdlRWRpdG9yKG1lc3NhZ2VGcm9tQm94KTtcbiAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICB9XG4gIH1cblxuICBpc0NvbW1pdE1lc3NhZ2VFZGl0b3JFeHBhbmRlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDb21taXRNZXNzYWdlRWRpdG9ycygpLmxlbmd0aCA+IDA7XG4gIH1cblxuICBjb21taXRNZXNzYWdlRWRpdG9ySXNJbkZvcmVncm91bmQoKSB7XG4gICAgY29uc3QgY29tbWl0TWVzc2FnZUVkaXRvcnNJbkZvcmVncm91bmQgPSB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRQYW5lcygpXG4gICAgICAubWFwKHBhbmUgPT4gcGFuZS5nZXRBY3RpdmVJdGVtKCkpXG4gICAgICAuZmlsdGVyKGl0ZW0gPT4gaXRlbSAmJiBpdGVtLmdldFBhdGggJiYgaXRlbS5nZXRQYXRoKCkgPT09IHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSk7XG4gICAgcmV0dXJuIGNvbW1pdE1lc3NhZ2VFZGl0b3JzSW5Gb3JlZ3JvdW5kLmxlbmd0aCA+IDA7XG4gIH1cblxuICBhY3RpdmF0ZUNvbW1pdE1lc3NhZ2VFZGl0b3IoKSB7XG4gICAgY29uc3QgcGFuZXMgPSB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRQYW5lcygpO1xuICAgIGxldCBlZGl0b3I7XG4gICAgY29uc3QgcGFuZVdpdGhFZGl0b3IgPSBwYW5lcy5maW5kKHBhbmUgPT4ge1xuICAgICAgZWRpdG9yID0gcGFuZS5nZXRJdGVtcygpLmZpbmQoaXRlbSA9PiBpdGVtLmdldFBhdGggJiYgaXRlbS5nZXRQYXRoKCkgPT09IHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSk7XG4gICAgICByZXR1cm4gISFlZGl0b3I7XG4gICAgfSk7XG4gICAgcGFuZVdpdGhFZGl0b3IuYWN0aXZhdGUoKTtcbiAgICBwYW5lV2l0aEVkaXRvci5hY3RpdmF0ZUl0ZW0oZWRpdG9yKTtcbiAgfVxuXG4gIGNsb3NlQWxsT3BlbkNvbW1pdE1lc3NhZ2VFZGl0b3JzKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgIHRoaXMucHJvcHMud29ya3NwYWNlLmdldFBhbmVzKCkubWFwKHBhbmUgPT4ge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgICAgICAgcGFuZS5nZXRJdGVtcygpLm1hcChhc3luYyBpdGVtID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtICYmIGl0ZW0uZ2V0UGF0aCAmJiBpdGVtLmdldFBhdGgoKSA9PT0gdGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGRlc3Ryb3llZCA9IGF3YWl0IHBhbmUuZGVzdHJveUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgIGlmICghZGVzdHJveWVkKSB7XG4gICAgICAgICAgICAgICAgcGFuZS5hY3RpdmF0ZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgKTtcbiAgICAgIH0pLFxuICAgICk7XG4gIH1cblxuICBhc3luYyBvcGVuQ29tbWl0TWVzc2FnZUVkaXRvcihtZXNzYWdlRnJvbUJveCkge1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZSh0aGlzLmdldENvbW1pdE1lc3NhZ2VQYXRoKCksIG1lc3NhZ2VGcm9tQm94LCAndXRmOCcpO1xuICAgIGNvbnN0IGNvbW1pdEVkaXRvciA9IGF3YWl0IHRoaXMucHJvcHMud29ya3NwYWNlLm9wZW4odGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpKTtcbiAgICBhZGRFdmVudCgnb3Blbi1jb21taXQtbWVzc2FnZS1lZGl0b3InLCB7cGFja2FnZTogJ2dpdGh1Yid9KTtcblxuICAgIGNvbnN0IGdyYW1tYXIgPSB0aGlzLnByb3BzLmdyYW1tYXJzLmdyYW1tYXJGb3JTY29wZU5hbWUoQ09NTUlUX0dSQU1NQVJfU0NPUEUpO1xuICAgIGlmIChncmFtbWFyKSB7XG4gICAgICBjb21taXRFZGl0b3Iuc2V0R3JhbW1hcihncmFtbWFyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ncmFtbWFyU3Vic2NyaXB0aW9uID0gdGhpcy5wcm9wcy5ncmFtbWFycy5vbkRpZEFkZEdyYW1tYXIodGhpcy5ncmFtbWFyQWRkZWQpO1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLmdyYW1tYXJTdWJzY3JpcHRpb24pO1xuICAgIH1cbiAgfVxuXG4gIGdyYW1tYXJBZGRlZChncmFtbWFyKSB7XG4gICAgaWYgKGdyYW1tYXIuc2NvcGVOYW1lICE9PSBDT01NSVRfR1JBTU1BUl9TQ09QRSkgeyByZXR1cm47IH1cblxuICAgIHRoaXMuZ2V0Q29tbWl0TWVzc2FnZUVkaXRvcnMoKS5mb3JFYWNoKGVkaXRvciA9PiBlZGl0b3Iuc2V0R3JhbW1hcihncmFtbWFyKSk7XG4gICAgdGhpcy5ncmFtbWFyU3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIGdldEZvY3VzKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gdGhpcy5yZWZDb21taXRWaWV3Lm1hcCh2aWV3ID0+IHZpZXcuZ2V0Rm9jdXMoZWxlbWVudCkpLmdldE9yKG51bGwpO1xuICB9XG5cbiAgc2V0Rm9jdXMoZm9jdXMpIHtcbiAgICByZXR1cm4gdGhpcy5yZWZDb21taXRWaWV3Lm1hcCh2aWV3ID0+IHZpZXcuc2V0Rm9jdXMoZm9jdXMpKS5nZXRPcihmYWxzZSk7XG4gIH1cblxuICBhZHZhbmNlRm9jdXNGcm9tKC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gdGhpcy5yZWZDb21taXRWaWV3Lm1hcCh2aWV3ID0+IHZpZXcuYWR2YW5jZUZvY3VzRnJvbSguLi5hcmdzKSkuZ2V0T3IoZmFsc2UpO1xuICB9XG5cbiAgcmV0cmVhdEZvY3VzRnJvbSguLi5hcmdzKSB7XG4gICAgcmV0dXJuIHRoaXMucmVmQ29tbWl0Vmlldy5tYXAodmlldyA9PiB2aWV3LnJldHJlYXRGb2N1c0Zyb20oLi4uYXJncykpLmdldE9yKGZhbHNlKTtcbiAgfVxuXG4gIHRvZ2dsZUNvbW1pdFByZXZpZXcoKSB7XG4gICAgYWRkRXZlbnQoJ3RvZ2dsZS1jb21taXQtcHJldmlldycsIHtwYWNrYWdlOiAnZ2l0aHViJ30pO1xuICAgIGNvbnN0IHVyaSA9IENvbW1pdFByZXZpZXdJdGVtLmJ1aWxkVVJJKHRoaXMucHJvcHMucmVwb3NpdG9yeS5nZXRXb3JraW5nRGlyZWN0b3J5UGF0aCgpKTtcbiAgICBpZiAodGhpcy5wcm9wcy53b3Jrc3BhY2UuaGlkZSh1cmkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLndvcmtzcGFjZS5vcGVuKHVyaSwge3NlYXJjaEFsbFBhbmVzOiB0cnVlLCBwZW5kaW5nOiB0cnVlfSk7XG4gICAgfVxuICB9XG5cbiAgYWN0aXZhdGVDb21taXRQcmV2aWV3ID0gKCkgPT4ge1xuICAgIGNvbnN0IHVyaSA9IENvbW1pdFByZXZpZXdJdGVtLmJ1aWxkVVJJKHRoaXMucHJvcHMucmVwb3NpdG9yeS5nZXRXb3JraW5nRGlyZWN0b3J5UGF0aCgpKTtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy53b3Jrc3BhY2Uub3Blbih1cmksIHtzZWFyY2hBbGxQYW5lczogdHJ1ZSwgcGVuZGluZzogdHJ1ZSwgYWN0aXZhdGU6IHRydWV9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiB3cmFwQ29tbWl0TWVzc2FnZShtZXNzYWdlKSB7XG4gIC8vIGhhcmQgd3JhcCBtZXNzYWdlIChleGNlcHQgZm9yIGZpcnN0IGxpbmUpIGF0IDcyIGNoYXJhY3RlcnNcbiAgbGV0IHJlc3VsdHMgPSBbXTtcbiAgbWVzc2FnZS5zcGxpdCgnXFxuJykuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICBpZiAobGluZS5sZW5ndGggPD0gNzIgfHwgaW5kZXggPT09IDApIHtcbiAgICAgIHJlc3VsdHMucHVzaChsaW5lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IGxpbmUubWF0Y2goLy57MSw3Mn0oXFxzfCQpfFxcUys/KFxcc3wkKS9nKVxuICAgICAgICAubWFwKG1hdGNoID0+IHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2guZW5kc1dpdGgoJ1xcbicpID8gbWF0Y2guc3Vic3RyKDAsIG1hdGNoLmxlbmd0aCAtIDEpIDogbWF0Y2g7XG4gICAgICAgIH0pO1xuICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KG1hdGNoZXMpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdHMuam9pbignXFxuJyk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLEtBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLEtBQUEsR0FBQUQsT0FBQTtBQUVBLElBQUFFLE1BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLFVBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLFNBQUEsR0FBQUosT0FBQTtBQUNBLElBQUFLLFFBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUVBLElBQUFNLFdBQUEsR0FBQVAsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFPLFVBQUEsR0FBQVIsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFRLGtCQUFBLEdBQUFULHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBUyxXQUFBLEdBQUFULE9BQUE7QUFDQSxJQUFBVSxtQkFBQSxHQUFBVixPQUFBO0FBQ0EsSUFBQVcsUUFBQSxHQUFBWCxPQUFBO0FBQ0EsSUFBQVksY0FBQSxHQUFBWixPQUFBO0FBQTJDLFNBQUFELHVCQUFBYyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsUUFBQUMsQ0FBQSxFQUFBQyxDQUFBLFFBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFKLENBQUEsT0FBQUcsTUFBQSxDQUFBRSxxQkFBQSxRQUFBQyxDQUFBLEdBQUFILE1BQUEsQ0FBQUUscUJBQUEsQ0FBQUwsQ0FBQSxHQUFBQyxDQUFBLEtBQUFLLENBQUEsR0FBQUEs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