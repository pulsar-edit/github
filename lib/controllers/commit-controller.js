"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.COMMIT_GRAMMAR_SCOPE = void 0;
var _path = _interopRequireDefault(require("path"));
var _atom = require("atom");
var _react = _interopRequireDefault(require("react"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _eventKit = require("event-kit");
var _fsExtra = _interopRequireDefault(require("fs-extra"));
var _commitView = _interopRequireDefault(require("../views/commit-view"));
var _refHolder = _interopRequireDefault(require("../models/ref-holder"));
var _commitPreviewItem = _interopRequireDefault(require("../items/commit-preview-item"));
var _propTypes2 = require("../prop-types");
var _watchWorkspaceItem = require("../watch-workspace-item");
var _helpers = require("../helpers");
var _reporterProxy = require("../reporter-proxy");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const COMMIT_GRAMMAR_SCOPE = 'text.git-commit';
exports.COMMIT_GRAMMAR_SCOPE = COMMIT_GRAMMAR_SCOPE;
class CommitController extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    _defineProperty(this, "activateCommitPreview", () => {
      const uri = _commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath());
      return this.props.workspace.open(uri, {
        searchAllPanes: true,
        pending: true,
        activate: true
      });
    });
    (0, _helpers.autobind)(this, 'commit', 'handleMessageChange', 'toggleExpandedCommitMessageEditor', 'grammarAdded', 'toggleCommitPreview');
    this.subscriptions = new _eventKit.CompositeDisposable();
    this.refCommitView = new _refHolder.default();
    this.commitMessageBuffer = new _atom.TextBuffer({
      text: this.props.repository.getCommitMessage()
    });
    this.subscriptions.add(this.commitMessageBuffer.onDidChange(this.handleMessageChange));
    this.previewWatcher = (0, _watchWorkspaceItem.watchWorkspaceItem)(this.props.workspace, _commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath()), this, 'commitPreviewActive');
    this.subscriptions.add(this.previewWatcher);
  }
  componentDidMount() {
    this.subscriptions.add(this.props.workspace.onDidAddTextEditor(({
      textEditor
    }) => {
      if (this.props.repository.isPresent() && textEditor.getPath() === this.getCommitMessagePath()) {
        const grammar = this.props.grammars.grammarForScopeName(COMMIT_GRAMMAR_SCOPE);
        if (grammar) {
          textEditor.setGrammar(grammar);
        }
      }
    }), this.props.workspace.onDidDestroyPaneItem(async ({
      item
    }) => {
      if (this.props.repository.isPresent() && item.getPath && item.getPath() === this.getCommitMessagePath() && this.getCommitMessageEditors().length === 0) {
        // we closed the last editor pointing to the commit message file
        try {
          this.commitMessageBuffer.setText(await _fsExtra.default.readFile(this.getCommitMessagePath(), {
            encoding: 'utf8'
          }));
        } catch (e) {
          if (e.code !== 'ENOENT') {
            throw e;
          }
        }
      }
    }));
  }
  render() {
    const operationStates = this.props.repository.getOperationStates();
    return _react.default.createElement(_commitView.default, {
      ref: this.refCommitView.setter,
      workspace: this.props.workspace,
      tooltips: this.props.tooltips,
      config: this.props.config,
      stagedChangesExist: this.props.stagedChangesExist,
      mergeConflictsExist: this.props.mergeConflictsExist,
      prepareToCommit: this.props.prepareToCommit,
      commit: this.commit,
      abortMerge: this.props.abortMerge,
      commands: this.props.commands,
      maximumCharacterLimit: 72,
      messageBuffer: this.commitMessageBuffer,
      isMerging: this.props.isMerging,
      isCommitting: operationStates.isCommitInProgress(),
      lastCommit: this.props.lastCommit,
      currentBranch: this.props.currentBranch,
      toggleExpandedCommitMessageEditor: this.toggleExpandedCommitMessageEditor,
      deactivateCommitBox: this.isCommitMessageEditorExpanded(),
      userStore: this.props.userStore,
      selectedCoAuthors: this.props.selectedCoAuthors,
      updateSelectedCoAuthors: this.props.updateSelectedCoAuthors,
      toggleCommitPreview: this.toggleCommitPreview,
      activateCommitPreview: this.activateCommitPreview,
      commitPreviewActive: this.state.commitPreviewActive
    });
  }
  componentDidUpdate(prevProps) {
    this.commitMessageBuffer.setTextViaDiff(this.getCommitMessage());
    if (prevProps.repository !== this.props.repository) {
      this.previewWatcher.setPattern(_commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath()));
    }
  }
  componentWillUnmount() {
    this.subscriptions.dispose();
  }
  commit(message, coAuthors = [], amend = false) {
    let msg, verbatim;
    if (this.isCommitMessageEditorExpanded()) {
      msg = this.getCommitMessageEditors()[0].getText();
      verbatim = false;
    } else {
      const wrapMessage = this.props.config.get('github.automaticCommitMessageWrapping');
      msg = wrapMessage ? wrapCommitMessage(message) : message;
      verbatim = true;
    }
    return this.props.commit(msg.trim(), {
      amend,
      coAuthors,
      verbatim
    });
  }
  setCommitMessage(message, options) {
    if (!this.props.repository.isPresent()) {
      return;
    }
    this.props.repository.setCommitMessage(message, options);
  }
  getCommitMessage() {
    return this.props.repository.getCommitMessage();
  }
  getCommitMessagePath() {
    return _path.default.join(this.props.repository.getGitDirectoryPath(), 'ATOM_COMMIT_EDITMSG');
  }
  handleMessageChange() {
    if (!this.props.repository.isPresent()) {
      return;
    }
    this.setCommitMessage(this.commitMessageBuffer.getText(), {
      suppressUpdate: true
    });
  }
  getCommitMessageEditors() {
    if (!this.props.repository.isPresent()) {
      return [];
    }
    return this.props.workspace.getTextEditors().filter(editor => editor.getPath() === this.getCommitMessagePath());
  }
  async toggleExpandedCommitMessageEditor(messageFromBox) {
    if (this.isCommitMessageEditorExpanded()) {
      if (this.commitMessageEditorIsInForeground()) {
        await this.closeAllOpenCommitMessageEditors();
        this.forceUpdate();
      } else {
        this.activateCommitMessageEditor();
      }
    } else {
      await this.openCommitMessageEditor(messageFromBox);
      this.forceUpdate();
    }
  }
  isCommitMessageEditorExpanded() {
    return this.getCommitMessageEditors().length > 0;
  }
  commitMessageEditorIsInForeground() {
    const commitMessageEditorsInForeground = this.props.workspace.getPanes().map(pane => pane.getActiveItem()).filter(item => item && item.getPath && item.getPath() === this.getCommitMessagePath());
    return commitMessageEditorsInForeground.length > 0;
  }
  activateCommitMessageEditor() {
    const panes = this.props.workspace.getPanes();
    let editor;
    const paneWithEditor = panes.find(pane => {
      editor = pane.getItems().find(item => item.getPath && item.getPath() === this.getCommitMessagePath());
      return !!editor;
    });
    paneWithEditor.activate();
    paneWithEditor.activateItem(editor);
  }
  closeAllOpenCommitMessageEditors() {
    return Promise.all(this.props.workspace.getPanes().map(pane => {
      return Promise.all(pane.getItems().map(async item => {
        if (item && item.getPath && item.getPath() === this.getCommitMessagePath()) {
          const destroyed = await pane.destroyItem(item);
          if (!destroyed) {
            pane.activateItem(item);
          }
        }
      }));
    }));
  }
  async openCommitMessageEditor(messageFromBox) {
    await _fsExtra.default.writeFile(this.getCommitMessagePath(), messageFromBox, 'utf8');
    const commitEditor = await this.props.workspace.open(this.getCommitMessagePath());
    (0, _reporterProxy.addEvent)('open-commit-message-editor', {
      package: 'github'
    });
    const grammar = this.props.grammars.grammarForScopeName(COMMIT_GRAMMAR_SCOPE);
    if (grammar) {
      commitEditor.setGrammar(grammar);
    } else {
      this.grammarSubscription = this.props.grammars.onDidAddGrammar(this.grammarAdded);
      this.subscriptions.add(this.grammarSubscription);
    }
  }
  grammarAdded(grammar) {
    if (grammar.scopeName !== COMMIT_GRAMMAR_SCOPE) {
      return;
    }
    this.getCommitMessageEditors().forEach(editor => editor.setGrammar(grammar));
    this.grammarSubscription.dispose();
  }
  getFocus(element) {
    return this.refCommitView.map(view => view.getFocus(element)).getOr(null);
  }
  setFocus(focus) {
    return this.refCommitView.map(view => view.setFocus(focus)).getOr(false);
  }
  advanceFocusFrom(...args) {
    return this.refCommitView.map(view => view.advanceFocusFrom(...args)).getOr(false);
  }
  retreatFocusFrom(...args) {
    return this.refCommitView.map(view => view.retreatFocusFrom(...args)).getOr(false);
  }
  toggleCommitPreview() {
    (0, _reporterProxy.addEvent)('toggle-commit-preview', {
      package: 'github'
    });
    const uri = _commitPreviewItem.default.buildURI(this.props.repository.getWorkingDirectoryPath());
    if (this.props.workspace.hide(uri)) {
      return Promise.resolve();
    } else {
      return this.props.workspace.open(uri, {
        searchAllPanes: true,
        pending: true
      });
    }
  }
}
exports.default = CommitController;
_defineProperty(CommitController, "focus", _objectSpread({}, _commitView.default.focus));
_defineProperty(CommitController, "propTypes", {
  workspace: _propTypes.default.object.isRequired,
  grammars: _propTypes.default.object.isRequired,
  commands: _propTypes.default.object.isRequired,
  config: _propTypes.default.object.isRequired,
  tooltips: _propTypes.default.object.isRequired,
  repository: _propTypes.default.object.isRequired,
  isMerging: _propTypes.default.bool.isRequired,
  mergeConflictsExist: _propTypes.default.bool.isRequired,
  stagedChangesExist: _propTypes.default.bool.isRequired,
  lastCommit: _propTypes.default.object.isRequired,
  currentBranch: _propTypes.default.object.isRequired,
  userStore: _propTypes2.UserStorePropType.isRequired,
  selectedCoAuthors: _propTypes.default.arrayOf(_propTypes2.AuthorPropType),
  updateSelectedCoAuthors: _propTypes.default.func,
  prepareToCommit: _propTypes.default.func.isRequired,
  commit: _propTypes.default.func.isRequired,
  abortMerge: _propTypes.default.func.isRequired
});
function wrapCommitMessage(message) {
  // hard wrap message (except for first line) at 72 characters
  let results = [];
  message.split('\n').forEach((line, index) => {
    if (line.length <= 72 || index === 0) {
      results.push(line);
    } else {
      const matches = line.match(/.{1,72}(\s|$)|\S+?(\s|$)/g).map(match => {
        return match.endsWith('\n') ? match.substr(0, match.length - 1) : match;
      });
      results = results.concat(matches);
    }
  });
  return results.join('\n');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcGF0aCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2F0b20iLCJfcmVhY3QiLCJfcHJvcFR5cGVzIiwiX2V2ZW50S2l0IiwiX2ZzRXh0cmEiLCJfY29tbWl0VmlldyIsIl9yZWZIb2xkZXIiLCJfY29tbWl0UHJldmlld0l0ZW0iLCJfcHJvcFR5cGVzMiIsIl93YXRjaFdvcmtzcGFjZUl0ZW0iLCJfaGVscGVycyIsIl9yZXBvcnRlclByb3h5Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJvd25LZXlzIiwib2JqZWN0IiwiZW51bWVyYWJsZU9ubHkiLCJrZXlzIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwic3ltYm9scyIsImZpbHRlciIsInN5bSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwidGFyZ2V0IiwiaSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInNvdXJjZSIsImZvckVhY2giLCJrZXkiLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiY2FsbCIsIlR5cGVFcnJvciIsIk51bWJlciIsIkNPTU1JVF9HUkFNTUFSX1NDT1BFIiwiZXhwb3J0cyIsIkNvbW1pdENvbnRyb2xsZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJjb250ZXh0IiwidXJpIiwiQ29tbWl0UHJldmlld0l0ZW0iLCJidWlsZFVSSSIsInJlcG9zaXRvcnkiLCJnZXRXb3JraW5nRGlyZWN0b3J5UGF0aCIsIndvcmtzcGFjZSIsIm9wZW4iLCJzZWFyY2hBbGxQYW5lcyIsInBlbmRpbmciLCJhY3RpdmF0ZSIsImF1dG9iaW5kIiwic3Vic2NyaXB0aW9ucyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJyZWZDb21taXRWaWV3IiwiUmVmSG9sZGVyIiwiY29tbWl0TWVzc2FnZUJ1ZmZlciIsIlRleHRCdWZmZXIiLCJ0ZXh0IiwiZ2V0Q29tbWl0TWVzc2FnZSIsImFkZCIsIm9uRGlkQ2hhbmdlIiwiaGFuZGxlTWVzc2FnZUNoYW5nZSIsInByZXZpZXdXYXRjaGVyIiwid2F0Y2hXb3Jrc3BhY2VJdGVtIiwiY29tcG9uZW50RGlkTW91bnQiLCJvbkRpZEFkZFRleHRFZGl0b3IiLCJ0ZXh0RWRpdG9yIiwiaXNQcmVzZW50IiwiZ2V0UGF0aCIsImdldENvbW1pdE1lc3NhZ2VQYXRoIiwiZ3JhbW1hciIsImdyYW1tYXJzIiwiZ3JhbW1hckZvclNjb3BlTmFtZSIsInNldEdyYW1tYXIiLCJvbkRpZERlc3Ryb3lQYW5lSXRlbSIsIml0ZW0iLCJnZXRDb21taXRNZXNzYWdlRWRpdG9ycyIsInNldFRleHQiLCJmcyIsInJlYWRGaWxlIiwiZW5jb2RpbmciLCJlIiwiY29kZSIsInJlbmRlciIsIm9wZXJhdGlvblN0YXRlcyIsImdldE9wZXJhdGlvblN0YXRlcyIsImNyZWF0ZUVsZW1lbnQiLCJyZWYiLCJzZXR0ZXIiLCJ0b29sdGlwcyIsImNvbmZpZyIsInN0YWdlZENoYW5nZXNFeGlzdCIsIm1lcmdlQ29uZmxpY3RzRXhpc3QiLCJwcmVwYXJlVG9Db21taXQiLCJjb21taXQiLCJhYm9ydE1lcmdlIiwiY29tbWFuZHMiLCJtYXhpbXVtQ2hhcmFjdGVyTGltaXQiLCJtZXNzYWdlQnVmZmVyIiwiaXNNZXJnaW5nIiwiaXNDb21taXR0aW5nIiwiaXNDb21taXRJblByb2dyZXNzIiwibGFzdENvbW1pdCIsImN1cnJlbnRCcmFuY2giLCJ0b2dnbGVFeHBhbmRlZENvbW1pdE1lc3NhZ2VFZGl0b3IiLCJkZWFjdGl2YXRlQ29tbWl0Qm94IiwiaXNDb21taXRNZXNzYWdlRWRpdG9yRXhwYW5kZWQiLCJ1c2VyU3RvcmUiLCJzZWxlY3RlZENvQXV0aG9ycyIsInVwZGF0ZVNlbGVjdGVkQ29BdXRob3JzIiwidG9nZ2xlQ29tbWl0UHJldmlldyIsImFjdGl2YXRlQ29tbWl0UHJldmlldyIsImNvbW1pdFByZXZpZXdBY3RpdmUiLCJzdGF0ZSIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInNldFRleHRWaWFEaWZmIiwic2V0UGF0dGVybiIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsIm1lc3NhZ2UiLCJjb0F1dGhvcnMiLCJhbWVuZCIsIm1zZyIsInZlcmJhdGltIiwiZ2V0VGV4dCIsIndyYXBNZXNzYWdlIiwiZ2V0Iiwid3JhcENvbW1pdE1lc3NhZ2UiLCJ0cmltIiwic2V0Q29tbWl0TWVzc2FnZSIsIm9wdGlvbnMiLCJwYXRoIiwiam9pbiIsImdldEdpdERpcmVjdG9yeVBhdGgiLCJzdXBwcmVzc1VwZGF0ZSIsImdldFRleHRFZGl0b3JzIiwiZWRpdG9yIiwibWVzc2FnZUZyb21Cb3giLCJjb21taXRNZXNzYWdlRWRpdG9ySXNJbkZvcmVncm91bmQiLCJjbG9zZUFsbE9wZW5Db21taXRNZXNzYWdlRWRpdG9ycyIsImZvcmNlVXBkYXRlIiwiYWN0aXZhdGVDb21taXRNZXNzYWdlRWRpdG9yIiwib3BlbkNvbW1pdE1lc3NhZ2VFZGl0b3IiLCJjb21taXRNZXNzYWdlRWRpdG9yc0luRm9yZWdyb3VuZCIsImdldFBhbmVzIiwibWFwIiwicGFuZSIsImdldEFjdGl2ZUl0ZW0iLCJwYW5lcyIsInBhbmVXaXRoRWRpdG9yIiwiZmluZCIsImdldEl0ZW1zIiwiYWN0aXZhdGVJdGVtIiwiUHJvbWlzZSIsImFsbCIsImRlc3Ryb3llZCIsImRlc3Ryb3lJdGVtIiwid3JpdGVGaWxlIiwiY29tbWl0RWRpdG9yIiwiYWRkRXZlbnQiLCJwYWNrYWdlIiwiZ3JhbW1hclN1YnNjcmlwdGlvbiIsIm9uRGlkQWRkR3JhbW1hciIsImdyYW1tYXJBZGRlZCIsInNjb3BlTmFtZSIsImdldEZvY3VzIiwiZWxlbWVudCIsInZpZXciLCJnZXRPciIsInNldEZvY3VzIiwiZm9jdXMiLCJhZHZhbmNlRm9jdXNGcm9tIiwiYXJncyIsInJldHJlYXRGb2N1c0Zyb20iLCJoaWRlIiwicmVzb2x2ZSIsIkNvbW1pdFZpZXciLCJQcm9wVHlwZXMiLCJpc1JlcXVpcmVkIiwiYm9vbCIsIlVzZXJTdG9yZVByb3BUeXBlIiwiYXJyYXlPZiIsIkF1dGhvclByb3BUeXBlIiwiZnVuYyIsInJlc3VsdHMiLCJzcGxpdCIsImxpbmUiLCJpbmRleCIsIm1hdGNoZXMiLCJtYXRjaCIsImVuZHNXaXRoIiwic3Vic3RyIiwiY29uY2F0Il0sInNvdXJjZXMiOlsiY29tbWl0LWNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQge1RleHRCdWZmZXJ9IGZyb20gJ2F0b20nO1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZX0gZnJvbSAnZXZlbnQta2l0JztcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5cbmltcG9ydCBDb21taXRWaWV3IGZyb20gJy4uL3ZpZXdzL2NvbW1pdC12aWV3JztcbmltcG9ydCBSZWZIb2xkZXIgZnJvbSAnLi4vbW9kZWxzL3JlZi1ob2xkZXInO1xuaW1wb3J0IENvbW1pdFByZXZpZXdJdGVtIGZyb20gJy4uL2l0ZW1zL2NvbW1pdC1wcmV2aWV3LWl0ZW0nO1xuaW1wb3J0IHtBdXRob3JQcm9wVHlwZSwgVXNlclN0b3JlUHJvcFR5cGV9IGZyb20gJy4uL3Byb3AtdHlwZXMnO1xuaW1wb3J0IHt3YXRjaFdvcmtzcGFjZUl0ZW19IGZyb20gJy4uL3dhdGNoLXdvcmtzcGFjZS1pdGVtJztcbmltcG9ydCB7YXV0b2JpbmR9IGZyb20gJy4uL2hlbHBlcnMnO1xuaW1wb3J0IHthZGRFdmVudH0gZnJvbSAnLi4vcmVwb3J0ZXItcHJveHknO1xuXG5leHBvcnQgY29uc3QgQ09NTUlUX0dSQU1NQVJfU0NPUEUgPSAndGV4dC5naXQtY29tbWl0JztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29tbWl0Q29udHJvbGxlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBmb2N1cyA9IHtcbiAgICAuLi5Db21taXRWaWV3LmZvY3VzLFxuICB9XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICB3b3Jrc3BhY2U6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBncmFtbWFyczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGNvbW1hbmRzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgY29uZmlnOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdG9vbHRpcHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcblxuICAgIHJlcG9zaXRvcnk6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBpc01lcmdpbmc6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgbWVyZ2VDb25mbGljdHNFeGlzdDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBzdGFnZWRDaGFuZ2VzRXhpc3Q6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgbGFzdENvbW1pdDogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGN1cnJlbnRCcmFuY2g6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB1c2VyU3RvcmU6IFVzZXJTdG9yZVByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgc2VsZWN0ZWRDb0F1dGhvcnM6IFByb3BUeXBlcy5hcnJheU9mKEF1dGhvclByb3BUeXBlKSxcbiAgICB1cGRhdGVTZWxlY3RlZENvQXV0aG9yczogUHJvcFR5cGVzLmZ1bmMsXG4gICAgcHJlcGFyZVRvQ29tbWl0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNvbW1pdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBhYm9ydE1lcmdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG4gICAgYXV0b2JpbmQodGhpcywgJ2NvbW1pdCcsICdoYW5kbGVNZXNzYWdlQ2hhbmdlJywgJ3RvZ2dsZUV4cGFuZGVkQ29tbWl0TWVzc2FnZUVkaXRvcicsICdncmFtbWFyQWRkZWQnLFxuICAgICAgJ3RvZ2dsZUNvbW1pdFByZXZpZXcnKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5yZWZDb21taXRWaWV3ID0gbmV3IFJlZkhvbGRlcigpO1xuXG4gICAgdGhpcy5jb21taXRNZXNzYWdlQnVmZmVyID0gbmV3IFRleHRCdWZmZXIoe3RleHQ6IHRoaXMucHJvcHMucmVwb3NpdG9yeS5nZXRDb21taXRNZXNzYWdlKCl9KTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKFxuICAgICAgdGhpcy5jb21taXRNZXNzYWdlQnVmZmVyLm9uRGlkQ2hhbmdlKHRoaXMuaGFuZGxlTWVzc2FnZUNoYW5nZSksXG4gICAgKTtcblxuICAgIHRoaXMucHJldmlld1dhdGNoZXIgPSB3YXRjaFdvcmtzcGFjZUl0ZW0oXG4gICAgICB0aGlzLnByb3BzLndvcmtzcGFjZSxcbiAgICAgIENvbW1pdFByZXZpZXdJdGVtLmJ1aWxkVVJJKHRoaXMucHJvcHMucmVwb3NpdG9yeS5nZXRXb3JraW5nRGlyZWN0b3J5UGF0aCgpKSxcbiAgICAgIHRoaXMsXG4gICAgICAnY29tbWl0UHJldmlld0FjdGl2ZScsXG4gICAgKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKHRoaXMucHJldmlld1dhdGNoZXIpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChcbiAgICAgIHRoaXMucHJvcHMud29ya3NwYWNlLm9uRGlkQWRkVGV4dEVkaXRvcigoe3RleHRFZGl0b3J9KSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlcG9zaXRvcnkuaXNQcmVzZW50KCkgJiYgdGV4dEVkaXRvci5nZXRQYXRoKCkgPT09IHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSkge1xuICAgICAgICAgIGNvbnN0IGdyYW1tYXIgPSB0aGlzLnByb3BzLmdyYW1tYXJzLmdyYW1tYXJGb3JTY29wZU5hbWUoQ09NTUlUX0dSQU1NQVJfU0NPUEUpO1xuICAgICAgICAgIGlmIChncmFtbWFyKSB7XG4gICAgICAgICAgICB0ZXh0RWRpdG9yLnNldEdyYW1tYXIoZ3JhbW1hcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHRoaXMucHJvcHMud29ya3NwYWNlLm9uRGlkRGVzdHJveVBhbmVJdGVtKGFzeW5jICh7aXRlbX0pID0+IHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMucmVwb3NpdG9yeS5pc1ByZXNlbnQoKSAmJiBpdGVtLmdldFBhdGggJiYgaXRlbS5nZXRQYXRoKCkgPT09IHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSAmJlxuICAgICAgICAgIHRoaXMuZ2V0Q29tbWl0TWVzc2FnZUVkaXRvcnMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAvLyB3ZSBjbG9zZWQgdGhlIGxhc3QgZWRpdG9yIHBvaW50aW5nIHRvIHRoZSBjb21taXQgbWVzc2FnZSBmaWxlXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuY29tbWl0TWVzc2FnZUJ1ZmZlci5zZXRUZXh0KGF3YWl0IGZzLnJlYWRGaWxlKHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSwge2VuY29kaW5nOiAndXRmOCd9KSk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKGUuY29kZSAhPT0gJ0VOT0VOVCcpIHtcbiAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qgb3BlcmF0aW9uU3RhdGVzID0gdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmdldE9wZXJhdGlvblN0YXRlcygpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxDb21taXRWaWV3XG4gICAgICAgIHJlZj17dGhpcy5yZWZDb21taXRWaWV3LnNldHRlcn1cbiAgICAgICAgd29ya3NwYWNlPXt0aGlzLnByb3BzLndvcmtzcGFjZX1cbiAgICAgICAgdG9vbHRpcHM9e3RoaXMucHJvcHMudG9vbHRpcHN9XG4gICAgICAgIGNvbmZpZz17dGhpcy5wcm9wcy5jb25maWd9XG4gICAgICAgIHN0YWdlZENoYW5nZXNFeGlzdD17dGhpcy5wcm9wcy5zdGFnZWRDaGFuZ2VzRXhpc3R9XG4gICAgICAgIG1lcmdlQ29uZmxpY3RzRXhpc3Q9e3RoaXMucHJvcHMubWVyZ2VDb25mbGljdHNFeGlzdH1cbiAgICAgICAgcHJlcGFyZVRvQ29tbWl0PXt0aGlzLnByb3BzLnByZXBhcmVUb0NvbW1pdH1cbiAgICAgICAgY29tbWl0PXt0aGlzLmNvbW1pdH1cbiAgICAgICAgYWJvcnRNZXJnZT17dGhpcy5wcm9wcy5hYm9ydE1lcmdlfVxuICAgICAgICBjb21tYW5kcz17dGhpcy5wcm9wcy5jb21tYW5kc31cbiAgICAgICAgbWF4aW11bUNoYXJhY3RlckxpbWl0PXs3Mn1cbiAgICAgICAgbWVzc2FnZUJ1ZmZlcj17dGhpcy5jb21taXRNZXNzYWdlQnVmZmVyfVxuICAgICAgICBpc01lcmdpbmc9e3RoaXMucHJvcHMuaXNNZXJnaW5nfVxuICAgICAgICBpc0NvbW1pdHRpbmc9e29wZXJhdGlvblN0YXRlcy5pc0NvbW1pdEluUHJvZ3Jlc3MoKX1cbiAgICAgICAgbGFzdENvbW1pdD17dGhpcy5wcm9wcy5sYXN0Q29tbWl0fVxuICAgICAgICBjdXJyZW50QnJhbmNoPXt0aGlzLnByb3BzLmN1cnJlbnRCcmFuY2h9XG4gICAgICAgIHRvZ2dsZUV4cGFuZGVkQ29tbWl0TWVzc2FnZUVkaXRvcj17dGhpcy50b2dnbGVFeHBhbmRlZENvbW1pdE1lc3NhZ2VFZGl0b3J9XG4gICAgICAgIGRlYWN0aXZhdGVDb21taXRCb3g9e3RoaXMuaXNDb21taXRNZXNzYWdlRWRpdG9yRXhwYW5kZWQoKX1cbiAgICAgICAgdXNlclN0b3JlPXt0aGlzLnByb3BzLnVzZXJTdG9yZX1cbiAgICAgICAgc2VsZWN0ZWRDb0F1dGhvcnM9e3RoaXMucHJvcHMuc2VsZWN0ZWRDb0F1dGhvcnN9XG4gICAgICAgIHVwZGF0ZVNlbGVjdGVkQ29BdXRob3JzPXt0aGlzLnByb3BzLnVwZGF0ZVNlbGVjdGVkQ29BdXRob3JzfVxuICAgICAgICB0b2dnbGVDb21taXRQcmV2aWV3PXt0aGlzLnRvZ2dsZUNvbW1pdFByZXZpZXd9XG4gICAgICAgIGFjdGl2YXRlQ29tbWl0UHJldmlldz17dGhpcy5hY3RpdmF0ZUNvbW1pdFByZXZpZXd9XG4gICAgICAgIGNvbW1pdFByZXZpZXdBY3RpdmU9e3RoaXMuc3RhdGUuY29tbWl0UHJldmlld0FjdGl2ZX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICB0aGlzLmNvbW1pdE1lc3NhZ2VCdWZmZXIuc2V0VGV4dFZpYURpZmYodGhpcy5nZXRDb21taXRNZXNzYWdlKCkpO1xuXG4gICAgaWYgKHByZXZQcm9wcy5yZXBvc2l0b3J5ICE9PSB0aGlzLnByb3BzLnJlcG9zaXRvcnkpIHtcbiAgICAgIHRoaXMucHJldmlld1dhdGNoZXIuc2V0UGF0dGVybihcbiAgICAgICAgQ29tbWl0UHJldmlld0l0ZW0uYnVpbGRVUkkodGhpcy5wcm9wcy5yZXBvc2l0b3J5LmdldFdvcmtpbmdEaXJlY3RvcnlQYXRoKCkpLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpO1xuICB9XG5cbiAgY29tbWl0KG1lc3NhZ2UsIGNvQXV0aG9ycyA9IFtdLCBhbWVuZCA9IGZhbHNlKSB7XG4gICAgbGV0IG1zZywgdmVyYmF0aW07XG4gICAgaWYgKHRoaXMuaXNDb21taXRNZXNzYWdlRWRpdG9yRXhwYW5kZWQoKSkge1xuICAgICAgbXNnID0gdGhpcy5nZXRDb21taXRNZXNzYWdlRWRpdG9ycygpWzBdLmdldFRleHQoKTtcbiAgICAgIHZlcmJhdGltID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHdyYXBNZXNzYWdlID0gdGhpcy5wcm9wcy5jb25maWcuZ2V0KCdnaXRodWIuYXV0b21hdGljQ29tbWl0TWVzc2FnZVdyYXBwaW5nJyk7XG4gICAgICBtc2cgPSB3cmFwTWVzc2FnZSA/IHdyYXBDb21taXRNZXNzYWdlKG1lc3NhZ2UpIDogbWVzc2FnZTtcbiAgICAgIHZlcmJhdGltID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5jb21taXQobXNnLnRyaW0oKSwge2FtZW5kLCBjb0F1dGhvcnMsIHZlcmJhdGltfSk7XG4gIH1cblxuICBzZXRDb21taXRNZXNzYWdlKG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICBpZiAoIXRoaXMucHJvcHMucmVwb3NpdG9yeS5pc1ByZXNlbnQoKSkgeyByZXR1cm47IH1cbiAgICB0aGlzLnByb3BzLnJlcG9zaXRvcnkuc2V0Q29tbWl0TWVzc2FnZShtZXNzYWdlLCBvcHRpb25zKTtcbiAgfVxuXG4gIGdldENvbW1pdE1lc3NhZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMucmVwb3NpdG9yeS5nZXRDb21taXRNZXNzYWdlKCk7XG4gIH1cblxuICBnZXRDb21taXRNZXNzYWdlUGF0aCgpIHtcbiAgICByZXR1cm4gcGF0aC5qb2luKHRoaXMucHJvcHMucmVwb3NpdG9yeS5nZXRHaXREaXJlY3RvcnlQYXRoKCksICdBVE9NX0NPTU1JVF9FRElUTVNHJyk7XG4gIH1cblxuICBoYW5kbGVNZXNzYWdlQ2hhbmdlKCkge1xuICAgIGlmICghdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmlzUHJlc2VudCgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2V0Q29tbWl0TWVzc2FnZSh0aGlzLmNvbW1pdE1lc3NhZ2VCdWZmZXIuZ2V0VGV4dCgpLCB7c3VwcHJlc3NVcGRhdGU6IHRydWV9KTtcbiAgfVxuXG4gIGdldENvbW1pdE1lc3NhZ2VFZGl0b3JzKCkge1xuICAgIGlmICghdGhpcy5wcm9wcy5yZXBvc2l0b3J5LmlzUHJlc2VudCgpKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRUZXh0RWRpdG9ycygpLmZpbHRlcihlZGl0b3IgPT4gZWRpdG9yLmdldFBhdGgoKSA9PT0gdGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpKTtcbiAgfVxuXG4gIGFzeW5jIHRvZ2dsZUV4cGFuZGVkQ29tbWl0TWVzc2FnZUVkaXRvcihtZXNzYWdlRnJvbUJveCkge1xuICAgIGlmICh0aGlzLmlzQ29tbWl0TWVzc2FnZUVkaXRvckV4cGFuZGVkKCkpIHtcbiAgICAgIGlmICh0aGlzLmNvbW1pdE1lc3NhZ2VFZGl0b3JJc0luRm9yZWdyb3VuZCgpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xvc2VBbGxPcGVuQ29tbWl0TWVzc2FnZUVkaXRvcnMoKTtcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZUNvbW1pdE1lc3NhZ2VFZGl0b3IoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5vcGVuQ29tbWl0TWVzc2FnZUVkaXRvcihtZXNzYWdlRnJvbUJveCk7XG4gICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgfVxuICB9XG5cbiAgaXNDb21taXRNZXNzYWdlRWRpdG9yRXhwYW5kZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q29tbWl0TWVzc2FnZUVkaXRvcnMoKS5sZW5ndGggPiAwO1xuICB9XG5cbiAgY29tbWl0TWVzc2FnZUVkaXRvcklzSW5Gb3JlZ3JvdW5kKCkge1xuICAgIGNvbnN0IGNvbW1pdE1lc3NhZ2VFZGl0b3JzSW5Gb3JlZ3JvdW5kID0gdGhpcy5wcm9wcy53b3Jrc3BhY2UuZ2V0UGFuZXMoKVxuICAgICAgLm1hcChwYW5lID0+IHBhbmUuZ2V0QWN0aXZlSXRlbSgpKVxuICAgICAgLmZpbHRlcihpdGVtID0+IGl0ZW0gJiYgaXRlbS5nZXRQYXRoICYmIGl0ZW0uZ2V0UGF0aCgpID09PSB0aGlzLmdldENvbW1pdE1lc3NhZ2VQYXRoKCkpO1xuICAgIHJldHVybiBjb21taXRNZXNzYWdlRWRpdG9yc0luRm9yZWdyb3VuZC5sZW5ndGggPiAwO1xuICB9XG5cbiAgYWN0aXZhdGVDb21taXRNZXNzYWdlRWRpdG9yKCkge1xuICAgIGNvbnN0IHBhbmVzID0gdGhpcy5wcm9wcy53b3Jrc3BhY2UuZ2V0UGFuZXMoKTtcbiAgICBsZXQgZWRpdG9yO1xuICAgIGNvbnN0IHBhbmVXaXRoRWRpdG9yID0gcGFuZXMuZmluZChwYW5lID0+IHtcbiAgICAgIGVkaXRvciA9IHBhbmUuZ2V0SXRlbXMoKS5maW5kKGl0ZW0gPT4gaXRlbS5nZXRQYXRoICYmIGl0ZW0uZ2V0UGF0aCgpID09PSB0aGlzLmdldENvbW1pdE1lc3NhZ2VQYXRoKCkpO1xuICAgICAgcmV0dXJuICEhZWRpdG9yO1xuICAgIH0pO1xuICAgIHBhbmVXaXRoRWRpdG9yLmFjdGl2YXRlKCk7XG4gICAgcGFuZVdpdGhFZGl0b3IuYWN0aXZhdGVJdGVtKGVkaXRvcik7XG4gIH1cblxuICBjbG9zZUFsbE9wZW5Db21taXRNZXNzYWdlRWRpdG9ycygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgICB0aGlzLnByb3BzLndvcmtzcGFjZS5nZXRQYW5lcygpLm1hcChwYW5lID0+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgICAgIHBhbmUuZ2V0SXRlbXMoKS5tYXAoYXN5bmMgaXRlbSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbSAmJiBpdGVtLmdldFBhdGggJiYgaXRlbS5nZXRQYXRoKCkgPT09IHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSkge1xuICAgICAgICAgICAgICBjb25zdCBkZXN0cm95ZWQgPSBhd2FpdCBwYW5lLmRlc3Ryb3lJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICBpZiAoIWRlc3Ryb3llZCkge1xuICAgICAgICAgICAgICAgIHBhbmUuYWN0aXZhdGVJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgb3BlbkNvbW1pdE1lc3NhZ2VFZGl0b3IobWVzc2FnZUZyb21Cb3gpIHtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUodGhpcy5nZXRDb21taXRNZXNzYWdlUGF0aCgpLCBtZXNzYWdlRnJvbUJveCwgJ3V0ZjgnKTtcbiAgICBjb25zdCBjb21taXRFZGl0b3IgPSBhd2FpdCB0aGlzLnByb3BzLndvcmtzcGFjZS5vcGVuKHRoaXMuZ2V0Q29tbWl0TWVzc2FnZVBhdGgoKSk7XG4gICAgYWRkRXZlbnQoJ29wZW4tY29tbWl0LW1lc3NhZ2UtZWRpdG9yJywge3BhY2thZ2U6ICdnaXRodWInfSk7XG5cbiAgICBjb25zdCBncmFtbWFyID0gdGhpcy5wcm9wcy5ncmFtbWFycy5ncmFtbWFyRm9yU2NvcGVOYW1lKENPTU1JVF9HUkFNTUFSX1NDT1BFKTtcbiAgICBpZiAoZ3JhbW1hcikge1xuICAgICAgY29tbWl0RWRpdG9yLnNldEdyYW1tYXIoZ3JhbW1hcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ3JhbW1hclN1YnNjcmlwdGlvbiA9IHRoaXMucHJvcHMuZ3JhbW1hcnMub25EaWRBZGRHcmFtbWFyKHRoaXMuZ3JhbW1hckFkZGVkKTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5ncmFtbWFyU3Vic2NyaXB0aW9uKTtcbiAgICB9XG4gIH1cblxuICBncmFtbWFyQWRkZWQoZ3JhbW1hcikge1xuICAgIGlmIChncmFtbWFyLnNjb3BlTmFtZSAhPT0gQ09NTUlUX0dSQU1NQVJfU0NPUEUpIHsgcmV0dXJuOyB9XG5cbiAgICB0aGlzLmdldENvbW1pdE1lc3NhZ2VFZGl0b3JzKCkuZm9yRWFjaChlZGl0b3IgPT4gZWRpdG9yLnNldEdyYW1tYXIoZ3JhbW1hcikpO1xuICAgIHRoaXMuZ3JhbW1hclN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG4gIH1cblxuICBnZXRGb2N1cyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIHRoaXMucmVmQ29tbWl0Vmlldy5tYXAodmlldyA9PiB2aWV3LmdldEZvY3VzKGVsZW1lbnQpKS5nZXRPcihudWxsKTtcbiAgfVxuXG4gIHNldEZvY3VzKGZvY3VzKSB7XG4gICAgcmV0dXJuIHRoaXMucmVmQ29tbWl0Vmlldy5tYXAodmlldyA9PiB2aWV3LnNldEZvY3VzKGZvY3VzKSkuZ2V0T3IoZmFsc2UpO1xuICB9XG5cbiAgYWR2YW5jZUZvY3VzRnJvbSguLi5hcmdzKSB7XG4gICAgcmV0dXJuIHRoaXMucmVmQ29tbWl0Vmlldy5tYXAodmlldyA9PiB2aWV3LmFkdmFuY2VGb2N1c0Zyb20oLi4uYXJncykpLmdldE9yKGZhbHNlKTtcbiAgfVxuXG4gIHJldHJlYXRGb2N1c0Zyb20oLi4uYXJncykge1xuICAgIHJldHVybiB0aGlzLnJlZkNvbW1pdFZpZXcubWFwKHZpZXcgPT4gdmlldy5yZXRyZWF0Rm9jdXNGcm9tKC4uLmFyZ3MpKS5nZXRPcihmYWxzZSk7XG4gIH1cblxuICB0b2dnbGVDb21taXRQcmV2aWV3KCkge1xuICAgIGFkZEV2ZW50KCd0b2dnbGUtY29tbWl0LXByZXZpZXcnLCB7cGFja2FnZTogJ2dpdGh1Yid9KTtcbiAgICBjb25zdCB1cmkgPSBDb21taXRQcmV2aWV3SXRlbS5idWlsZFVSSSh0aGlzLnByb3BzLnJlcG9zaXRvcnkuZ2V0V29ya2luZ0RpcmVjdG9yeVBhdGgoKSk7XG4gICAgaWYgKHRoaXMucHJvcHMud29ya3NwYWNlLmhpZGUodXJpKSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9wcy53b3Jrc3BhY2Uub3Blbih1cmksIHtzZWFyY2hBbGxQYW5lczogdHJ1ZSwgcGVuZGluZzogdHJ1ZX0pO1xuICAgIH1cbiAgfVxuXG4gIGFjdGl2YXRlQ29tbWl0UHJldmlldyA9ICgpID0+IHtcbiAgICBjb25zdCB1cmkgPSBDb21taXRQcmV2aWV3SXRlbS5idWlsZFVSSSh0aGlzLnByb3BzLnJlcG9zaXRvcnkuZ2V0V29ya2luZ0RpcmVjdG9yeVBhdGgoKSk7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMud29ya3NwYWNlLm9wZW4odXJpLCB7c2VhcmNoQWxsUGFuZXM6IHRydWUsIHBlbmRpbmc6IHRydWUsIGFjdGl2YXRlOiB0cnVlfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd3JhcENvbW1pdE1lc3NhZ2UobWVzc2FnZSkge1xuICAvLyBoYXJkIHdyYXAgbWVzc2FnZSAoZXhjZXB0IGZvciBmaXJzdCBsaW5lKSBhdCA3MiBjaGFyYWN0ZXJzXG4gIGxldCByZXN1bHRzID0gW107XG4gIG1lc3NhZ2Uuc3BsaXQoJ1xcbicpLmZvckVhY2goKGxpbmUsIGluZGV4KSA9PiB7XG4gICAgaWYgKGxpbmUubGVuZ3RoIDw9IDcyIHx8IGluZGV4ID09PSAwKSB7XG4gICAgICByZXN1bHRzLnB1c2gobGluZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBsaW5lLm1hdGNoKC8uezEsNzJ9KFxcc3wkKXxcXFMrPyhcXHN8JCkvZylcbiAgICAgICAgLm1hcChtYXRjaCA9PiB7XG4gICAgICAgICAgcmV0dXJuIG1hdGNoLmVuZHNXaXRoKCdcXG4nKSA/IG1hdGNoLnN1YnN0cigwLCBtYXRjaC5sZW5ndGggLSAxKSA6IG1hdGNoO1xuICAgICAgICB9KTtcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmNvbmNhdChtYXRjaGVzKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByZXN1bHRzLmpvaW4oJ1xcbicpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxLQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxLQUFBLEdBQUFELE9BQUE7QUFFQSxJQUFBRSxNQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxVQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSSxTQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxRQUFBLEdBQUFOLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBTSxXQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTyxVQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBUSxrQkFBQSxHQUFBVCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQVMsV0FBQSxHQUFBVCxPQUFBO0FBQ0EsSUFBQVUsbUJBQUEsR0FBQVYsT0FBQTtBQUNBLElBQUFXLFFBQUEsR0FBQVgsT0FBQTtBQUNBLElBQUFZLGNBQUEsR0FBQVosT0FBQTtBQUEyQyxTQUFBRCx1QkFBQWMsR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLEtBQUFFLE9BQUEsRUFBQUYsR0FBQTtBQUFBLFNBQUFHLFFBQUFDLE1BQUEsRUFBQUMsY0FBQSxRQUFBQyxJQUFBLEdBQUFDLE1BQUEsQ0FBQUQsSUFBQSxDQUFBRixNQUFBLE9BQUFHLE1BQUEsQ0FBQUMscUJBQUEsUUFBQUMsT0FBQSxHQUFBRixNQUFBLENBQUFDLHFC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