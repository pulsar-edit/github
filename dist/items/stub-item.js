"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _eventKit = require("event-kit");

let key = 0;

class StubItem {
  // StubItems should only be created by `create` and never constructed directly.
  static create(name, props, uri = '') {
    const stub = new StubItem(name, props, uri);
    const override = {
      _getStub: () => stub,
      getElement: () => stub.getElement(),
      destroy: stub.destroy.bind(stub)
    };
    const proxy = new Proxy(override, {
      get(target, propName) {
        const item = stub.getRealItem();

        if (Reflect.has(target, propName)) {
          return target[propName];
        } else if (item && Reflect.has(item, propName)) {
          let val = item[propName];

          if (typeof val === 'function') {
            val = val.bind(item);
          }

          return val;
        } else {
          let val = stub[propName];

          if (typeof val === 'function') {
            val = val.bind(stub);
          }

          return val;
        }
      }

    });
    return proxy;
  }

  constructor(name, props = {}, uri) {
    this.emitter = new _eventKit.Emitter();
    this.subscriptions = new _eventKit.CompositeDisposable();
    this.name = name;
    this.props = props;
    this.uri = uri;
    this.key = ++key;
    this.element = document.createElement('div');
    this.element.classList.add(`github-StubItem-${name}`);
    this.realItem = null;
    this.realItemPromise = new Promise(res => {
      this.resolveRealItemPromise = res;
    });
  }

  setRealItem(item) {
    this.realItem = item;

    if (this.realItem.getRealItemPromise) {
      this.realItem.getRealItemPromise().then(this.resolveRealItemPromise);
    } else {
      this.resolveRealItemPromise(this.realItem);
    }

    this.emitter.emit('did-change-title');
    this.emitter.emit('did-change-icon');

    if (item.onDidChangeTitle) {
      this.subscriptions.add(item.onDidChangeTitle((...args) => this.emitter.emit('did-change-title', ...args)));
    }

    if (item.onDidChangeIcon) {
      this.subscriptions.add(item.onDidChangeIcon((...args) => this.emitter.emit('did-change-icon', ...args)));
    }

    if (item.onDidDestroy) {
      this.subscriptions.add(item.onDidDestroy((...args) => {
        this.realItem = null;
        this.emitter.emit('did-destroy', ...args);
      }));
    }
  }

  getRealItemPromise() {
    return this.realItemPromise;
  }

  getRealItem() {
    return this.realItem;
  }

  getURI() {
    return this.uri;
  }

  getTitle() {
    return this.props.title || null;
  }

  getIconName() {
    return this.props.iconName || null;
  }

  onDidChangeTitle(cb) {
    return this.emitter.on('did-change-title', cb);
  }

  onDidChangeIcon(cb) {
    return this.emitter.on('did-change-icon', cb);
  }

  getElement() {
    return this.element;
  }

  onDidDestroy(cb) {
    return this.emitter.on('did-destroy', cb);
  }

  destroy() {
    this.resolveRealItemPromise(null);
    this.subscriptions.dispose();
    this.emitter.dispose();

    if (this.realItem) {
      this.realItem.destroy && this.realItem.destroy();
    }
  }

}

exports.default = StubItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9pdGVtcy9zdHViLWl0ZW0uanMiXSwibmFtZXMiOlsia2V5IiwiU3R1Ykl0ZW0iLCJjcmVhdGUiLCJuYW1lIiwicHJvcHMiLCJ1cmkiLCJzdHViIiwib3ZlcnJpZGUiLCJfZ2V0U3R1YiIsImdldEVsZW1lbnQiLCJkZXN0cm95IiwiYmluZCIsInByb3h5IiwiUHJveHkiLCJnZXQiLCJ0YXJnZXQiLCJwcm9wTmFtZSIsIml0ZW0iLCJnZXRSZWFsSXRlbSIsIlJlZmxlY3QiLCJoYXMiLCJ2YWwiLCJjb25zdHJ1Y3RvciIsImVtaXR0ZXIiLCJFbWl0dGVyIiwic3Vic2NyaXB0aW9ucyIsIkNvbXBvc2l0ZURpc3Bvc2FibGUiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwicmVhbEl0ZW0iLCJyZWFsSXRlbVByb21pc2UiLCJQcm9taXNlIiwicmVzIiwicmVzb2x2ZVJlYWxJdGVtUHJvbWlzZSIsInNldFJlYWxJdGVtIiwiZ2V0UmVhbEl0ZW1Qcm9taXNlIiwidGhlbiIsImVtaXQiLCJvbkRpZENoYW5nZVRpdGxlIiwiYXJncyIsIm9uRGlkQ2hhbmdlSWNvbiIsIm9uRGlkRGVzdHJveSIsImdldFVSSSIsImdldFRpdGxlIiwidGl0bGUiLCJnZXRJY29uTmFtZSIsImljb25OYW1lIiwiY2IiLCJvbiIsImRpc3Bvc2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQSxJQUFJQSxHQUFHLEdBQUcsQ0FBVjs7QUFDZSxNQUFNQyxRQUFOLENBQWU7QUFDNUI7QUFDYSxTQUFOQyxNQUFNLENBQUNDLElBQUQsRUFBT0MsS0FBUCxFQUFjQyxHQUFHLEdBQUcsRUFBcEIsRUFBd0I7QUFDbkMsVUFBTUMsSUFBSSxHQUFHLElBQUlMLFFBQUosQ0FBYUUsSUFBYixFQUFtQkMsS0FBbkIsRUFBMEJDLEdBQTFCLENBQWI7QUFDQSxVQUFNRSxRQUFRLEdBQUc7QUFDZkMsTUFBQUEsUUFBUSxFQUFFLE1B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ZSxDQUFDTyxFQUFELEVBQUs7QUFDbEIsV0FBTyxLQUFLM0IsT0FBTCxDQUFhNEIsRUFBYixDQUFnQixpQkFBaEIsRUFBbUNELEVBQW5DLENBQVA7QUFDRDs7QUFFRHpDLEVBQUFBLFVBQVUsR0FBRztBQUNYLFdBQU8sS0FBS2tCLE9BQVo7QUFDRDs7QUFFRGlCLEVBQUFBLFlBQVksQ0FBQ00sRUFBRCxFQUFLO0FBQ2YsV0FBTyxLQUFLM0IsT0FBTCxDQUFhNEIsRUFBYixDQUFnQixhQUFoQixFQUErQkQsRUFBL0IsQ0FBUDtBQUNEOztBQUVEeEMsRUFBQUEsT0FBTyxHQUFHO0FBQ1IsU0FBSzBCLHNCQUFMLENBQTRCLElBQTVCO0FBQ0EsU0FBS1gsYUFBTCxDQUFtQjJCLE9BQW5CO0FBQ0EsU0FBSzdCLE9BQUwsQ0FBYTZCLE9BQWI7O0FBQ0EsUUFBSSxLQUFLcEIsUUFBVCxFQUFtQjtBQUNqQixXQUFLQSxRQUFMLENBQWN0QixPQUFkLElBQXlCLEtBQUtzQixRQUFMLENBQWN0QixPQUFkLEVBQXpCO0FBQ0Q7QUFDRjs7QUF2SDJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFbWl0dGVyLCBDb21wb3NpdGVEaXNwb3NhYmxlfSBmcm9tICdldmVudC1raXQnO1xuXG5sZXQga2V5ID0gMDtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0dWJJdGVtIHtcbiAgLy8gU3R1Ykl0ZW1zIHNob3VsZCBvbmx5IGJlIGNyZWF0ZWQgYnkgYGNyZWF0ZWAgYW5kIG5ldmVyIGNvbnN0cnVjdGVkIGRpcmVjdGx5LlxuICBzdGF0aWMgY3JlYXRlKG5hbWUsIHByb3BzLCB1cmkgPSAnJykge1xuICAgIGNvbnN0IHN0dWIgPSBuZXcgU3R1Ykl0ZW0obmFtZSwgcHJvcHMsIHVyaSk7XG4gICAgY29uc3Qgb3ZlcnJpZGUgPSB7XG4gICAgICBfZ2V0U3R1YjogKCkgPT4gc3R1YixcbiAgICAgIGdldEVsZW1lbnQ6ICgpID0+IHN0dWIuZ2V0RWxlbWVudCgpLFxuICAgICAgZGVzdHJveTogc3R1Yi5kZXN0cm95LmJpbmQoc3R1YiksXG4gICAgfTtcbiAgICBjb25zdCBwcm94eSA9IG5ldyBQcm94eShvdmVycmlkZSwge1xuICAgICAgZ2V0KHRhcmdldCwgcHJvcE5hbWUpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHN0dWIuZ2V0UmVhbEl0ZW0oKTtcbiAgICAgICAgaWYgKFJlZmxlY3QuaGFzKHRhcmdldCwgcHJvcE5hbWUpKSB7XG4gICAgICAgICAgcmV0dXJuIHRhcmdldFtwcm9wTmFtZV07XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbSAmJiBSZWZsZWN0LmhhcyhpdGVtLCBwcm9wTmFtZSkpIHtcbiAgICAgICAgICBsZXQgdmFsID0gaXRlbVtwcm9wTmFtZV07XG4gICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHZhbCA9IHZhbC5iaW5kKGl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCB2YWwgPSBzdHViW3Byb3BOYW1lXTtcbiAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdmFsID0gdmFsLmJpbmQoc3R1Yik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIHByb3h5O1xuICB9XG5cbiAgY29uc3RydWN0b3IobmFtZSwgcHJvcHMgPSB7fSwgdXJpKSB7XG4gICAgdGhpcy5lbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnByb3BzID0gcHJvcHM7XG4gICAgdGhpcy51cmkgPSB1cmk7XG4gICAgdGhpcy5rZXkgPSArK2tleTtcbiAgICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChgZ2l0aHViLVN0dWJJdGVtLSR7bmFtZX1gKTtcbiAgICB0aGlzLnJlYWxJdGVtID0gbnVsbDtcbiAgICB0aGlzLnJlYWxJdGVtUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlcyA9PiB7XG4gICAgICB0aGlzLnJlc29sdmVSZWFsSXRlbVByb21pc2UgPSByZXM7XG4gICAgfSk7XG4gIH1cblxuICBzZXRSZWFsSXRlbShpdGVtKSB7XG4gICAgdGhpcy5yZWFsSXRlbSA9IGl0ZW07XG5cbiAgICBpZiAodGhpcy5yZWFsSXRlbS5nZXRSZWFsSXRlbVByb21pc2UpIHtcbiAgICAgIHRoaXMucmVhbEl0ZW0uZ2V0UmVhbEl0ZW1Qcm9taXNlKCkudGhlbih0aGlzLnJlc29sdmVSZWFsSXRlbVByb21pc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlc29sdmVSZWFsSXRlbVByb21pc2UodGhpcy5yZWFsSXRlbSk7XG4gICAgfVxuXG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1jaGFuZ2UtdGl0bGUnKTtcbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgnZGlkLWNoYW5nZS1pY29uJyk7XG5cbiAgICBpZiAoaXRlbS5vbkRpZENoYW5nZVRpdGxlKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKGl0ZW0ub25EaWRDaGFuZ2VUaXRsZSgoLi4uYXJncykgPT4gdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1jaGFuZ2UtdGl0bGUnLCAuLi5hcmdzKSkpO1xuICAgIH1cblxuICAgIGlmIChpdGVtLm9uRGlkQ2hhbmdlSWNvbikge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChpdGVtLm9uRGlkQ2hhbmdlSWNvbigoLi4uYXJncykgPT4gdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1jaGFuZ2UtaWNvbicsIC4uLmFyZ3MpKSk7XG4gICAgfVxuXG4gICAgaWYgKGl0ZW0ub25EaWREZXN0cm95KSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKGl0ZW0ub25EaWREZXN0cm95KCguLi5hcmdzKSA9PiB7XG4gICAgICAgIHRoaXMucmVhbEl0ZW0gPSBudWxsO1xuICAgICAgICB0aGlzLmVtaXR0ZXIuZW1pdCgnZGlkLWRlc3Ryb3knLCAuLi5hcmdzKTtcbiAgICAgIH0pKTtcbiAgICB9XG4gIH1cblxuICBnZXRSZWFsSXRlbVByb21pc2UoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVhbEl0ZW1Qcm9taXNlO1xuICB9XG5cbiAgZ2V0UmVhbEl0ZW0oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVhbEl0ZW07XG4gIH1cblxuICBnZXRVUkkoKSB7XG4gICAgcmV0dXJuIHRoaXMudXJpO1xuICB9XG5cbiAgZ2V0VGl0bGUoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMudGl0bGUgfHwgbnVsbDtcbiAgfVxuXG4gIGdldEljb25OYW1lKCkge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmljb25OYW1lIHx8IG51bGw7XG4gIH1cblxuICBvbkRpZENoYW5nZVRpdGxlKGNiKSB7XG4gICAgcmV0dXJuIHRoaXMuZW1pdHRlci5vbignZGlkLWNoYW5nZS10aXRsZScsIGNiKTtcbiAgfVxuXG4gIG9uRGlkQ2hhbmdlSWNvbihjYikge1xuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ2RpZC1jaGFuZ2UtaWNvbicsIGNiKTtcbiAgfVxuXG4gIGdldEVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgfVxuXG4gIG9uRGlkRGVzdHJveShjYikge1xuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ2RpZC1kZXN0cm95JywgY2IpO1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLnJlc29sdmVSZWFsSXRlbVByb21pc2UobnVsbCk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmRpc3Bvc2UoKTtcbiAgICB0aGlzLmVtaXR0ZXIuZGlzcG9zZSgpO1xuICAgIGlmICh0aGlzLnJlYWxJdGVtKSB7XG4gICAgICB0aGlzLnJlYWxJdGVtLmRlc3Ryb3kgJiYgdGhpcy5yZWFsSXRlbS5kZXN0cm95KCk7XG4gICAgfVxuICB9XG59XG4iXX0=