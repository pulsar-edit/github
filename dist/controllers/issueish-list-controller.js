"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BareIssueishListController = void 0;

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactRelay = require("react-relay");

var _propTypes2 = require("../prop-types");

var _issueishListView = _interopRequireDefault(require("../views/issueish-list-view"));

var _issueish = _interopRequireDefault(require("../models/issueish"));

var _electron = require("electron");

var _reporterProxy = require("../reporter-proxy");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const {
  Menu,
  MenuItem
} = _electron.remote;

const StatePropType = _propTypes.default.oneOf(['EXPECTED', 'PENDING', 'SUCCESS', 'ERROR', 'FAILURE']);

class BareIssueishListController extends _react.default.Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "openOnGitHub", async url => {
      await _electron.shell.openExternal(url);
      (0, _reporterProxy.addEvent)('open-issueish-in-browser', {
        package: 'github',
        component: this.constructor.name
      });
    });

    _defineProperty(this, "showActionsMenu",
    /* istanbul ignore next */
    issueish => {
      const menu = new Menu();
      menu.append(new MenuItem({
        label: 'See reviews',
        click: () => this.props.onOpenReviews(issueish)
      }));
      menu.append(new MenuItem({
        label: 'Open on GitHub',
        click: () => this.openOnGitHub(issueish.getGitHubURL())
      }));
      menu.popup(_electron.remote.getCurrentWindow());
    });

    this.state = {};
  }

  static getDerivedStateFromProps(props, state) {
    if (props.results === null) {
      return {
        lastResults: null,
        issueishes: []
      };
    }

    if (props.results !== state.lastResults) {
      return {
        lastResults: props.results,
        issueishes: props.results.map(node => new _issueish.default(node)).filter(props.resultFilter)
      };
    }

    return null;
  }

  render() {
    return _react.default.createElement(_issueishListView.default, {
      title: this.props.title,
      isLoading: this.props.isLoading,
      total: this.props.total,
      issueishes: this.state.issueishes,
      error: this.props.error,
      needReviewsButton: this.props.needReviewsButton,
      onIssueishClick: this.props.onOpenIssueish,
      onMoreClick: this.props.onOpenMore,
      openReviews: this.props.onOpenReviews,
      openOnGitHub: this.openOnGitHub,
      showActionsMenu: this.showActionsMenu,
      emptyComponent: this.props.emptyComponent
    });
  }

}

exports.BareIssueishListController = BareIssueishListController;

_defineProperty(BareIssueishListController, "propTypes", {
  results: _propTypes.default.arrayOf(_propTypes.default.shape({
    number: _propTypes.default.number.isRequired,
    title: _propTypes.default.string.isRequired,
    url: _propTypes.default.string.isRequired,
    author: _propTypes.default.shape({
      login: _propTypes.default.string.isRequired,
      avatarUrl: _propTypes.default.string.isRequired
    }),
    createdAt: _propTypes.default.string.isRequired,
    headRefName: _propTypes.default.string.isRequired,
    repository: _propTypes.default.shape({
      id: _propTypes.default.string.isRequired,
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }).isRequired,
    commits: _propTypes.default.shape({
      nodes: _propTypes.default.arrayOf(_propTypes.default.shape({
        commit: _propTypes.default.shape({
          status: _propTypes.default.shape({
            contexts: _propTypes.default.arrayOf(_propTypes.default.shape({
              state: StatePropType.isRequired
            }).isRequired).isRequired
          })
        })
      }))
    })
  })),
  total: _propTypes.default.number.isRequired,
  isLoading: _propTypes.default.bool.isRequired,
  title: _propTypes.default.string.isRequired,
  error: _propTypes.default.object,
  resultFilter: _propTypes.default.func,
  onOpenIssueish: _propTypes.default.func.isRequired,
  onOpenReviews: _propTypes.default.func.isRequired,
  onOpenMore: _propTypes.default.func,
  emptyComponent: _propTypes.default.func,
  endpoint: _propTypes2.EndpointPropType,
  needReviewsButton: _propTypes.default.bool
});

_defineProperty(BareIssueishListController, "defaultProps", {
  results: [],
  total: 0,
  resultFilter: () => true
});

var _default = (0, _reactRelay.createFragmentContainer)(BareIssueishListController, {
  results: function () {
    const node = require("./__generated__/issueishListController_results.graphql");

    if (node.hash && node.hash !== "af31b5400d8cce5026fc1bb3fc42dc91") {
      console.error("The definition of 'issueishListController_results' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
    }

    return require("./__generated__/issueishListController_results.graphql");
  }
});

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb250cm9sbGVycy9pc3N1ZWlzaC1saXN0LWNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiTWVudSIsIk1lbnVJdGVtIiwicmVtb3RlIiwiU3RhdGVQcm9wVHlwZSIsIlByb3BUeXBlcyIsIm9uZU9mIiwiQmFyZUlzc3VlaXNoTGlzdENvbnRyb2xsZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJ1cmwiLCJzaGVsbCIsIm9wZW5FeHRlcm5hbCIsInBhY2thZ2UiLCJjb21wb25lbnQiLCJuYW1lIiwiaXNzdWVpc2giLCJtZW51IiwiYXBwZW5kIiwibGFiZWwiLCJjbGljayIsIm9uT3BlblJldmlld3MiLCJvcGVuT25HaXRIdWIiLCJnZXRHaXRIdWJVUkwiLCJwb3B1cCIsImdldEN1cnJlbnRXaW5kb3ciLCJzdGF0ZSIsImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsInJlc3VsdHMiLCJsYXN0UmVzdWx0cyIsImlzc3VlaXNoZXMiLCJtYXAiLCJub2RlIiwiSXNzdWVpc2giLCJmaWx0ZXIiLCJyZXN1bHRGaWx0ZXIiLCJyZW5kZXIiLCJ0aXRsZSIsImlzTG9hZGluZyIsInRvdGFsIiwiZXJyb3IiLCJuZWVkUmV2aWV3c0J1dHRvbiIsIm9uT3Blbklzc3VlaXNoIiwib25PcGVuTW9yZSIsInNob3dBY3Rpb25zTWVudSIsImVtcHR5Q29tcG9uZW50IiwiYXJyYXlPZiIsInNoYXBlIiwibnVtYmVyIiwiaXNSZXF1aXJlZCIsInN0cmluZyIsImF1dGhvciIsImxvZ2luIiwiYXZhdGFyVXJsIiwiY3JlYXRlZEF0IiwiaGVhZFJlZk5hbWUiLCJyZXBvc2l0b3J5IiwiaWQiLCJvd25lciIsImNvbW1pdHMiLCJub2RlcyIsImNvbW1pdCIsInN0YXR1cyIsImNvbnRleHRzIiwiYm9vbCIsIm9iamVjdCIsImZ1bmMiLCJlbmRwb2ludCIsIkVuZHBvaW50UHJvcFR5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7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QUFVK0QsSUE1Q1Q7QUE2Q2pCQyxFQUFBQSxRQUFRLEVBQUVDLDRCQTdDTztBQThDakIzQixFQUFBQSxpQkFBaUIsRUFBRXRDLG1CQUFVNkQ7QUE5Q1osQzs7Z0JBRFIzRCwwQixrQkFrRFc7QUFDcEJ1QixFQUFBQSxPQUFPLEVBQUUsRUFEVztBQUVwQlcsRUFBQUEsS0FBSyxFQUFFLENBRmE7QUFHcEJKLEVBQUFBLFlBQVksRUFBRSxNQUFNO0FBSEEsQzs7ZUF1RVQseUNBQXdCOUIsMEJBQXhCLEVBQW9EO0FBQ2pFdUIsRUFBQUEsT0FBTztBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBRDBELENBQXBELEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7Z3JhcGhxbCwgY3JlYXRlRnJhZ21lbnRDb250YWluZXJ9IGZyb20gJ3JlYWN0LXJlbGF5JztcbmltcG9ydCB7RW5kcG9pbnRQcm9wVHlwZX0gZnJvbSAnLi4vcHJvcC10eXBlcyc7XG5pbXBvcnQgSXNzdWVpc2hMaXN0VmlldyBmcm9tICcuLi92aWV3cy9pc3N1ZWlzaC1saXN0LXZpZXcnO1xuaW1wb3J0IElzc3VlaXNoIGZyb20gJy4uL21vZGVscy9pc3N1ZWlzaCc7XG5pbXBvcnQge3NoZWxsLCByZW1vdGV9IGZyb20gJ2VsZWN0cm9uJztcbmNvbnN0IHtNZW51LCBNZW51SXRlbX0gPSByZW1vdGU7XG5pbXBvcnQge2FkZEV2ZW50fSBmcm9tICcuLi9yZXBvcnRlci1wcm94eSc7XG5cbmNvbnN0IFN0YXRlUHJvcFR5cGUgPSBQcm9wVHlwZXMub25lT2YoWydFWFBFQ1RFRCcsICdQRU5ESU5HJywgJ1NVQ0NFU1MnLCAnRVJST1InLCAnRkFJTFVSRSddKTtcblxuZXhwb3J0IGNsYXNzIEJhcmVJc3N1ZWlzaExpc3RDb250cm9sbGVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICByZXN1bHRzOiBQcm9wVHlwZXMuYXJyYXlPZihcbiAgICAgIFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIG51bWJlcjogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgICAgICB0aXRsZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICB1cmw6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgYXV0aG9yOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICAgIGxvZ2luOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgICAgYXZhdGFyVXJsOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIH0pLFxuICAgICAgICBjcmVhdGVkQXQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgaGVhZFJlZk5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgcmVwb3NpdG9yeTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICBpZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgICBvd25lcjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICAgIGxvZ2luOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICAgICAgY29tbWl0czogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICBub2RlczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICAgIGNvbW1pdDogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICAgICAgc3RhdHVzOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICAgICAgICAgIGNvbnRleHRzOiBQcm9wVHlwZXMuYXJyYXlPZihcbiAgICAgICAgICAgICAgICAgIFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlOiBTdGF0ZVByb3BUeXBlLmlzUmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICB9KS5pc1JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICkuaXNSZXF1aXJlZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSksXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgKSxcbiAgICB0b3RhbDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgIGlzTG9hZGluZzogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICB0aXRsZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGVycm9yOiBQcm9wVHlwZXMub2JqZWN0LFxuXG4gICAgcmVzdWx0RmlsdGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbk9wZW5Jc3N1ZWlzaDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbk9wZW5SZXZpZXdzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uT3Blbk1vcmU6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgZW1wdHlDb21wb25lbnQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIGVuZHBvaW50OiBFbmRwb2ludFByb3BUeXBlLFxuICAgIG5lZWRSZXZpZXdzQnV0dG9uOiBQcm9wVHlwZXMuYm9vbCxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHJlc3VsdHM6IFtdLFxuICAgIHRvdGFsOiAwLFxuICAgIHJlc3VsdEZpbHRlcjogKCkgPT4gdHJ1ZSxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHt9O1xuICB9XG5cbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHtcbiAgICBpZiAocHJvcHMucmVzdWx0cyA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGFzdFJlc3VsdHM6IG51bGwsXG4gICAgICAgIGlzc3VlaXNoZXM6IFtdLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAocHJvcHMucmVzdWx0cyAhPT0gc3RhdGUubGFzdFJlc3VsdHMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhc3RSZXN1bHRzOiBwcm9wcy5yZXN1bHRzLFxuICAgICAgICBpc3N1ZWlzaGVzOiBwcm9wcy5yZXN1bHRzLm1hcChub2RlID0+IG5ldyBJc3N1ZWlzaChub2RlKSkuZmlsdGVyKHByb3BzLnJlc3VsdEZpbHRlciksXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgb3Blbk9uR2l0SHViID0gYXN5bmMgdXJsID0+IHtcbiAgICBhd2FpdCBzaGVsbC5vcGVuRXh0ZXJuYWwodXJsKTtcbiAgICBhZGRFdmVudCgnb3Blbi1pc3N1ZWlzaC1pbi1icm93c2VyJywge3BhY2thZ2U6ICdnaXRodWInLCBjb21wb25lbnQ6IHRoaXMuY29uc3RydWN0b3IubmFtZX0pO1xuICB9XG5cbiAgc2hvd0FjdGlvbnNNZW51ID0gLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gaXNzdWVpc2ggPT4ge1xuICAgIGNvbnN0IG1lbnUgPSBuZXcgTWVudSgpO1xuXG4gICAgbWVudS5hcHBlbmQobmV3IE1lbnVJdGVtKHtcbiAgICAgIGxhYmVsOiAnU2VlIHJldmlld3MnLFxuICAgICAgY2xpY2s6ICgpID0+IHRoaXMucHJvcHMub25PcGVuUmV2aWV3cyhpc3N1ZWlzaCksXG4gICAgfSkpO1xuXG4gICAgbWVudS5hcHBlbmQobmV3IE1lbnVJdGVtKHtcbiAgICAgIGxhYmVsOiAnT3BlbiBvbiBHaXRIdWInLFxuICAgICAgY2xpY2s6ICgpID0+IHRoaXMub3Blbk9uR2l0SHViKGlzc3VlaXNoLmdldEdpdEh1YlVSTCgpKSxcbiAgICB9KSk7XG5cbiAgICBtZW51LnBvcHVwKHJlbW90ZS5nZXRDdXJyZW50V2luZG93KCkpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8SXNzdWVpc2hMaXN0Vmlld1xuICAgICAgICB0aXRsZT17dGhpcy5wcm9wcy50aXRsZX1cbiAgICAgICAgaXNMb2FkaW5nPXt0aGlzLnByb3BzLmlzTG9hZGluZ31cbiAgICAgICAgdG90YWw9e3RoaXMucHJvcHMudG90YWx9XG4gICAgICAgIGlzc3VlaXNoZXM9e3RoaXMuc3RhdGUuaXNzdWVpc2hlc31cbiAgICAgICAgZXJyb3I9e3RoaXMucHJvcHMuZXJyb3J9XG4gICAgICAgIG5lZWRSZXZpZXdzQnV0dG9uPXt0aGlzLnByb3BzLm5lZWRSZXZpZXdzQnV0dG9ufVxuICAgICAgICBvbklzc3VlaXNoQ2xpY2s9e3RoaXMucHJvcHMub25PcGVuSXNzdWVpc2h9XG4gICAgICAgIG9uTW9yZUNsaWNrPXt0aGlzLnByb3BzLm9uT3Blbk1vcmV9XG4gICAgICAgIG9wZW5SZXZpZXdzPXt0aGlzLnByb3BzLm9uT3BlblJldmlld3N9XG4gICAgICAgIG9wZW5PbkdpdEh1Yj17dGhpcy5vcGVuT25HaXRIdWJ9XG4gICAgICAgIHNob3dBY3Rpb25zTWVudT17dGhpcy5zaG93QWN0aW9uc01lbnV9XG4gICAgICAgIGVtcHR5Q29tcG9uZW50PXt0aGlzLnByb3BzLmVtcHR5Q29tcG9uZW50fVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUZyYWdtZW50Q29udGFpbmVyKEJhcmVJc3N1ZWlzaExpc3RDb250cm9sbGVyLCB7XG4gIHJlc3VsdHM6IGdyYXBocWxgXG4gICAgZnJhZ21lbnQgaXNzdWVpc2hMaXN0Q29udHJvbGxlcl9yZXN1bHRzIG9uIFB1bGxSZXF1ZXN0XG4gICAgQHJlbGF5KHBsdXJhbDogdHJ1ZSlcbiAgICBAYXJndW1lbnREZWZpbml0aW9ucyhcbiAgICAgIGNoZWNrU3VpdGVDb3VudDoge3R5cGU6IFwiSW50IVwifVxuICAgICAgY2hlY2tTdWl0ZUN1cnNvcjoge3R5cGU6IFwiU3RyaW5nXCJ9XG4gICAgICBjaGVja1J1bkNvdW50OiB7dHlwZTogXCJJbnQhXCJ9XG4gICAgICBjaGVja1J1bkN1cnNvcjoge3R5cGU6IFwiU3RyaW5nXCJ9XG4gICAgKSB7XG4gICAgICBudW1iZXJcbiAgICAgIHRpdGxlXG4gICAgICB1cmxcbiAgICAgIGF1dGhvciB7XG4gICAgICAgIGxvZ2luXG4gICAgICAgIGF2YXRhclVybFxuICAgICAgfVxuICAgICAgY3JlYXRlZEF0XG4gICAgICBoZWFkUmVmTmFtZVxuXG4gICAgICByZXBvc2l0b3J5IHtcbiAgICAgICAgaWRcbiAgICAgICAgbmFtZVxuICAgICAgICBvd25lciB7XG4gICAgICAgICAgbG9naW5cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb21taXRzKGxhc3Q6MSkge1xuICAgICAgICBub2RlcyB7XG4gICAgICAgICAgY29tbWl0IHtcbiAgICAgICAgICAgIHN0YXR1cyB7XG4gICAgICAgICAgICAgIGNvbnRleHRzIHtcbiAgICAgICAgICAgICAgICBpZFxuICAgICAgICAgICAgICAgIHN0YXRlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLi4uY2hlY2tTdWl0ZXNBY2N1bXVsYXRvcl9jb21taXQgQGFyZ3VtZW50cyhcbiAgICAgICAgICAgICAgY2hlY2tTdWl0ZUNvdW50OiAkY2hlY2tTdWl0ZUNvdW50XG4gICAgICAgICAgICAgIGNoZWNrU3VpdGVDdXJzb3I6ICRjaGVja1N1aXRlQ3Vyc29yXG4gICAgICAgICAgICAgIGNoZWNrUnVuQ291bnQ6ICRjaGVja1J1bkNvdW50XG4gICAgICAgICAgICAgIGNoZWNrUnVuQ3Vyc29yOiAkY2hlY2tSdW5DdXJzb3JcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIGAsXG59KTtcbiJdfQ==